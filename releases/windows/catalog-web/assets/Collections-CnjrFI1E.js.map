{"version":3,"mappings":"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","names":["Textarea","label","value","onChange","placeholder","rows","className","disabled","error","cn","jsx","Switch","checked","onCheckedChange","handleToggle","COLLECTION_FIELD_OPTIONS","COLLECTION_OPERATORS","MEDIA_TYPE_OPTIONS","QUALITY_OPTIONS","GENRE_OPTIONS","DECADE_OPTIONS","RESOLUTION_OPTIONS","LANGUAGE_OPTIONS","COLLECTION_TEMPLATES","getFieldOptions","fieldType","getFieldLabel","fieldValue","field","f","getFieldType","validateRule","rule","errors","v","validateRules","rules","allErrors","index","ruleErrors","FIELD_ICONS","Music","Film","Image","FileText","TEMPLATE_ICONS","Clock","Star","Heart","HardDrive","Mic","Play","SmartCollectionBuilder","initialName","initialDescription","initialRules","onSave","onCancel","name","setName","useState","description","setDescription","setRules","expandedRules","setExpandedRules","showTemplates","setShowTemplates","showAdvanced","setShowAdvanced","testResults","setTestResults","isTesting","setIsTesting","generateRuleId","useEffect","addRule","parentId","newRule","prev","removeRule","ruleId","removeNestedRules","updateRule","updates","updateNestedRules","validFieldType","updatedRule","loadTemplate","template","rulesWithIds","toast","duplicateRule","originalRule","r","ruleIndex","duplicatedRule","newRules","testRules","resolve","handleSave","renderRule","level","parentRule","operators","fieldOptions","jsxs","motion","Select","Input","e","Button","Copy","Plus","Trash2","nestedRule","Zap","X","Lightbulb","ChevronUp","ChevronDown","AnimatePresence","IconComponent","Filter","TestTube","item","React","Save","MOCK_COLLECTIONS","MOCK_SMART_COLLECTIONS","MOCK_TEMPLATES","MOCK_ANALYTICS","mockCollectionsApi","id","collection","c","data","newCollection","_a","newSmartCollection","collectionId","analytics","a","CollectionsApi","__publicField","apiCall","mockCall","api","page","limit","mockItems","_","i","shareRequest","shareId","format","file","formData","text","newName","original","itemIds","collectionIds","results","mockShareInfo","collections","action","duplicate","updated","collectionsApi","useCollections","queryClient","useQueryClient","isLoading","refetchCollections","useQuery","createCollectionMutation","useMutation","updateCollectionMutation","updatedCollection","deleteCollectionMutation","refreshCollectionMutation","refreshedCollection","shareCollectionMutation","shareInfo","duplicateCollectionMutation","duplicatedCollection","exportCollectionMutation","blob","url","bulkDeleteCollectionsMutation","bulkShareCollectionsMutation","bulkExportCollectionsMutation","bulkUpdateCollectionsMutation","useCollection","refetchCollection","collectionItems","isLoadingItems","refetchItems","MEDIA_ICONS","formatDuration","seconds","minutes","secs","formatFileSize","bytes","units","size","unitIndex","renderStars","rating","star","CollectionPreview","onClose","onPlayItem","onPreviewItem","onViewAllItems","hoveredItem","setHoveredItem","selectedItems","setSelectedItems","handleItemSelect","itemId","event","newSelected","handlePlayItem","handlePreviewItem","handleDownloadItem","items","totalItems","Icon","isHovered","isSelected","Pause","Volume2","Download","MoreHorizontal","Eye","BulkOperations","selectedCollections","onOperation","showActions","setShowActions","selectedAction","setSelectedAction","actionOptions","setActionOptions","showConfirmation","setShowConfirmation","isActionInProgress","setIsActionInProgress","bulkActions","Share2","ShareOptions","ExportOptions","DuplicateOptions","Tag","TagOptions","Archive","ArchiveOptions","FolderOpen","MoveOptions","handleActionSelect","actionId","executeAction","options","handleConfirmAction","getActionIcon","getActionDescription","DeleteOptions","_b","tag","PerformanceOptimizer","children","itemCount","threshold","loadingStrategy","itemHeight","containerHeight","onVisibleItemsChange","containerRef","useRef","visibleRange","setVisibleRange","scrollTop","setScrollTop","isIntersecting","setIsIntersecting","loadedItems","setLoadedItems","observerRef","calculateVisibleRange","useCallback","startIndex","endIndex","handleScroll","newScrollTop","newRange","entries","entry","container","timeoutId","debouncedScroll","renderVirtualizedItems","totalHeight","child","top","renderLazyItems","isLoaded","renderPaginatedItems","shouldOptimize","renderItems","DEFAULT_PREFERENCES","VIEW_SIZE_OPTIONS","ITEMS_PER_PAGE_OPTIONS","REFRESH_INTERVAL_OPTIONS","DOWNLOAD_QUALITY_OPTIONS","SORT_OPTIONS","GROUP_BY_OPTIONS","CollectionSettings","preferences","setPreferences","isSaving","setIsSaving","activeTab","setActiveTab","hasChanges","setHasChanges","savedPrefs","parsed","savePreferences","updatePreference","key","updateNestedPreference","path","parent","tabs","Layout","Settings","Shield","tab","isActive","Grid","List","count","interval","FileAudio","FileVideo","FileImage","TIME_RANGES","CHART_TYPES","CollectionAnalytics","timeRange","setTimeRange","chartType","setChartType","setIsLoading","showComparison","setShowComparison","itemsLoading","analyticsData","useMemo","totalSize","sum","averageRating","generateActivityData","period","now","periods","date","mediaTypes","acc","type","topItems","b","k","sizes","hours","handleExportAnalytics","csv","StatCard","title","change","changeType","TrendingUp","TrendingDown","renderOverview","BarChart3","Card","total","percentage","renderActivity","renderSharing","Link","Mail","MessageCircle","Upload","referrer","renderContent","renderEngagement","Activity","Users","RefreshCw","DownloadIcon","Fragment","EXPIRY_OPTIONS","PERMISSION_LEVELS","SHARE_METHODS","QrCode","CollectionSharing","onShareUpdate","shareLinks","setShareLinks","isCreating","setIsCreating","selectedPermission","setSelectedPermission","expiryTime","setExpiryTime","requirePassword","setRequirePassword","password","setPassword","allowAnonymous","setAllowAnonymous","maxDownloads","setMaxDownloads","emailRecipients","setEmailRecipients","customMessage","setCustomMessage","embedSize","setEmbedSize","isRealTimeEnabled","setIsRealTimeEnabled","connectionStatus","setConnectionStatus","mockLinks","timer","generateShareLink","newLink","copyToClipboard","revokeShare","link","deleteShare","sendEmailInvites","emails","getEmbedCode","generateQRCode","shareUrl","ShareLinkCard","ExternalLink","EyeOff","Wifi","WifiOff","method","p","EXPORT_FORMATS","FileJson","FileSpreadsheet","File","COMPRESSION_OPTIONS","FILE_TYPES","CollectionExport","exportOptions","setExportOptions","importOptions","setImportOptions","isExporting","setIsExporting","isImporting","setIsImporting","exportProgress","setExportProgress","importPreview","setImportPreview","importFile","setImportFile","searchTerm","setSearchTerm","selectedFields","setSelectedFields","fileInputRef","selectedFormat","handleExport","exportData","filename","mimeType","content","handleImportFile","reader","parsedContent","lines","headers","line","values","obj","header","preview","_c","_d","handleImport","FormatCard","onClick","ext","t","EVENT_ICONS","UserPlus","UserMinus","FilePlus","FileMinus","Edit","MessageSquare","EVENT_DESCRIPTIONS","userName","itemTitle","CollectionRealTime","isConnected","setIsConnected","onlineUsers","setOnlineUsers","recentEvents","setRecentEvents","notificationsEnabled","setNotificationsEnabled","notificationSettings","setNotificationSettings","showUserList","setShowUserList","showEventHistory","setShowEventHistory","activityStats","setActivityStats","reconnectTimeoutRef","heartbeatIntervalRef","connectWebSocket","mockUsers","mockEvents","disconnectWebSocket","toggleConnection","eventTypes","randomType","newEvent","getEventCategory","getEventDescription","audio","eventType","descriptionFn","formatTimestamp","timestamp","diffMs","diffMins","diffHours","requestDesktopNotifications","EventItem","OnlineUserItem","user","Bell","BellOff","CollectionTemplates","lazy","AdvancedSearch","CollectionAutomation","ExternalIntegrations","__vitePreload","SmartCollectionBuilder$1","m","CollectionAnalytics$1","BulkOperations$1","preloadComponent","componentName","MemoCacheManager","maxSize","cleanupIntervalMs","ttl","oldestKey","oldest","current","globalCache","useMemoized","computation","dependencies","cacheKey","dep","computedValue","cachedValue","useOptimizedData","filters","sortBy","sortDirection","result","itemValue","aVal","bVal","usePagination","itemsPerPage","currentPage","setPage","paginatedData","totalPages","hasNextPage","hasPrevPage","nextPage","prevPage","goToPage","targetPage","COLLECTIONS_TABS","VIEW_OPTIONS","Collections","searchQuery","setSearchQuery","filterMediaType","setFilterMediaType","setSortBy","viewMode","setViewMode","showSmartBuilder","setShowSmartBuilder","selectedCollection","setSelectedCollection","previewCollection","setPreviewCollection","setSelectedCollections","showBulkOperations","setShowBulkOperations","showSettings","setShowSettings","showAnalytics","setShowAnalytics","showSharing","setShowSharing","showExport","setShowExport","showRealTime","setShowRealTime","showAdvancedSearch","setShowAdvancedSearch","showAutomation","setShowAutomation","showIntegrations","setShowIntegrations","showAI","setShowAI","selectAll","setSelectAll","performanceMetrics","setPerformanceMetrics","measurePerformance","startTime","duration","createCollection","updateCollection","deleteCollection","shareCollection","duplicateCollection","bulkDeleteCollections","bulkShareCollections","bulkExportCollections","bulkUpdateCollections","isSharing","isDuplicating","debouncedSearch","setDebouncedSearch","isDebouncing","setIsDebouncing","filteredCollections","paginatedCollections","handleSearchChange","endPerformance","handleSelectCollection","selected","handleSelectAll","handleClearSelection","handlePreviewCollection","handleClosePreview","handleOpenSettings","handleCreateSmartCollection","handleSaveSmartCollection","handleShareCollection","handleDuplicateCollection","handleDeleteCollection","handleBulkOperation","operation","handleShowAnalytics","handleShowSharing","handleShowExport","handleShowRealTime","handleShowTemplates","handleShowAdvancedSearch","handleShowAutomation","handleShowIntegrations","handleShowAI","handleAISuggestionAccept","suggestion","handleAINaturalSearch","query","handleAICategorizationComplete","handleAIActionImplement","handleAIPredictionAction","predictionId","handleAIOrganizationApply","suggestionId","handleAIMetadataExtracted","metadata","handleAIRuleToggle","enabled","handleAIRuleExecute","handleAIQualityImprovement","improvement","renderCollectionCard","CheckSquare","Share","renderCollectionListItem","collectionName","Brain","Sparkles","AICollectionSuggestions","AINaturalSearch","AIContentCategorizer","AIUserBehaviorAnalytics","AIPredictions","AISmartOrganization","AIMetadataExtractor","AIContentQualityAnalyzer","AIAutomationRules","Database","Tabs","Search","Loader2","option","Bot","pageNum","settings"],"ignoreList":[],"sources":["../../src/components/ui/Textarea.tsx","../../src/components/ui/Switch.tsx","../../src/lib/collectionRules.ts","../../src/components/collections/SmartCollectionBuilder.tsx","../../src/lib/mockCollectionsApi.ts","../../src/lib/collectionsApi.ts","../../src/hooks/useCollections.ts","../../src/components/collections/CollectionPreview.tsx","../../src/components/collections/BulkOperations.tsx","../../src/components/collections/PerformanceOptimizer.tsx","../../src/components/collections/CollectionSettings.tsx","../../src/components/collections/CollectionAnalytics.tsx","../../src/components/collections/CollectionSharing.tsx","../../src/components/collections/CollectionExport.tsx","../../src/components/collections/CollectionRealTime.tsx","../../src/components/performance/LazyComponents.tsx","../../src/components/performance/MemoCache.tsx","../../src/pages/Collections.tsx"],"sourcesContent":["import React from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface TextareaProps {\n  label?: string;\n  value?: string;\n  onChange?: (e: React.ChangeEvent<HTMLTextAreaElement>) => void;\n  placeholder?: string;\n  rows?: number;\n  className?: string;\n  disabled?: boolean;\n  error?: string;\n}\n\nexport const Textarea: React.FC<TextareaProps> = ({\n  label,\n  value = '',\n  onChange,\n  placeholder,\n  rows = 4,\n  className = '',\n  disabled = false,\n  error,\n}) => {\n  return (\n    <div className={cn('mb-4', className)}>\n      {label && (\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          {label}\n        </label>\n      )}\n      <textarea\n        value={value}\n        onChange={onChange}\n        placeholder={placeholder}\n        rows={rows}\n        disabled={disabled}\n        className={cn(\n          'w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg',\n          'focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent',\n          'bg-white dark:bg-gray-800 text-gray-900 dark:text-white',\n          'resize-none',\n          disabled && 'opacity-50 cursor-not-allowed',\n          error && 'border-red-500 focus:ring-red-500',\n          className\n        )}\n      />\n      {error && (\n        <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">{error}</p>\n      )}\n    </div>\n  );\n};","import React from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface SwitchProps {\n  checked?: boolean;\n  onCheckedChange?: (checked: boolean) => void;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport const Switch: React.FC<SwitchProps> = ({\n  checked = false,\n  onCheckedChange,\n  disabled = false,\n  className = ''\n}) => {\n  const handleToggle = () => {\n    if (!disabled && onCheckedChange) {\n      onCheckedChange(!checked);\n    }\n  };\n\n  return (\n    <button\n      type=\"button\"\n      role=\"switch\"\n      aria-checked={checked}\n      disabled={disabled}\n      onClick={handleToggle}\n      className={cn(\n        'relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2',\n        checked\n          ? 'bg-blue-600 dark:bg-blue-500'\n          : 'bg-gray-200 dark:bg-gray-700',\n        disabled && 'opacity-50 cursor-not-allowed',\n        className\n      )}\n    >\n      <span\n        className={cn(\n          'inline-block h-4 w-4 transform rounded-full bg-white transition-transform',\n          checked ? 'translate-x-6' : 'translate-x-1'\n        )}\n      />\n    </button>\n  );\n};","import { CollectionRule, CollectionTemplate, CollectionTemplateRule } from '../types/collections';\n\nexport const COLLECTION_FIELD_OPTIONS = [\n  { value: 'title', label: 'Title', type: 'text' },\n  { value: 'artist', label: 'Artist', type: 'text' },\n  { value: 'album', label: 'Album', type: 'text' },\n  { value: 'genre', label: 'Genre', type: 'select' },\n  { value: 'year', label: 'Year', type: 'number' },\n  { value: 'decade', label: 'Decade', type: 'select' },\n  { value: 'duration', label: 'Duration', type: 'number' },\n  { value: 'file_size', label: 'File Size', type: 'number' },\n  { value: 'media_type', label: 'Media Type', type: 'select' },\n  { value: 'quality', label: 'Quality', type: 'select' },\n  { value: 'rating', label: 'Rating', type: 'number' },\n  { value: 'play_count', label: 'Play Count', type: 'number' },\n  { value: 'last_played', label: 'Last Played', type: 'date' },\n  { value: 'date_added', label: 'Date Added', type: 'date' },\n  { value: 'date_modified', label: 'Date Modified', type: 'date' },\n  { value: 'file_extension', label: 'File Extension', type: 'text' },\n  { value: 'bitrate', label: 'Bitrate', type: 'number' },\n  { value: 'resolution', label: 'Resolution', type: 'select' },\n  { value: 'fps', label: 'Frame Rate', type: 'number' },\n  { value: 'channels', label: 'Audio Channels', type: 'number' },\n  { value: 'language', label: 'Language', type: 'select' },\n  { value: 'subtitles', label: 'Has Subtitles', type: 'boolean' },\n  { value: 'is_favorite', label: 'Is Favorite', type: 'boolean' },\n  { value: 'tags', label: 'Tags', type: 'multiselect' },\n];\n\nexport const COLLECTION_OPERATORS = {\n  text: [\n    { value: 'contains', label: 'contains' },\n    { value: 'equals', label: 'equals' },\n    { value: 'starts_with', label: 'starts with' },\n    { value: 'ends_with', label: 'ends with' },\n    { value: 'not_contains', label: 'does not contain' },\n    { value: 'not_equals', label: 'does not equal' },\n    { value: 'is_empty', label: 'is empty' },\n    { value: 'is_not_empty', label: 'is not empty' },\n  ],\n  number: [\n    { value: 'equals', label: 'equals' },\n    { value: 'not_equals', label: 'does not equal' },\n    { value: 'greater_than', label: 'greater than' },\n    { value: 'less_than', label: 'less than' },\n    { value: 'greater_or_equal', label: 'greater than or equal to' },\n    { value: 'less_or_equal', label: 'less than or equal to' },\n    { value: 'between', label: 'between' },\n    { value: 'not_between', label: 'not between' },\n    { value: 'is_empty', label: 'is empty' },\n    { value: 'is_not_empty', label: 'is not empty' },\n  ],\n  date: [\n    { value: 'equals', label: 'equals' },\n    { value: 'not_equals', label: 'does not equal' },\n    { value: 'after', label: 'after' },\n    { value: 'before', label: 'before' },\n    { value: 'between', label: 'between' },\n    { value: 'not_between', label: 'not between' },\n    { value: 'today', label: 'is today' },\n    { value: 'yesterday', label: 'is yesterday' },\n    { value: 'this_week', label: 'is this week' },\n    { value: 'this_month', label: 'is this month' },\n    { value: 'this_year', label: 'is this year' },\n    { value: 'last_7_days', label: 'in last 7 days' },\n    { value: 'last_30_days', label: 'in last 30 days' },\n    { value: 'last_90_days', label: 'in last 90 days' },\n  ],\n  select: [\n    { value: 'equals', label: 'equals' },\n    { value: 'not_equals', label: 'does not equal' },\n    { value: 'is_any', label: 'is any of' },\n    { value: 'is_not_any', label: 'is not any of' },\n    { value: 'is_empty', label: 'is empty' },\n    { value: 'is_not_empty', label: 'is not empty' },\n  ],\n  multiselect: [\n    { value: 'contains_all', label: 'contains all' },\n    { value: 'contains_any', label: 'contains any' },\n    { value: 'contains_none', label: 'contains none' },\n    { value: 'is_empty', label: 'is empty' },\n    { value: 'is_not_empty', label: 'is not empty' },\n  ],\n  boolean: [\n    { value: 'is_true', label: 'is true' },\n    { value: 'is_false', label: 'is false' },\n  ],\n};\n\nexport const MEDIA_TYPE_OPTIONS = [\n  { value: 'music', label: 'Music' },\n  { value: 'video', label: 'Video' },\n  { value: 'image', label: 'Image' },\n  { value: 'document', label: 'Document' },\n];\n\nexport const QUALITY_OPTIONS = [\n  { value: 'sd', label: 'SD (Standard Definition)' },\n  { value: 'hd', label: 'HD (High Definition)' },\n  { value: 'fhd', label: 'FHD (Full HD)' },\n  { value: 'uhd', label: 'UHD (4K)' },\n  { value: '8k', label: '8K' },\n];\n\nexport const GENRE_OPTIONS = [\n  { value: 'rock', label: 'Rock' },\n  { value: 'pop', label: 'Pop' },\n  { value: 'jazz', label: 'Jazz' },\n  { value: 'classical', label: 'Classical' },\n  { value: 'electronic', label: 'Electronic' },\n  { value: 'hip_hop', label: 'Hip Hop' },\n  { value: 'country', label: 'Country' },\n  { value: 'blues', label: 'Blues' },\n  { value: 'reggae', label: 'Reggae' },\n  { value: 'metal', label: 'Metal' },\n];\n\nexport const DECADE_OPTIONS = [\n  { value: '1950s', label: '1950s' },\n  { value: '1960s', label: '1960s' },\n  { value: '1970s', label: '1970s' },\n  { value: '1980s', label: '1980s' },\n  { value: '1990s', label: '1990s' },\n  { value: '2000s', label: '2000s' },\n  { value: '2010s', label: '2010s' },\n  { value: '2020s', label: '2020s' },\n];\n\nexport const RESOLUTION_OPTIONS = [\n  { value: '480p', label: '480p' },\n  { value: '720p', label: '720p' },\n  { value: '1080p', label: '1080p' },\n  { value: '1440p', label: '1440p' },\n  { value: '2160p', label: '2160p (4K)' },\n  { value: '4320p', label: '4320p (8K)' },\n];\n\nexport const LANGUAGE_OPTIONS = [\n  { value: 'en', label: 'English' },\n  { value: 'es', label: 'Spanish' },\n  { value: 'fr', label: 'French' },\n  { value: 'de', label: 'German' },\n  { value: 'it', label: 'Italian' },\n  { value: 'pt', label: 'Portuguese' },\n  { value: 'ru', label: 'Russian' },\n  { value: 'ja', label: 'Japanese' },\n  { value: 'zh', label: 'Chinese' },\n  { value: 'ko', label: 'Korean' },\n];\n\nexport const COLLECTION_TEMPLATES: CollectionTemplate[] = [\n  {\n    id: 'recently_added',\n    name: 'Recently Added',\n    description: 'Items added in the last 30 days',\n    category: 'Time-based',\n    rules: [\n      {\n        field: 'date_added',\n        operator: 'last_30_days',\n        value: null,\n        field_type: 'date',\n        label: 'Date Added',\n      },\n    ],\n    icon: 'Clock',\n  },\n  {\n    id: 'high_rated',\n    name: 'High Rated',\n    description: 'Items with rating 4 stars or higher',\n    category: 'Quality-based',\n    rules: [\n      {\n        field: 'rating',\n        operator: 'greater_or_equal',\n        value: 4,\n        field_type: 'number',\n        label: 'Rating',\n      },\n    ],\n    icon: 'Star',\n  },\n  {\n    id: 'hd_movies',\n    name: 'HD Movies',\n    description: 'High definition video content',\n    category: 'Quality-based',\n    rules: [\n      {\n        field: 'media_type',\n        operator: 'equals',\n        value: 'video',\n        field_type: 'select',\n        label: 'Media Type',\n      },\n      {\n        field: 'quality',\n        operator: 'is_any',\n        value: ['hd', 'fhd', 'uhd', '8k'],\n        field_type: 'select',\n        label: 'Quality',\n        condition: 'AND',\n      },\n    ],\n    icon: 'Film',\n  },\n  {\n    id: 'music_classics',\n    name: 'Music Classics',\n    description: 'Classic music from before the year 2000',\n    category: 'Genre-based',\n    rules: [\n      {\n        field: 'media_type',\n        operator: 'equals',\n        value: 'music',\n        field_type: 'select',\n        label: 'Media Type',\n      },\n      {\n        field: 'year',\n        operator: 'less_than',\n        value: 2000,\n        field_type: 'number',\n        label: 'Year',\n        condition: 'AND',\n      },\n    ],\n    icon: 'Music',\n  },\n  {\n    id: 'favorites',\n    name: 'My Favorites',\n    description: 'All items marked as favorites',\n    category: 'Personal',\n    rules: [\n      {\n        field: 'is_favorite',\n        operator: 'is_true',\n        value: null,\n        field_type: 'boolean',\n        label: 'Is Favorite',\n      },\n    ],\n    icon: 'Heart',\n  },\n  {\n    id: 'large_files',\n    name: 'Large Files',\n    description: 'Files larger than 1GB',\n    category: 'Size-based',\n    rules: [\n      {\n        field: 'file_size',\n        operator: 'greater_than',\n        value: 1073741824, // 1GB in bytes\n        field_type: 'number',\n        label: 'File Size',\n      },\n    ],\n    icon: 'HardDrive',\n  },\n  {\n    id: 'rock_music',\n    name: 'Rock Music Collection',\n    description: 'All rock music tracks',\n    category: 'Genre-based',\n    rules: [\n      {\n        field: 'media_type',\n        operator: 'equals',\n        value: 'music',\n        field_type: 'select',\n        label: 'Media Type',\n      },\n      {\n        field: 'genre',\n        operator: 'equals',\n        value: 'rock',\n        field_type: 'select',\n        label: 'Genre',\n        condition: 'AND',\n      },\n    ],\n    icon: 'Guitar',\n  },\n  {\n    id: 'recently_played',\n    name: 'Recently Played',\n    description: 'Items played in the last 7 days',\n    category: 'Activity-based',\n    rules: [\n      {\n        field: 'last_played',\n        operator: 'last_7_days',\n        value: null,\n        field_type: 'date',\n        label: 'Last Played',\n      },\n    ],\n    icon: 'Play',\n  },\n];\n\nexport const getFieldOptions = (fieldType: string) => {\n  switch (fieldType) {\n    case 'media_type':\n      return MEDIA_TYPE_OPTIONS;\n    case 'quality':\n      return QUALITY_OPTIONS;\n    case 'genre':\n      return GENRE_OPTIONS;\n    case 'decade':\n      return DECADE_OPTIONS;\n    case 'resolution':\n      return RESOLUTION_OPTIONS;\n    case 'language':\n      return LANGUAGE_OPTIONS;\n    case 'tags':\n      return [\n        { value: 'favorite', label: 'Favorite' },\n        { value: 'downloaded', label: 'Downloaded' },\n        { value: 'watched', label: 'Watched' },\n        { value: 'listened', label: 'Listened' },\n      ];\n    default:\n      return [];\n  }\n};\n\nexport const getFieldLabel = (fieldValue: string) => {\n  const field = COLLECTION_FIELD_OPTIONS.find(f => f.value === fieldValue);\n  return field?.label || fieldValue;\n};\n\nexport const getFieldType = (fieldValue: string) => {\n  const field = COLLECTION_FIELD_OPTIONS.find(f => f.value === fieldValue);\n  return field?.type || 'text';\n};\n\nexport const validateRule = (rule: CollectionRule): string[] => {\n  const errors: string[] = [];\n  \n  if (!rule.field) {\n    errors.push('Field is required');\n  }\n  \n  if (!rule.operator) {\n    errors.push('Operator is required');\n  }\n  \n  const fieldType = getFieldType(rule.field);\n  \n  // Check value requirements based on operator\n  if (rule.operator !== 'is_empty' && \n      rule.operator !== 'is_not_empty' && \n      rule.operator !== 'is_true' && \n      rule.operator !== 'is_false' &&\n      rule.operator !== 'today' &&\n      rule.operator !== 'yesterday' &&\n      rule.operator !== 'this_week' &&\n      rule.operator !== 'this_month' &&\n      rule.operator !== 'this_year' &&\n      rule.operator !== 'last_7_days' &&\n      rule.operator !== 'last_30_days' &&\n      rule.operator !== 'last_90_days') {\n    \n    if (rule.value === null || rule.value === undefined || rule.value === '') {\n      errors.push('Value is required for this operator');\n    }\n  }\n  \n  // Type-specific validation\n  if (fieldType === 'number' && rule.value !== null && rule.value !== undefined) {\n    if (isNaN(Number(rule.value))) {\n      errors.push('Value must be a number');\n    }\n  }\n  \n  if (fieldType === 'date' && rule.value !== null && rule.value !== undefined) {\n    if (rule.operator === 'between' || rule.operator === 'not_between') {\n      if (!Array.isArray(rule.value) || rule.value.length !== 2) {\n        errors.push('Date range must have 2 values');\n      } else if (rule.value.some((v: any) => isNaN(Date.parse(v)))) {\n        errors.push('Invalid date format in range');\n      }\n    } else if (rule.operator !== 'today' && \n               rule.operator !== 'yesterday' &&\n               rule.operator !== 'this_week' &&\n               rule.operator !== 'this_month' &&\n               rule.operator !== 'this_year' &&\n               rule.operator !== 'last_7_days' &&\n               rule.operator !== 'last_30_days' &&\n               rule.operator !== 'last_90_days') {\n      if (isNaN(Date.parse(rule.value))) {\n        errors.push('Invalid date format');\n      }\n    }\n  }\n  \n  return errors;\n};\n\nexport const validateRules = (rules: CollectionRule[]): string[] => {\n  const allErrors: string[] = [];\n  \n  if (rules.length === 0) {\n    allErrors.push('At least one rule is required');\n    return allErrors;\n  }\n  \n  rules.forEach((rule, index) => {\n    const ruleErrors = validateRule(rule);\n    if (ruleErrors.length > 0) {\n      allErrors.push(`Rule ${index + 1}: ${ruleErrors.join(', ')}`);\n    }\n  });\n  \n  return allErrors;\n};","import React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Plus,\n  X,\n  Save,\n  Play,\n  Shuffle,\n  Filter,\n  Search,\n  Calendar,\n  Clock,\n  Star,\n  Tag,\n  Music,\n  Film,\n  Image,\n  FileText,\n  ChevronDown,\n  ChevronUp,\n  HelpCircle,\n  Trash2,\n  Copy,\n  TestTube,\n  Lightbulb,\n  Zap,\n  Heart,\n  HardDrive,\n  Mic\n} from 'lucide-react';\nimport { Button } from '../ui/Button';\nimport { Input } from '../ui/Input';\nimport { Select } from '../ui/Select';\nimport { Textarea } from '../ui/Textarea';\nimport { Card } from '../ui/Card';\nimport { Switch } from '../ui/Switch';\nimport { \n  COLLECTION_TEMPLATES, \n  COLLECTION_FIELD_OPTIONS, \n  COLLECTION_OPERATORS, \n  getFieldOptions, \n  getFieldLabel, \n  getFieldType, \n  validateRules \n} from '../../lib/collectionRules';\nimport { CollectionRule, CollectionTemplate } from '../../types/collections';\nimport { toast } from 'react-hot-toast';\n\ninterface SmartCollectionBuilderProps {\n  initialName?: string;\n  initialDescription?: string;\n  initialRules?: CollectionRule[];\n  onSave: (name: string, description: string, rules: CollectionRule[]) => void;\n  onCancel: () => void;\n  className?: string;\n}\n\nconst FIELD_ICONS = {\n  music: Music,\n  video: Film,\n  image: Image,\n  document: FileText,\n};\n\nconst TEMPLATE_ICONS = {\n  Clock: Clock,\n  Star: Star,\n  Film: Film,\n  Music: Music,\n  Heart: Heart,\n  HardDrive: HardDrive,\n  Guitar: Mic,\n  Play: Play,\n};\n\nexport const SmartCollectionBuilder: React.FC<SmartCollectionBuilderProps> = ({\n  initialName = '',\n  initialDescription = '',\n  initialRules = [],\n  onSave,\n  onCancel,\n  className = ''\n}) => {\n  const [name, setName] = useState(initialName);\n  const [description, setDescription] = useState(initialDescription);\n  const [rules, setRules] = useState<CollectionRule[]>(initialRules);\n  const [expandedRules, setExpandedRules] = useState<Set<string>>(new Set());\n  const [showTemplates, setShowTemplates] = useState(false);\n  const [showAdvanced, setShowAdvanced] = useState(false);\n  const [testResults, setTestResults] = useState<any>(null);\n  const [isTesting, setIsTesting] = useState(false);\n\n  // Generate unique ID for new rules\n  const generateRuleId = () => `rule_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n  // Initialize with at least one rule if none provided\n  useEffect(() => {\n    if (rules.length === 0) {\n      addRule();\n    }\n  }, []);\n\n  const addRule = (parentId?: string, index?: number) => {\n    const newRule: CollectionRule = {\n      id: generateRuleId(),\n      field: 'title',\n      operator: 'contains',\n      value: '',\n      field_type: 'text',\n      label: 'Title',\n    };\n\n    if (parentId) {\n      setRules(prev => prev.map(rule => {\n        if (rule.id === parentId) {\n          return {\n            ...rule,\n            nested_rules: [...(rule.nested_rules || []), newRule]\n          };\n        }\n        return rule;\n      }));\n    } else {\n      setRules(prev => {\n        if (index !== undefined) {\n          const newRules = [...prev];\n          newRules.splice(index + 1, 0, newRule);\n          return newRules;\n        }\n        return [...prev, newRule];\n      });\n    }\n  };\n\n  const removeRule = (ruleId: string) => {\n    setRules(prev => {\n      const removeNestedRules = (rules: CollectionRule[]): CollectionRule[] => {\n        return rules.filter(rule => rule.id !== ruleId).map(rule => ({\n          ...rule,\n          nested_rules: rule.nested_rules ? removeNestedRules(rule.nested_rules) : undefined\n        }));\n      };\n      return removeNestedRules(prev);\n    });\n  };\n\n  const updateRule = (ruleId: string, updates: Partial<CollectionRule>) => {\n    setRules(prev => {\n      const updateNestedRules = (rules: CollectionRule[]): CollectionRule[] => {\n        return rules.map(rule => {\n          if (rule.id === ruleId) {\n            const fieldType = getFieldType(updates.field || rule.field);\n            const validFieldType: 'text' | 'number' | 'date' | 'boolean' | 'select' | 'multiselect' = \n              ['text', 'number', 'date', 'boolean', 'select', 'multiselect'].includes(fieldType)\n                ? fieldType as 'text' | 'number' | 'date' | 'boolean' | 'select' | 'multiselect'\n                : 'text';\n            \n            const updatedRule = {\n              field: rule.field,\n              operator: rule.operator,\n              value: rule.value,\n              condition: rule.condition,\n              nested_rules: rule.nested_rules,\n              label: rule.label,\n              id: rule.id,\n              field_type: validFieldType,\n              ...updates\n            };\n            \n            // Update field_type and label if field changed\n            if (updates.field) {\n              updatedRule.field_type = validFieldType;\n              updatedRule.label = getFieldLabel(updates.field);\n            }\n            \n            return updatedRule;\n          }\n          if (rule.nested_rules) {\n            return { ...rule, nested_rules: updateNestedRules(rule.nested_rules) };\n          }\n          return rule;\n        });\n      };\n      return updateNestedRules(prev);\n    });\n  };\n\n  const loadTemplate = (template: CollectionTemplate) => {\n    const rulesWithIds: CollectionRule[] = template.rules.map((rule): CollectionRule => {\n      const validFieldType = ['text', 'number', 'date', 'boolean', 'select', 'multiselect'].includes(rule.field_type) \n        ? rule.field_type as 'text' | 'number' | 'date' | 'boolean' | 'select' | 'multiselect'\n        : 'text';\n      \n      return {\n        field: rule.field,\n        operator: rule.operator,\n        value: rule.value,\n        condition: rule.condition,\n        nested_rules: rule.nested_rules,\n        label: rule.label,\n        id: generateRuleId(),\n        field_type: validFieldType,\n      };\n    });\n    setRules(rulesWithIds);\n    setName(template.name);\n    setDescription(template.description);\n    setShowTemplates(false);\n    toast.success(`Loaded template: ${template.name}`);\n  };\n\n  const toggleRuleExpansion = (ruleId: string) => {\n    setExpandedRules(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(ruleId)) {\n        newSet.delete(ruleId);\n      } else {\n        newSet.add(ruleId);\n      }\n      return newSet;\n    });\n  };\n\n  const duplicateRule = (ruleId: string) => {\n    const findAndDuplicateRule = (rules: CollectionRule[]): CollectionRule[] => {\n      return rules.map(rule => {\n        if (rule.id === ruleId) {\n          const duplicatedRule = {\n            ...rule,\n            id: generateRuleId(),\n          };\n          return duplicatedRule;\n        }\n        if (rule.nested_rules) {\n          return { ...rule, nested_rules: findAndDuplicateRule(rule.nested_rules) };\n        }\n        return rule;\n      });\n    };\n\n    const originalRule = rules.find(r => r.id === ruleId);\n    if (originalRule) {\n      const ruleIndex = rules.findIndex(r => r.id === ruleId);\n      const duplicatedRule = { ...originalRule, id: generateRuleId() };\n      const newRules = [...rules];\n      newRules.splice(ruleIndex + 1, 0, duplicatedRule);\n      setRules(newRules);\n    }\n  };\n\n  const testRules = async () => {\n    setIsTesting(true);\n    setTestResults(null);\n\n    try {\n      // Simulate testing the rules against the library\n      await new Promise(resolve => setTimeout(resolve, 1500));\n      \n      // Mock test results\n      setTestResults({\n        total_items: 1234,\n        matched_items: 87,\n        sample_items: [\n          { id: '1', title: 'Sample Song 1', artist: 'Artist A', media_type: 'music' },\n          { id: '2', title: 'Sample Movie 1', director: 'Director B', media_type: 'video' },\n          { id: '3', title: 'Sample Image 1', filename: 'image.jpg', media_type: 'image' },\n        ],\n        performance_ms: 245,\n      });\n      \n      toast.success('Rules tested successfully');\n    } catch (error) {\n      toast.error('Failed to test rules');\n    } finally {\n      setIsTesting(false);\n    }\n  };\n\n  const handleSave = () => {\n    const errors = validateRules(rules);\n    if (errors.length > 0) {\n      toast.error(errors[0]);\n      return;\n    }\n\n    if (!name.trim()) {\n      toast.error('Collection name is required');\n      return;\n    }\n\n    onSave(name.trim(), description.trim(), rules);\n  };\n\n  const renderRule = (rule: CollectionRule, level = 0, parentRule?: CollectionRule) => {\n    const isExpanded = expandedRules.has(rule.id);\n    const fieldType = getFieldType(rule.field);\n    const operators = COLLECTION_OPERATORS[fieldType as keyof typeof COLLECTION_OPERATORS] || [];\n    const fieldOptions = getFieldOptions(rule.field);\n\n    return (\n      <motion.div\n        key={rule.id}\n        initial={{ opacity: 0, x: -20 }}\n        animate={{ opacity: 1, x: 0 }}\n        exit={{ opacity: 0, x: 20 }}\n        className={`border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-3 ${\n          level > 0 ? 'ml-6 border-l-4 border-l-blue-500' : ''\n        }`}\n      >\n        <div className=\"flex items-start gap-3\">\n          {/* Drag Handle */}\n          <div className=\"flex items-center justify-center mt-2\">\n            <div className=\"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded cursor-move\" />\n          </div>\n\n          <div className=\"flex-1 grid grid-cols-1 md:grid-cols-4 gap-3\">\n            {/* Field Select */}\n            <Select\n              value={rule.field}\n              onChange={(value) => updateRule(rule.id, { field: value })}\n              options={COLLECTION_FIELD_OPTIONS}\n              className=\"w-full\"\n            />\n\n            {/* Operator Select */}\n            <Select\n              value={rule.operator}\n              onChange={(value) => updateRule(rule.id, { operator: value })}\n              options={operators}\n              className=\"w-full\"\n            />\n\n            {/* Value Input */}\n            <div className=\"relative\">\n              {fieldType === 'boolean' ? (\n                <Switch\n                  checked={rule.value === true}\n                  onCheckedChange={(checked) => updateRule(rule.id, { value: checked })}\n                />\n              ) : fieldOptions.length > 0 ? (\n                <Select\n                  value={Array.isArray(rule.value) ? rule.value[0] : rule.value}\n                  onChange={(value) => updateRule(rule.id, { \n                    value: rule.operator === 'is_any' || rule.operator === 'is_not_any' ? [value] : value \n                  })}\n                  options={fieldOptions}\n                  className=\"w-full\"\n                />\n              ) : (\n                <Input\n                  value={rule.value || ''}\n                  onChange={(e: React.ChangeEvent<HTMLInputElement>) => updateRule(rule.id, { value: e.target.value })}\n                  placeholder=\"Enter value\"\n                  type={fieldType === 'number' ? 'number' : fieldType === 'date' ? 'date' : 'text'}\n                  className=\"w-full\"\n                />\n              )}\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => duplicateRule(rule.id)}\n                title=\"Duplicate rule\"\n              >\n                <Copy className=\"w-4 h-4\" />\n              </Button>\n              \n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => addRule(rule.id)}\n                title=\"Add nested rule\"\n              >\n                <Plus className=\"w-4 h-4\" />\n              </Button>\n\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => removeRule(rule.id)}\n                title=\"Remove rule\"\n                className=\"text-red-600 hover:text-red-700\"\n              >\n                <Trash2 className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {/* Nested Rules */}\n        {rule.nested_rules && rule.nested_rules.length > 0 && (\n          <div className=\"mt-3 border-t border-gray-200 dark:border-gray-700 pt-3\">\n            {rule.nested_rules.map(nestedRule => renderRule(nestedRule, level + 1, rule))}\n          </div>\n        )}\n      </motion.div>\n    );\n  };\n\n  return (\n    <div className={`bg-white dark:bg-gray-900 rounded-lg shadow-lg ${className}`}>\n      <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center\">\n              <Zap className=\"w-5 h-5 text-white\" />\n            </div>\n            <div>\n              <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">\n                Smart Collection Builder\n              </h2>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                Create collections that automatically update based on rules\n              </p>\n            </div>\n          </div>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={onCancel}\n          >\n            <X className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"p-6\">\n        {/* Basic Info */}\n        <div className=\"mb-6\">\n          <Input\n            label=\"Collection Name\"\n            value={name}\n            onChange={(e) => setName(e.target.value)}\n            placeholder=\"Enter collection name\"\n            className=\"mb-4\"\n          />\n          \n          <Textarea\n            label=\"Description\"\n            value={description}\n            onChange={(e) => setDescription(e.target.value)}\n            placeholder=\"Optional description for this collection\"\n            rows={3}\n            className=\"mb-4\"\n          />\n        </div>\n\n        {/* Templates */}\n        <div className=\"mb-6\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n              <Lightbulb className=\"w-5 h-5 text-yellow-500\" />\n              Quick Start Templates\n            </h3>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setShowTemplates(!showTemplates)}\n            >\n              {showTemplates ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n            </Button>\n          </div>\n\n          <AnimatePresence>\n            {showTemplates && (\n              <motion.div\n                initial={{ height: 0, opacity: 0 }}\n                animate={{ height: 'auto', opacity: 1 }}\n                exit={{ height: 0, opacity: 0 }}\n                className=\"overflow-hidden\"\n              >\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                  {COLLECTION_TEMPLATES.map(template => {\n                    const IconComponent = (TEMPLATE_ICONS as any)[template.icon || 'Star'];\n                    return (\n                      <motion.div\n                        key={template.id}\n                        whileHover={{ scale: 1.02 }}\n                        whileTap={{ scale: 0.98 }}\n                        className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800\"\n                        onClick={() => loadTemplate(template)}\n                      >\n                        <div className=\"flex items-center gap-3 mb-2\">\n                          <div className=\"w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center\">\n                            {IconComponent && <IconComponent className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />}\n                          </div>\n                          <div>\n                            <h4 className=\"font-semibold text-gray-900 dark:text-white text-sm\">\n                              {template.name}\n                            </h4>\n                            <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n                              {template.category}\n                            </span>\n                          </div>\n                        </div>\n                        <p className=\"text-xs text-gray-600 dark:text-gray-400\">\n                          {template.description}\n                        </p>\n                      </motion.div>\n                    );\n                  })}\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n\n        {/* Rules Section */}\n        <div className=\"mb-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n              <Filter className=\"w-5 h-5\" />\n              Collection Rules\n            </h3>\n            \n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={testRules}\n                disabled={isTesting}\n                className=\"flex items-center gap-2\"\n              >\n                <TestTube className=\"w-4 h-4\" />\n                {isTesting ? 'Testing...' : 'Test Rules'}\n              </Button>\n              \n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => addRule()}\n              >\n                <Plus className=\"w-4 h-4 mr-1\" />\n                Add Rule\n              </Button>\n            </div>\n          </div>\n\n          <AnimatePresence>\n            {rules.map((rule) => renderRule(rule))}\n          </AnimatePresence>\n\n          {rules.length === 0 && (\n            <div className=\"text-center py-8 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg\">\n              <Filter className=\"w-12 h-12 text-gray-400 mx-auto mb-3\" />\n              <p className=\"text-gray-600 dark:text-gray-400 mb-3\">\n                No rules defined yet. Start by adding a rule above.\n              </p>\n              <Button\n                variant=\"outline\"\n                onClick={() => addRule()}\n              >\n                <Plus className=\"w-4 h-4 mr-1\" />\n                Add First Rule\n              </Button>\n            </div>\n          )}\n        </div>\n\n        {/* Test Results */}\n        {testResults && (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"mb-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg\"\n          >\n            <h4 className=\"font-semibold text-green-800 dark:text-green-200 mb-3\">\n              Test Results\n            </h4>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\n              <div>\n                <p className=\"text-sm text-green-600 dark:text-green-400\">Total Items</p>\n                <p className=\"text-lg font-bold text-green-800 dark:text-green-200\">\n                  {testResults.total_items.toLocaleString()}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-green-600 dark:text-green-400\">Matched Items</p>\n                <p className=\"text-lg font-bold text-green-800 dark:text-green-200\">\n                  {testResults.matched_items.toLocaleString()}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-green-600 dark:text-green-400\">Match Rate</p>\n                <p className=\"text-lg font-bold text-green-800 dark:text-green-200\">\n                  {((testResults.matched_items / testResults.total_items) * 100).toFixed(1)}%\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm text-green-600 dark:text-green-400\">Performance</p>\n                <p className=\"text-lg font-bold text-green-800 dark:text-green-200\">\n                  {testResults.performance_ms}ms\n                </p>\n              </div>\n            </div>\n            \n            {testResults.sample_items && testResults.sample_items.length > 0 && (\n              <div>\n                <p className=\"text-sm text-green-600 dark:text-green-400 mb-2\">Sample Items:</p>\n                <div className=\"space-y-1\">\n                  {testResults.sample_items.map((item: any) => (\n                    <div key={item.id} className=\"flex items-center gap-2 text-sm\">\n                      {FIELD_ICONS[item.media_type as keyof typeof FIELD_ICONS] && \n                        React.createElement(FIELD_ICONS[item.media_type as keyof typeof FIELD_ICONS], { className: 'w-4 h-4' })\n                      }\n                      <span className=\"text-green-800 dark:text-green-200\">{item.title}</span>\n                      {item.artist && <span className=\"text-green-600 dark:text-green-400\">by {item.artist}</span>}\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n\n        {/* Actions */}\n        <div className=\"flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center gap-2\">\n            <label className=\"text-sm text-gray-600 dark:text-gray-400\">Advanced options</label>\n            <Switch\n              checked={showAdvanced}\n              onCheckedChange={setShowAdvanced}\n            />\n          </div>\n          \n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"ghost\"\n              onClick={onCancel}\n            >\n              Cancel\n            </Button>\n            \n            <Button\n              onClick={handleSave}\n              className=\"flex items-center gap-2\"\n            >\n              <Save className=\"w-4 h-4\" />\n              Create Collection\n            </Button>\n          </div>\n        </div>\n\n        {/* Advanced Options */}\n        <AnimatePresence>\n          {showAdvanced && (\n            <motion.div\n              initial={{ height: 0, opacity: 0 }}\n              animate={{ height: 'auto', opacity: 1 }}\n              exit={{ height: 0, opacity: 0 }}\n              className=\"overflow-hidden mt-6 pt-6 border-t border-gray-200 dark:border-gray-700\"\n            >\n              <h4 className=\"font-semibold text-gray-900 dark:text-white mb-4\">Advanced Options</h4>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                      Auto-refresh frequency\n                    </label>\n                    <Select\n                      value=\"daily\"\n                      onChange={() => {}}\n                      options={[\n                        { value: 'hourly', label: 'Hourly' },\n                        { value: 'daily', label: 'Daily' },\n                        { value: 'weekly', label: 'Weekly' },\n                        { value: 'manual', label: 'Manual only' },\n                      ]}\n                      className=\"w-full\"\n                    />\n                  </div>\n                  \n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                      Sort order\n                    </label>\n                    <Select\n                      value=\"date_added\"\n                      onChange={() => {}}\n                      options={[\n                        { value: 'date_added', label: 'Date Added' },\n                        { value: 'title', label: 'Title' },\n                        { value: 'artist', label: 'Artist' },\n                        { value: 'rating', label: 'Rating' },\n                        { value: 'play_count', label: 'Play Count' },\n                      ]}\n                      className=\"w-full\"\n                    />\n                  </div>\n                </div>\n                \n                <div className=\"space-y-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                      Maximum items (0 = unlimited)\n                    </label>\n                    <Input\n                      type=\"number\"\n                      value=\"0\"\n                      onChange={() => {}}\n                      placeholder=\"0\"\n                      className=\"w-full\"\n                    />\n                  </div>\n                  \n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                      Cache results\n                    </label>\n                    <Switch\n                      checked={true}\n                      onCheckedChange={() => {}}\n                    />\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                      Improve performance by caching query results\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </div>\n  );\n};","import { Collection, SmartCollection, CollectionRule, CollectionTemplate, CollectionAnalytics } from '../types/collections';\n\n// Mock collections data for testing\nconst MOCK_COLLECTIONS: Collection[] = [\n  {\n    id: '1',\n    name: 'My Music Collection',\n    description: 'All my favorite music tracks organized by genre and artist',\n    item_count: 1250,\n    is_public: false,\n    is_smart: false,\n    primary_media_type: 'music',\n    created_at: '2024-01-15T10:00:00Z',\n    updated_at: '2024-01-20T15:30:00Z',\n    thumbnail_url: '/collections/music-thumb.jpg',\n    owner_id: 'user1'\n  },\n  {\n    id: '2',\n    name: 'Movie Favorites',\n    description: 'Best movies in my collection',\n    item_count: 87,\n    is_public: true,\n    is_smart: false,\n    primary_media_type: 'video',\n    created_at: '2024-01-10T09:00:00Z',\n    updated_at: '2024-01-18T20:15:00Z',\n    thumbnail_url: '/collections/movies-thumb.jpg',\n    owner_id: 'user1'\n  },\n  {\n    id: '3',\n    name: 'Recently Added',\n    description: 'Items added in the last 30 days',\n    item_count: 45,\n    is_public: false,\n    is_smart: true,\n    primary_media_type: 'mixed',\n    created_at: '2024-01-01T00:00:00Z',\n    updated_at: '2024-01-20T18:45:00Z',\n    owner_id: 'user1'\n  }\n];\n\nconst MOCK_SMART_COLLECTIONS: SmartCollection[] = [\n  {\n    id: '3',\n    name: 'Recently Added',\n    description: 'Items added in the last 30 days',\n    is_smart: true,\n    smart_rules: [\n      {\n        id: 'rule1',\n        field: 'date_added',\n        operator: 'last_30_days',\n        value: null,\n        field_type: 'date',\n        label: 'Date Added'\n      }\n    ],\n    item_count: 45,\n    last_updated: '2024-01-20T18:45:00Z',\n    created_at: '2024-01-01T00:00:00Z',\n    updated_at: '2024-01-20T18:45:00Z',\n    thumbnail_url: '/collections/recent-thumb.jpg',\n    owner_id: 'user1',\n    is_public: false,\n    primary_media_type: 'mixed'\n  },\n  {\n    id: '4',\n    name: 'High Rated Movies',\n    description: 'Movies with rating 4 stars or higher',\n    is_smart: true,\n    smart_rules: [\n      {\n        id: 'rule1',\n        field: 'media_type',\n        operator: 'equals',\n        value: 'video',\n        field_type: 'select',\n        label: 'Media Type',\n        condition: 'AND'\n      },\n      {\n        id: 'rule2',\n        field: 'rating',\n        operator: 'greater_or_equal',\n        value: 4,\n        field_type: 'number',\n        label: 'Rating',\n        condition: 'AND'\n      }\n    ],\n    item_count: 23,\n    last_updated: '2024-01-19T22:30:00Z',\n    created_at: '2024-01-05T12:00:00Z',\n    updated_at: '2024-01-19T22:30:00Z',\n    thumbnail_url: '/collections/high-rated-thumb.jpg',\n    owner_id: 'user1',\n    is_public: true,\n    primary_media_type: 'video'\n  }\n];\n\nconst MOCK_TEMPLATES: CollectionTemplate[] = [\n  {\n    id: 'recently_added',\n    name: 'Recently Added',\n    description: 'Items added in the last 30 days',\n    category: 'Time-based',\n    rules: [\n      {\n        field: 'date_added',\n        operator: 'last_30_days',\n        value: null,\n        field_type: 'date',\n        label: 'Date Added'\n      }\n    ],\n    icon: 'Clock'\n  },\n  {\n    id: 'high_rated',\n    name: 'High Rated',\n    description: 'Items with rating 4 stars or higher',\n    category: 'Quality-based',\n    rules: [\n      {\n        field: 'rating',\n        operator: 'greater_or_equal',\n        value: 4,\n        field_type: 'number',\n        label: 'Rating'\n      }\n    ],\n    icon: 'Star'\n  }\n];\n\nconst MOCK_ANALYTICS: CollectionAnalytics[] = [\n  {\n    collection_id: '1',\n    total_items: 1250,\n    media_type_distribution: {\n      music: 1250,\n      video: 0,\n      image: 0,\n      document: 0\n    },\n    size_distribution: {\n      total_size_bytes: 5368709120, // ~5GB\n      average_size_bytes: 4294967, // ~4MB\n      largest_item_size_bytes: 52428800 // ~50MB\n    },\n    quality_distribution: {\n      hd: 0,\n      sd: 1250,\n      uhd: 0\n    },\n    time_based_stats: {\n      items_added_today: 5,\n      items_added_this_week: 25,\n      items_added_this_month: 68,\n      oldest_item_date: '2023-01-15T10:00:00Z',\n      newest_item_date: '2024-01-20T15:30:00Z'\n    },\n    engagement_stats: {\n      total_views: 3420,\n      unique_viewers: 45,\n      total_plays: 2890,\n      average_completion_rate: 0.78,\n      last_accessed: '2024-01-20T18:45:00Z'\n    },\n    genre_distribution: {\n      'Rock': 450,\n      'Pop': 320,\n      'Jazz': 280,\n      'Electronic': 200\n    }\n  }\n];\n\n// Mock API functions\nexport const mockCollectionsApi = {\n  // Basic CRUD\n  getCollections: async (): Promise<Collection[]> => {\n    await new Promise(resolve => setTimeout(resolve, 100));\n    return MOCK_COLLECTIONS;\n  },\n\n  getCollection: async (id: string): Promise<Collection> => {\n    await new Promise(resolve => setTimeout(resolve, 100));\n    const collection = MOCK_COLLECTIONS.find(c => c.id === id);\n    if (!collection) throw new Error('Collection not found');\n    return collection;\n  },\n\n  createCollection: async (data: { name: string; description?: string; items?: string[] }): Promise<Collection> => {\n    await new Promise(resolve => setTimeout(resolve, 200));\n    const newCollection: Collection = {\n      id: Date.now().toString(),\n      name: data.name,\n      description: data.description,\n      item_count: data.items?.length || 0,\n      is_public: false,\n      is_smart: false,\n      primary_media_type: 'mixed',\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      owner_id: 'user1'\n    };\n    MOCK_COLLECTIONS.push(newCollection);\n    return newCollection;\n  },\n\n  updateCollection: async (id: string, data: Partial<Collection>): Promise<Collection> => {\n    await new Promise(resolve => setTimeout(resolve, 200));\n    const index = MOCK_COLLECTIONS.findIndex(c => c.id === id);\n    if (index === -1) throw new Error('Collection not found');\n    MOCK_COLLECTIONS[index] = { ...MOCK_COLLECTIONS[index], ...data, updated_at: new Date().toISOString() };\n    return MOCK_COLLECTIONS[index];\n  },\n\n  deleteCollection: async (id: string): Promise<void> => {\n    await new Promise(resolve => setTimeout(resolve, 200));\n    const index = MOCK_COLLECTIONS.findIndex(c => c.id === id);\n    if (index === -1) throw new Error('Collection not found');\n    MOCK_COLLECTIONS.splice(index, 1);\n  },\n\n  // Smart Collections\n  getSmartCollections: async (): Promise<SmartCollection[]> => {\n    await new Promise(resolve => setTimeout(resolve, 100));\n    return MOCK_SMART_COLLECTIONS;\n  },\n\n  getSmartCollection: async (id: string): Promise<SmartCollection> => {\n    await new Promise(resolve => setTimeout(resolve, 100));\n    const collection = MOCK_SMART_COLLECTIONS.find(c => c.id === id);\n    if (!collection) throw new Error('Smart Collection not found');\n    return collection;\n  },\n\n  createSmartCollection: async (data: { name: string; description?: string; rules: CollectionRule[] }): Promise<SmartCollection> => {\n    await new Promise(resolve => setTimeout(resolve, 300));\n    const newSmartCollection: SmartCollection = {\n      id: Date.now().toString(),\n      name: data.name,\n      description: data.description,\n      is_smart: true,\n      smart_rules: data.rules,\n      item_count: Math.floor(Math.random() * 100) + 10, // Mock item count\n      last_updated: new Date().toISOString(),\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n      owner_id: 'user1',\n      is_public: false,\n      primary_media_type: 'mixed'\n    };\n    MOCK_SMART_COLLECTIONS.push(newSmartCollection);\n    return newSmartCollection;\n  },\n\n  updateSmartCollection: async (id: string, data: Partial<SmartCollection>): Promise<SmartCollection> => {\n    await new Promise(resolve => setTimeout(resolve, 200));\n    const index = MOCK_SMART_COLLECTIONS.findIndex(c => c.id === id);\n    if (index === -1) throw new Error('Smart Collection not found');\n    MOCK_SMART_COLLECTIONS[index] = { ...MOCK_SMART_COLLECTIONS[index], ...data, updated_at: new Date().toISOString() };\n    return MOCK_SMART_COLLECTIONS[index];\n  },\n\n  deleteSmartCollection: async (id: string): Promise<void> => {\n    await new Promise(resolve => setTimeout(resolve, 200));\n    const index = MOCK_SMART_COLLECTIONS.findIndex(c => c.id === id);\n    if (index === -1) throw new Error('Smart Collection not found');\n    MOCK_SMART_COLLECTIONS.splice(index, 1);\n  },\n\n  // Templates\n  getTemplates: async (): Promise<CollectionTemplate[]> => {\n    await new Promise(resolve => setTimeout(resolve, 100));\n    return MOCK_TEMPLATES;\n  },\n\n  // Analytics\n  getAnalytics: async (collectionId: string): Promise<CollectionAnalytics> => {\n    await new Promise(resolve => setTimeout(resolve, 150));\n    const analytics = MOCK_ANALYTICS.find(a => a.collection_id === collectionId);\n    if (!analytics) throw new Error('Analytics not found');\n    return analytics;\n  },\n\n  // Test Rules\n  testRules: async (rules: CollectionRule[]): Promise<{ valid: boolean; sample_count: number; errors?: string[] }> => {\n    await new Promise(resolve => setTimeout(resolve, 100));\n    // Mock rule validation - always return success for testing\n    return {\n      valid: true,\n      sample_count: Math.floor(Math.random() * 1000) + 10\n    };\n  }\n};\n\n// Helper function to determine if we should use mock API\nexport const shouldUseMockCollections = () => {\n  // Use mock API when backend doesn't have collections endpoints\n  return true;\n};","import { SmartCollection, CollectionRule, CreateCollectionRequest, UpdateCollectionRequest, CollectionAnalytics, ShareCollectionRequest, CollectionShareInfo, Collection, CollectionTemplate } from '../types/collections';\nimport { api } from './api';\nimport { mockCollectionsApi, shouldUseMockCollections } from './mockCollectionsApi';\n\nclass CollectionsApi {\n  private baseUrl = '/api/collections';\n\n  private async tryApiCall<T>(apiCall: () => Promise<T>, mockCall: () => Promise<T>): Promise<T> {\n    if (shouldUseMockCollections()) {\n      return mockCall();\n    }\n    \n    try {\n      return await apiCall();\n    } catch (error: any) {\n      // If API endpoint not found (404), fall back to mock data\n      if (error.response?.status === 404) {\n        return mockCall();\n      }\n      throw error;\n    }\n  }\n\n  async getCollections(): Promise<SmartCollection[]> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.get(`${this.baseUrl}`);\n        return response.data;\n      },\n      () => mockCollectionsApi.getSmartCollections()\n    );\n  }\n\n  async getCollection(id: string): Promise<SmartCollection> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.get(`${this.baseUrl}/${id}`);\n        return response.data;\n      },\n      () => mockCollectionsApi.getSmartCollection(id)\n    );\n  }\n\n  async createCollection(collection: CreateCollectionRequest): Promise<SmartCollection> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.post(`${this.baseUrl}`, collection);\n        return response.data;\n      },\n      () => mockCollectionsApi.createSmartCollection({\n        name: collection.name,\n        description: collection.description,\n        rules: collection.smart_rules || []\n      })\n    );\n  }\n\n  async updateCollection(id: string, updates: UpdateCollectionRequest): Promise<SmartCollection> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.put(`${this.baseUrl}/${id}`, updates);\n        return response.data;\n      },\n      () => mockCollectionsApi.updateSmartCollection(id, updates)\n    );\n  }\n\n  async deleteCollection(id: string): Promise<void> {\n    return this.tryApiCall(\n      async () => {\n        await api.delete(`${this.baseUrl}/${id}`);\n      },\n      () => mockCollectionsApi.deleteSmartCollection(id)\n    );\n  }\n\n  async getCollectionItems(id: string, page = 1, limit = 50): Promise<any> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.get(`${this.baseUrl}/${id}/items`, {\n          params: { page, limit }\n        });\n        return response.data;\n      },\n      async () => {\n        // Mock items data\n        const mockItems = Array.from({ length: 20 }, (_, i) => ({\n          id: `item${i + 1}`,\n          title: `Sample Item ${i + 1}`,\n          artist: `Sample Artist ${i + 1}`,\n          album: `Sample Album ${i + 1}`,\n          duration: Math.floor(Math.random() * 300) + 120,\n          media_type: ['music', 'video', 'image'][Math.floor(Math.random() * 3)],\n          file_size: Math.floor(Math.random() * 10000000) + 1000000,\n          date_added: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString()\n        }));\n        \n        return {\n          items: mockItems,\n          total: mockItems.length,\n          page,\n          limit\n        };\n      }\n    );\n  }\n\n  async refreshCollection(id: string): Promise<SmartCollection> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.post(`${this.baseUrl}/${id}/refresh`);\n        return response.data;\n      },\n      async () => {\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        const collection = await mockCollectionsApi.getSmartCollection(id);\n        collection.item_count = Math.floor(Math.random() * 100) + 10;\n        collection.last_updated = new Date().toISOString();\n        return collection;\n      }\n    );\n  }\n\n  async getCollectionAnalytics(id: string): Promise<CollectionAnalytics> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.get(`${this.baseUrl}/${id}/analytics`);\n        return response.data;\n      },\n      () => mockCollectionsApi.getAnalytics(id)\n    );\n  }\n\n  async shareCollection(id: string, shareRequest: ShareCollectionRequest): Promise<CollectionShareInfo> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.post(`${this.baseUrl}/${id}/share`, shareRequest);\n        return response.data;\n      },\n      async () => {\n        const mockShareInfo: CollectionShareInfo = {\n          share_id: `share_${id}_${Date.now()}`,\n          share_url: `http://localhost:3006/shared/share_${id}_${Date.now()}`,\n          expires_at: shareRequest.expires_at || new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),\n          created_at: new Date().toISOString(),\n          access_count: 0,\n          permissions: shareRequest\n        };\n        return mockShareInfo;\n      }\n    );\n  }\n\n  async getSharedCollection(shareId: string): Promise<SmartCollection> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.get(`${this.baseUrl}/shared/${shareId}`);\n        return response.data;\n      },\n      async () => {\n        return mockCollectionsApi.getSmartCollection('3'); // Return recently added as mock shared\n      }\n    );\n  }\n\n  async exportCollection(id: string, format: 'json' | 'csv' | 'm3u' = 'json'): Promise<Blob> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.get(`${this.baseUrl}/${id}/export`, {\n          params: { format },\n          responseType: 'blob'\n        });\n        return response.data;\n      },\n      async () => {\n        const collection = await mockCollectionsApi.getSmartCollection(id);\n        let data: string;\n        \n        if (format === 'json') {\n          data = JSON.stringify(collection, null, 2);\n        } else {\n          data = `name,description\\n${collection.name},\"${collection.description || ''}\"`;\n        }\n        \n        return new Blob([data], { type: format === 'json' ? 'application/json' : 'text/csv' });\n      }\n    );\n  }\n\n  async importCollection(file: File): Promise<SmartCollection> {\n    return this.tryApiCall(\n      async () => {\n        const formData = new FormData();\n        formData.append('file', file);\n        \n        const response = await api.post(`${this.baseUrl}/import`, formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data',\n          },\n        });\n        return response.data;\n      },\n      async () => {\n        const text = await file.text();\n        const data = JSON.parse(text) as SmartCollection;\n        return mockCollectionsApi.createSmartCollection({\n          name: data.name,\n          description: data.description,\n          rules: data.smart_rules || []\n        });\n      }\n    );\n  }\n\n  async duplicateCollection(id: string, newName?: string): Promise<SmartCollection> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.post(`${this.baseUrl}/${id}/duplicate`, {\n          name: newName\n        });\n        return response.data;\n      },\n      async () => {\n        const original = await mockCollectionsApi.getSmartCollection(id);\n        return mockCollectionsApi.createSmartCollection({\n          name: newName || `${original.name} (Copy)`,\n          description: original.description,\n          rules: original.smart_rules\n        });\n      }\n    );\n  }\n\n  async addItemsToCollection(id: string, itemIds: string[]): Promise<void> {\n    return this.tryApiCall(\n      async () => {\n        await api.post(`${this.baseUrl}/${id}/items`, { item_ids: itemIds });\n      },\n      async () => {\n        // Mock implementation - just delay\n        await new Promise(resolve => setTimeout(resolve, 200));\n      }\n    );\n  }\n\n  async removeItemsFromCollection(id: string, itemIds: string[]): Promise<void> {\n    return this.tryApiCall(\n      async () => {\n        await api.delete(`${this.baseUrl}/${id}/items`, {\n          data: { item_ids: itemIds }\n        });\n      },\n      async () => {\n        // Mock implementation - just delay\n        await new Promise(resolve => setTimeout(resolve, 200));\n      }\n    );\n  }\n\n  async getCollectionSuggestions(): Promise<string[]> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.get(`${this.baseUrl}/suggestions`);\n        return response.data;\n      },\n      async () => {\n        return [\n          'Summer Mix 2024',\n          'Workout Music',\n          'Evening Jazz',\n          'Movie Night Favorites',\n          'Travel Photography'\n        ];\n      }\n    );\n  }\n\n  async getTemplates(): Promise<CollectionTemplate[]> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.get(`${this.baseUrl}/templates`);\n        return response.data;\n      },\n      () => mockCollectionsApi.getTemplates()\n    );\n  }\n\n  async testRules(rules: CollectionRule[]): Promise<{ valid: boolean; sample_count: number; errors?: string[] }> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.post(`${this.baseUrl}/test-rules`, { rules });\n        return response.data;\n      },\n      () => mockCollectionsApi.testRules(rules)\n    );\n  }\n\n  // Bulk operations\n  async bulkDeleteCollections(collectionIds: string[]): Promise<void> {\n    return this.tryApiCall(\n      async () => {\n        await api.delete(`${this.baseUrl}/bulk`, { data: { collection_ids: collectionIds } });\n      },\n      async () => {\n        for (const id of collectionIds) {\n          await mockCollectionsApi.deleteSmartCollection(id);\n        }\n      }\n    );\n  }\n\n  async bulkShareCollections(collectionIds: string[], shareRequest: ShareCollectionRequest): Promise<CollectionShareInfo[]> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.post(`${this.baseUrl}/bulk/share`, {\n          collection_ids: collectionIds,\n          share_request: shareRequest\n        });\n        return response.data;\n      },\n      async () => {\n        const results: CollectionShareInfo[] = [];\n        for (const id of collectionIds) {\n          const mockShareInfo: CollectionShareInfo = {\n            share_id: `share_${id}_${Date.now()}`,\n            share_url: `http://localhost:3006/shared/share_${id}_${Date.now()}`,\n            expires_at: shareRequest.expires_at || new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),\n            created_at: new Date().toISOString(),\n            access_count: 0,\n            permissions: shareRequest\n          };\n          results.push(mockShareInfo);\n        }\n        return results;\n      }\n    );\n  }\n\n  async bulkExportCollections(collectionIds: string[], format: 'json' | 'csv' | 'm3u' = 'json'): Promise<Blob> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.post(`${this.baseUrl}/bulk/export`, {\n          collection_ids: collectionIds,\n          format\n        }, {\n          responseType: 'blob'\n        });\n        return response.data;\n      },\n      async () => {\n        let data: string;\n        const collections = [];\n        \n        for (const id of collectionIds) {\n          const collection = await mockCollectionsApi.getSmartCollection(id);\n          collections.push(collection);\n        }\n        \n        if (format === 'json') {\n          data = JSON.stringify(collections, null, 2);\n        } else {\n          data = 'name,description\\n' + collections.map(c => `${c.name},\"${c.description || ''}\"`).join('\\n');\n        }\n        \n        return new Blob([data], { type: format === 'json' ? 'application/json' : 'text/csv' });\n      }\n    );\n  }\n\n  async bulkUpdateCollections(collectionIds: string[], action: string, updates?: UpdateCollectionRequest): Promise<SmartCollection[]> {\n    return this.tryApiCall(\n      async () => {\n        const response = await api.put(`${this.baseUrl}/bulk`, {\n          collection_ids: collectionIds,\n          action,\n          updates\n        });\n        return response.data;\n      },\n      async () => {\n        const results: SmartCollection[] = [];\n        for (const id of collectionIds) {\n          if (action === 'duplicate') {\n            const original = await mockCollectionsApi.getSmartCollection(id);\n            const duplicate = await mockCollectionsApi.createSmartCollection({\n              name: `${original.name} (Copy)`,\n              description: original.description,\n              rules: original.smart_rules\n            });\n            results.push(duplicate);\n          } else if (updates) {\n            const updated = await mockCollectionsApi.updateSmartCollection(id, updates);\n            results.push(updated);\n          }\n        }\n        return results;\n      }\n    );\n  }\n}\n\nexport const collectionsApi = new CollectionsApi();","import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { collectionsApi } from '../lib/collectionsApi';\nimport { SmartCollection, CreateCollectionRequest, UpdateCollectionRequest, CollectionAnalytics, ShareCollectionRequest, CollectionShareInfo } from '../types/collections';\nimport { toast } from 'react-hot-toast';\n\nexport const useCollections = () => {\n  const queryClient = useQueryClient();\n\n  const {\n    data: collections = [],\n    isLoading,\n    error,\n    refetch: refetchCollections,\n  } = useQuery({\n    queryKey: ['collections'],\n    queryFn: () => collectionsApi.getCollections(),\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  const createCollectionMutation = useMutation({\n    mutationFn: ({ collection }: { collection: CreateCollectionRequest }) =>\n      collectionsApi.createCollection(collection),\n    onSuccess: (newCollection) => {\n      queryClient.invalidateQueries({ queryKey: ['collections'] });\n      toast.success(`Created collection: ${newCollection.name}`);\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to create collection');\n    },\n  });\n\n  const updateCollectionMutation = useMutation({\n    mutationFn: ({ id, updates }: { id: string; updates: UpdateCollectionRequest }) =>\n      collectionsApi.updateCollection(id, updates),\n    onSuccess: (updatedCollection) => {\n      queryClient.invalidateQueries({ queryKey: ['collections'] });\n      queryClient.invalidateQueries({ queryKey: ['collection', updatedCollection.id] });\n      toast.success(`Updated collection: ${updatedCollection.name}`);\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to update collection');\n    },\n  });\n\n  const deleteCollectionMutation = useMutation({\n    mutationFn: ({ id }: { id: string }) => collectionsApi.deleteCollection(id),\n    onSuccess: (_, { id }) => {\n      queryClient.invalidateQueries({ queryKey: ['collections'] });\n      queryClient.removeQueries({ queryKey: ['collection', id] });\n      toast.success('Collection deleted successfully');\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to delete collection');\n    },\n  });\n\n  const refreshCollectionMutation = useMutation({\n    mutationFn: ({ id }: { id: string }) => collectionsApi.refreshCollection(id),\n    onSuccess: (refreshedCollection) => {\n      queryClient.invalidateQueries({ queryKey: ['collections'] });\n      queryClient.invalidateQueries({ queryKey: ['collection', refreshedCollection.id] });\n      toast.success('Collection refreshed successfully');\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to refresh collection');\n    },\n  });\n\n  const shareCollectionMutation = useMutation({\n    mutationFn: ({ id, shareRequest }: { id: string; shareRequest: ShareCollectionRequest }) =>\n      collectionsApi.shareCollection(id, shareRequest),\n    onSuccess: async (shareInfo) => {\n      try {\n        await navigator.clipboard.writeText(shareInfo.share_url);\n        toast.success('Share link copied to clipboard!');\n      } catch (error) {\n        toast.success('Collection shared successfully!');\n        console.error('Failed to copy to clipboard:', error);\n      }\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to share collection');\n    },\n  });\n\n  const duplicateCollectionMutation = useMutation({\n    mutationFn: ({ id, newName }: { id: string; newName?: string }) =>\n      collectionsApi.duplicateCollection(id, newName),\n    onSuccess: (duplicatedCollection) => {\n      queryClient.invalidateQueries({ queryKey: ['collections'] });\n      toast.success(`Duplicated collection: ${duplicatedCollection.name}`);\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to duplicate collection');\n    },\n  });\n\n  const exportCollectionMutation = useMutation({\n    mutationFn: ({ id, format }: { id: string; format: 'json' | 'csv' | 'm3u' }) =>\n      collectionsApi.exportCollection(id, format),\n    onSuccess: (blob, { id, format }) => {\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `collection-${id}.${format}`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n      toast.success('Collection exported successfully');\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to export collection');\n    },\n  });\n\n  const bulkDeleteCollectionsMutation = useMutation({\n    mutationFn: ({ collectionIds }: { collectionIds: string[] }) =>\n      collectionsApi.bulkDeleteCollections(collectionIds),\n    onSuccess: (_, { collectionIds }) => {\n      queryClient.invalidateQueries({ queryKey: ['collections'] });\n      collectionIds.forEach(id => {\n        queryClient.removeQueries({ queryKey: ['collection', id] });\n      });\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to delete collections');\n    },\n  });\n\n  const bulkShareCollectionsMutation = useMutation({\n    mutationFn: ({ collectionIds, shareRequest }: { collectionIds: string[]; shareRequest: ShareCollectionRequest }) =>\n      collectionsApi.bulkShareCollections(collectionIds, shareRequest),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['collections'] });\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to share collections');\n    },\n  });\n\n  const bulkExportCollectionsMutation = useMutation({\n    mutationFn: ({ collectionIds, format }: { collectionIds: string[]; format: 'json' | 'csv' | 'm3u' }) =>\n      collectionsApi.bulkExportCollections(collectionIds, format),\n    onSuccess: (blob, { format }) => {\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `collections-bulk-export.${format}`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n      toast.success('Collections exported successfully');\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to export collections');\n    },\n  });\n\n  const bulkUpdateCollectionsMutation = useMutation({\n    mutationFn: ({ collectionIds, action, updates }: { collectionIds: string[]; action: string; updates?: UpdateCollectionRequest }) =>\n      collectionsApi.bulkUpdateCollections(collectionIds, action, updates),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['collections'] });\n    },\n    onError: (error: any) => {\n      toast.error(error.message || 'Failed to update collections');\n    },\n  });\n\n  return {\n    collections,\n    isLoading,\n    error,\n    refetchCollections,\n    createCollection: createCollectionMutation.mutateAsync,\n    updateCollection: updateCollectionMutation.mutateAsync,\n    deleteCollection: deleteCollectionMutation.mutateAsync,\n    refreshCollection: refreshCollectionMutation.mutateAsync,\n    shareCollection: shareCollectionMutation.mutateAsync,\n    duplicateCollection: duplicateCollectionMutation.mutateAsync,\n    exportCollection: exportCollectionMutation.mutateAsync,\n    bulkDeleteCollections: bulkDeleteCollectionsMutation.mutateAsync,\n    bulkShareCollections: bulkShareCollectionsMutation.mutateAsync,\n    bulkExportCollections: bulkExportCollectionsMutation.mutateAsync,\n    bulkUpdateCollections: bulkUpdateCollectionsMutation.mutateAsync,\n    isCreating: createCollectionMutation.isPending,\n    isUpdating: updateCollectionMutation.isPending,\n    isDeleting: deleteCollectionMutation.isPending,\n    isRefreshing: refreshCollectionMutation.isPending,\n    isSharing: shareCollectionMutation.isPending,\n    isDuplicating: duplicateCollectionMutation.isPending,\n    isExporting: exportCollectionMutation.isPending,\n    isBulkDeleting: bulkDeleteCollectionsMutation.isPending,\n    isBulkSharing: bulkShareCollectionsMutation.isPending,\n    isBulkExporting: bulkExportCollectionsMutation.isPending,\n    isBulkUpdating: bulkUpdateCollectionsMutation.isPending,\n  };\n};\n\nexport const useCollection = (id: string) => {\n  const queryClient = useQueryClient();\n\n  const {\n    data: collection,\n    isLoading,\n    error,\n    refetch: refetchCollection,\n  } = useQuery({\n    queryKey: ['collection', id],\n    queryFn: () => collectionsApi.getCollection(id),\n    enabled: !!id,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n\n  const {\n    data: collectionItems,\n    isLoading: isLoadingItems,\n    refetch: refetchItems,\n  } = useQuery({\n    queryKey: ['collection-items', id],\n    queryFn: () => collectionsApi.getCollectionItems(id),\n    enabled: !!id,\n    staleTime: 2 * 60 * 1000, // 2 minutes\n  });\n\n  return {\n    collection,\n    collectionItems,\n    isLoading,\n    isLoadingItems,\n    error,\n    refetchCollection,\n    refetchItems,\n  };\n};\n\nexport const useCollectionAnalytics = (id: string) => {\n  const {\n    data: analytics,\n    isLoading,\n    error,\n    refetch: refetchAnalytics,\n  } = useQuery({\n    queryKey: ['collection-analytics', id],\n    queryFn: () => collectionsApi.getCollectionAnalytics(id),\n    enabled: !!id,\n    staleTime: 10 * 60 * 1000, // 10 minutes\n  });\n\n  return {\n    analytics,\n    isLoading,\n    error,\n    refetchAnalytics,\n  };\n};\n\nexport const useSharedCollection = (shareId: string) => {\n  const {\n    data: collection,\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: ['shared-collection', shareId],\n    queryFn: () => collectionsApi.getSharedCollection(shareId),\n    enabled: !!shareId,\n    staleTime: 15 * 60 * 1000, // 15 minutes\n  });\n\n  return {\n    collection,\n    isLoading,\n    error,\n  };\n};","import React, { useState, useEffect } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport { Play, Pause, SkipForward, Volume2, Download, Eye, MoreHorizontal, Music, Film, Image, FileText, Clock, Star, X, Loader2 } from 'lucide-react'\nimport { SmartCollection } from '../../types/collections'\nimport { useCollection } from '../../hooks/useCollections'\nimport { Button } from '../ui/Button'\nimport { toast } from 'react-hot-toast'\n\ninterface CollectionItem {\n  id: string\n  title: string\n  artist?: string\n  album?: string\n  duration?: number\n  media_type: 'music' | 'video' | 'image' | 'document'\n  file_size: number\n  date_added: string\n  thumbnail_url?: string\n  is_playing?: boolean\n  is_favorite?: boolean\n  rating?: number\n}\n\ninterface CollectionPreviewProps {\n  collection: SmartCollection\n  isLoading?: boolean\n  onClose: () => void\n  onPlayItem?: (itemId: string) => void\n  onPreviewItem?: (itemId: string) => void\n  onViewAllItems?: () => void\n}\n\nconst MEDIA_ICONS = {\n  music: Music,\n  video: Film,\n  image: Image,\n  document: FileText\n}\n\nconst formatDuration = (seconds?: number) => {\n  if (!seconds) return '--:--'\n  const minutes = Math.floor(seconds / 60)\n  const secs = Math.floor(seconds % 60)\n  return `${minutes}:${secs.toString().padStart(2, '0')}`\n}\n\nconst formatFileSize = (bytes: number) => {\n  const units = ['B', 'KB', 'MB', 'GB']\n  let size = bytes\n  let unitIndex = 0\n  \n  while (size >= 1024 && unitIndex < units.length - 1) {\n    size /= 1024\n    unitIndex++\n  }\n  \n  return `${size.toFixed(1)} ${units[unitIndex]}`\n}\n\nconst formatDate = (dateString: string) => {\n  const date = new Date(dateString)\n  return date.toLocaleDateString('en-US', { \n    month: 'short', \n    day: 'numeric', \n    year: 'numeric' \n  })\n}\n\nconst renderStars = (rating?: number) => {\n  if (!rating) return null\n  \n  return (\n    <div className=\"flex items-center gap-1\">\n      {[1, 2, 3, 4, 5].map((star) => (\n        <Star\n          key={star}\n          className={`w-3 h-3 ${\n            star <= rating \n              ? 'fill-yellow-400 text-yellow-400' \n              : 'text-gray-300'\n          }`}\n        />\n      ))}\n    </div>\n  )\n}\n\nexport const CollectionPreview: React.FC<CollectionPreviewProps> = ({\n  collection,\n  isLoading = false,\n  onClose,\n  onPlayItem,\n  onPreviewItem,\n  onViewAllItems\n}) => {\n  const [hoveredItem, setHoveredItem] = useState<string | null>(null)\n  const [selectedItems, setSelectedItems] = useState<Set<string>>(new Set())\n\n  // Fetch collection items using the hook\n  const { collectionItems, isLoadingItems } = useCollection(collection.id)\n\n  const handleItemSelect = (itemId: string, event: React.MouseEvent) => {\n    event.stopPropagation()\n    const newSelected = new Set(selectedItems)\n    if (newSelected.has(itemId)) {\n      newSelected.delete(itemId)\n    } else {\n      newSelected.add(itemId)\n    }\n    setSelectedItems(newSelected)\n  }\n\n  const handlePlayItem = (itemId: string, event: React.MouseEvent) => {\n    event.stopPropagation()\n    onPlayItem?.(itemId)\n    toast.success('Playing item')\n  }\n\n  const handlePreviewItem = (itemId: string, event: React.MouseEvent) => {\n    event.stopPropagation()\n    onPreviewItem?.(itemId)\n    toast.success('Previewing item')\n  }\n\n  const handleDownloadItem = (item: CollectionItem) => {\n    toast.success(`Downloading ${item.title}`)\n  }\n\n  if (isLoading || isLoadingItems) {\n    return (\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          exit={{ opacity: 0, scale: 0.9 }}\n          className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden\"\n        >\n          <div className=\"p-6\">\n            <div className=\"animate-pulse\">\n              <div className=\"h-6 bg-gray-200 rounded w-1/3 mb-4\"></div>\n              <div className=\"space-y-3\">\n                {[1, 2, 3, 4, 5].map((i) => (\n                  <div key={i} className=\"flex items-center gap-3\">\n                    <div className=\"w-12 h-12 bg-gray-200 rounded\"></div>\n                    <div className=\"flex-1\">\n                      <div className=\"h-4 bg-gray-200 rounded w-3/4 mb-2\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </motion.div>\n      </div>\n    )\n  }\n\n  const items = collectionItems?.items || []\n  const totalItems = collectionItems?.total || 0\n\n  return (\n    <AnimatePresence>\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          exit={{ opacity: 0, scale: 0.9 }}\n          className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden\"\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\n            <div>\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                {collection.name}\n              </h3>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                {totalItems} items total\n              </p>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              {selectedItems.size > 0 && (\n                <span className=\"text-sm text-gray-500 dark:text-gray-400\">\n                  {selectedItems.size} selected\n                </span>\n              )}\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={onClose}\n              >\n                <X className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6 overflow-y-auto max-h-[calc(80vh-120px)]\">\n            <div className=\"space-y-2\">\n              <AnimatePresence>\n                {items.map((item: any, index: number) => {\n                  const Icon = MEDIA_ICONS[item.media_type as keyof typeof MEDIA_ICONS]\n                  const isHovered = hoveredItem === item.id\n                  const isSelected = selectedItems.has(item.id)\n                  \n                  return (\n                    <motion.div\n                      key={item.id}\n                      initial={{ opacity: 0, y: 20 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: -20 }}\n                      transition={{ duration: 0.2, delay: index * 0.05 }}\n                      className={`\n                        group relative flex items-center gap-3 p-3 rounded-lg cursor-pointer\n                        ${isSelected \n                          ? 'bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700' \n                          : 'hover:bg-gray-50 dark:hover:bg-gray-800'\n                        }\n                      `}\n                      onMouseEnter={() => setHoveredItem(item.id)}\n                      onMouseLeave={() => setHoveredItem(null)}\n                      onClick={() => handlePreviewItem(item.id, { stopPropagation: () => {} } as any)}\n                    >\n                      {/* Selection Checkbox */}\n                      <div \n                        className=\"absolute left-2 top-1/2 -translate-y-1/2\"\n                        onClick={(e) => handleItemSelect(item.id, e)}\n                      >\n                        <div className={`\n                          w-4 h-4 rounded border-2 transition-colors\n                          ${isSelected \n                            ? 'bg-blue-500 border-blue-500' \n                            : 'border-gray-300 dark:border-gray-600'\n                          }\n                        `}>\n                          {isSelected && (\n                            <div className=\"w-full h-full flex items-center justify-center\">\n                              <div className=\"w-2 h-2 bg-white rounded-sm\"></div>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n\n                      {/* Thumbnail/Icon */}\n                      <div className=\"relative ml-6\">\n                        {item.thumbnail_url ? (\n                          <img\n                            src={item.thumbnail_url}\n                            alt={item.title}\n                            className=\"w-12 h-12 rounded object-cover\"\n                          />\n                        ) : (\n                          <div className=\"w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded flex items-center justify-center\">\n                            <Icon className=\"w-6 h-6 text-gray-400\" />\n                          </div>\n                        )}\n                        \n                        {/* Play/Pause Overlay */}\n                        {isHovered && (\n                          <motion.div\n                            initial={{ opacity: 0 }}\n                            animate={{ opacity: 1 }}\n                            className=\"absolute inset-0 bg-black/40 rounded flex items-center justify-center\"\n                            onClick={(e) => handlePlayItem(item.id, e)}\n                          >\n                            {item.is_playing ? (\n                              <Pause className=\"w-4 h-4 text-white\" />\n                            ) : (\n                              <Play className=\"w-4 h-4 text-white\" />\n                            )}\n                          </motion.div>\n                        )}\n\n                        {/* Favorite Badge */}\n                        {item.is_favorite && (\n                          <div className=\"absolute -top-1 -right-1\">\n                            <Star className=\"w-3 h-3 fill-yellow-400 text-yellow-400\" />\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Item Info */}\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2\">\n                          <h4 className=\"font-medium text-gray-900 dark:text-white truncate\">\n                            {item.title}\n                          </h4>\n                          {item.rating && renderStars(item.rating)}\n                        </div>\n                        \n                        <div className=\"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400\">\n                          {item.artist && (\n                            <span className=\"truncate\">{item.artist}</span>\n                          )}\n                          {item.album && (\n                            <span className=\"truncate\">{item.album}</span>\n                          )}\n                          <span className=\"flex items-center gap-1\">\n                            <Clock className=\"w-3 h-3\" />\n                            {formatDuration(item.duration)}\n                          </span>\n                          <span className=\"flex items-center gap-1\">\n                            <Volume2 className=\"w-3 h-3\" />\n                            {formatFileSize(item.file_size)}\n                          </span>\n                        </div>\n                      </div>\n\n                      {/* Actions */}\n                      <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                        <button\n                          className=\"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\n                          title=\"Download\"\n                          onClick={(e) => {\n                            e.stopPropagation()\n                            handleDownloadItem(item)\n                          }}\n                        >\n                          <Download className=\"w-4 h-4 text-gray-500\" />\n                        </button>\n                        \n                        <button\n                          className=\"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\"\n                          title=\"More options\"\n                          onClick={(e) => e.stopPropagation()}\n                        >\n                          <MoreHorizontal className=\"w-4 h-4 text-gray-500\" />\n                        </button>\n                      </div>\n                    </motion.div>\n                  )\n                })}\n              </AnimatePresence>\n            </div>\n\n            {/* Empty State */}\n            {items.length === 0 && (\n              <div className=\"text-center py-12\">\n                <div className=\"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Eye className=\"w-8 h-8 text-gray-400\" />\n                </div>\n                <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">\n                  No items found\n                </h3>\n                <p className=\"text-gray-500 dark:text-gray-400\">\n                  This collection doesn&apos;t have any items yet.\n                </p>\n              </div>\n            )}\n\n            {/* Load More Indicator */}\n            {items.length < totalItems && items.length > 0 && (\n              <div className=\"text-center py-4\">\n                <Button\n                  variant=\"ghost\"\n                  onClick={onViewAllItems}\n                >\n                  View All Items\n                </Button>\n              </div>\n            )}\n          </div>\n        </motion.div>\n      </div>\n    </AnimatePresence>\n  )\n}\n\nexport default CollectionPreview","import React, { useState } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport { \n  Trash2, \n  Share2, \n  Download, \n  Copy, \n  Tag, \n  Archive, \n  FolderOpen,\n  MoreHorizontal,\n  Check,\n  X\n} from 'lucide-react'\nimport { Collection } from '../../types/collections'\nimport { Button } from '../ui/Button'\nimport { Switch } from '../ui/Switch'\n\ninterface BulkOperationsProps {\n  selectedCollections: string[]\n  collections: any[]\n  onOperation: (operation: string, options?: any) => void\n  onClose: () => void\n}\n\ntype BulkAction = {\n  id: string\n  label: string\n  icon: React.ComponentType<any>\n  description: string\n  requiresConfirmation: boolean\n  options?: React.ComponentType<{ value: any; onChange: (value: any) => void }>\n}\n\ninterface ActionOptions {\n  deleteForever?: boolean\n  shareWithPermissions?: {\n    can_download: boolean\n    can_reshare: boolean\n    expires_at?: string\n  }\n  exportFormat?: 'json' | 'csv' | 'm3u'\n  moveTo?: string\n  addTags?: string[]\n}\n\nexport const BulkOperations: React.FC<BulkOperationsProps> = ({\n  selectedCollections,\n  collections,\n  onOperation,\n  onClose\n}) => {\n  const [showActions, setShowActions] = useState(false)\n  const [selectedAction, setSelectedAction] = useState<string | null>(null)\n  const [actionOptions, setActionOptions] = useState<ActionOptions>({})\n  const [showConfirmation, setShowConfirmation] = useState(false)\n  const [isActionInProgress, setIsActionInProgress] = useState(false)\n\n  const bulkActions: BulkAction[] = [\n    {\n      id: 'delete',\n      label: 'Delete Collections',\n      icon: Trash2,\n      description: 'Permanently remove selected collections',\n      requiresConfirmation: true\n    },\n    {\n      id: 'share',\n      label: 'Share Collections',\n      icon: Share2,\n      description: 'Share selected collections with others',\n      requiresConfirmation: false,\n      options: ShareOptions\n    },\n    {\n      id: 'export',\n      label: 'Export Collections',\n      icon: Download,\n      description: 'Export selected collections to file',\n      requiresConfirmation: false,\n      options: ExportOptions\n    },\n    {\n      id: 'duplicate',\n      label: 'Duplicate Collections',\n      icon: Copy,\n      description: 'Create copies of selected collections',\n      requiresConfirmation: false,\n      options: DuplicateOptions\n    },\n    {\n      id: 'tag',\n      label: 'Add Tags',\n      icon: Tag,\n      description: 'Add tags to selected collections',\n      requiresConfirmation: false,\n      options: TagOptions\n    },\n    {\n      id: 'archive',\n      label: 'Archive Collections',\n      icon: Archive,\n      description: 'Archive selected collections to storage',\n      requiresConfirmation: false,\n      options: ArchiveOptions\n    },\n    {\n      id: 'move',\n      label: 'Move Collections',\n      icon: FolderOpen,\n      description: 'Move selected collections to folder',\n      requiresConfirmation: false,\n      options: MoveOptions\n    }\n  ]\n\n  const handleActionSelect = (actionId: string) => {\n    const action = bulkActions.find(a => a.id === actionId)\n    if (!action) return\n\n    if (action.requiresConfirmation) {\n      setSelectedAction(actionId)\n      setShowConfirmation(true)\n    } else if (action.options) {\n      setSelectedAction(actionId)\n      setActionOptions({})\n    } else {\n      executeAction(actionId)\n    }\n  }\n\n  const executeAction = async (actionId: string, options?: ActionOptions) => {\n    try {\n      setIsActionInProgress(true)\n      onOperation(actionId, options || actionOptions)\n      setShowActions(false)\n      setSelectedAction(null)\n      setActionOptions({})\n      setShowConfirmation(false)\n      onClose()\n    } catch (error) {\n      console.error('Bulk action failed:', error)\n    } finally {\n      setIsActionInProgress(false)\n    }\n  }\n\n  const handleConfirmAction = async () => {\n    if (selectedAction) {\n      await executeAction(selectedAction, actionOptions)\n    }\n  }\n\n  const getActionIcon = (actionId: string) => {\n    const action = bulkActions.find(a => a.id === actionId)\n    return action ? action.icon : MoreHorizontal\n  }\n\n  const getActionDescription = (actionId: string) => {\n    const action = bulkActions.find(a => a.id === actionId)\n    return action ? action.description : ''\n  }\n\n  return (\n    <AnimatePresence>\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          exit={{ opacity: 0, scale: 0.9 }}\n          className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden\"\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\n            <div>\n              <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                Bulk Operations\n              </h3>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                {selectedCollections.length} collections selected\n              </p>\n            </div>\n            \n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onClose}\n              disabled={isActionInProgress}\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n\n          {/* Content */}\n          {!selectedAction ? (\n            <div className=\"p-6 overflow-y-auto max-h-[calc(80vh-120px)]\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {bulkActions.map((action) => {\n                  const Icon = action.icon\n                  \n                  return (\n                    <motion.div\n                      key={action.id}\n                      whileHover={{ scale: 1.02 }}\n                      whileTap={{ scale: 0.98 }}\n                      className=\"p-4 rounded-lg border cursor-pointer transition-all border-gray-200 dark:border-gray-700 hover:border-blue-500 dark:hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20\"\n                      onClick={() => handleActionSelect(action.id)}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center\">\n                          <Icon className=\"w-6 h-6 text-gray-600 dark:text-gray-400\" />\n                        </div>\n                        \n                        <div className=\"flex-1\">\n                          <h4 className=\"font-medium text-gray-900 dark:text-white\">\n                            {action.label}\n                          </h4>\n                          <p className=\"text-sm text-gray-500 dark:text-gray-400 mt-1\">\n                            {action.description}\n                          </p>\n                        </div>\n                      </div>\n                    </motion.div>\n                  )\n                })}\n              </div>\n            </div>\n          ) : (\n            <div className=\"p-6 overflow-y-auto max-h-[calc(80vh-120px)]\">\n              <div className=\"flex items-center gap-3 mb-6\">\n                <div className=\"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center\">\n                  {React.createElement(getActionIcon(selectedAction), { \n                    className: 'w-5 h-5 text-blue-600 dark:text-blue-400' \n                  })}\n                </div>\n                \n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                    {bulkActions.find(a => a.id === selectedAction)?.label}\n                  </h3>\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                    {getActionDescription(selectedAction)}\n                  </p>\n                </div>\n              </div>\n\n              {/* Action Options */}\n              <div className=\"mb-6\">\n                {selectedAction === 'share' && <ShareOptions value={actionOptions} onChange={setActionOptions} />}\n                {selectedAction === 'export' && <ExportOptions value={actionOptions} onChange={setActionOptions} />}\n                {selectedAction === 'duplicate' && <DuplicateOptions value={actionOptions} onChange={setActionOptions} />}\n                {selectedAction === 'tag' && <TagOptions value={actionOptions} onChange={setActionOptions} />}\n                {selectedAction === 'archive' && <ArchiveOptions value={actionOptions} onChange={setActionOptions} />}\n                {selectedAction === 'move' && <MoveOptions value={actionOptions} onChange={setActionOptions} />}\n                {selectedAction === 'delete' && <DeleteOptions value={actionOptions} onChange={setActionOptions} />}\n              </div>\n              \n              {/* Actions */}\n              <div className=\"flex items-center gap-3\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setSelectedAction(null)\n                    setActionOptions({})\n                  }}\n                  disabled={isActionInProgress}\n                >\n                  Back\n                </Button>\n                \n                <Button\n                  onClick={() => {\n                    if (bulkActions.find(a => a.id === selectedAction)?.requiresConfirmation) {\n                      setShowConfirmation(true)\n                    } else {\n                      executeAction(selectedAction)\n                    }\n                  }}\n                  disabled={isActionInProgress}\n                  className=\"flex-1\"\n                >\n                  {isActionInProgress ? 'Processing...' : 'Execute Action'}\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {/* Confirmation Modal */}\n          {showConfirmation && (\n            <div className=\"absolute inset-0 bg-black/70 flex items-center justify-center\">\n              <motion.div\n                initial={{ scale: 0.9 }}\n                animate={{ scale: 1 }}\n                exit={{ scale: 0.9 }}\n                className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full mx-4\"\n              >\n                <div className=\"flex items-center gap-3 mb-4\">\n                  <div className=\"w-12 h-12 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center\">\n                    <Trash2 className=\"w-6 h-6 text-red-600 dark:text-red-400\" />\n                  </div>\n                  \n                  <div>\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                      Delete Collections?\n                    </h3>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                      This will permanently delete {selectedCollections.length} collection(s) and cannot be undone.\n                    </p>\n                  </div>\n                </div>\n                \n                <div className=\"flex items-center gap-3\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      setShowConfirmation(false)\n                      setSelectedAction(null)\n                      setActionOptions({})\n                    }}\n                    disabled={isActionInProgress}\n                  >\n                    Cancel\n                  </Button>\n                  \n                  <Button\n                    variant=\"destructive\"\n                    onClick={handleConfirmAction}\n                    disabled={isActionInProgress}\n                  >\n                    {isActionInProgress ? 'Deleting...' : 'Delete'}\n                  </Button>\n                </div>\n              </motion.div>\n            </div>\n          )}\n        </motion.div>\n      </div>\n    </AnimatePresence>\n  )\n}\n\n// Action Options Components\nconst ShareOptions: React.FC<{ value: any; onChange: (value: any) => void }> = ({ value, onChange }) => (\n  <div className=\"space-y-4\">\n    <div>\n      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n        Download Permission\n      </label>\n      <Switch\n        checked={value.shareWithPermissions?.can_download ?? true}\n        onCheckedChange={(checked) => \n          onChange({\n            ...value,\n            shareWithPermissions: {\n              ...value.shareWithPermissions,\n              can_download: checked\n            }\n          })\n        }\n      />\n    </div>\n    \n    <div>\n      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n        Reshare Permission\n      </label>\n      <Switch\n        checked={value.shareWithPermissions?.can_reshare ?? false}\n        onCheckedChange={(checked) => \n          onChange({\n            ...value,\n            shareWithPermissions: {\n              ...value.shareWithPermissions,\n              can_reshare: checked\n            }\n          })\n        }\n      />\n    </div>\n  </div>\n)\n\nconst ExportOptions: React.FC<{ value: any; onChange: (value: any) => void }> = ({ value, onChange }) => (\n  <div>\n    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n      Export Format\n    </label>\n    <select\n      value={value.exportFormat || 'json'}\n      onChange={(e) => onChange({ ...value, exportFormat: e.target.value })}\n      className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n    >\n      <option value=\"json\">JSON</option>\n      <option value=\"csv\">CSV</option>\n      <option value=\"m3u\">M3U Playlist</option>\n    </select>\n  </div>\n)\n\nconst DuplicateOptions: React.FC<{ value: any; onChange: (value: any) => void }> = ({ value, onChange }) => (\n  <div>\n    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n      Suffix\n    </label>\n    <input\n      type=\"text\"\n      value={value.suffix || '(Copy)'}\n      onChange={(e) => onChange({ ...value, suffix: e.target.value })}\n      placeholder=\"Add suffix to duplicated collections\"\n      className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n    />\n  </div>\n)\n\nconst TagOptions: React.FC<{ value: any; onChange: (value: any) => void }> = ({ value, onChange }) => (\n  <div>\n    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n      Tags\n    </label>\n    <input\n      type=\"text\"\n      value={(value.addTags || []).join(', ')}\n      onChange={(e) => onChange({ \n        ...value, \n        addTags: e.target.value.split(',').map(tag => tag.trim()).filter(Boolean) \n      })}\n      placeholder=\"Enter tags separated by commas\"\n      className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n    />\n  </div>\n)\n\nconst ArchiveOptions: React.FC<{ value: any; onChange: (value: any) => void }> = ({ value, onChange }) => (\n  <div className=\"space-y-4\">\n    <div>\n      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n        Archive Location\n      </label>\n      <select\n        value={value.archiveLocation || 'default'}\n        onChange={(e) => onChange({ ...value, archiveLocation: e.target.value })}\n        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n      >\n        <option value=\"default\">Default Archive</option>\n        <option value=\"custom\">Custom Location</option>\n      </select>\n    </div>\n    \n    <div>\n      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n        Compress Archive\n      </label>\n      <Switch\n        checked={value.compressArchive ?? true}\n        onCheckedChange={(checked) => onChange({ ...value, compressArchive: checked })}\n      />\n    </div>\n  </div>\n)\n\nconst MoveOptions: React.FC<{ value: any; onChange: (value: any) => void }> = ({ value, onChange }) => (\n  <div>\n    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n      Destination Folder\n    </label>\n    <input\n      type=\"text\"\n      value={value.moveTo || ''}\n      onChange={(e) => onChange({ ...value, moveTo: e.target.value })}\n      placeholder=\"Enter destination folder path\"\n      className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n    />\n  </div>\n)\n\nconst DeleteOptions: React.FC<{ value: any; onChange: (value: any) => void }> = ({ value, onChange }) => (\n  <div>\n    <label className=\"flex items-center gap-2\">\n      <input\n        type=\"checkbox\"\n        checked={value.deleteForever ?? false}\n        onChange={(e) => onChange({ ...value, deleteForever: e.target.checked })}\n        className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n      />\n      <span className=\"text-sm text-gray-700 dark:text-gray-300\">\n        Delete permanently (cannot be recovered)\n      </span>\n    </label>\n  </div>\n)\n\nexport default BulkOperations","import React, { useEffect, useRef, useState, useCallback } from 'react'\nimport { motion } from 'framer-motion'\n\ninterface PerformanceOptimizerProps {\n  children: React.ReactNode\n  itemCount: number\n  threshold?: number\n  loadingStrategy?: 'lazy' | 'virtual' | 'pagination'\n  itemHeight?: number\n  containerHeight?: number\n  onVisibleItemsChange?: (visibleIndices: [number, number]) => void\n}\n\ninterface VirtualItem {\n  index: number\n  top: number\n  bottom: number\n  height: number\n  data: any\n}\n\nexport const PerformanceOptimizer: React.FC<PerformanceOptimizerProps> = ({\n  children,\n  itemCount,\n  threshold = 100,\n  loadingStrategy = 'lazy',\n  itemHeight = 60,\n  containerHeight = 400,\n  onVisibleItemsChange\n}) => {\n  const containerRef = useRef<HTMLDivElement>(null)\n  const [visibleRange, setVisibleRange] = useState<[number, number]>([0, Math.min(20, itemCount)])\n  const [scrollTop, setScrollTop] = useState(0)\n  const [isIntersecting, setIsIntersecting] = useState<Map<number, boolean>>(new Map())\n  const [loadedItems, setLoadedItems] = useState<Set<number>>(new Set())\n  const observerRef = useRef<IntersectionObserver | null>(null)\n\n  // Calculate visible items for virtualization\n  const calculateVisibleRange = useCallback((scrollTop: number) => {\n    const startIndex = Math.floor(scrollTop / itemHeight)\n    const endIndex = Math.min(\n      startIndex + Math.ceil(containerHeight / itemHeight) + 5, // Add buffer\n      itemCount - 1\n    )\n    return [Math.max(0, startIndex), endIndex] as [number, number]\n  }, [itemHeight, containerHeight, itemCount])\n\n  // Handle scroll events\n  const handleScroll = useCallback(() => {\n    if (!containerRef.current) return\n    \n    const newScrollTop = containerRef.current.scrollTop\n    setScrollTop(newScrollTop)\n    \n    if (loadingStrategy === 'virtual') {\n      const newRange = calculateVisibleRange(newScrollTop)\n      setVisibleRange(newRange)\n      onVisibleItemsChange?.(newRange)\n    }\n  }, [loadingStrategy, calculateVisibleRange, onVisibleItemsChange])\n\n  // Set up intersection observer for lazy loading\n  useEffect(() => {\n    if (loadingStrategy !== 'lazy') return\n\n    observerRef.current = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          const index = parseInt(entry.target.getAttribute('data-index') || '0')\n          setIsIntersecting(prev => new Map(prev.set(index, entry.isIntersecting)))\n          \n          if (entry.isIntersecting && !loadedItems.has(index)) {\n            setLoadedItems(prev => new Set(prev).add(index))\n          }\n        })\n      },\n      {\n        root: containerRef.current,\n        rootMargin: '50px',\n        threshold: 0.1\n      }\n    )\n\n    return () => {\n      observerRef.current?.disconnect()\n    }\n  }, [loadingStrategy, loadedItems])\n\n  // Debounced scroll handler\n  useEffect(() => {\n    const container = containerRef.current\n    if (!container) return\n\n    let timeoutId: NodeJS.Timeout\n    const debouncedScroll = () => {\n      clearTimeout(timeoutId)\n      timeoutId = setTimeout(handleScroll, 16) // ~60fps\n    }\n\n    container.addEventListener('scroll', debouncedScroll)\n    return () => {\n      container.removeEventListener('scroll', debouncedScroll)\n      clearTimeout(timeoutId)\n    }\n  }, [handleScroll])\n\n  // Render virtualized items\n  const renderVirtualizedItems = () => {\n    if (!Array.isArray(children)) return children\n\n    const [startIndex, endIndex] = visibleRange\n    const items = []\n    const totalHeight = itemCount * itemHeight\n\n    for (let i = startIndex; i <= endIndex; i++) {\n      const child = children[i] as React.ReactElement\n      if (!child) continue\n\n      const top = i * itemHeight\n      items.push(\n        <motion.div\n          key={i}\n          style={{\n            position: 'absolute',\n            top: `${top}px`,\n            left: 0,\n            right: 0,\n            height: `${itemHeight}px`\n          }}\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.2, delay: (i - startIndex) * 0.02 }}\n        >\n          {React.cloneElement(child, { index: i })}\n        </motion.div>\n      )\n    }\n\n    return (\n      <div style={{ height: `${totalHeight}px`, position: 'relative' }}>\n        {items}\n      </div>\n    )\n  }\n\n  // Render lazy loaded items\n  const renderLazyItems = () => {\n    if (!Array.isArray(children)) return children\n\n    return children.map((child, index) => {\n      const isLoaded = loadedItems.has(index) || index < 10 // Load first 10 items immediately\n      \n      return (\n        <motion.div\n          key={index}\n          data-index={index}\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: isLoaded ? 1 : 0, y: isLoaded ? 0 : 20 }}\n          transition={{ duration: 0.3, delay: isLoaded ? 0 : index * 0.05 }}\n          style={{\n            minHeight: isLoaded ? 'auto' : `${itemHeight}px`\n          }}\n        >\n          {isLoaded ? child : (\n            <div className=\"animate-pulse bg-gray-100 dark:bg-gray-800 rounded\" \n                 style={{ height: `${itemHeight}px` }} />\n          )}\n        </motion.div>\n      )\n    })\n  }\n\n  // Render paginated items\n  const renderPaginatedItems = () => {\n    if (!Array.isArray(children)) return children\n\n    const [startIndex, endIndex] = visibleRange\n    return children.slice(startIndex, endIndex + 1).map((child, index) => (\n      <motion.div\n        key={startIndex + index}\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.2, delay: index * 0.05 }}\n      >\n        {child}\n      </motion.div>\n    ))\n  }\n\n  // Determine rendering strategy\n  const shouldOptimize = itemCount > threshold\n  const renderItems = () => {\n    if (!shouldOptimize) return children\n\n    switch (loadingStrategy) {\n      case 'virtual':\n        return renderVirtualizedItems()\n      case 'lazy':\n        return renderLazyItems()\n      case 'pagination':\n        return renderPaginatedItems()\n      default:\n        return children\n    }\n  }\n\n  if (!shouldOptimize) {\n    return <>{children}</>\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"overflow-auto\"\n      style={{ height: `${containerHeight}px` }}\n      onScroll={handleScroll}\n    >\n      {renderItems()}\n      \n      {/* Loading indicator for pagination */}\n      {loadingStrategy === 'pagination' && visibleRange[1] < itemCount - 1 && (\n        <div className=\"flex justify-center py-4\">\n          <div className=\"animate-spin w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full\"></div>\n        </div>\n      )}\n    </div>\n  )\n}\n\n// Performance monitoring hook\nexport const usePerformanceMonitor = (componentName: string) => {\n  const renderCount = useRef(0)\n  const startTime = useRef(Date.now())\n  const lastRenderTime = useRef(Date.now())\n\n  useEffect(() => {\n    renderCount.current++\n    const now = Date.now()\n    const timeSinceLastRender = now - lastRenderTime.current\n    const totalTime = now - startTime.current\n\n    // Performance metrics available via getMetrics()\n\n    lastRenderTime.current = now\n\n    // Track frequent rendering (less than 60fps threshold)\n  })\n\n  const getMetrics = () => ({\n    renderCount: renderCount.current,\n    totalTime: Date.now() - startTime.current,\n    averageRenderTime: (Date.now() - startTime.current) / renderCount.current\n  })\n\n  return { getMetrics }\n}\n\n// Memory optimization hook\nexport const useMemoryOptimization = () => {\n  const [cache, setCache] = useState<Map<string, any>>(new Map())\n  const maxCacheSize = 100\n\n  const addToCache = useCallback((key: string, data: any) => {\n    setCache(prev => {\n      const newCache = new Map(prev)\n      \n      // Remove oldest items if cache is full\n      if (newCache.size >= maxCacheSize) {\n        const firstKey = newCache.keys().next().value\n        newCache.delete(firstKey)\n      }\n      \n      newCache.set(key, data)\n      return newCache\n    })\n  }, [])\n\n  const getFromCache = useCallback((key: string) => {\n    return cache.get(key)\n  }, [cache])\n\n  const clearCache = useCallback(() => {\n    setCache(new Map())\n  }, [])\n\n  useEffect(() => {\n    // Cleanup cache on unmount\n    return () => {\n      setCache(new Map())\n    }\n  }, [])\n\n  return { addToCache, getFromCache, clearCache, cacheSize: cache.size }\n}\n\n// Debounced search hook\nexport const useDebouncedSearch = (searchTerm: string, delay = 300) => {\n  const [debouncedTerm, setDebouncedTerm] = useState(searchTerm)\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      setDebouncedTerm(searchTerm)\n    }, delay)\n\n    return () => {\n      clearTimeout(handler)\n    }\n  }, [searchTerm, delay])\n\n  return debouncedTerm\n}\n\n// Infinite scroll hook\nexport const useInfiniteScroll = (\n  hasMore: boolean,\n  isLoading: boolean,\n  onLoadMore: () => void\n) => {\n  const observerRef = useRef<IntersectionObserver | null>(null)\n  const loadMoreRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    if (!hasMore || isLoading) return\n\n    observerRef.current = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting) {\n          onLoadMore()\n        }\n      },\n      {\n        threshold: 0.1,\n        rootMargin: '100px'\n      }\n    )\n\n    if (loadMoreRef.current) {\n      observerRef.current.observe(loadMoreRef.current)\n    }\n\n    return () => {\n      observerRef.current?.disconnect()\n    }\n  }, [hasMore, isLoading, onLoadMore])\n\n  return loadMoreRef\n}","import React, { useState, useEffect } from 'react'\nimport { motion } from 'framer-motion'\nimport {\n  Settings,\n  Palette,\n  Layout,\n  Clock,\n  Filter,\n  Download,\n  Share2,\n  Bell,\n  Shield,\n  Zap,\n  Save,\n  X,\n  Eye,\n  Grid,\n  List,\n  Play\n} from 'lucide-react'\nimport { SmartCollection } from '../../types/collections'\nimport { Button } from '../ui/Button'\nimport { Switch } from '../ui/Switch'\nimport { Select } from '../ui/Select'\n\ninterface CollectionSettingsProps {\n  collection: SmartCollection\n  onClose: () => void\n  onSave: (settings: any) => void\n}\n\ninterface CollectionPreferences {\n  // Display Settings\n  defaultView: 'grid' | 'list'\n  itemsPerPage: number\n  thumbnailSize: 'small' | 'medium' | 'large'\n  showThumbnails: boolean\n  showMetadata: boolean\n  compactView: boolean\n  \n  // Behavior Settings\n  autoRefresh: boolean\n  refreshInterval: number // minutes\n  sortOrder: 'name' | 'date_added' | 'date_modified' | 'size' | 'rating'\n  sortDirection: 'asc' | 'desc'\n  groupBy?: 'artist' | 'album' | 'genre' | 'year' | 'type'\n  \n  // Playback Settings\n  autoPlayNext: boolean\n  loopPlayback: boolean\n  rememberPosition: boolean\n  shuffleByDefault: boolean\n  \n  // Download Settings\n  defaultDownloadFormat: string\n  downloadQuality: 'original' | 'high' | 'medium' | 'low'\n  downloadLocation: 'default' | 'custom'\n  customDownloadPath?: string\n  \n  // Sharing Settings\n  defaultSharePermissions: {\n    can_download: boolean\n    can_reshare: boolean\n    expires_after_days: number\n  }\n  shareAnalytics: boolean\n  \n  // Notification Settings\n  notifyOnNewItems: boolean\n  notifyOnCollectionChanges: boolean\n  notifyOnSharedAccess: boolean\n  \n  // Privacy Settings\n  isPrivate: boolean\n  requirePassword: boolean\n  password?: string\n  allowedUsers?: string[]\n}\n\nconst DEFAULT_PREFERENCES: CollectionPreferences = {\n  defaultView: 'grid',\n  itemsPerPage: 20,\n  thumbnailSize: 'medium',\n  showThumbnails: true,\n  showMetadata: true,\n  compactView: false,\n  autoRefresh: false,\n  refreshInterval: 30,\n  sortOrder: 'date_added',\n  sortDirection: 'desc',\n  autoPlayNext: true,\n  loopPlayback: false,\n  rememberPosition: true,\n  shuffleByDefault: false,\n  defaultDownloadFormat: 'original',\n  downloadQuality: 'original',\n  downloadLocation: 'default',\n  defaultSharePermissions: {\n    can_download: true,\n    can_reshare: false,\n    expires_after_days: 7\n  },\n  shareAnalytics: true,\n  notifyOnNewItems: false,\n  notifyOnCollectionChanges: true,\n  notifyOnSharedAccess: true,\n  isPrivate: false,\n  requirePassword: false\n}\n\nconst VIEW_SIZE_OPTIONS = [\n  { value: 'small', label: 'Small (128px)' },\n  { value: 'medium', label: 'Medium (256px)' },\n  { value: 'large', label: 'Large (512px)' }\n]\n\nconst ITEMS_PER_PAGE_OPTIONS = [10, 20, 50, 100]\nconst REFRESH_INTERVAL_OPTIONS = [5, 10, 15, 30, 60, 120]\nconst DOWNLOAD_QUALITY_OPTIONS = [\n  { value: 'original', label: 'Original Quality' },\n  { value: 'high', label: 'High Quality' },\n  { value: 'medium', label: 'Medium Quality' },\n  { value: 'low', label: 'Low Quality' }\n]\n\nconst SORT_OPTIONS = [\n  { value: 'name', label: 'Name' },\n  { value: 'date_added', label: 'Date Added' },\n  { value: 'date_modified', label: 'Date Modified' },\n  { value: 'size', label: 'File Size' },\n  { value: 'rating', label: 'Rating' }\n]\n\nconst GROUP_BY_OPTIONS = [\n  { value: '', label: 'No Grouping' },\n  { value: 'artist', label: 'Artist' },\n  { value: 'album', label: 'Album' },\n  { value: 'genre', label: 'Genre' },\n  { value: 'year', label: 'Year' },\n  { value: 'type', label: 'Media Type' }\n]\n\nexport const CollectionSettings: React.FC<CollectionSettingsProps> = ({\n  collection,\n  onClose,\n  onSave\n}) => {\n  const [preferences, setPreferences] = useState<CollectionPreferences>(DEFAULT_PREFERENCES)\n  const [isSaving, setIsSaving] = useState(false)\n  const [activeTab, setActiveTab] = useState<'display' | 'behavior' | 'playback' | 'download' | 'sharing' | 'privacy'>('display')\n  const [hasChanges, setHasChanges] = useState(false)\n\n  // Load preferences on mount\n  useEffect(() => {\n    if (!collection) return\n\n    // Load saved preferences or use defaults\n    const savedPrefs = localStorage.getItem(`collection_prefs_${collection.id}`)\n    if (savedPrefs) {\n      try {\n        const parsed = JSON.parse(savedPrefs)\n        setPreferences({ ...DEFAULT_PREFERENCES, ...parsed })\n      } catch (error) {\n        console.error('Failed to load preferences:', error)\n      }\n    }\n  }, [collection])\n\n  // Save preferences to localStorage\n  const savePreferences = async () => {\n    if (!collection) return\n\n    setIsSaving(true)\n    try {\n      // Save to localStorage\n      localStorage.setItem(\n        `collection_prefs_${collection.id}`,\n        JSON.stringify(preferences)\n      )\n\n      // Update collection with relevant settings\n      await onSave({\n        is_public: !preferences.isPrivate\n      })\n\n      setHasChanges(false)\n    } catch (error) {\n      console.error('Failed to save preferences:', error)\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  // Update preferences and track changes\n  const updatePreference = <K extends keyof CollectionPreferences>(\n    key: K,\n    value: CollectionPreferences[K]\n  ) => {\n    setPreferences(prev => ({ ...prev, [key]: value }))\n    setHasChanges(true)\n  }\n\n  // Update nested preferences\n  const updateNestedPreference = (\n    path: string,\n    value: any\n  ) => {\n    setPreferences(prev => {\n      const [parent, child] = path.split('.')\n      return {\n        ...prev,\n        [parent]: {\n          ...(prev as any)[parent],\n          [child]: value\n        }\n      }\n    })\n    setHasChanges(true)\n  }\n\n  const tabs = [\n    { id: 'display', label: 'Display', icon: Layout },\n    { id: 'behavior', label: 'Behavior', icon: Settings },\n    { id: 'playback', label: 'Playback', icon: Play },\n    { id: 'download', label: 'Download', icon: Download },\n    { id: 'sharing', label: 'Sharing', icon: Share2 },\n    { id: 'privacy', label: 'Privacy', icon: Shield }\n  ]\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n    >\n      <motion.div\n        initial={{ scale: 0.9, y: 20 }}\n        animate={{ scale: 1, y: 0 }}\n        exit={{ scale: 0.9, y: 20 }}\n        className=\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden\"\n      >\n        {/* Header */}\n        <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                Collection Settings\n              </h2>\n              <p className=\"text-gray-500 dark:text-gray-400 mt-1\">\n                {collection.name}\n              </p>\n            </div>\n            \n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onClose}\n            >\n              <X className=\"w-5 h-5\" />\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"flex flex-1 overflow-hidden\">\n          {/* Sidebar */}\n          <div className=\"w-48 border-r border-gray-200 dark:border-gray-700 p-4\">\n            <nav className=\"space-y-1\">\n              {tabs.map(tab => {\n                const Icon = tab.icon\n                const isActive = activeTab === tab.id\n                \n                return (\n                  <button\n                    key={tab.id}\n                    onClick={() => setActiveTab(tab.id as any)}\n                    className={`\n                      w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors\n                      ${isActive \n                        ? 'bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400' \n                        : 'text-gray-600 hover:bg-gray-50 dark:text-gray-400 dark:hover:bg-gray-800'\n                      }\n                    `}\n                  >\n                    <Icon className=\"w-4 h-4\" />\n                    <span className=\"font-medium\">{tab.label}</span>\n                  </button>\n                )\n              })}\n            </nav>\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 overflow-y-auto p-6\">\n            {/* Display Settings */}\n            {activeTab === 'display' && (\n              <motion.div\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                className=\"space-y-6\"\n              >\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                    View Settings\n                  </h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Default View\n                      </label>\n                      <div className=\"flex gap-2\">\n                        <button\n                          onClick={() => updatePreference('defaultView', 'grid')}\n                          className={`\n                            flex items-center gap-2 px-4 py-2 rounded-lg border\n                            ${preferences.defaultView === 'grid'\n                              ? 'bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-700 dark:text-blue-300'\n                              : 'border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-300'\n                            }\n                          `}\n                        >\n                          <Grid className=\"w-4 h-4\" />\n                          Grid\n                        </button>\n                        <button\n                          onClick={() => updatePreference('defaultView', 'list')}\n                          className={`\n                            flex items-center gap-2 px-4 py-2 rounded-lg border\n                            ${preferences.defaultView === 'list'\n                              ? 'bg-blue-50 border-blue-200 text-blue-700 dark:bg-blue-900/20 dark:border-blue-700 dark:text-blue-300'\n                              : 'border-gray-200 dark:border-gray-600 text-gray-700 dark:text-gray-300'\n                            }\n                          `}\n                        >\n                          <List className=\"w-4 h-4\" />\n                          List\n                        </button>\n                      </div>\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Items Per Page\n                      </label>\n                      <Select\n                        value={preferences.itemsPerPage.toString()}\n                        onChange={(value) => updatePreference('itemsPerPage', parseInt(value))}\n                        options={ITEMS_PER_PAGE_OPTIONS.map(count => ({\n                          value: count.toString(),\n                          label: `${count} items`\n                        }))}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Thumbnail Size\n                      </label>\n                      <Select\n                        value={preferences.thumbnailSize}\n                        onChange={(value) => updatePreference('thumbnailSize', value as any)}\n                        options={VIEW_SIZE_OPTIONS}\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                    Display Options\n                  </h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                        Show Thumbnails\n                      </label>\n                      <Switch\n                        checked={preferences.showThumbnails}\n                        onCheckedChange={(checked) => updatePreference('showThumbnails', checked)}\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                        Show Metadata\n                      </label>\n                      <Switch\n                        checked={preferences.showMetadata}\n                        onCheckedChange={(checked) => updatePreference('showMetadata', checked)}\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                        Compact View\n                      </label>\n                      <Switch\n                        checked={preferences.compactView}\n                        onCheckedChange={(checked) => updatePreference('compactView', checked)}\n                      />\n                    </div>\n                  </div>\n                </div>\n              </motion.div>\n            )}\n\n            {/* Behavior Settings */}\n            {activeTab === 'behavior' && (\n              <motion.div\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                className=\"space-y-6\"\n              >\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                    Auto-Refresh\n                  </h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                        Auto Refresh Collection\n                      </label>\n                      <Switch\n                        checked={preferences.autoRefresh}\n                        onCheckedChange={(checked) => updatePreference('autoRefresh', checked)}\n                      />\n                    </div>\n\n                    {preferences.autoRefresh && (\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          Refresh Interval\n                        </label>\n                        <Select\n                          value={preferences.refreshInterval.toString()}\n                          onChange={(value) => updatePreference('refreshInterval', parseInt(value))}\n                          options={REFRESH_INTERVAL_OPTIONS.map(interval => ({\n                            value: interval.toString(),\n                            label: interval >= 60 \n                              ? `${interval / 60} hours` \n                              : `${interval} minutes`\n                          }))}\n                        />\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                    Sort & Group\n                  </h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Sort By\n                      </label>\n                      <Select\n                        value={preferences.sortOrder}\n                        onChange={(value) => updatePreference('sortOrder', value as any)}\n                        options={SORT_OPTIONS}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Sort Direction\n                      </label>\n                      <Select\n                        value={preferences.sortDirection}\n                        onChange={(value) => updatePreference('sortDirection', value as any)}\n                        options={[\n                          { value: 'asc', label: 'Ascending' },\n                          { value: 'desc', label: 'Descending' }\n                        ]}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Group By\n                      </label>\n                      <Select\n                        value={preferences.groupBy || ''}\n                        onChange={(value) => updatePreference('groupBy', value as any)}\n                        options={GROUP_BY_OPTIONS}\n                      />\n                    </div>\n                  </div>\n                </div>\n              </motion.div>\n            )}\n\n            {/* Playback Settings */}\n            {activeTab === 'playback' && (\n              <motion.div\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                className=\"space-y-6\"\n              >\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                      Auto Play Next Item\n                    </label>\n                    <Switch\n                      checked={preferences.autoPlayNext}\n                      onCheckedChange={(checked) => updatePreference('autoPlayNext', checked)}\n                    />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                      Loop Playback\n                    </label>\n                    <Switch\n                      checked={preferences.loopPlayback}\n                      onCheckedChange={(checked) => updatePreference('loopPlayback', checked)}\n                    />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                      Remember Playback Position\n                    </label>\n                    <Switch\n                      checked={preferences.rememberPosition}\n                      onCheckedChange={(checked) => updatePreference('rememberPosition', checked)}\n                    />\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                      Shuffle by Default\n                    </label>\n                    <Switch\n                      checked={preferences.shuffleByDefault}\n                      onCheckedChange={(checked) => updatePreference('shuffleByDefault', checked)}\n                    />\n                  </div>\n                </div>\n              </motion.div>\n            )}\n\n            {/* Download Settings */}\n            {activeTab === 'download' && (\n              <motion.div\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                className=\"space-y-6\"\n              >\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                    Download Options\n                  </h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Default Format\n                      </label>\n                      <Select\n                        value={preferences.defaultDownloadFormat}\n                        onChange={(value) => updatePreference('defaultDownloadFormat', value)}\n                        options={[\n                          { value: 'original', label: 'Original Format' },\n                          { value: 'mp3', label: 'MP3' },\n                          { value: 'mp4', label: 'MP4' },\n                          { value: 'flac', label: 'FLAC' }\n                        ]}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Download Quality\n                      </label>\n                      <Select\n                        value={preferences.downloadQuality}\n                        onChange={(value) => updatePreference('downloadQuality', value as any)}\n                        options={DOWNLOAD_QUALITY_OPTIONS}\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Download Location\n                      </label>\n                      <Select\n                        value={preferences.downloadLocation}\n                        onChange={(value) => updatePreference('downloadLocation', value as any)}\n                        options={[\n                          { value: 'default', label: 'Default Downloads Folder' },\n                          { value: 'custom', label: 'Custom Location' }\n                        ]}\n                      />\n                    </div>\n\n                    {preferences.downloadLocation === 'custom' && (\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          Custom Path\n                        </label>\n                        <input\n                          type=\"text\"\n                          value={preferences.customDownloadPath || ''}\n                          onChange={(e) => updatePreference('customDownloadPath', e.target.value)}\n                          placeholder=\"/path/to/downloads\"\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                        />\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </motion.div>\n            )}\n\n            {/* Sharing Settings */}\n            {activeTab === 'sharing' && (\n              <motion.div\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                className=\"space-y-6\"\n              >\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                    Default Permissions\n                  </h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                        Allow Download\n                      </label>\n                      <Switch\n                        checked={preferences.defaultSharePermissions.can_download}\n                        onCheckedChange={(checked) => \n                          updateNestedPreference('defaultSharePermissions.can_download', checked)\n                        }\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                        Allow Reshare\n                      </label>\n                      <Switch\n                        checked={preferences.defaultSharePermissions.can_reshare}\n                        onCheckedChange={(checked) => \n                          updateNestedPreference('defaultSharePermissions.can_reshare', checked)\n                        }\n                      />\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Default Expiry (Days)\n                      </label>\n                      <input\n                        type=\"number\"\n                        min=\"1\"\n                        max=\"365\"\n                        value={preferences.defaultSharePermissions.expires_after_days}\n                        onChange={(e) => \n                          updateNestedPreference('defaultSharePermissions.expires_after_days', parseInt(e.target.value))\n                        }\n                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                    Analytics\n                  </h3>\n                  \n                  <div className=\"flex items-center justify-between\">\n                    <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                      Track Share Analytics\n                    </label>\n                    <Switch\n                      checked={preferences.shareAnalytics}\n                      onCheckedChange={(checked) => updatePreference('shareAnalytics', checked)}\n                    />\n                  </div>\n                </div>\n              </motion.div>\n            )}\n\n            {/* Privacy Settings */}\n            {activeTab === 'privacy' && (\n              <motion.div\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                className=\"space-y-6\"\n              >\n                <div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                    Privacy Controls\n                  </h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                        Private Collection\n                      </label>\n                      <Switch\n                        checked={preferences.isPrivate}\n                        onCheckedChange={(checked) => updatePreference('isPrivate', checked)}\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                        Require Password\n                      </label>\n                      <Switch\n                        checked={preferences.requirePassword}\n                        onCheckedChange={(checked) => updatePreference('requirePassword', checked)}\n                      />\n                    </div>\n\n                    {preferences.requirePassword && (\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          Collection Password\n                        </label>\n                        <input\n                          type=\"password\"\n                          value={preferences.password || ''}\n                          onChange={(e) => updatePreference('password', e.target.value)}\n                          placeholder=\"Enter collection password\"\n                          className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                        />\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </motion.div>\n            )}\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"p-6 border-t border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n              {hasChanges ? 'You have unsaved changes' : 'All changes saved'}\n            </div>\n            \n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"outline\"\n                onClick={onClose}\n              >\n                Cancel\n              </Button>\n              \n              <Button\n                onClick={savePreferences}\n                disabled={isSaving || !hasChanges}\n              >\n                <Save className=\"w-4 h-4 mr-2\" />\n                {isSaving ? 'Saving...' : 'Save Settings'}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </motion.div>\n    </motion.div>\n  )\n}\n\nexport default CollectionSettings","import React, { useState, useEffect, useMemo } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport {\n  BarChart3,\n  TrendingUp,\n  TrendingDown,\n  Play,\n  Clock,\n  Users,\n  Share2,\n  Download,\n  Star,\n  Eye,\n  Filter,\n  Calendar,\n  PieChart,\n  Activity,\n  FileAudio,\n  FileVideo,\n  FileImage,\n  FileText,\n  RefreshCw,\n  Download as DownloadIcon,\n  Upload,\n  Link,\n  Mail,\n  MessageCircle,\n  X\n} from 'lucide-react'\nimport { Button } from '../ui/Button'\nimport { Card } from '../ui/Card'\nimport { Select } from '../ui/Select'\nimport { Input } from '../ui/Input'\nimport { Switch } from '../ui/Switch'\nimport { SmartCollection } from '../../types/collections'\nimport { useCollection } from '../../hooks/useCollections'\n\ninterface CollectionAnalyticsProps {\n  collection: SmartCollection\n  onClose?: () => void\n}\n\ninterface AnalyticsData {\n  overview: {\n    totalItems: number\n    totalSize: string\n    totalDuration: string\n    averageRating: number\n    playCount: number\n    downloadCount: number\n    shareCount: number\n    viewCount: number\n  }\n  mediaBreakdown: {\n    music: number\n    video: number\n    image: number\n    document: number\n  }\n  activity: {\n    daily: Array<{ date: string; plays: number; downloads: number; shares: number }>\n    weekly: Array<{ week: string; plays: number; downloads: number; shares: number }>\n    monthly: Array<{ month: string; plays: number; downloads: number; shares: number }>\n  }\n  topItems: Array<{\n    id: string\n    title: string\n    type: string\n    plays: number\n    rating: number\n    size: string\n  }>\n  sharingStats: {\n    sharedByType: {\n      link: number\n      email: number\n      social: number\n      embed: number\n    }\n    sharePerformance: Array<{\n      date: string\n      shares: number\n      clicks: number\n      downloads: number\n    }>\n    topReferrers: Array<{\n      source: string\n      visits: number\n      conversion: number\n    }>\n  }\n  engagementMetrics: {\n    completionRate: number\n    averageWatchTime: string\n    skipRate: number\n    repeatViews: number\n    comments: number\n    likes: number\n  }\n}\n\nconst MEDIA_ICONS = {\n  music: FileAudio,\n  video: FileVideo,\n  image: FileImage,\n  document: FileText\n}\n\nconst TIME_RANGES = [\n  { value: '7d', label: 'Last 7 Days' },\n  { value: '30d', label: 'Last 30 Days' },\n  { value: '90d', label: 'Last 90 Days' },\n  { value: '1y', label: 'Last Year' },\n  { value: 'all', label: 'All Time' }\n]\n\nconst CHART_TYPES = [\n  { value: 'plays', label: 'Plays' },\n  { value: 'downloads', label: 'Downloads' },\n  { value: 'shares', label: 'Shares' },\n  { value: 'views', label: 'Views' }\n]\n\nexport const CollectionAnalytics: React.FC<CollectionAnalyticsProps> = ({\n  collection,\n  onClose\n}) => {\n  const [timeRange, setTimeRange] = useState('30d')\n  const [chartType, setChartType] = useState('plays')\n  const [isLoading, setIsLoading] = useState(false)\n  const [showComparison, setShowComparison] = useState(false)\n  const [activeTab, setActiveTab] = useState<'overview' | 'activity' | 'content' | 'sharing' | 'engagement'>('overview')\n  \n  const { collectionItems, isLoading: itemsLoading } = useCollection(collection?.id || '')\n\n  // Use collection items from props if available\n  const items = collectionItems || []\n\n  // Mock analytics data generation\n  const analyticsData = useMemo((): AnalyticsData => {\n    const totalItems = items.length\n    const totalSize = items.reduce((sum: any, item: any) => sum + (item.size || 0), 0)\n    const averageRating = items.reduce((sum: any, item: any) => sum + (item.rating || 0), 0) / totalItems || 0\n    \n    // Generate activity data based on time range\n    const generateActivityData = (period: 'daily' | 'weekly' | 'monthly'): any[] => {\n      const now = new Date()\n      const data: any[] = []\n      let periods = 30\n      \n      if (timeRange === '7d') periods = period === 'daily' ? 7 : period === 'weekly' ? 1 : 1\n      else if (timeRange === '30d') periods = period === 'daily' ? 30 : period === 'weekly' ? 4 : 1\n      else if (timeRange === '90d') periods = period === 'daily' ? 90 : period === 'weekly' ? 12 : 3\n      else if (timeRange === '1y') periods = period === 'daily' ? 365 : period === 'weekly' ? 52 : 12\n      \n      for (let i = periods - 1; i >= 0; i--) {\n        const date = new Date(now)\n        \n        if (period === 'daily') {\n          date.setDate(date.getDate() - i)\n          data.push({\n            date: date.toLocaleDateString(),\n            plays: Math.floor(Math.random() * 100) + 20,\n            downloads: Math.floor(Math.random() * 20) + 5,\n            shares: Math.floor(Math.random() * 10) + 1\n          })\n        } else if (period === 'weekly') {\n          date.setDate(date.getDate() - (i * 7))\n          data.push({\n            week: `Week ${i + 1}`,\n            plays: Math.floor(Math.random() * 500) + 100,\n            downloads: Math.floor(Math.random() * 50) + 10,\n            shares: Math.floor(Math.random() * 30) + 5\n          })\n        } else {\n          date.setMonth(date.getMonth() - i)\n          data.push({\n            month: date.toLocaleDateString('en', { month: 'short', year: 'numeric' }),\n            plays: Math.floor(Math.random() * 2000) + 500,\n            downloads: Math.floor(Math.random() * 200) + 50,\n            shares: Math.floor(Math.random() * 100) + 20\n          })\n        }\n      }\n      \n      return data\n    }\n\n    // Generate media breakdown\n    const mediaTypes = items.reduce((acc: any, item: any) => {\n      const type = item.media_type || 'document'\n      acc[type] = (acc[type] || 0) + 1\n      return acc\n    }, {} as Record<string, number>)\n\n    // Generate top items\n    const topItems = items\n      .filter((item: any) => item.rating || Math.random() > 0.5)\n      .slice(0, 10)\n      .map((item: any) => ({\n        id: item.id,\n        title: item.title || item.name || 'Unknown',\n        type: item.media_type || 'document',\n        plays: Math.floor(Math.random() * 1000) + 100,\n        rating: item.rating || Math.random() * 5,\n        size: formatFileSize(item.size || Math.random() * 1000000000)\n      }))\n      .sort((a: any, b: any) => b.plays - a.plays)\n\n    return {\n      overview: {\n        totalItems,\n        totalSize: formatFileSize(totalSize),\n        totalDuration: formatDuration(items.reduce((sum: any, item: any) => sum + (item.duration || 0), 0)),\n        averageRating,\n        playCount: Math.floor(Math.random() * 10000) + 1000,\n        downloadCount: Math.floor(Math.random() * 1000) + 100,\n        shareCount: Math.floor(Math.random() * 500) + 50,\n        viewCount: Math.floor(Math.random() * 20000) + 2000\n      },\n      mediaBreakdown: {\n        music: mediaTypes.music || 0,\n        video: mediaTypes.video || 0,\n        image: mediaTypes.image || 0,\n        document: mediaTypes.document || 0\n      },\n      activity: {\n        daily: generateActivityData('daily'),\n        weekly: generateActivityData('weekly'),\n        monthly: generateActivityData('monthly')\n      },\n      topItems,\n      sharingStats: {\n        sharedByType: {\n          link: Math.floor(Math.random() * 100) + 20,\n          email: Math.floor(Math.random() * 50) + 10,\n          social: Math.floor(Math.random() * 30) + 5,\n          embed: Math.floor(Math.random() * 20) + 5\n        },\n        sharePerformance: Array.from({ length: 30 }, (_, i) => ({\n          date: new Date(Date.now() - (29 - i) * 24 * 60 * 60 * 1000).toLocaleDateString(),\n          shares: Math.floor(Math.random() * 20) + 5,\n          clicks: Math.floor(Math.random() * 100) + 20,\n          downloads: Math.floor(Math.random() * 50) + 10\n        })),\n        topReferrers: [\n          { source: 'Direct', visits: 1000, conversion: 15.5 },\n          { source: 'Google', visits: 500, conversion: 8.2 },\n          { source: 'Facebook', visits: 300, conversion: 12.1 },\n          { source: 'Twitter', visits: 200, conversion: 9.8 },\n          { source: 'Email', visits: 150, conversion: 22.3 }\n        ]\n      },\n      engagementMetrics: {\n        completionRate: Math.random() * 50 + 50,\n        averageWatchTime: formatDuration(Math.floor(Math.random() * 3600) + 300),\n        skipRate: Math.random() * 30,\n        repeatViews: Math.floor(Math.random() * 1000) + 200,\n        comments: Math.floor(Math.random() * 100) + 20,\n        likes: Math.floor(Math.random() * 500) + 100\n      }\n    }\n  }, [items, timeRange])\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes === 0) return '0 B'\n    const k = 1024\n    const sizes = ['B', 'KB', 'MB', 'GB', 'TB']\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\n  }\n\n  const formatDuration = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600)\n    const minutes = Math.floor((seconds % 3600) / 60)\n    const secs = Math.floor(seconds % 60)\n    \n    if (hours > 0) {\n      return `${hours}h ${minutes}m`\n    } else if (minutes > 0) {\n      return `${minutes}m ${secs}s`\n    } else {\n      return `${secs}s`\n    }\n  }\n\n  const handleExportAnalytics = (format: 'csv' | 'json' | 'pdf') => {\n    const data = {\n      collection: collection.name,\n      generated: new Date().toISOString(),\n      timeRange,\n      analytics: analyticsData\n    }\n    \n    if (format === 'json') {\n      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' })\n      const url = URL.createObjectURL(blob)\n      const a = document.createElement('a')\n      a.href = url\n      a.download = `collection-analytics-${collection.name}-${Date.now()}.json`\n      a.click()\n      URL.revokeObjectURL(url)\n    } else if (format === 'csv') {\n      // Simple CSV export for overview stats\n      const csv = `Metric,Value\\nTotal Items,${analyticsData.overview.totalItems}\\nTotal Size,${analyticsData.overview.totalSize}\\nAverage Rating,${analyticsData.overview.averageRating.toFixed(2)}\\nPlay Count,${analyticsData.overview.playCount}\\nDownload Count,${analyticsData.overview.downloadCount}\\nShare Count,${analyticsData.overview.shareCount}\\nView Count,${analyticsData.overview.viewCount}`\n      \n      const blob = new Blob([csv], { type: 'text/csv' })\n      const url = URL.createObjectURL(blob)\n      const a = document.createElement('a')\n      a.href = url\n      a.download = `collection-analytics-${collection.name}-${Date.now()}.csv`\n      a.click()\n      URL.revokeObjectURL(url)\n    }\n  }\n\n  const StatCard = ({ title, value, icon: Icon, change, changeType }: {\n    title: string\n    value: string | number\n    icon: any\n    change?: number\n    changeType?: 'increase' | 'decrease'\n  }) => (\n    <motion.div\n      whileHover={{ scale: 1.02 }}\n      className=\"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700\"\n    >\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-1\">{title}</p>\n          <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">{value}</p>\n          {change !== undefined && (\n            <div className=\"flex items-center mt-2 text-sm\">\n              {changeType === 'increase' ? (\n                <TrendingUp className=\"w-4 h-4 text-green-500 mr-1\" />\n              ) : (\n                <TrendingDown className=\"w-4 h-4 text-red-500 mr-1\" />\n              )}\n              <span className={changeType === 'increase' ? 'text-green-500' : 'text-red-500'}>\n                {change}%\n              </span>\n              <span className=\"text-gray-500 dark:text-gray-400 ml-1\">vs last period</span>\n            </div>\n          )}\n        </div>\n        <div className=\"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg\">\n          <Icon className=\"w-6 h-6 text-blue-600 dark:text-blue-400\" />\n        </div>\n      </div>\n    </motion.div>\n  )\n\n  const renderOverview = () => (\n    <div className=\"space-y-6\">\n      {/* Key Metrics */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <StatCard\n          title=\"Total Items\"\n          value={analyticsData.overview.totalItems.toLocaleString()}\n          icon={BarChart3}\n          change={12.5}\n          changeType=\"increase\"\n        />\n        <StatCard\n          title=\"Total Plays\"\n          value={analyticsData.overview.playCount.toLocaleString()}\n          icon={Play}\n          change={8.3}\n          changeType=\"increase\"\n        />\n        <StatCard\n          title=\"Downloads\"\n          value={analyticsData.overview.downloadCount.toLocaleString()}\n          icon={Download}\n          change={-2.1}\n          changeType=\"decrease\"\n        />\n        <StatCard\n          title=\"Shares\"\n          value={analyticsData.overview.shareCount.toLocaleString()}\n          icon={Share2}\n          change={15.7}\n          changeType=\"increase\"\n        />\n      </div>\n\n      {/* Media Breakdown */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Media Breakdown</h3>\n          <div className=\"space-y-3\">\n            {Object.entries(analyticsData.mediaBreakdown).map(([type, count]) => {\n              const Icon = MEDIA_ICONS[type as keyof typeof MEDIA_ICONS]\n              const total = Object.values(analyticsData.mediaBreakdown).reduce((a, b) => a + b, 0)\n              const percentage = total > 0 ? (count / total) * 100 : 0\n              \n              return (\n                <div key={type} className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"bg-gray-100 dark:bg-gray-700 p-2 rounded\">\n                      <Icon className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\n                    </div>\n                    <div>\n                      <p className=\"font-medium text-gray-900 dark:text-white capitalize\">{type}</p>\n                      <p className=\"text-sm text-gray-500 dark:text-gray-400\">{count} items</p>\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-semibold text-gray-900 dark:text-white\">{percentage.toFixed(1)}%</p>\n                    <div className=\"w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-1\">\n                      <div \n                        className=\"bg-blue-500 h-2 rounded-full\" \n                        style={{ width: `${percentage}%` }}\n                      />\n                    </div>\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Collection Stats</h3>\n          <div className=\"space-y-4\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-gray-600 dark:text-gray-400\">Total Size</span>\n              <span className=\"font-semibold text-gray-900 dark:text-white\">\n                {analyticsData.overview.totalSize}\n              </span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-gray-600 dark:text-gray-400\">Total Duration</span>\n              <span className=\"font-semibold text-gray-900 dark:text-white\">\n                {analyticsData.overview.totalDuration}\n              </span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-gray-600 dark:text-gray-400\">Average Rating</span>\n              <div className=\"flex items-center gap-2\">\n                <Star className=\"w-4 h-4 text-yellow-500 fill-current\" />\n                <span className=\"font-semibold text-gray-900 dark:text-white\">\n                  {analyticsData.overview.averageRating.toFixed(1)}\n                </span>\n              </div>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-gray-600 dark:text-gray-400\">Total Views</span>\n              <span className=\"font-semibold text-gray-900 dark:text-white\">\n                {analyticsData.overview.viewCount.toLocaleString()}\n              </span>\n            </div>\n          </div>\n        </Card>\n      </div>\n\n      {/* Top Items */}\n      <Card className=\"p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Top Items</h3>\n        <div className=\"space-y-3\">\n          {analyticsData.topItems.slice(0, 5).map((item, index) => (\n            <div key={item.id} className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center text-sm font-semibold text-blue-600 dark:text-blue-400\">\n                  {index + 1}\n                </div>\n                <div>\n                  <p className=\"font-medium text-gray-900 dark:text-white truncate max-w-xs\">\n                    {item.title}\n                  </p>\n                  <div className=\"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400\">\n                    {(() => {\n                      const IconComponent = MEDIA_ICONS[item.type as keyof typeof MEDIA_ICONS] || FileText\n                      return <IconComponent className=\"w-3 h-3\" />\n                    })()}\n                    <span>{item.size}</span>\n                  </div>\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <p className=\"font-semibold text-gray-900 dark:text-white\">{item.plays}</p>\n                <div className=\"flex items-center gap-1 text-sm\">\n                  <Star className=\"w-3 h-3 text-yellow-500 fill-current\" />\n                  <span className=\"text-gray-500 dark:text-gray-400\">{item.rating.toFixed(1)}</span>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </Card>\n    </div>\n  )\n\n  const renderActivity = () => (\n    <div className=\"space-y-6\">\n      {/* Activity Chart Controls */}\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Activity Trends</h3>\n        <div className=\"flex items-center gap-4\">\n          <Select\n            value={timeRange}\n            onChange={setTimeRange}\n            options={TIME_RANGES}\n            className=\"w-40\"\n          />\n          <Select\n            value={chartType}\n            onChange={setChartType}\n            options={CHART_TYPES}\n            className=\"w-32\"\n          />\n        </div>\n      </div>\n\n      {/* Simple Activity Chart */}\n      <Card className=\"p-6\">\n        <div className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            {['daily', 'weekly', 'monthly'].map((period) => (\n              <div key={period} className=\"space-y-2\">\n                <h4 className=\"font-medium text-gray-900 dark:text-white capitalize\">{period} Activity</h4>\n                <div className=\"space-y-2\">\n                  {analyticsData.activity[period as keyof typeof analyticsData.activity].slice(0, 5).map((data, index) => (\n                    <div key={index} className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-600 dark:text-gray-400\">\n                        {period === 'daily' ? (data as any).date : period === 'weekly' ? (data as any).week : (data as any).month}\n                      </span>\n                      <span className=\"font-medium text-gray-900 dark:text-white\">\n                        {data[chartType as keyof typeof data] || 0}\n                      </span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </Card>\n\n      {/* Engagement Metrics */}\n      <Card className=\"p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Engagement Metrics</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n            <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n              {analyticsData.engagementMetrics.completionRate.toFixed(1)}%\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Completion Rate</p>\n          </div>\n          <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n            <p className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n              {analyticsData.engagementMetrics.averageWatchTime}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Avg Watch Time</p>\n          </div>\n          <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n            <p className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">\n              {analyticsData.engagementMetrics.repeatViews.toLocaleString()}\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">Repeat Views</p>\n          </div>\n        </div>\n      </Card>\n    </div>\n  )\n\n  const renderSharing = () => (\n    <div className=\"space-y-6\">\n      {/* Share Performance */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Share Types</h3>\n          <div className=\"space-y-3\">\n            {Object.entries(analyticsData.sharingStats.sharedByType).map(([type, count]) => {\n              const total = Object.values(analyticsData.sharingStats.sharedByType).reduce((a, b) => a + b, 0)\n              const percentage = total > 0 ? (count / total) * 100 : 0\n              \n              const iconMap = {\n                link: Link,\n                email: Mail,\n                social: MessageCircle,\n                embed: Upload\n              }\n              const Icon = iconMap[type as keyof typeof iconMap] || Share2\n              \n              return (\n                <div key={type} className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <Icon className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\n                    <span className=\"capitalize text-gray-900 dark:text-white\">{type}</span>\n                  </div>\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-20 bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\n                      <div \n                        className=\"bg-green-500 h-2 rounded-full\" \n                        style={{ width: `${percentage}%` }}\n                      />\n                    </div>\n                    <span className=\"text-sm font-medium text-gray-900 dark:text-white w-12 text-right\">\n                      {count}\n                    </span>\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Top Referrers</h3>\n          <div className=\"space-y-3\">\n            {analyticsData.sharingStats.topReferrers.map((referrer, index) => (\n              <div key={referrer.source} className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-6 h-6 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center text-xs font-semibold text-blue-600 dark:text-blue-400\">\n                    {index + 1}\n                  </div>\n                  <span className=\"font-medium text-gray-900 dark:text-white\">{referrer.source}</span>\n                </div>\n                <div className=\"text-right\">\n                  <p className=\"font-semibold text-gray-900 dark:text-white\">{referrer.visits}</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">{referrer.conversion}% conv.</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </Card>\n      </div>\n\n      {/* Recent Share Activity */}\n      <Card className=\"p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Recent Share Activity</h3>\n        <div className=\"space-y-2\">\n          {analyticsData.sharingStats.sharePerformance.slice(0, 10).map((data, index) => (\n            <div key={index} className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n              <div>\n                <p className=\"font-medium text-gray-900 dark:text-white\">{data.date}</p>\n              </div>\n              <div className=\"flex items-center gap-6 text-sm\">\n                <div className=\"flex items-center gap-1\">\n                  <Share2 className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"text-gray-600 dark:text-gray-400\">{data.shares}</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <Eye className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"text-gray-600 dark:text-gray-400\">{data.clicks}</span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <Download className=\"w-3 h-3 text-gray-500\" />\n                  <span className=\"text-gray-600 dark:text-gray-400\">{data.downloads}</span>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </Card>\n    </div>\n  )\n\n  const renderContent = () => (\n    <div className=\"space-y-6\">\n      <Card className=\"p-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Content Performance</h3>\n        <div className=\"space-y-4\">\n          {analyticsData.topItems.map((item, index) => (\n            <div key={item.id} className=\"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center text-sm font-semibold text-blue-600 dark:text-blue-400\">\n                  {index + 1}\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"font-medium text-gray-900 dark:text-white mb-1\">{item.title}</p>\n                  <div className=\"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400\">\n                    <span className=\"capitalize\">{item.type}</span>\n                    <span>{item.size}</span>\n                    <div className=\"flex items-center gap-1\">\n                      <Star className=\"w-3 h-3 text-yellow-500 fill-current\" />\n                      <span>{item.rating.toFixed(1)}</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <p className=\"text-xl font-bold text-gray-900 dark:text-white\">{item.plays}</p>\n                <p className=\"text-sm text-gray-500 dark:text-gray-400\">plays</p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </Card>\n    </div>\n  )\n\n  const renderEngagement = () => (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"font-medium text-gray-900 dark:text-white\">Completion Rate</h3>\n            <Activity className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"text-3xl font-bold text-blue-600 dark:text-blue-400\">\n              {analyticsData.engagementMetrics.completionRate.toFixed(1)}%\n            </div>\n            <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3\">\n              <div \n                className=\"bg-blue-500 h-3 rounded-full\" \n                style={{ width: `${analyticsData.engagementMetrics.completionRate}%` }}\n              />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"font-medium text-gray-900 dark:text-white\">Skip Rate</h3>\n            <TrendingDown className=\"w-5 h-5 text-red-600 dark:text-red-400\" />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"text-3xl font-bold text-red-600 dark:text-red-400\">\n              {analyticsData.engagementMetrics.skipRate.toFixed(1)}%\n            </div>\n            <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3\">\n              <div \n                className=\"bg-red-500 h-3 rounded-full\" \n                style={{ width: `${analyticsData.engagementMetrics.skipRate}%` }}\n              />\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"font-medium text-gray-900 dark:text-white\">Average Watch Time</h3>\n            <Clock className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"text-3xl font-bold text-green-600 dark:text-green-400\">\n              {analyticsData.engagementMetrics.averageWatchTime}\n            </div>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">per session</p>\n          </div>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">User Interactions</h3>\n          <div className=\"space-y-4\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-gray-600 dark:text-gray-400\">Repeat Views</span>\n              <span className=\"font-semibold text-gray-900 dark:text-white\">\n                {analyticsData.engagementMetrics.repeatViews.toLocaleString()}\n              </span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-gray-600 dark:text-gray-400\">Comments</span>\n              <span className=\"font-semibold text-gray-900 dark:text-white\">\n                {analyticsData.engagementMetrics.comments}\n              </span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-gray-600 dark:text-gray-400\">Likes</span>\n              <span className=\"font-semibold text-gray-900 dark:text-white\">\n                {analyticsData.engagementMetrics.likes}\n              </span>\n            </div>\n          </div>\n        </Card>\n\n        <Card className=\"p-6\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Engagement Quality</h3>\n          <div className=\"space-y-4\">\n            <div className=\"text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n              <p className=\"text-2xl font-bold text-green-600 dark:text-green-400 mb-1\">\n                {((analyticsData.engagementMetrics.completionRate + (100 - analyticsData.engagementMetrics.skipRate)) / 2).toFixed(1)}%\n              </p>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">Overall Engagement Score</p>\n            </div>\n            <div className=\"text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n              <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400 mb-1\">\n                {(analyticsData.engagementMetrics.repeatViews / analyticsData.overview.viewCount * 100).toFixed(1)}%\n              </p>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">Repeat View Rate</p>\n            </div>\n          </div>\n        </Card>\n      </div>\n    </div>\n  )\n\n  const tabs = [\n    { id: 'overview', label: 'Overview', icon: BarChart3 },\n    { id: 'activity', label: 'Activity', icon: Activity },\n    { id: 'content', label: 'Content', icon: FileVideo },\n    { id: 'sharing', label: 'Sharing', icon: Share2 },\n    { id: 'engagement', label: 'Engagement', icon: Users }\n  ]\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.95 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.95 }}\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\"\n      onClick={onClose}\n    >\n      <motion.div\n        initial={{ y: 20 }}\n        animate={{ y: 0 }}\n        className=\"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\n          <div>\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Collection Analytics</h2>\n            <p className=\"text-gray-600 dark:text-gray-400\">{collection.name}</p>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setShowComparison(!showComparison)}\n              className=\"flex items-center gap-2\"\n            >\n              <RefreshCw className=\"w-4 h-4\" />\n              Compare\n            </Button>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => handleExportAnalytics('csv')}\n              >\n                <DownloadIcon className=\"w-4 h-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => handleExportAnalytics('json')}\n              >\n                <Upload className=\"w-4 h-4\" />\n              </Button>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onClose}\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n\n        {/* Tab Navigation */}\n        <div className=\"border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center px-6 overflow-x-auto\">\n            {tabs.map((tab) => {\n              const Icon = tab.icon\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id as any)}\n                  className={`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors whitespace-nowrap ${\n                    activeTab === tab.id\n                      ? 'border-blue-500 text-blue-600 dark:text-blue-400'\n                      : 'border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'\n                  }`}\n                >\n                  <Icon className=\"w-4 h-4\" />\n                  {tab.label}\n                </button>\n              )\n            })}\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"overflow-y-auto p-6 max-h-[calc(90vh-140px)]\">\n          {itemsLoading ? (\n            <div className=\"flex items-center justify-center h-64\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n            </div>\n          ) : (\n            <>\n              {activeTab === 'overview' && renderOverview()}\n              {activeTab === 'activity' && renderActivity()}\n              {activeTab === 'content' && renderContent()}\n              {activeTab === 'sharing' && renderSharing()}\n              {activeTab === 'engagement' && renderEngagement()}\n            </>\n          )}\n        </div>\n      </motion.div>\n    </motion.div>\n  )\n}","import React, { useState, useEffect, useCallback } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport {\n  Share2,\n  Link,\n  Mail,\n  MessageCircle,\n  Globe,\n  Lock,\n  Users,\n  Copy,\n  Download,\n  Upload,\n  QrCode,\n  ExternalLink,\n  Clock,\n  Calendar,\n  Shield,\n  Eye,\n  EyeOff,\n  Edit,\n  Trash2,\n  Plus,\n  X,\n  Check,\n  AlertCircle,\n  RefreshCw,\n  Wifi,\n  WifiOff\n} from 'lucide-react'\nimport { Button } from '../ui/Button'\nimport { Input } from '../ui/Input'\nimport { Select } from '../ui/Select'\nimport { Switch } from '../ui/Switch'\nimport { Card } from '../ui/Card'\nimport { SmartCollection } from '../../types/collections'\nimport { toast } from 'react-hot-toast'\n\ninterface CollectionSharingProps {\n  collection: SmartCollection\n  onClose: () => void\n  onShareUpdate?: (shares: CollectionShare[]) => void\n}\n\ninterface CollectionShare {\n  id: string\n  collectionId: string\n  type: 'link' | 'email' | 'social' | 'embed'\n  url: string\n  token: string\n  permissions: {\n    can_view: boolean\n    can_download: boolean\n    can_comment: boolean\n    can_edit: boolean\n    can_reshare: boolean\n  }\n  expires_at?: string\n  created_at: string\n  created_by: string\n  access_count: number\n  last_accessed?: string\n  is_active: boolean\n  settings: {\n    require_password: boolean\n    password?: string\n    allow_anonymous: boolean\n    max_downloads?: number\n    download_count: number\n  }\n}\n\ninterface ShareLink {\n  id: string\n  title: string\n  url: string\n  token: string\n  permissions: CollectionShare['permissions']\n  expires_in: string\n  created_at: string\n  access_count: number\n  is_active: boolean\n}\n\nconst EXPIRY_OPTIONS = [\n  { value: '1h', label: '1 Hour' },\n  { value: '24h', label: '24 Hours' },\n  { value: '7d', label: '7 Days' },\n  { value: '30d', label: '30 Days' },\n  { value: '90d', label: '90 Days' },\n  { value: 'never', label: 'Never' }\n]\n\nconst PERMISSION_LEVELS = [\n  {\n    name: 'View Only',\n    description: 'Can only view the collection',\n    permissions: {\n      can_view: true,\n      can_download: false,\n      can_comment: false,\n      can_edit: false,\n      can_reshare: false\n    }\n  },\n  {\n    name: 'View & Download',\n    description: 'Can view and download items',\n    permissions: {\n      can_view: true,\n      can_download: true,\n      can_comment: false,\n      can_edit: false,\n      can_reshare: false\n    }\n  },\n  {\n    name: 'Contributor',\n    description: 'Can view, download, and comment',\n    permissions: {\n      can_view: true,\n      can_download: true,\n      can_comment: true,\n      can_edit: false,\n      can_reshare: false\n    }\n  },\n  {\n    name: 'Editor',\n    description: 'Can view, download, comment, and edit',\n    permissions: {\n      can_view: true,\n      can_download: true,\n      can_comment: true,\n      can_edit: true,\n      can_reshare: false\n    }\n  },\n  {\n    name: 'Full Access',\n    description: 'Can do everything including reshare',\n    permissions: {\n      can_view: true,\n      can_download: true,\n      can_comment: true,\n      can_edit: true,\n      can_reshare: true\n    }\n  }\n]\n\nconst SHARE_METHODS = [\n  {\n    id: 'link',\n    name: 'Share Link',\n    description: 'Create a shareable link',\n    icon: Link,\n    color: 'blue'\n  },\n  {\n    id: 'email',\n    name: 'Email Invite',\n    description: 'Send via email invitation',\n    icon: Mail,\n    color: 'green'\n  },\n  {\n    id: 'embed',\n    name: 'Embed',\n    description: 'Get embed code for websites',\n    icon: Upload,\n    color: 'purple'\n  },\n  {\n    id: 'qr',\n    name: 'QR Code',\n    description: 'Generate QR code for mobile',\n    icon: QrCode,\n    color: 'orange'\n  }\n]\n\nexport const CollectionSharing: React.FC<CollectionSharingProps> = ({\n  collection,\n  onClose,\n  onShareUpdate\n}) => {\n  const [activeTab, setActiveTab] = useState<'link' | 'email' | 'embed' | 'qr'>('link')\n  const [shareLinks, setShareLinks] = useState<ShareLink[]>([])\n  const [isCreating, setIsCreating] = useState(false)\n  const [selectedPermission, setSelectedPermission] = useState(PERMISSION_LEVELS[1])\n  const [expiryTime, setExpiryTime] = useState('7d')\n  const [requirePassword, setRequirePassword] = useState(false)\n  const [password, setPassword] = useState('')\n  const [allowAnonymous, setAllowAnonymous] = useState(true)\n  const [maxDownloads, setMaxDownloads] = useState<number | undefined>()\n  const [emailRecipients, setEmailRecipients] = useState('')\n  const [customMessage, setCustomMessage] = useState('')\n  const [embedSize, setEmbedSize] = useState({ width: 800, height: 600 })\n  const [isRealTimeEnabled, setIsRealTimeEnabled] = useState(false)\n  const [connectionStatus, setConnectionStatus] = useState<'connected' | 'disconnected' | 'connecting'>('disconnected')\n\n  // Mock existing share links\n  useEffect(() => {\n    const mockLinks: ShareLink[] = [\n      {\n        id: '1',\n        title: 'Public Share',\n        url: `https://catalogizer.app/shared/${collection.id}/abc123`,\n        token: 'abc123',\n        permissions: PERMISSION_LEVELS[1].permissions,\n        expires_in: '7d',\n        created_at: new Date(Date.now() - 86400000).toISOString(),\n        access_count: 25,\n        is_active: true\n      },\n      {\n        id: '2',\n        title: 'Editor Access',\n        url: `https://catalogizer.app/shared/${collection.id}/def456`,\n        token: 'def456',\n        permissions: PERMISSION_LEVELS[3].permissions,\n        expires_in: '30d',\n        created_at: new Date(Date.now() - 604800000).toISOString(),\n        access_count: 8,\n        is_active: true\n      }\n    ]\n    setShareLinks(mockLinks)\n  }, [collection.id])\n\n  // Simulate real-time connection\n  useEffect(() => {\n    if (isRealTimeEnabled) {\n      setConnectionStatus('connecting')\n      const timer = setTimeout(() => {\n        setConnectionStatus('connected')\n      }, 1000)\n      \n      return () => clearTimeout(timer)\n    } else {\n      setConnectionStatus('disconnected')\n    }\n  }, [isRealTimeEnabled])\n\n  const generateShareLink = useCallback(async () => {\n    setIsCreating(true)\n    \n    try {\n      // Simulate API call\n      await new Promise(resolve => setTimeout(resolve, 1500))\n      \n      const newLink: ShareLink = {\n        id: Date.now().toString(),\n        title: `Share Link ${shareLinks.length + 1}`,\n        url: `https://catalogizer.app/shared/${collection.id}/${Math.random().toString(36).substr(2, 9)}`,\n        token: Math.random().toString(36).substr(2, 9),\n        permissions: selectedPermission.permissions,\n        expires_in: expiryTime,\n        created_at: new Date().toISOString(),\n        access_count: 0,\n        is_active: true\n      }\n      \n      setShareLinks(prev => [newLink, ...prev])\n      onShareUpdate?.(shareLinks.concat(newLink) as any)\n      toast.success('Share link created successfully')\n      \n      // Reset form\n      setSelectedPermission(PERMISSION_LEVELS[1])\n      setExpiryTime('7d')\n      setRequirePassword(false)\n      setPassword('')\n      setAllowAnonymous(true)\n      setMaxDownloads(undefined)\n      \n    } catch (error) {\n      toast.error('Failed to create share link')\n    } finally {\n      setIsCreating(false)\n    }\n  }, [collection.id, selectedPermission, expiryTime, requirePassword, password, allowAnonymous, maxDownloads, shareLinks, onShareUpdate])\n\n  const copyToClipboard = useCallback((text: string) => {\n    navigator.clipboard.writeText(text)\n    toast.success('Copied to clipboard')\n  }, [])\n\n  const revokeShare = useCallback(async (shareId: string) => {\n    try {\n      // Simulate API call\n      await new Promise(resolve => setTimeout(resolve, 1000))\n      \n      setShareLinks(prev => prev.map(link => \n        link.id === shareId ? { ...link, is_active: false } : link\n      ))\n      toast.success('Share link revoked')\n    } catch (error) {\n      toast.error('Failed to revoke share link')\n    }\n  }, [])\n\n  const deleteShare = useCallback(async (shareId: string) => {\n    try {\n      // Simulate API call\n      await new Promise(resolve => setTimeout(resolve, 1000))\n      \n      setShareLinks(prev => prev.filter(link => link.id !== shareId))\n      toast.success('Share link deleted')\n    } catch (error) {\n      toast.error('Failed to delete share link')\n    }\n  }, [])\n\n  const sendEmailInvites = useCallback(async () => {\n    if (!emailRecipients.trim()) {\n      toast.error('Please enter at least one email address')\n      return\n    }\n    \n    try {\n      // Simulate API call\n      await new Promise(resolve => setTimeout(resolve, 2000))\n      \n      const emails = emailRecipients.split(',').map(e => e.trim())\n      toast.success(`Invitation sent to ${emails.length} recipient${emails.length > 1 ? 's' : ''}`)\n      setEmailRecipients('')\n      setCustomMessage('')\n    } catch (error) {\n      toast.error('Failed to send invitations')\n    }\n  }, [emailRecipients, customMessage])\n\n  const getEmbedCode = useCallback(() => {\n    return `<iframe src=\"${window.location.origin}/embed/${collection.id}\" width=\"${embedSize.width}\" height=\"${embedSize.height}\" frameborder=\"0\" allowfullscreen></iframe>`\n  }, [collection.id, embedSize])\n\n  const generateQRCode = useCallback(() => {\n    // This would integrate with a QR code library\n    const shareUrl = `https://catalogizer.app/shared/${collection.id}/qr-${Date.now()}`\n    copyToClipboard(shareUrl)\n    toast.success('QR code URL copied to clipboard')\n  }, [collection.id, copyToClipboard])\n\n  const ShareLinkCard = ({ link }: { link: ShareLink }) => (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\"\n    >\n      <div className=\"flex items-start justify-between mb-3\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h4 className=\"font-medium text-gray-900 dark:text-white\">{link.title}</h4>\n            {link.is_active ? (\n              <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n            ) : (\n              <div className=\"w-2 h-2 bg-red-500 rounded-full\"></div>\n            )}\n          </div>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 truncate\">{link.url}</p>\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => copyToClipboard(link.url)}\n            title=\"Copy link\"\n          >\n            <Copy className=\"w-4 h-4\" />\n          </Button>\n          <a\n            href={link.url}\n            target=\"_blank\"\n            title=\"Open in new tab\"\n            className=\"inline-flex\" rel=\"noreferrer\"\n          >\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              type=\"button\"\n            >\n              <ExternalLink className=\"w-4 h-4\" />\n            </Button>\n          </a>\n        </div>\n      </div>\n      \n      <div className=\"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 mb-3\">\n        <div className=\"flex items-center gap-4\">\n          <span>{link.access_count} views</span>\n          <span>Created {new Date(link.created_at).toLocaleDateString()}</span>\n          <span>Expires in {link.expires_in}</span>\n        </div>\n      </div>\n      \n      <div className=\"flex flex-wrap gap-1 mb-3\">\n        {link.permissions.can_view && (\n          <span className=\"px-2 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 text-xs rounded\">View</span>\n        )}\n        {link.permissions.can_download && (\n          <span className=\"px-2 py-1 bg-green-100 dark:bg-green-900/20 text-green-600 dark:text-green-400 text-xs rounded\">Download</span>\n        )}\n        {link.permissions.can_comment && (\n          <span className=\"px-2 py-1 bg-purple-100 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 text-xs rounded\">Comment</span>\n        )}\n        {link.permissions.can_edit && (\n          <span className=\"px-2 py-1 bg-orange-100 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 text-xs rounded\">Edit</span>\n        )}\n        {link.permissions.can_reshare && (\n          <span className=\"px-2 py-1 bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400 text-xs rounded\">Reshare</span>\n        )}\n      </div>\n      \n      <div className=\"flex items-center gap-2\">\n        {link.is_active && (\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => revokeShare(link.id)}\n            className=\"text-yellow-600 border-yellow-600 hover:bg-yellow-50 dark:hover:bg-yellow-900/20\"\n          >\n            <EyeOff className=\"w-4 h-4 mr-1\" />\n            Revoke\n          </Button>\n        )}\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => deleteShare(link.id)}\n          className=\"text-red-600 border-red-600 hover:bg-red-50 dark:hover:bg-red-900/20\"\n        >\n          <Trash2 className=\"w-4 h-4 mr-1\" />\n          Delete\n        </Button>\n      </div>\n    </motion.div>\n  )\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.95 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.95 }}\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\"\n      onClick={onClose}\n    >\n      <motion.div\n        initial={{ y: 20 }}\n        animate={{ y: 0 }}\n        className=\"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\n          <div>\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Share Collection</h2>\n            <p className=\"text-gray-600 dark:text-gray-400\">{collection.name}</p>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            {/* Real-time Connection Status */}\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsRealTimeEnabled(!isRealTimeEnabled)}\n                className={`flex items-center gap-2 ${\n                  isRealTimeEnabled ? 'text-green-600 dark:text-green-400' : 'text-gray-600 dark:text-gray-400'\n                }`}\n              >\n                {connectionStatus === 'connected' ? (\n                  <Wifi className=\"w-4 h-4\" />\n                ) : connectionStatus === 'connecting' ? (\n                  <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                ) : (\n                  <WifiOff className=\"w-4 h-4\" />\n                )}\n                {isRealTimeEnabled ? 'Live' : 'Offline'}\n              </Button>\n            </div>\n            \n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onClose}\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n\n        {/* Tab Navigation */}\n        <div className=\"border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center px-6\">\n            {SHARE_METHODS.map((method) => {\n              const Icon = method.icon\n              return (\n                <button\n                  key={method.id}\n                  onClick={() => setActiveTab(method.id as any)}\n                  className={`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${\n                    activeTab === method.id\n                      ? 'border-blue-500 text-blue-600 dark:text-blue-400'\n                      : 'border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'\n                  }`}\n                >\n                  <Icon className=\"w-4 h-4\" />\n                  {method.name}\n                </button>\n              )\n            })}\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"overflow-y-auto p-6 max-h-[calc(90vh-140px)]\">\n          <AnimatePresence mode=\"wait\">\n            {activeTab === 'link' && (\n              <motion.div\n                key=\"link\"\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                className=\"space-y-6\"\n              >\n                {/* Create New Share Link */}\n                <Card className=\"p-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Create Share Link</h3>\n                  \n                  <div className=\"space-y-4\">\n                    {/* Permission Level */}\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Permission Level\n                      </label>\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                        {PERMISSION_LEVELS.map((level) => (\n                          <button\n                            key={level.name}\n                            onClick={() => setSelectedPermission(level)}\n                            className={`p-3 rounded-lg border-2 text-left transition-colors ${\n                              selectedPermission.name === level.name\n                                ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n                                : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n                            }`}\n                          >\n                            <div className=\"font-medium text-gray-900 dark:text-white\">{level.name}</div>\n                            <div className=\"text-xs text-gray-600 dark:text-gray-400\">{level.description}</div>\n                          </button>\n                        ))}\n                      </div>\n                    </div>\n\n                    {/* Expiry Time */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          Expires In\n                        </label>\n                        <Select\n                          value={expiryTime}\n                          onChange={setExpiryTime}\n                          options={EXPIRY_OPTIONS}\n                          className=\"w-full\"\n                        />\n                      </div>\n                      \n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          Max Downloads\n                        </label>\n                        <Input\n                          type=\"number\"\n                          placeholder=\"Unlimited\"\n                          value={maxDownloads || ''}\n                          onChange={(e) => setMaxDownloads(e.target.value ? parseInt(e.target.value) : undefined)}\n                          min=\"1\"\n                        />\n                      </div>\n                    </div>\n\n                    {/* Additional Settings */}\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <div className=\"font-medium text-gray-900 dark:text-white\">Require Password</div>\n                          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Users must enter a password to access</div>\n                        </div>\n                        <Switch\n                          checked={requirePassword}\n                          onCheckedChange={setRequirePassword}\n                        />\n                      </div>\n                      \n                      {requirePassword && (\n                        <Input\n                          type=\"password\"\n                          placeholder=\"Enter password\"\n                          value={password}\n                          onChange={(e) => setPassword(e.target.value)}\n                          className=\"ml-4\"\n                        />\n                      )}\n                      \n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <div className=\"font-medium text-gray-900 dark:text-white\">Allow Anonymous Access</div>\n                          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Anyone with the link can access</div>\n                        </div>\n                        <Switch\n                          checked={allowAnonymous}\n                          onCheckedChange={setAllowAnonymous}\n                        />\n                      </div>\n                    </div>\n\n                    <Button\n                      onClick={generateShareLink}\n                      disabled={isCreating}\n                      className=\"w-full\"\n                    >\n                      {isCreating ? (\n                        <>\n                          <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\n                          Creating...\n                        </>\n                      ) : (\n                        <>\n                          <Plus className=\"w-4 h-4 mr-2\" />\n                          Create Share Link\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                </Card>\n\n                {/* Existing Share Links */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Active Shares</h3>\n                  <div className=\"space-y-4\">\n                    {shareLinks.map((link) => (\n                      <ShareLinkCard key={link.id} link={link} />\n                    ))}\n                  </div>\n                </div>\n              </motion.div>\n            )}\n\n            {activeTab === 'email' && (\n              <motion.div\n                key=\"email\"\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                className=\"space-y-6\"\n              >\n                <Card className=\"p-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Send Email Invitations</h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Email Addresses\n                      </label>\n                      <Input\n                        type=\"email\"\n                        placeholder=\"Enter email addresses, separated by commas\"\n                        value={emailRecipients}\n                        onChange={(e) => setEmailRecipients(e.target.value)}\n                        className=\"w-full\"\n                      />\n                    </div>\n                    \n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Permission Level\n                      </label>\n                      <Select\n                        value={selectedPermission.name}\n                        onChange={(value) => setSelectedPermission(PERMISSION_LEVELS.find(p => p.name === value) || PERMISSION_LEVELS[1])}\n                        options={PERMISSION_LEVELS.map(p => ({ value: p.name, label: p.name }))}\n                        className=\"w-full\"\n                      />\n                    </div>\n                    \n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Personal Message (Optional)\n                      </label>\n                      <textarea\n                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white\"\n                        rows={4}\n                        placeholder=\"Add a personal message to your invitation...\"\n                        value={customMessage}\n                        onChange={(e) => setCustomMessage(e.target.value)}\n                      />\n                    </div>\n                    \n                    <Button\n                      onClick={sendEmailInvites}\n                      className=\"w-full\"\n                    >\n                      <Mail className=\"w-4 h-4 mr-2\" />\n                      Send Invitations\n                    </Button>\n                  </div>\n                </Card>\n              </motion.div>\n            )}\n\n            {activeTab === 'embed' && (\n              <motion.div\n                key=\"embed\"\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                className=\"space-y-6\"\n              >\n                <Card className=\"p-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Embed Collection</h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          Width (px)\n                        </label>\n                        <Input\n                          type=\"number\"\n                          value={embedSize.width}\n                          onChange={(e) => setEmbedSize(prev => ({ ...prev, width: parseInt(e.target.value) || 800 }))}\n                          min=\"200\"\n                          max=\"1920\"\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                          Height (px)\n                        </label>\n                        <Input\n                          type=\"number\"\n                          value={embedSize.height}\n                          onChange={(e) => setEmbedSize(prev => ({ ...prev, height: parseInt(e.target.value) || 600 }))}\n                          min=\"200\"\n                          max=\"1080\"\n                        />\n                      </div>\n                    </div>\n                    \n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                        Embed Code\n                      </label>\n                      <textarea\n                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white font-mono text-sm\"\n                        rows={4}\n                        value={getEmbedCode()}\n                        readOnly\n                      />\n                    </div>\n                    \n                    <Button\n                      onClick={() => copyToClipboard(getEmbedCode())}\n                      className=\"w-full\"\n                    >\n                      <Copy className=\"w-4 h-4 mr-2\" />\n                      Copy Embed Code\n                    </Button>\n                  </div>\n                </Card>\n              </motion.div>\n            )}\n\n            {activeTab === 'qr' && (\n              <motion.div\n                key=\"qr\"\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                className=\"space-y-6\"\n              >\n                <Card className=\"p-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">QR Code Sharing</h3>\n                  \n                  <div className=\"text-center space-y-4\">\n                    <div className=\"w-64 h-64 bg-gray-100 dark:bg-gray-800 rounded-lg mx-auto flex items-center justify-center\">\n                      <QrCode className=\"w-32 h-32 text-gray-400\" />\n                    </div>\n                    \n                    <p className=\"text-gray-600 dark:text-gray-400\">\n                      Generate a QR code that mobile users can scan to quickly access this collection\n                    </p>\n                    \n                    <Button\n                      onClick={generateQRCode}\n                      className=\"w-full max-w-xs\"\n                    >\n                      <QrCode className=\"w-4 h-4 mr-2\" />\n                      Generate QR Code\n                    </Button>\n                  </div>\n                </Card>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      </motion.div>\n    </motion.div>\n  )\n}","import React, { useState, useCallback, useRef } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport {\n  Download,\n  Upload,\n  FileText,\n  FileSpreadsheet,\n  Music,\n  Video,\n  Image,\n  Archive,\n  Settings,\n  Check,\n  X,\n  AlertCircle,\n  Clock,\n  HardDrive,\n  FileJson,\n  File,\n  Folder,\n  FolderOpen,\n  Copy,\n  ExternalLink,\n  RefreshCw,\n  Filter,\n  Search,\n  ChevronDown,\n  ChevronRight,\n  Plus,\n  Minus\n} from 'lucide-react'\nimport { Button } from '../ui/Button'\nimport { Input } from '../ui/Input'\nimport { Select } from '../ui/Select'\nimport { Switch } from '../ui/Switch'\nimport { Card } from '../ui/Card'\nimport { SmartCollection } from '../../types/collections'\nimport { useCollection } from '../../hooks/useCollections'\nimport { toast } from 'react-hot-toast'\n\ninterface CollectionExportProps {\n  collection: SmartCollection\n  onClose: () => void\n}\n\ninterface ExportOptions {\n  format: 'json' | 'csv' | 'm3u' | 'xspf' | 'wpl' | 'zip'\n  includeMetadata: boolean\n  includeThumbnails: boolean\n  includeFiles: boolean\n  compression: 'none' | 'zip' | 'tar' | '7z'\n  quality: 'original' | 'high' | 'medium' | 'low'\n  maxFileSize: number | null\n  fileTypes: string[]\n  dateRange: {\n    start: string\n    end: string\n  } | null\n  customFields: string[]\n}\n\ninterface ImportOptions {\n  format: 'json' | 'csv' | 'm3u' | 'zip'\n  mergeStrategy: 'replace' | 'merge' | 'append'\n  duplicateHandling: 'skip' | 'replace' | 'rename' | 'merge'\n  preserveIds: boolean\n  validateData: boolean\n  createBackup: boolean\n  mapping: Record<string, string>\n}\n\ninterface ExportProgress {\n  stage: string\n  progress: number\n  total: number\n  currentFile?: string\n  estimatedTime?: number\n}\n\ninterface ImportPreview {\n  totalItems: number\n  validItems: number\n  invalidItems: number\n  duplicates: number\n  newItems: number\n  sampleItems: any[]\n  conflicts: any[]\n}\n\nconst EXPORT_FORMATS = [\n  {\n    value: 'json',\n    label: 'JSON',\n    description: 'Structured data format with full metadata',\n    icon: FileJson,\n    extensions: ['.json'],\n    supportsMetadata: true,\n    supportsFiles: true\n  },\n  {\n    value: 'csv',\n    label: 'CSV',\n    description: 'Spreadsheet format for basic data',\n    icon: FileSpreadsheet,\n    extensions: ['.csv'],\n    supportsMetadata: true,\n    supportsFiles: false\n  },\n  {\n    value: 'm3u',\n    label: 'M3U Playlist',\n    description: 'Standard playlist format for media players',\n    icon: Music,\n    extensions: ['.m3u', '.m3u8'],\n    supportsMetadata: false,\n    supportsFiles: false\n  },\n  {\n    value: 'xspf',\n    label: 'XSPF Playlist',\n    description: 'XML Shareable Playlist Format',\n    icon: FileText,\n    extensions: ['.xspf'],\n    supportsMetadata: true,\n    supportsFiles: false\n  },\n  {\n    value: 'wpl',\n    label: 'WPL Playlist',\n    description: 'Windows Media Player playlist',\n    icon: File,\n    extensions: ['.wpl'],\n    supportsMetadata: false,\n    supportsFiles: false\n  },\n  {\n    value: 'zip',\n    label: 'ZIP Archive',\n    description: 'Complete collection with files',\n    icon: Archive,\n    extensions: ['.zip'],\n    supportsMetadata: true,\n    supportsFiles: true\n  }\n]\n\nconst COMPRESSION_OPTIONS = [\n  { value: 'none', label: 'No Compression', description: 'Original file size' },\n  { value: 'zip', label: 'ZIP', description: 'Standard compression' },\n  { value: 'tar', label: 'TAR', description: 'Unix archive format' },\n  { value: '7z', label: '7-Zip', description: 'Best compression ratio' }\n]\n\nconst QUALITY_OPTIONS = [\n  { value: 'original', label: 'Original Quality', description: 'No quality loss' },\n  { value: 'high', label: 'High Quality', description: 'Slight compression for better size' },\n  { value: 'medium', label: 'Medium Quality', description: 'Balanced quality and size' },\n  { value: 'low', label: 'Low Quality', description: 'Maximum compression' }\n]\n\nconst FILE_TYPES = [\n  { value: 'audio', label: 'Audio Files', extensions: ['.mp3', '.wav', '.flac', '.m4a'] },\n  { value: 'video', label: 'Video Files', extensions: ['.mp4', '.avi', '.mkv', '.mov'] },\n  { value: 'image', label: 'Image Files', extensions: ['.jpg', '.png', '.gif', '.webp'] },\n  { value: 'document', label: 'Documents', extensions: ['.pdf', '.doc', '.txt'] }\n]\n\nexport const CollectionExport: React.FC<CollectionExportProps> = ({\n  collection,\n  onClose\n}) => {\n  const [activeTab, setActiveTab] = useState<'export' | 'import'>('export')\n  const [exportOptions, setExportOptions] = useState<ExportOptions>({\n    format: 'json',\n    includeMetadata: true,\n    includeThumbnails: false,\n    includeFiles: false,\n    compression: 'none',\n    quality: 'original',\n    maxFileSize: null,\n    fileTypes: [],\n    dateRange: null,\n    customFields: []\n  })\n  const [importOptions, setImportOptions] = useState<ImportOptions>({\n    format: 'json',\n    mergeStrategy: 'merge',\n    duplicateHandling: 'skip',\n    preserveIds: false,\n    validateData: true,\n    createBackup: true,\n    mapping: {}\n  })\n  const [isExporting, setIsExporting] = useState(false)\n  const [isImporting, setIsImporting] = useState(false)\n  const [exportProgress, setExportProgress] = useState<ExportProgress | null>(null)\n  const [importPreview, setImportPreview] = useState<ImportPreview | null>(null)\n  const [importFile, setImportFile] = useState<File | null>(null)\n  const [showAdvanced, setShowAdvanced] = useState(false)\n  const [searchTerm, setSearchTerm] = useState('')\n  const [selectedFields, setSelectedFields] = useState<string[]>([])\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  \n  const { collectionItems, isLoading } = useCollection(collection?.id || '')\n\n  // Use collection items from props if available\n  const items = collectionItems || []\n\n  const selectedFormat = EXPORT_FORMATS.find(f => f.value === exportOptions.format)\n\n  const handleExport = useCallback(async () => {\n    setIsExporting(true)\n    setExportProgress({\n      stage: 'Preparing export',\n      progress: 0,\n      total: items.length\n    })\n\n    try {\n      // Simulate export process\n      for (let i = 0; i <= 100; i += 10) {\n        await new Promise(resolve => setTimeout(resolve, 200))\n        setExportProgress(prev => prev ? {\n          ...prev,\n          progress: Math.floor((items.length * i) / 100),\n          stage: i < 30 ? 'Preparing files' : i < 70 ? 'Processing items' : i < 90 ? 'Generating export' : 'Finalizing'\n        } : null)\n      }\n\n      // Generate actual export data\n      const exportData = {\n        collection: {\n          id: collection.id,\n          name: collection.name,\n          description: collection.description,\n          created_at: collection.created_at,\n          updated_at: collection.updated_at\n        },\n        items: items.map((item: any) => ({\n          id: item.id,\n          title: item.title || item.name,\n          type: item.media_type,\n          path: item.path,\n          size: item.size,\n          duration: item.duration,\n          rating: item.rating,\n          metadata: exportOptions.includeMetadata ? item.metadata : undefined,\n          thumbnail: exportOptions.includeThumbnails ? item.thumbnail : undefined\n        })),\n        exported_at: new Date().toISOString(),\n        export_options: exportOptions\n      }\n\n      // Create and download file\n      let filename = `${collection.name.replace(/[^a-z0-9]/gi, '_')}_${Date.now()}`\n      let mimeType = 'application/json'\n      let content: string | Blob = JSON.stringify(exportData, null, 2)\n\n      if (exportOptions.format === 'csv') {\n        // Simple CSV generation\n        const headers = ['id', 'title', 'type', 'path', 'size', 'duration', 'rating']\n        const csvContent = [\n          headers.join(','),\n          ...items.map((item: any) => [\n            item.id,\n            `\"${item.title || item.name}\"`,\n            item.media_type,\n            `\"${item.path}\"`,\n            item.size || 0,\n            item.duration || 0,\n            item.rating || 0\n          ].join(','))\n        ].join('\\n')\n        \n        content = csvContent\n        mimeType = 'text/csv'\n        filename += '.csv'\n      } else if (exportOptions.format === 'm3u') {\n        // M3U playlist generation\n        const m3uContent = [\n          '#EXTM3U',\n          ...items.map((item: any) => `#EXTINF:${item.duration || 0},${item.title || item.name}\\n${item.path}`)\n        ].join('\\n')\n        \n        content = m3uContent\n        mimeType = 'audio/x-mpegurl'\n        filename += '.m3u'\n      } else {\n        filename += '.json'\n      }\n\n      const blob = new Blob([content], { type: mimeType })\n      const url = URL.createObjectURL(blob)\n      const a = document.createElement('a')\n      a.href = url\n      a.download = filename\n      a.click()\n      URL.revokeObjectURL(url)\n\n      toast.success('Collection exported successfully')\n    } catch (error) {\n      toast.error('Export failed')\n      console.error('Export error:', error)\n    } finally {\n      setIsExporting(false)\n      setExportProgress(null)\n    }\n  }, [collection, items, exportOptions])\n\n  const handleImportFile = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0]\n    if (file) {\n      setImportFile(file)\n      \n      // Generate import preview\n      const reader = new FileReader()\n      reader.onload = (e) => {\n        try {\n          const content = e.target?.result as string\n          let parsedContent: any\n          \n          if (file.name.endsWith('.json')) {\n            parsedContent = JSON.parse(content)\n          } else if (file.name.endsWith('.csv')) {\n            // Simple CSV parsing\n            const lines = content.split('\\n')\n            const headers = lines[0].split(',')\n            parsedContent = {\n              items: lines.slice(1).map(line => {\n                const values = line.split(',')\n                return headers.reduce((obj, header, index) => {\n                  obj[header.trim()] = values[index]?.replace(/\"/g, '') || ''\n                  return obj\n                }, {} as any)\n              }).filter(item => item.title)\n            }\n          }\n          \n          const preview: ImportPreview = {\n            totalItems: parsedContent.items?.length || 0,\n            validItems: parsedContent.items?.length || 0,\n            invalidItems: 0,\n            duplicates: 0,\n            newItems: parsedContent.items?.length || 0,\n            sampleItems: (parsedContent.items || []).slice(0, 5),\n            conflicts: []\n          }\n          \n          setImportPreview(preview)\n        } catch (error) {\n          toast.error('Failed to parse import file')\n          setImportPreview(null)\n        }\n      }\n      \n      reader.readAsText(file)\n    }\n  }, [])\n\n  const handleImport = useCallback(async () => {\n    if (!importFile || !importPreview) return\n    \n    setIsImporting(true)\n    \n    try {\n      // Simulate import process\n      await new Promise(resolve => setTimeout(resolve, 2000))\n      \n      toast.success(`Successfully imported ${importPreview.newItems} items`)\n      setImportFile(null)\n      setImportPreview(null)\n      if (fileInputRef.current) {\n        fileInputRef.current.value = ''\n      }\n    } catch (error) {\n      toast.error('Import failed')\n      console.error('Import error:', error)\n    } finally {\n      setIsImporting(false)\n    }\n  }, [importFile, importPreview])\n\n  const formatFileSize = (bytes: number): string => {\n    if (bytes === 0) return '0 B'\n    const k = 1024\n    const sizes = ['B', 'KB', 'MB', 'GB', 'TB']\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]\n  }\n\n  const FormatCard = ({ format, isSelected, onClick }: {\n    format: typeof EXPORT_FORMATS[0]\n    isSelected: boolean\n    onClick: () => void\n  }) => (\n    <motion.button\n      whileHover={{ scale: 1.02 }}\n      whileTap={{ scale: 0.98 }}\n      onClick={onClick}\n      className={`p-4 rounded-lg border-2 text-left transition-colors ${\n        isSelected\n          ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20'\n          : 'border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600'\n      }`}\n    >\n      <div className=\"flex items-start gap-3\">\n        <div className={`p-2 rounded-lg ${\n          isSelected ? 'bg-blue-100 dark:bg-blue-900/40' : 'bg-gray-100 dark:bg-gray-800'\n        }`}>\n          <format.icon className={`w-5 h-5 ${\n            isSelected ? 'text-blue-600 dark:text-blue-400' : 'text-gray-600 dark:text-gray-400'\n          }`} />\n        </div>\n        <div className=\"flex-1\">\n          <h4 className=\"font-medium text-gray-900 dark:text-white\">{format.label}</h4>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">{format.description}</p>\n          <div className=\"flex flex-wrap gap-1 mt-2\">\n            {format.extensions.map(ext => (\n              <span key={ext} className=\"px-2 py-1 bg-gray-100 dark:bg-gray-800 text-xs rounded text-gray-600 dark:text-gray-400\">\n                {ext}\n              </span>\n            ))}\n          </div>\n        </div>\n      </div>\n    </motion.button>\n  )\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.95 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.95 }}\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\"\n      onClick={onClose}\n    >\n      <motion.div\n        initial={{ y: 20 }}\n        animate={{ y: 0 }}\n        className=\"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\n          <div>\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Export / Import Collection</h2>\n            <p className=\"text-gray-600 dark:text-gray-400\">{collection.name}</p>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={onClose}\n          >\n            <X className=\"w-4 h-4\" />\n          </Button>\n        </div>\n\n        {/* Tab Navigation */}\n        <div className=\"border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex items-center px-6\">\n            <button\n              onClick={() => setActiveTab('export')}\n              className={`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${\n                activeTab === 'export'\n                  ? 'border-blue-500 text-blue-600 dark:text-blue-400'\n                  : 'border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'\n              }`}\n            >\n              <Download className=\"w-4 h-4\" />\n              Export\n            </button>\n            <button\n              onClick={() => setActiveTab('import')}\n              className={`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors ${\n                activeTab === 'import'\n                  ? 'border-blue-500 text-blue-600 dark:text-blue-400'\n                  : 'border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'\n              }`}\n            >\n              <Upload className=\"w-4 h-4\" />\n              Import\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"overflow-y-auto p-6 max-h-[calc(90vh-140px)]\">\n          <AnimatePresence mode=\"wait\">\n            {activeTab === 'export' && (\n              <motion.div\n                key=\"export\"\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                className=\"space-y-6\"\n              >\n                {/* Format Selection */}\n                <Card className=\"p-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Export Format</h3>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    {EXPORT_FORMATS.map((format) => (\n                      <FormatCard\n                        key={format.value}\n                        format={format}\n                        isSelected={exportOptions.format === format.value}\n                        onClick={() => setExportOptions(prev => ({ ...prev, format: format.value as any }))}\n                      />\n                    ))}\n                  </div>\n                </Card>\n\n                {/* Export Options */}\n                <Card className=\"p-6\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Export Options</h3>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => setShowAdvanced(!showAdvanced)}\n                      className=\"flex items-center gap-2\"\n                    >\n                      <Settings className=\"w-4 h-4\" />\n                      {showAdvanced ? 'Hide' : 'Show'} Advanced\n                    </Button>\n                  </div>\n                  \n                  <div className=\"space-y-4\">\n                    {/* Basic Options */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <div className=\"font-medium text-gray-900 dark:text-white\">Include Metadata</div>\n                          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Export tags, ratings, and custom fields</div>\n                        </div>\n                        <Switch\n                          checked={exportOptions.includeMetadata}\n                          onCheckedChange={(checked) => setExportOptions(prev => ({ ...prev, includeMetadata: checked }))}\n                          disabled={!selectedFormat?.supportsMetadata}\n                        />\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <div className=\"font-medium text-gray-900 dark:text-white\">Include Thumbnails</div>\n                          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Export thumbnail images</div>\n                        </div>\n                        <Switch\n                          checked={exportOptions.includeThumbnails}\n                          onCheckedChange={(checked) => setExportOptions(prev => ({ ...prev, includeThumbnails: checked }))}\n                        />\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <div className=\"font-medium text-gray-900 dark:text-white\">Include Files</div>\n                          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Export actual media files</div>\n                        </div>\n                        <Switch\n                          checked={exportOptions.includeFiles}\n                          onCheckedChange={(checked) => setExportOptions(prev => ({ ...prev, includeFiles: checked }))}\n                          disabled={!selectedFormat?.supportsFiles}\n                        />\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <div className=\"font-medium text-gray-900 dark:text-white\">Create Backup</div>\n                          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Keep original data intact</div>\n                        </div>\n                        <Switch\n                          checked={true}\n                          disabled\n                        />\n                      </div>\n                    </div>\n\n                    {/* Advanced Options */}\n                    <AnimatePresence>\n                      {showAdvanced && (\n                        <motion.div\n                          initial={{ opacity: 0, height: 0 }}\n                          animate={{ opacity: 1, height: 'auto' }}\n                          exit={{ opacity: 0, height: 0 }}\n                          className=\"space-y-4 border-t border-gray-200 dark:border-gray-700 pt-4\"\n                        >\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                                Compression\n                              </label>\n                              <Select\n                                value={exportOptions.compression}\n                                onChange={(value) => setExportOptions(prev => ({ ...prev, compression: value as any }))}\n                                options={COMPRESSION_OPTIONS}\n                                className=\"w-full\"\n                              />\n                            </div>\n                            \n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                                Quality\n                              </label>\n                              <Select\n                                value={exportOptions.quality}\n                                onChange={(value) => setExportOptions(prev => ({ ...prev, quality: value as any }))}\n                                options={QUALITY_OPTIONS}\n                                className=\"w-full\"\n                              />\n                            </div>\n                            \n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                                Max File Size (MB)\n                              </label>\n                              <Input\n                                type=\"number\"\n                                placeholder=\"No limit\"\n                                value={exportOptions.maxFileSize || ''}\n                                onChange={(e) => setExportOptions(prev => ({ \n                                  ...prev, \n                                  maxFileSize: e.target.value ? parseInt(e.target.value) : null \n                                }))}\n                                min=\"1\"\n                              />\n                            </div>\n                            \n                            <div>\n                              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                                File Types\n                              </label>\n                              <div className=\"space-y-2\">\n                                {FILE_TYPES.map((type) => (\n                                  <label key={type.value} className=\"flex items-center gap-2\">\n                                    <input\n                                      type=\"checkbox\"\n                                      checked={exportOptions.fileTypes.includes(type.value)}\n                                      onChange={(e) => {\n                                        if (e.target.checked) {\n                                          setExportOptions(prev => ({ \n                                            ...prev, \n                                            fileTypes: [...prev.fileTypes, type.value] \n                                          }))\n                                        } else {\n                                          setExportOptions(prev => ({ \n                                            ...prev, \n                                            fileTypes: prev.fileTypes.filter(t => t !== type.value) \n                                          }))\n                                        }\n                                      }}\n                                      className=\"rounded border-gray-300 dark:border-gray-600\"\n                                    />\n                                    <span className=\"text-sm text-gray-700 dark:text-gray-300\">{type.label}</span>\n                                  </label>\n                                ))}\n                              </div>\n                            </div>\n                          </div>\n                        </motion.div>\n                      )}\n                    </AnimatePresence>\n\n                    {/* Collection Summary */}\n                    <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <div className=\"font-medium text-gray-900 dark:text-white\">Collection Summary</div>\n                          <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                            {items.length} items  {formatFileSize(items.reduce((sum: any, item: any) => sum + (item.size || 0), 0))}\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          <div className=\"font-medium text-gray-900 dark:text-white\">Est. Export Size</div>\n                          <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                            ~{formatFileSize(items.reduce((sum: any, item: any) => sum + (item.size || 0), 0))}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </Card>\n\n                {/* Export Progress */}\n                {exportProgress && (\n                  <Card className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Export Progress</h3>\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">{exportProgress.stage}</span>\n                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          {exportProgress.progress} / {exportProgress.total}\n                        </span>\n                      </div>\n                      <div className=\"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2\">\n                        <motion.div\n                          className=\"bg-blue-500 h-2 rounded-full\"\n                          initial={{ width: 0 }}\n                          animate={{ width: `${(exportProgress.progress / exportProgress.total) * 100}%` }}\n                          transition={{ duration: 0.3 }}\n                        />\n                      </div>\n                      {exportProgress.currentFile && (\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          Processing: {exportProgress.currentFile}\n                        </div>\n                      )}\n                    </div>\n                  </Card>\n                )}\n\n                {/* Export Button */}\n                <Button\n                  onClick={handleExport}\n                  disabled={isExporting || isLoading}\n                  className=\"w-full\"\n                >\n                  {isExporting ? (\n                    <>\n                      <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\n                      Exporting...\n                    </>\n                  ) : (\n                    <>\n                      <Download className=\"w-4 h-4 mr-2\" />\n                      Export Collection\n                    </>\n                  )}\n                </Button>\n              </motion.div>\n            )}\n\n            {activeTab === 'import' && (\n              <motion.div\n                key=\"import\"\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                className=\"space-y-6\"\n              >\n                {/* File Upload */}\n                <Card className=\"p-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Import File</h3>\n                  \n                  <div className=\"space-y-4\">\n                    <div\n                      onClick={() => fileInputRef.current?.click()}\n                      className=\"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 transition-colors\"\n                    >\n                      <Upload className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                      <div className=\"text-gray-900 dark:text-white font-medium mb-2\">\n                        Click to upload or drag and drop\n                      </div>\n                      <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                        JSON, CSV, M3U, or ZIP files\n                      </div>\n                      <input\n                        ref={fileInputRef}\n                        type=\"file\"\n                        accept=\".json,.csv,.m3u,.m3u8,.zip\"\n                        onChange={handleImportFile}\n                        className=\"hidden\"\n                      />\n                    </div>\n                    \n                    {importFile && (\n                      <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-3\">\n                            <FileText className=\"w-5 h-5 text-gray-600 dark:text-gray-400\" />\n                            <div>\n                              <div className=\"font-medium text-gray-900 dark:text-white\">{importFile.name}</div>\n                              <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                                {formatFileSize(importFile.size)}\n                              </div>\n                            </div>\n                          </div>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setImportFile(null)\n                              setImportPreview(null)\n                              if (fileInputRef.current) {\n                                fileInputRef.current.value = ''\n                              }\n                            }}\n                          >\n                            <X className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </Card>\n\n                {/* Import Options */}\n                {importFile && (\n                  <Card className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Import Options</h3>\n                    \n                    <div className=\"space-y-4\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                            Merge Strategy\n                          </label>\n                          <Select\n                            value={importOptions.mergeStrategy}\n                            onChange={(value) => setImportOptions(prev => ({ ...prev, mergeStrategy: value as any }))}\n                            options={[\n                              { value: 'replace', label: 'Replace Collection' },\n                              { value: 'merge', label: 'Merge with Existing' },\n                              { value: 'append', label: 'Append to Collection' }\n                            ]}\n                            className=\"w-full\"\n                          />\n                        </div>\n                        \n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                            Duplicate Handling\n                          </label>\n                          <Select\n                            value={importOptions.duplicateHandling}\n                            onChange={(value) => setImportOptions(prev => ({ ...prev, duplicateHandling: value as any }))}\n                            options={[\n                              { value: 'skip', label: 'Skip Duplicates' },\n                              { value: 'replace', label: 'Replace Existing' },\n                              { value: 'rename', label: 'Rename Imports' },\n                              { value: 'merge', label: 'Merge Data' }\n                            ]}\n                            className=\"w-full\"\n                          />\n                        </div>\n                      </div>\n                      \n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <div className=\"font-medium text-gray-900 dark:text-white\">Preserve IDs</div>\n                            <div className=\"text-sm text-gray-600 dark:text-gray-400\">Keep original item IDs</div>\n                          </div>\n                          <Switch\n                            checked={importOptions.preserveIds}\n                            onCheckedChange={(checked) => setImportOptions(prev => ({ ...prev, preserveIds: checked }))}\n                          />\n                        </div>\n                        \n                        <div className=\"flex items-center justify-between\">\n                          <div>\n                            <div className=\"font-medium text-gray-900 dark:text-white\">Validate Data</div>\n                            <div className=\"text-sm text-gray-600 dark:text-gray-400\">Check for errors</div>\n                          </div>\n                          <Switch\n                            checked={importOptions.validateData}\n                            onCheckedChange={(checked: boolean) => setImportOptions(prev => ({ ...prev, validateData: checked }))}\n                          />\n                        </div>\n                      </div>\n                    </div>\n                  </Card>\n                )}\n\n                {/* Import Preview */}\n                {importPreview && (\n                  <Card className=\"p-6\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">Import Preview</h3>\n                    \n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n                          {importPreview.totalItems}\n                        </div>\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Items</div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n                          {importPreview.newItems}\n                        </div>\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">New Items</div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-orange-600 dark:text-orange-400\">\n                          {importPreview.duplicates}\n                        </div>\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Duplicates</div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">\n                          {importPreview.invalidItems}\n                        </div>\n                        <div className=\"text-sm text-gray-600 dark:text-gray-400\">Invalid Items</div>\n                      </div>\n                    </div>\n                    \n                    {importPreview.sampleItems.length > 0 && (\n                      <div>\n                        <h4 className=\"font-medium text-gray-900 dark:text-white mb-3\">Sample Items</h4>\n                        <div className=\"space-y-2\">\n                          {importPreview.sampleItems.map((item, index) => (\n                            <div key={index} className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                              <div className=\"flex-1\">\n                                <div className=\"font-medium text-gray-900 dark:text-white\">\n                                  {item.title || item.name || 'Unknown'}\n                                </div>\n                                <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                                  {item.path || 'No path'}\n                                </div>\n                              </div>\n                              <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                                {item.type || 'Unknown type'}\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                  </Card>\n                )}\n\n                {/* Import Button */}\n                {importFile && importPreview && (\n                  <Button\n                    onClick={handleImport}\n                    disabled={isImporting}\n                    className=\"w-full\"\n                  >\n                    {isImporting ? (\n                      <>\n                        <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\n                        Importing...\n                      </>\n                    ) : (\n                      <>\n                        <Upload className=\"w-4 h-4 mr-2\" />\n                        Import Collection\n                      </>\n                    )}\n                  </Button>\n                )}\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n      </motion.div>\n    </motion.div>\n  )\n}","import React, { useState, useEffect, useCallback, useRef } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport {\n  Wifi,\n  WifiOff,\n  Bell,\n  BellOff,\n  RefreshCw,\n  Users,\n  UserPlus,\n  UserMinus,\n  FilePlus,\n  FileMinus,\n  Edit,\n  Trash2,\n  Download,\n  Play,\n  Eye,\n  EyeOff,\n  MessageSquare,\n  Heart,\n  Share2,\n  Clock,\n  Check,\n  X,\n  AlertCircle,\n  Activity,\n  Server,\n  Database,\n  Cloud,\n  Zap,\n  Volume2,\n  VolumeX\n} from 'lucide-react'\nimport { Button } from '../ui/Button'\nimport { Switch } from '../ui/Switch'\nimport { Card } from '../ui/Card'\nimport { SmartCollection } from '../../types/collections'\nimport { useCollection } from '../../hooks/useCollections'\nimport { toast } from 'react-hot-toast'\n\ninterface CollectionRealTimeProps {\n  collection: SmartCollection\n  onClose?: () => void\n}\n\ninterface RealtimeEvent {\n  id: string\n  type: 'user_joined' | 'user_left' | 'item_added' | 'item_removed' | 'item_updated' | 'item_deleted' | 'download_started' | 'playback_started' | 'comment_added' | 'share_created' | 'rating_added'\n  timestamp: string\n  userId: string\n  userName: string\n  userAvatar?: string\n  data: {\n    itemId?: string\n    itemTitle?: string\n    itemType?: string\n    action?: string\n    details?: any\n  }\n  collectionId: string\n  collectionName: string\n}\n\ninterface OnlineUser {\n  id: string\n  name: string\n  avatar?: string\n  status: 'active' | 'away' | 'idle'\n  lastSeen: string\n  currentActivity?: string\n  isCurrentUser?: boolean\n}\n\ninterface ConnectionStatus {\n  status: 'connecting' | 'connected' | 'disconnected' | 'reconnecting' | 'error'\n  latency?: number\n  messageCount?: number\n  lastConnected?: string\n}\n\ninterface NotificationSettings {\n  userActivity: boolean\n  itemChanges: boolean\n  playbackActivity: boolean\n  commentsAndShares: boolean\n  systemNotifications: boolean\n  soundEnabled: boolean\n  desktopNotifications: boolean\n}\n\nconst EVENT_ICONS = {\n  user_joined: UserPlus,\n  user_left: UserMinus,\n  item_added: FilePlus,\n  item_removed: FileMinus,\n  item_updated: Edit,\n  item_deleted: Trash2,\n  download_started: Download,\n  playback_started: Play,\n  comment_added: MessageSquare,\n  share_created: Share2,\n  rating_added: Heart\n}\n\nconst EVENT_DESCRIPTIONS = {\n  user_joined: (userName: string) => `${userName} joined the collection`,\n  user_left: (userName: string) => `${userName} left the collection`,\n  item_added: (userName: string, itemTitle: string) => `${userName} added \"${itemTitle}\"`,\n  item_removed: (userName: string, itemTitle: string) => `${userName} removed \"${itemTitle}\"`,\n  item_updated: (userName: string, itemTitle: string) => `${userName} updated \"${itemTitle}\"`,\n  item_deleted: (userName: string, itemTitle: string) => `${userName} deleted \"${itemTitle}\"`,\n  download_started: (userName: string, itemTitle: string) => `${userName} started downloading \"${itemTitle}\"`,\n  playback_started: (userName: string, itemTitle: string) => `${userName} started playing \"${itemTitle}\"`,\n  comment_added: (userName: string, itemTitle: string) => `${userName} commented on \"${itemTitle}\"`,\n  share_created: (userName: string) => `${userName} shared this collection`,\n  rating_added: (userName: string, itemTitle: string, rating: number) => `${userName} rated \"${itemTitle}\" ${rating} stars`\n}\n\nexport const CollectionRealTime: React.FC<CollectionRealTimeProps> = ({\n  collection,\n  onClose\n}) => {\n  const [isConnected, setIsConnected] = useState(false)\n  const [connectionStatus, setConnectionStatus] = useState<ConnectionStatus>({\n    status: 'disconnected'\n  })\n  const [onlineUsers, setOnlineUsers] = useState<OnlineUser[]>([])\n  const [recentEvents, setRecentEvents] = useState<RealtimeEvent[]>([])\n  const [notificationsEnabled, setNotificationsEnabled] = useState(true)\n  const [notificationSettings, setNotificationSettings] = useState<NotificationSettings>({\n    userActivity: true,\n    itemChanges: true,\n    playbackActivity: true,\n    commentsAndShares: true,\n    systemNotifications: true,\n    soundEnabled: true,\n    desktopNotifications: false\n  })\n  const [showUserList, setShowUserList] = useState(true)\n  const [showEventHistory, setShowEventHistory] = useState(true)\n  const [activityStats, setActivityStats] = useState({\n    activeUsers: 0,\n    totalInteractions: 0,\n    recentActivity: 0,\n    peakConcurrent: 0\n  })\n  \n  const wsRef = useRef<WebSocket | null>(null)\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null)\n  const heartbeatIntervalRef = useRef<NodeJS.Timeout | null>(null)\n  \n  const { collectionItems, refetchItems } = useCollection(collection?.id || '')\n\n  // Use collection items from props if available\n  const items = collectionItems || []\n\n  // Simulate WebSocket connection\n  const connectWebSocket = useCallback(() => {\n    setConnectionStatus({ status: 'connecting' })\n    \n    // Simulate connection delay\n    setTimeout(() => {\n      setIsConnected(true)\n      setConnectionStatus({\n        status: 'connected',\n        latency: Math.floor(Math.random() * 50) + 20,\n        messageCount: 0,\n        lastConnected: new Date().toISOString()\n      })\n      \n      // Simulate initial online users\n      const mockUsers: OnlineUser[] = [\n        {\n          id: '1',\n          name: 'You',\n          avatar: undefined,\n          status: 'active',\n          lastSeen: new Date().toISOString(),\n          isCurrentUser: true\n        },\n        {\n          id: '2',\n          name: 'John Doe',\n          avatar: undefined,\n          status: 'active',\n          lastSeen: new Date().toISOString(),\n          currentActivity: 'Browsing items'\n        },\n        {\n          id: '3',\n          name: 'Jane Smith',\n          avatar: undefined,\n          status: 'away',\n          lastSeen: new Date(Date.now() - 300000).toISOString(),\n          currentActivity: 'Away'\n        }\n      ]\n      setOnlineUsers(mockUsers)\n      \n      // Generate some mock events\n      const mockEvents: RealtimeEvent[] = [\n        {\n          id: '1',\n          type: 'user_joined',\n          timestamp: new Date(Date.now() - 300000).toISOString(),\n          userId: '2',\n          userName: 'John Doe',\n          data: {},\n          collectionId: collection.id,\n          collectionName: collection.name\n        },\n        {\n          id: '2',\n          type: 'item_added',\n          timestamp: new Date(Date.now() - 180000).toISOString(),\n          userId: '2',\n          userName: 'John Doe',\n          data: {\n            itemId: 'item123',\n            itemTitle: 'Summer Mix 2024',\n            itemType: 'music'\n          },\n          collectionId: collection.id,\n          collectionName: collection.name\n        },\n        {\n          id: '3',\n          type: 'playback_started',\n          timestamp: new Date(Date.now() - 60000).toISOString(),\n          userId: '3',\n          userName: 'Jane Smith',\n          data: {\n            itemId: 'item456',\n            itemTitle: 'Presentation Video',\n            itemType: 'video'\n          },\n          collectionId: collection.id,\n          collectionName: collection.name\n        }\n      ]\n      setRecentEvents(mockEvents)\n      \n      setActivityStats({\n        activeUsers: mockUsers.length,\n        totalInteractions: mockEvents.length,\n        recentActivity: 3,\n        peakConcurrent: 5\n      })\n      \n    }, 1000)\n  }, [collection.id, collection.name])\n\n  const disconnectWebSocket = useCallback(() => {\n    setIsConnected(false)\n    setConnectionStatus({ status: 'disconnected' })\n    setOnlineUsers([])\n    \n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current)\n    }\n    \n    if (heartbeatIntervalRef.current) {\n      clearInterval(heartbeatIntervalRef.current)\n    }\n  }, [])\n\n  const toggleConnection = useCallback(() => {\n    if (isConnected) {\n      disconnectWebSocket()\n    } else {\n      connectWebSocket()\n    }\n  }, [isConnected, connectWebSocket, disconnectWebSocket])\n\n  // Auto-connect on component mount\n  useEffect(() => {\n    connectWebSocket()\n    \n    return () => {\n      disconnectWebSocket()\n    }\n  }, [connectWebSocket, disconnectWebSocket])\n\n  // Simulate real-time updates\n  useEffect(() => {\n    if (!isConnected) return\n    \n    const interval = setInterval(() => {\n      // Simulate random events\n      const eventTypes = Object.keys(EVENT_ICONS) as Array<keyof typeof EVENT_ICONS>\n      const randomType = eventTypes[Math.floor(Math.random() * eventTypes.length)]\n      \n      const newEvent: RealtimeEvent = {\n        id: Date.now().toString(),\n        type: randomType,\n        timestamp: new Date().toISOString(),\n        userId: Math.random().toString(),\n        userName: ['John Doe', 'Jane Smith', 'Bob Wilson'][Math.floor(Math.random() * 3)],\n        data: {\n          itemId: Math.random().toString(),\n          itemTitle: `Item ${Math.floor(Math.random() * 100)}`,\n          itemType: ['music', 'video', 'image'][Math.floor(Math.random() * 3)]\n        },\n        collectionId: collection.id,\n        collectionName: collection.name\n      }\n      \n      setRecentEvents(prev => [newEvent, ...prev.slice(0, 49)])\n      \n      // Update activity stats\n      setActivityStats(prev => ({\n        ...prev,\n        totalInteractions: prev.totalInteractions + 1,\n        recentActivity: prev.recentActivity + 1\n      }))\n      \n      // Show notification if enabled\n      if (notificationsEnabled && notificationSettings[getEventCategory(randomType) as keyof NotificationSettings]) {\n        const description = getEventDescription(newEvent)\n        \n        if (notificationSettings.desktopNotifications && 'Notification' in window) {\n          new Notification(description, {\n            body: collection.name,\n            icon: '/favicon.ico'\n          })\n        }\n        \n        if (notificationSettings.soundEnabled) {\n          // Play sound (simplified)\n          const audio = new Audio('/notification.mp3')\n          audio.volume = 0.3\n          audio.play().catch(() => {}) // Ignore errors\n        }\n        \n        toast(description)\n      }\n    }, Math.random() * 10000 + 5000) // Random interval between 5-15 seconds\n    \n    return () => clearInterval(interval)\n  }, [isConnected, collection, notificationsEnabled, notificationSettings])\n\n  const getEventCategory = (eventType: string): string => {\n    if (['user_joined', 'user_left'].includes(eventType)) return 'userActivity'\n    if (['item_added', 'item_removed', 'item_updated', 'item_deleted'].includes(eventType)) return 'itemChanges'\n    if (['download_started', 'playback_started'].includes(eventType)) return 'playbackActivity'\n    if (['comment_added', 'share_created', 'rating_added'].includes(eventType)) return 'commentsAndShares'\n    return 'systemNotifications'\n  }\n\n  const getEventDescription = (event: RealtimeEvent): string => {\n    const descriptionFn = EVENT_DESCRIPTIONS[event.type]\n    if (descriptionFn) {\n      if (event.type === 'rating_added') {\n        return (descriptionFn as any)(event.userName, event.data.itemTitle || '', event.data.details?.rating || 5)\n      } else if (event.type === 'user_joined' || event.type === 'user_left' || event.type === 'share_created') {\n        return (descriptionFn as any)(event.userName)\n      } else {\n        return (descriptionFn as any)(event.userName, event.data.itemTitle || '')\n      }\n    }\n    return `${event.userName} performed an action`\n  }\n\n  const formatTimestamp = (timestamp: string): string => {\n    const date = new Date(timestamp)\n    const now = new Date()\n    const diffMs = now.getTime() - date.getTime()\n    const diffMins = Math.floor(diffMs / 60000)\n    \n    if (diffMins < 1) return 'Just now'\n    if (diffMins < 60) return `${diffMins}m ago`\n    \n    const diffHours = Math.floor(diffMins / 60)\n    if (diffHours < 24) return `${diffHours}h ago`\n    \n    return date.toLocaleDateString()\n  }\n\n  const getStatusColor = (status: string): string => {\n    switch (status) {\n      case 'connected': return 'text-green-600 dark:text-green-400'\n      case 'connecting': return 'text-yellow-600 dark:text-yellow-400'\n      case 'reconnecting': return 'text-orange-600 dark:text-orange-400'\n      case 'error': return 'text-red-600 dark:text-red-400'\n      default: return 'text-gray-600 dark:text-gray-400'\n    }\n  }\n\n  const requestDesktopNotifications = useCallback(async () => {\n    if ('Notification' in window && Notification.permission === 'default') {\n      await Notification.requestPermission()\n      setNotificationSettings(prev => ({ ...prev, desktopNotifications: true }))\n    }\n  }, [])\n\n  const EventItem = ({ event }: { event: RealtimeEvent }) => {\n    const Icon = EVENT_ICONS[event.type]\n    \n    return (\n      <motion.div\n        initial={{ opacity: 0, x: -20 }}\n        animate={{ opacity: 1, x: 0 }}\n        className=\"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\"\n      >\n        <div className=\"p-2 bg-blue-100 dark:bg-blue-900/20 rounded-lg\">\n          <Icon className=\"w-4 h-4 text-blue-600 dark:text-blue-400\" />\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\n            {getEventDescription(event)}\n          </p>\n          <p className=\"text-xs text-gray-600 dark:text-gray-400\">\n            {formatTimestamp(event.timestamp)}\n          </p>\n        </div>\n      </motion.div>\n    )\n  }\n\n  const OnlineUserItem = ({ user }: { user: OnlineUser }) => (\n    <div className=\"flex items-center gap-3 p-2\">\n      <div className=\"relative\">\n        <div className=\"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-medium\">\n          {user.name.charAt(0)}\n        </div>\n        <div className={`absolute bottom-0 right-0 w-2.5 h-2.5 rounded-full border-2 border-white dark:border-gray-900 ${\n          user.status === 'active' ? 'bg-green-500' :\n          user.status === 'away' ? 'bg-yellow-500' : 'bg-gray-400'\n        }`} />\n      </div>\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"text-sm font-medium text-gray-900 dark:text-white\">\n          {user.name} {user.isCurrentUser && '(You)'}\n        </p>\n        {user.currentActivity && (\n          <p className=\"text-xs text-gray-600 dark:text-gray-400 truncate\">\n            {user.currentActivity}\n          </p>\n        )}\n      </div>\n    </div>\n  )\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.95 }}\n      animate={{ opacity: 1, scale: 1 }}\n      exit={{ opacity: 0, scale: 0.95 }}\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\"\n      onClick={onClose}\n    >\n      <motion.div\n        initial={{ y: 20 }}\n        animate={{ y: 0 }}\n        className=\"bg-white dark:bg-gray-900 rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\n          <div>\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Real-time Collection</h2>\n            <p className=\"text-gray-600 dark:text-gray-400\">{collection.name}</p>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            {/* Connection Status */}\n            <div className=\"flex items-center gap-2\">\n              <div className={`flex items-center gap-2 px-3 py-1.5 rounded-lg ${\n                connectionStatus.status === 'connected' \n                  ? 'bg-green-100 dark:bg-green-900/20 text-green-600 dark:text-green-400'\n                  : connectionStatus.status === 'connecting'\n                  ? 'bg-yellow-100 dark:bg-yellow-900/20 text-yellow-600 dark:text-yellow-400'\n                  : 'bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400'\n              }`}>\n                {connectionStatus.status === 'connected' ? (\n                  <Wifi className=\"w-4 h-4\" />\n                ) : connectionStatus.status === 'connecting' ? (\n                  <RefreshCw className=\"w-4 h-4 animate-spin\" />\n                ) : (\n                  <WifiOff className=\"w-4 h-4\" />\n                )}\n                <span className=\"text-sm font-medium\">\n                  {connectionStatus.status.charAt(0).toUpperCase() + connectionStatus.status.slice(1)}\n                </span>\n              </div>\n              \n              {connectionStatus.latency && (\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  {connectionStatus.latency}ms\n                </span>\n              )}\n            </div>\n\n            {/* Notifications Toggle */}\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setNotificationsEnabled(!notificationsEnabled)}\n              className={`flex items-center gap-2 ${\n                notificationsEnabled ? 'text-blue-600 dark:text-blue-400' : 'text-gray-600 dark:text-gray-400'\n              }`}\n            >\n              {notificationsEnabled ? (\n                <Bell className=\"w-4 h-4\" />\n              ) : (\n                <BellOff className=\"w-4 h-4\" />\n              )}\n            </Button>\n\n            {onClose && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={onClose}\n              >\n                <X className=\"w-4 h-4\" />\n              </Button>\n            )}\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"overflow-y-auto p-6 max-h-[calc(90vh-140px)]\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {/* Left Panel - Activity Stats */}\n            <div className=\"space-y-6\">\n              {/* Connection Controls */}\n              <Card className=\"p-4\">\n                <h3 className=\"font-semibold text-gray-900 dark:text-white mb-3\">Connection</h3>\n                <div className=\"space-y-3\">\n                  <Button\n                    onClick={toggleConnection}\n                    className={`w-full ${\n                      isConnected \n                        ? 'bg-red-600 hover:bg-red-700' \n                        : 'bg-green-600 hover:bg-green-700'\n                    }`}\n                  >\n                    {isConnected ? (\n                      <>\n                        <WifiOff className=\"w-4 h-4 mr-2\" />\n                        Disconnect\n                      </>\n                    ) : (\n                      <>\n                        <Wifi className=\"w-4 h-4 mr-2\" />\n                        Connect\n                      </>\n                    )}\n                  </Button>\n                  \n                  {connectionStatus.lastConnected && (\n                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      Last connected: {formatTimestamp(connectionStatus.lastConnected)}\n                    </div>\n                  )}\n                </div>\n              </Card>\n\n              {/* Activity Stats */}\n              <Card className=\"p-4\">\n                <h3 className=\"font-semibold text-gray-900 dark:text-white mb-3\">Activity Stats</h3>\n                <div className=\"space-y-3\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Active Users</span>\n                    <span className=\"font-medium text-gray-900 dark:text-white\">\n                      {activityStats.activeUsers}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Total Interactions</span>\n                    <span className=\"font-medium text-gray-900 dark:text-white\">\n                      {activityStats.totalInteractions}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Recent Activity</span>\n                    <span className=\"font-medium text-gray-900 dark:text-white\">\n                      {activityStats.recentActivity}\n                    </span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">Peak Concurrent</span>\n                    <span className=\"font-medium text-gray-900 dark:text-white\">\n                      {activityStats.peakConcurrent}\n                    </span>\n                  </div>\n                </div>\n              </Card>\n\n              {/* Notification Settings */}\n              <Card className=\"p-4\">\n                <h3 className=\"font-semibold text-gray-900 dark:text-white mb-3\">Notifications</h3>\n                <div className=\"space-y-3\">\n                  {Object.entries({\n                    userActivity: 'User Activity',\n                    itemChanges: 'Item Changes',\n                    playbackActivity: 'Playback Activity',\n                    commentsAndShares: 'Comments & Shares'\n                  }).map(([key, label]) => (\n                    <div key={key} className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-700 dark:text-gray-300\">{label}</span>\n                      <Switch\n                        checked={notificationSettings[key as keyof NotificationSettings]}\n                        onCheckedChange={(checked: boolean) => setNotificationSettings(prev => ({\n                          ...prev,\n                          [key]: checked\n                        }))}\n                      />\n                    </div>\n                  ))}\n                  \n                  <div className=\"border-t border-gray-200 dark:border-gray-700 pt-3 space-y-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-700 dark:text-gray-300\">Sound</span>\n                      <Switch\n                        checked={notificationSettings.soundEnabled}\n                        onCheckedChange={(checked: boolean) => setNotificationSettings(prev => ({\n                          ...prev,\n                          soundEnabled: checked\n                        }))}\n                      />\n                    </div>\n                    \n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-sm text-gray-700 dark:text-gray-300\">Desktop</span>\n                      {notificationSettings.desktopNotifications ? (\n                        <Switch\n                          checked={true}\n                          onCheckedChange={() => setNotificationSettings(prev => ({\n                            ...prev,\n                            desktopNotifications: false\n                          }))}\n                        />\n                      ) : (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={requestDesktopNotifications}\n                          className=\"text-xs\"\n                        >\n                          Enable\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </Card>\n            </div>\n\n            {/* Middle Panel - Online Users */}\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"font-semibold text-gray-900 dark:text-white\">\n                  Online Users ({onlineUsers.length})\n                </h3>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setShowUserList(!showUserList)}\n                >\n                  {showUserList ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                </Button>\n              </div>\n              \n              <AnimatePresence>\n                {showUserList && (\n                  <motion.div\n                    initial={{ opacity: 0, height: 0 }}\n                    animate={{ opacity: 1, height: 'auto' }}\n                    exit={{ opacity: 0, height: 0 }}\n                  >\n                    <Card className=\"p-4\">\n                      <div className=\"space-y-2\">\n                        {onlineUsers.map((user) => (\n                          <OnlineUserItem key={user.id} user={user} />\n                        ))}\n                      </div>\n                    </Card>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </div>\n\n            {/* Right Panel - Event History */}\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"font-semibold text-gray-900 dark:text-white\">\n                  Recent Events\n                </h3>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => setShowEventHistory(!showEventHistory)}\n                >\n                  {showEventHistory ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                </Button>\n              </div>\n              \n              <AnimatePresence>\n                {showEventHistory && (\n                  <motion.div\n                    initial={{ opacity: 0, height: 0 }}\n                    animate={{ opacity: 1, height: 'auto' }}\n                    exit={{ opacity: 0, height: 0 }}\n                  >\n                    <Card className=\"p-4\">\n                      <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n                        {recentEvents.length === 0 ? (\n                          <div className=\"text-center text-gray-500 dark:text-gray-400 py-8\">\n                            <Activity className=\"w-8 h-8 mx-auto mb-2\" />\n                            <p>No recent activity</p>\n                          </div>\n                        ) : (\n                          recentEvents.slice(0, 20).map((event) => (\n                            <EventItem key={event.id} event={event} />\n                          ))\n                        )}\n                      </div>\n                    </Card>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </div>\n          </div>\n        </div>\n      </motion.div>\n    </motion.div>\n  )\n}","import React, { lazy, Suspense } from 'react';\nimport { Loader2 } from 'lucide-react';\n\n// Lazy loaded components for better performance\nconst CollectionTemplates = lazy(() => import('../collections/CollectionTemplates'));\nconst AdvancedSearch = lazy(() => import('../collections/AdvancedSearch'));\nconst CollectionAutomation = lazy(() => import('../collections/CollectionAutomation'));\nconst ExternalIntegrations = lazy(() => import('../collections/ExternalIntegrations'));\nconst SmartCollectionBuilder = lazy(() => import('../collections/SmartCollectionBuilder').then(m => ({ default: m.SmartCollectionBuilder })));\nconst CollectionAnalytics = lazy(() => import('../collections/CollectionAnalytics').then(m => ({ default: m.CollectionAnalytics })));\nconst BulkOperations = lazy(() => import('../collections/BulkOperations'));\n\ninterface LazyComponentProps {\n  componentName: string;\n  fallback?: React.ReactNode;\n  children?: React.ReactNode;\n}\n\nexport const ComponentLoader: React.FC<LazyComponentProps> = ({\n  componentName,\n  fallback = (\n    <div className=\"flex items-center justify-center min-h-[200px]\">\n      <Loader2 className=\"w-8 h-8 animate-spin text-blue-600\" />\n    </div>\n  ),\n  children\n}) => (\n  <Suspense fallback={fallback}>\n    {children}\n  </Suspense>\n);\n\n// Preload specific components for better UX\nexport const preloadComponent = (componentName: string) => {\n  switch (componentName) {\n    case 'CollectionTemplates':\n      import('../collections/CollectionTemplates');\n      break;\n    case 'AdvancedSearch':\n      import('../collections/AdvancedSearch');\n      break;\n    case 'CollectionAutomation':\n      import('../collections/CollectionAutomation');\n      break;\n    case 'ExternalIntegrations':\n      import('../collections/ExternalIntegrations');\n      break;\n    case 'SmartCollectionBuilder':\n      import('../collections/SmartCollectionBuilder');\n      break;\n    case 'CollectionAnalytics':\n      import('../collections/CollectionAnalytics');\n      break;\n    case 'BulkOperations':\n      import('../collections/BulkOperations');\n      break;\n    default:\n      // Unknown component name - no preload action taken\n      break;\n  }\n};\n\n// Export lazy-loaded components\nexport {\n  CollectionTemplates,\n  AdvancedSearch,\n  CollectionAutomation,\n  ExternalIntegrations,\n  SmartCollectionBuilder,\n  CollectionAnalytics,\n  BulkOperations\n};\n\n// Component usage example:\n// <ComponentLoader componentName=\"CollectionTemplates\">\n//   <CollectionTemplates {...props} />\n// </ComponentLoader>","import React, { useMemo, useCallback, useState, useRef, useEffect } from 'react';\nimport debounce from 'lodash/debounce';\n\n// Memoization cache for expensive computations\ninterface MemoCache {\n  [key: string]: {\n    value: any;\n    timestamp: number;\n    ttl: number;\n  };\n}\n\nclass MemoCacheManager {\n  private cache: MemoCache = {};\n  private maxSize: number;\n  private cleanupInterval: NodeJS.Timeout;\n\n  constructor(maxSize = 100, cleanupIntervalMs = 60000) {\n    this.maxSize = maxSize;\n    this.cleanupInterval = setInterval(() => this.cleanup(), cleanupIntervalMs);\n  }\n\n  get(key: string): any {\n    const entry = this.cache[key];\n    if (!entry) return null;\n\n    if (Date.now() - entry.timestamp > entry.ttl) {\n      delete this.cache[key];\n      return null;\n    }\n\n    return entry.value;\n  }\n\n  set(key: string, value: any, ttl = 300000): void { // Default TTL: 5 minutes\n    if (Object.keys(this.cache).length >= this.maxSize) {\n      // Remove oldest entry\n      const oldestKey = Object.keys(this.cache).reduce((oldest, current) => {\n        return this.cache[current].timestamp < this.cache[oldest].timestamp ? current : oldest;\n      });\n      delete this.cache[oldestKey];\n    }\n\n    this.cache[key] = {\n      value,\n      timestamp: Date.now(),\n      ttl\n    };\n  }\n\n  private cleanup(): void {\n    const now = Date.now();\n    Object.keys(this.cache).forEach(key => {\n      if (now - this.cache[key].timestamp > this.cache[key].ttl) {\n        delete this.cache[key];\n      }\n    });\n  }\n\n  clear(): void {\n    this.cache = {};\n  }\n\n  destroy(): void {\n    clearInterval(this.cleanupInterval);\n    this.clear();\n  }\n}\n\n// Global cache instance\nconst globalCache = new MemoCacheManager();\n\n// Custom hook for memoized expensive operations\nexport const useMemoized = <T,>(\n  computation: () => T,\n  dependencies: React.DependencyList,\n  key?: string,\n  ttl = 300000\n): T => {\n  const cacheKey = key || dependencies.map(dep => String(dep)).join('|');\n\n  // Always call useMemo first (hooks must be called unconditionally)\n  const computedValue = useMemo(computation, dependencies);\n\n  // Try to get from cache first\n  const cachedValue = globalCache.get(cacheKey);\n  if (cachedValue !== null) {\n    return cachedValue;\n  }\n\n  // Cache and return the computed value\n  globalCache.set(cacheKey, computedValue, ttl);\n\n  return computedValue;\n};\n\n// Debounced search hook\nexport const useDebounceSearch = <T,>(\n  searchFunction: (query: string) => Promise<T>,\n  delay = 300\n) => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [results, setResults] = useState<T | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  const debouncedSearch = useMemo(\n    () => debounce(async (query: string) => {\n      if (!query.trim()) {\n        setResults(null);\n        return;\n      }\n\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        const result = await searchFunction(query);\n        setResults(result);\n      } catch (err) {\n        setError(err as Error);\n      } finally {\n        setIsLoading(false);\n      }\n    }, delay),\n    [searchFunction, delay]\n  );\n\n  useEffect(() => {\n    debouncedSearch(searchQuery);\n    return () => debouncedSearch.cancel();\n  }, [searchQuery, debouncedSearch]);\n\n  return {\n    searchQuery,\n    setSearchQuery,\n    results,\n    isLoading,\n    error\n  };\n};\n\n// Component to monitor and optimize render performance\nexport const usePerformanceMonitor = (componentName: string) => {\n  const renderCount = useRef(0);\n  const renderTimes = useRef<number[]>([]);\n  const lastRenderTime = useRef(Date.now());\n\n  useEffect(() => {\n    renderCount.current++;\n    const now = Date.now();\n    const renderTime = now - lastRenderTime.current;\n    renderTimes.current.push(renderTime);\n    lastRenderTime.current = now;\n\n    // Keep only last 10 renders\n    if (renderTimes.current.length > 10) {\n      renderTimes.current.shift();\n    }\n\n    // Performance data available via returned renderCount and averageRenderTime\n  });\n\n  return {\n    renderCount: renderCount.current,\n    averageRenderTime: renderTimes.current.length > 0 \n      ? renderTimes.current.reduce((a, b) => a + b, 0) / renderTimes.current.length\n      : 0\n  };\n};\n\n// Optimized data filtering and sorting hook\nexport const useOptimizedData = <T,>(\n  data: T[],\n  filters: Record<string, any>,\n  sortBy?: string,\n  sortDirection: 'asc' | 'desc' = 'asc'\n) => {\n  const key = `${JSON.stringify(filters)}-${sortBy}-${sortDirection}`;\n\n  const processedData = useMemoized(() => {\n    let result = [...data];\n\n    // Apply filters\n    Object.entries(filters).forEach(([field, value]) => {\n      if (value !== null && value !== undefined && value !== '') {\n        result = result.filter(item => {\n          const itemValue = (item as Record<string, any>)[field];\n          if (typeof value === 'string') {\n            return String(itemValue).toLowerCase().includes(value.toLowerCase());\n          }\n          return itemValue === value;\n        });\n      }\n    });\n\n    // Apply sorting\n    if (sortBy) {\n      result.sort((a, b) => {\n        const aVal = (a as Record<string, any>)[sortBy];\n        const bVal = (b as Record<string, any>)[sortBy];\n        \n        if (aVal === null || aVal === undefined) return sortDirection === 'asc' ? -1 : 1;\n        if (bVal === null || bVal === undefined) return sortDirection === 'asc' ? 1 : -1;\n        \n        if (typeof aVal === 'string' && typeof bVal === 'string') {\n          return sortDirection === 'asc' \n            ? aVal.localeCompare(bVal)\n            : bVal.localeCompare(aVal);\n        }\n        \n        if (typeof aVal === 'number' && typeof bVal === 'number') {\n          return sortDirection === 'asc' \n            ? aVal - bVal\n            : bVal - aVal;\n        }\n        \n        return 0;\n      });\n    }\n\n    return result;\n  }, [data, key]);\n\n  return processedData;\n};\n\n// Intersection Observer hook for lazy loading\nexport const useIntersectionObserver = (\n  options: IntersectionObserverInit = {}\n) => {\n  const [entries, setEntries] = useState<IntersectionObserverEntry[]>([]);\n  const observer = useRef<IntersectionObserver>();\n\n  const observe = useCallback((element: Element) => {\n    if (observer.current) {\n      observer.current.observe(element);\n    }\n  }, []);\n\n  const unobserve = useCallback((element: Element) => {\n    if (observer.current) {\n      observer.current.unobserve(element);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (typeof IntersectionObserver === 'undefined') {\n      return;\n    }\n\n    observer.current = new IntersectionObserver((entries) => {\n      setEntries(entries);\n    }, options);\n\n    return () => {\n      if (observer.current) {\n        observer.current.disconnect();\n      }\n    };\n  }, [options]);\n\n  return { entries, observe, unobserve };\n};\n\n// Pagination hook with caching\nexport const usePagination = <T,>(\n  data: T[],\n  itemsPerPage: number,\n  currentPage = 1\n) => {\n  const [page, setPage] = useState(currentPage);\n  const cacheKey = `pagination-${page}-${itemsPerPage}`;\n\n  const paginatedData = useMemoized(() => {\n    const startIndex = (page - 1) * itemsPerPage;\n    const endIndex = startIndex + itemsPerPage;\n    return data.slice(startIndex, endIndex);\n  }, [data, page, itemsPerPage], cacheKey);\n\n  const totalPages = Math.ceil(data.length / itemsPerPage);\n  const hasNextPage = page < totalPages;\n  const hasPrevPage = page > 1;\n\n  const nextPage = useCallback(() => {\n    setPage(prev => Math.min(prev + 1, totalPages));\n  }, [totalPages]);\n\n  const prevPage = useCallback(() => {\n    setPage(prev => Math.max(prev - 1, 1));\n  }, []);\n\n  const goToPage = useCallback((targetPage: number) => {\n    setPage(Math.max(1, Math.min(targetPage, totalPages)));\n  }, [totalPages]);\n\n  return {\n    page,\n    setPage,\n    paginatedData,\n    totalPages,\n    hasNextPage,\n    hasPrevPage,\n    nextPage,\n    prevPage,\n    goToPage\n  };\n};\n\n// Export cache manager for direct usage if needed\nexport { globalCache as memoCache };\n\n// Performance monitoring utility\nexport const measurePerformance = <T,>(\n  name: string,\n  fn: () => T\n): T => {\n  const result = fn();\n  return result;\n};\n\n// Async performance monitoring\nexport const measureAsyncPerformance = async <T,>(\n  name: string,\n  fn: () => Promise<T>\n): Promise<T> => {\n  const result = await fn();\n  return result;\n};","import React, { useState, useCallback, useMemo } from 'react';\nimport { motion } from 'framer-motion';\nimport {\n  Plus,\n  Search,\n  Filter,\n  Grid,\n  List,\n  Heart,\n  Clock,\n  BarChart3,\n  Share,\n  Share2,\n  MoreHorizontal,\n  Edit,\n  Trash2,\n  Copy,\n  Download,\n  Eye,\n  Settings,\n  CheckSquare,\n  Square,\n  X,\n  Users,\n  Bot,\n  FileText,\n  Zap,\n  Play,\n  Globe,\n  AlertCircle,\n  Database,\n  Link,\n  Shield,\n  RefreshCw,\n  Activity,\n  Loader2,\n  Brain,\n  Sparkles\n} from 'lucide-react';\nimport { Button } from '../components/ui/Button';\nimport { Input } from '../components/ui/Input';\nimport { Select } from '../components/ui/Select';\nimport { Tabs } from '../components/ui/Tabs';\nimport { Card } from '../components/ui/Card';\nimport { SmartCollectionBuilder } from '../components/collections/SmartCollectionBuilder';\nimport { CollectionPreview } from '../components/collections/CollectionPreview';\nimport { BulkOperations } from '../components/collections/BulkOperations';\nimport { PerformanceOptimizer } from '../components/collections/PerformanceOptimizer';\nimport { CollectionSettings } from '../components/collections/CollectionSettings';\nimport { CollectionAnalytics } from '../components/collections/CollectionAnalytics';\nimport { CollectionSharing } from '../components/collections/CollectionSharing';\nimport { CollectionExport } from '../components/collections/CollectionExport';\nimport { CollectionRealTime } from '../components/collections/CollectionRealTime';\nimport { \n  ComponentLoader,\n  preloadComponent,\n  CollectionTemplates,\n  AdvancedSearch,\n  CollectionAutomation,\n  ExternalIntegrations,\n  CollectionAnalytics as LazyCollectionAnalytics\n} from '../components/performance/LazyComponents';\nimport { VirtualList, VirtualizedTable } from '../components/performance/VirtualScroller';\nimport { useMemoized, useOptimizedData, usePagination } from '../components/performance/MemoCache';\nimport { BundleAnalyzer } from '../components/performance/BundleAnalyzer';\nimport { \n  AICollectionSuggestions,\n  AINaturalSearch,\n  AIContentCategorizer\n} from '../components/ai/AIComponents';\nimport { \n  AIUserBehaviorAnalytics,\n  AIPredictions,\n  AISmartOrganization\n} from '../components/ai/AIAnalytics';\nimport { \n  AIMetadataExtractor,\n  AIAutomationRules,\n  AIContentQualityAnalyzer\n} from '../components/ai/AIMetadata';\nimport { useCollections } from '../hooks/useCollections';\nimport { SmartCollection } from '../types/collections';\nimport { toast } from 'react-hot-toast';\n\nconst COLLECTIONS_TABS = [\n  { id: 'all', label: 'All Collections' },\n  { id: 'smart', label: 'Smart Collections' },\n  { id: 'manual', label: 'Manual Collections' },\n  { id: 'favorites', label: 'Favorites' },\n  { id: 'templates', label: 'Templates' },\n  { id: 'automation', label: 'Automation' },\n  { id: 'integrations', label: 'Integrations' },\n  { id: 'ai', label: 'AI Features' },\n];\n\nconst MEDIA_TYPE_OPTIONS = [\n  { value: 'all', label: 'All Media' },\n  { value: 'music', label: 'Music' },\n  { value: 'video', label: 'Video' },\n  { value: 'image', label: 'Images' },\n  { value: 'document', label: 'Documents' }\n];\n\nconst VIEW_OPTIONS = [\n  { value: 'grid', label: 'Grid View', icon: Grid },\n  { value: 'list', label: 'List View', icon: List },\n];\n\nconst SORT_OPTIONS = [\n  { value: 'name', label: 'Name' },\n  { value: 'created_at', label: 'Date Created' },\n  { value: 'updated_at', label: 'Date Updated' },\n  { value: 'item_count', label: 'Item Count' },\n];\n\nexport const Collections: React.FC = () => {\n  const [activeTab, setActiveTab] = useState('all');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [filterMediaType, setFilterMediaType] = useState('all');\n  const [sortBy, setSortBy] = useState('name');\n  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');\n  const [showSmartBuilder, setShowSmartBuilder] = useState(false);\n  const [selectedCollection, setSelectedCollection] = useState<SmartCollection | null>(null);\n  const [previewCollection, setPreviewCollection] = useState<SmartCollection | null>(null);\n  const [selectedCollections, setSelectedCollections] = useState<string[]>([]);\n  const [showBulkOperations, setShowBulkOperations] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [showAnalytics, setShowAnalytics] = useState(false);\n  const [showSharing, setShowSharing] = useState(false);\n  const [showExport, setShowExport] = useState(false);\n  const [showRealTime, setShowRealTime] = useState(false);\n  const [showTemplates, setShowTemplates] = useState(false);\n  const [showAdvancedSearch, setShowAdvancedSearch] = useState(false);\n  const [showAutomation, setShowAutomation] = useState(false);\n  const [showIntegrations, setShowIntegrations] = useState(false);\n  const [showAI, setShowAI] = useState(false);\n  const [selectAll, setSelectAll] = useState(false);\n\n  // Performance metrics state\n  const [performanceMetrics, setPerformanceMetrics] = useState({\n    bundleSize: 0,\n    renderTime: 0,\n    memoryUsage: 0,\n    cacheHitRate: 0\n  });\n\n  // Performance monitoring\n  const measurePerformance = useCallback((name: string) => {\n    const startTime = performance.now();\n    return () => {\n      const endTime = performance.now();\n      const duration = endTime - startTime;\n      \n      setPerformanceMetrics(prev => ({\n        ...prev,\n        renderTime: duration\n      }));\n      \n      if (duration > 100) {\n        // Slow render detected - duration exceeds 100ms threshold\n      }\n    };\n  }, []);\n\n  const {\n    collections,\n    isLoading,\n    error,\n    refetchCollections,\n    createCollection,\n    updateCollection,\n    deleteCollection,\n    shareCollection,\n    duplicateCollection,\n    exportCollection,\n    bulkDeleteCollections,\n    bulkShareCollections,\n    bulkExportCollections,\n    bulkUpdateCollections,\n    isSharing,\n    isDuplicating,\n    isExporting,\n  } = useCollections();\n\n  // Debounced search for performance\n  const [debouncedSearch, setDebouncedSearch] = useState(searchQuery);\n  const [isDebouncing, setIsDebouncing] = useState(false);\n\n  React.useEffect(() => {\n    setIsDebouncing(true);\n    const timer = setTimeout(() => {\n      setDebouncedSearch(searchQuery);\n      setIsDebouncing(false);\n    }, 300);\n    return () => clearTimeout(timer);\n  }, [searchQuery]);\n\n  // Performance optimized collection filtering\n  const filters = useMemoized(() => ({\n    activeTab,\n    searchQuery: debouncedSearch,\n    filterMediaType\n  }), [activeTab, debouncedSearch, filterMediaType]);\n\n  const filteredCollections = useOptimizedData(\n    collections,\n    filters,\n    sortBy\n  );\n\n  // Pagination for large collections\n  const {\n    page: currentPage,\n    paginatedData: paginatedCollections,\n    totalPages,\n    nextPage,\n    prevPage,\n    goToPage\n  } = usePagination(filteredCollections, 20);\n\n  // Update search query with debouncing\n  const handleSearchChange = useCallback((value: string) => {\n    setSearchQuery(value);\n  }, []);\n\n  // Performance monitoring effect\n  React.useEffect(() => {\n    const endPerformance = measurePerformance('Collections Page');\n    \n    return () => {\n      endPerformance();\n    };\n  }, [activeTab, filteredCollections.length, measurePerformance]);\n\n  // Preload components based on active tab\n  React.useEffect(() => {\n    switch (activeTab) {\n      case 'templates':\n        preloadComponent('CollectionTemplates');\n        break;\n      case 'automation':\n        preloadComponent('CollectionAutomation');\n        break;\n      case 'integrations':\n        preloadComponent('ExternalIntegrations');\n        break;\n      default:\n        break;\n    }\n  }, [activeTab]);\n\n  // Selection handlers\n  const handleSelectCollection = useCallback((collectionId: string, selected: boolean) => {\n    setSelectedCollections(prev => {\n      if (selected) {\n        return [...prev, collectionId];\n      } else {\n        return prev.filter(id => id !== collectionId);\n      }\n    });\n  }, []);\n\n  const handleSelectAll = useCallback(() => {\n    if (selectAll) {\n      setSelectedCollections([]);\n    } else {\n      setSelectedCollections(filteredCollections.map(c => c.id));\n    }\n    setSelectAll(!selectAll);\n  }, [selectAll, filteredCollections]);\n\n  const handleClearSelection = () => {\n    setSelectedCollections([]);\n    setSelectAll(false);\n  };\n\n  const handlePreviewCollection = (collection: SmartCollection) => {\n    setPreviewCollection(collection);\n  };\n\n  const handleClosePreview = () => {\n    setPreviewCollection(null);\n  };\n\n  const handleOpenSettings = (collection: SmartCollection) => {\n    setSelectedCollection(collection);\n    setShowSettings(true);\n  };\n\n  const handleCreateSmartCollection = () => {\n    setShowSmartBuilder(true);\n  };\n\n  const handleSaveSmartCollection = async (name: string, description: string, rules: any[]) => {\n    try {\n      await createCollection({\n        collection: {\n          name,\n          description,\n          is_public: false,\n          is_smart: true,\n          smart_rules: rules,\n        }\n      });\n      setShowSmartBuilder(false);\n    } catch (error) {\n      console.error('Failed to create smart collection:', error);\n    }\n  };\n\n  const handleShareCollection = async (collection: SmartCollection) => {\n    try {\n      await shareCollection({\n        id: collection.id,\n        shareRequest: {\n          can_view: true,\n          can_comment: false,\n          can_download: false,\n        }\n      });\n    } catch (error) {\n      console.error('Failed to share collection:', error);\n    }\n  };\n\n  const handleDuplicateCollection = async (collection: SmartCollection) => {\n    try {\n      await duplicateCollection({\n        id: collection.id,\n        newName: `${collection.name} (Copy)`\n      });\n    } catch (error) {\n      console.error('Failed to duplicate collection:', error);\n    }\n  };\n\n  const handleExportCollection = async (collection: SmartCollection, format: 'json' | 'csv' | 'm3u') => {\n    try {\n      await exportCollection({\n        id: collection.id,\n        format\n      });\n    } catch (error) {\n      console.error('Failed to export collection:', error);\n    }\n  };\n\n  const handleDeleteCollection = async (collection: SmartCollection) => {\n    if (window.confirm(`Are you sure you want to delete \"${collection.name}\"? This action cannot be undone.`)) {\n      try {\n        await deleteCollection({\n          id: collection.id\n        });\n        toast.success('Collection deleted successfully');\n      } catch (error) {\n        console.error('Failed to delete collection:', error);\n        toast.error('Failed to delete collection');\n      }\n    }\n  };\n\n  const handleBulkOperation = async (operation: string, options?: any) => {\n    try {\n      switch (operation) {\n        case 'delete':\n          await bulkDeleteCollections({ collectionIds: selectedCollections });\n          toast.success(`${selectedCollections.length} collections deleted`);\n          break;\n        case 'share':\n          await bulkShareCollections({ \n            collectionIds: selectedCollections,\n            shareRequest: options || { can_view: true, can_comment: false, can_download: false }\n          });\n          toast.success(`${selectedCollections.length} collections shared`);\n          break;\n        case 'export':\n          await bulkExportCollections({ \n            collectionIds: selectedCollections,\n            format: options?.format || 'json'\n          });\n          toast.success(`${selectedCollections.length} collections exported`);\n          break;\n        case 'duplicate':\n          await bulkUpdateCollections({ \n            collectionIds: selectedCollections,\n            action: 'duplicate'\n          });\n          toast.success(`${selectedCollections.length} collections duplicated`);\n          break;\n        default:\n          toast.error('Unknown operation');\n      }\n      handleClearSelection();\n    } catch (error) {\n      console.error('Bulk operation failed:', error);\n      toast.error('Bulk operation failed');\n    }\n  };\n\n  const handleShowAnalytics = (collection: SmartCollection) => {\n    setSelectedCollection(collection);\n    setShowAnalytics(true);\n  };\n\n  const handleShowSharing = (collection: SmartCollection) => {\n    setSelectedCollection(collection);\n    setShowSharing(true);\n  };\n\n  const handleShowExport = (collection: SmartCollection) => {\n    setSelectedCollection(collection);\n    setShowExport(true);\n  };\n\n  const handleShowRealTime = (collection: SmartCollection) => {\n    setSelectedCollection(collection);\n    setShowRealTime(true);\n  };\n\n  const handleShowTemplates = () => {\n    setShowTemplates(true);\n  };\n\n  const handleShowAdvancedSearch = () => {\n    setShowAdvancedSearch(true);\n  };\n\n  const handleShowAutomation = () => {\n    setShowAutomation(true);\n  };\n\n  const handleShowIntegrations = () => {\n    setShowIntegrations(true);\n  };\n\n  const handleShowAI = () => {\n    setShowAI(true);\n  };\n\n  // AI Feature Handlers\n  const handleAISuggestionAccept = (suggestion: any) => {\n    toast.success(`AI suggestion applied: ${suggestion.title}`);\n  };\n\n  const handleAINaturalSearch = (query: any) => {\n    toast.success(`AI search executed: ${query.query}`);\n  };\n\n  const handleAICategorizationComplete = (result: any) => {\n    toast.success(`Content categorized as: ${result.category}`);\n  };\n\n  const handleAIActionImplement = (action: string) => {\n    toast.success(`AI action implemented: ${action}`);\n  };\n\n  const handleAIPredictionAction = (predictionId: string, actionId: string) => {\n    toast.success(`AI prediction action executed: ${actionId}`);\n  };\n\n  const handleAIOrganizationApply = (suggestionId: string) => {\n    toast.success(`AI organization suggestion applied: ${suggestionId}`);\n  };\n\n  const handleAIMetadataExtracted = (metadata: any) => {\n    toast.success('AI metadata extraction completed');\n  };\n\n  const handleAIRuleToggle = (ruleId: string, enabled: boolean) => {\n    toast.success(`AI rule ${enabled ? 'enabled' : 'disabled'}: ${ruleId}`);\n  };\n\n  const handleAIRuleExecute = (ruleId: string) => {\n    toast.success(`AI rule executed: ${ruleId}`);\n  };\n\n  const handleAIQualityImprovement = (improvement: string) => {\n    toast.success(`AI quality improvement applied: ${improvement}`);\n  };\n\n  const renderCollectionCard = (collection: SmartCollection) => {\n    const isSelected = selectedCollections.includes(collection.id);\n    \n    return (\n      <motion.div\n        key={collection.id}\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        whileHover={{ scale: 1.02 }}\n        className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 cursor-pointer hover:shadow-md transition-shadow relative\"\n      >\n        {/* Selection Checkbox */}\n        <div className=\"absolute top-2 left-2 z-10\">\n          <button\n            onClick={(e) => {\n              e.stopPropagation();\n              handleSelectCollection(collection.id, !isSelected);\n            }}\n            className={`w-6 h-6 rounded-md border-2 flex items-center justify-center transition-colors ${\n              isSelected\n                ? 'bg-blue-600 border-blue-600 text-white'\n                : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:border-blue-400'\n            }`}\n          >\n            {isSelected && <CheckSquare className=\"w-4 h-4\" />}\n          </button>\n        </div>\n\n        <div className=\"flex items-start justify-between mb-3\">\n          <div className=\"flex-1 ml-8\">\n            <h3 className=\"font-semibold text-gray-900 dark:text-white mb-1\">\n              {collection.name}\n            </h3>\n            {collection.description && (\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 line-clamp-2\">\n                {collection.description}\n              </p>\n            )}\n          </div>\n          \n          <div className=\"flex items-center gap-1\">\n            {collection.is_smart && (\n              <div className=\"w-6 h-6 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center\">\n                <Clock className=\"w-3 h-3 text-purple-600 dark:text-purple-400\" />\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400\">\n          <span>{collection.item_count} items</span>\n          <span>{new Date(collection.created_at).toLocaleDateString()}</span>\n        </div>\n\n        <div className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={(e) => {\n                e.stopPropagation();\n                handlePreviewCollection(collection);\n              }}\n              title=\"Preview collection\"\n            >\n              <Eye className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={(e) => {\n                e.stopPropagation();\n                handleShareCollection(collection);\n              }}\n              disabled={isSharing}\n              title=\"Share collection\"\n            >\n              <Share className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={(e) => {\n                e.stopPropagation();\n                handleDuplicateCollection(collection);\n              }}\n              disabled={isDuplicating}\n              title=\"Duplicate collection\"\n            >\n              <Copy className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={(e) => {\n                e.stopPropagation();\n                handleOpenSettings(collection);\n              }}\n              title=\"Collection settings\"\n            >\n              <Settings className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          \n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={(e) => {\n              e.stopPropagation();\n              handleDeleteCollection(collection);\n            }}\n            className=\"text-red-600 hover:text-red-700\"\n            title=\"Delete collection\"\n          >\n            <Trash2 className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </motion.div>\n    );\n  };\n\n  const renderCollectionListItem = (collection: SmartCollection) => {\n    const isSelected = selectedCollections.includes(collection.id);\n    \n    return (\n      <motion.div\n        key={collection.id}\n        initial={{ opacity: 0, x: -20 }}\n        animate={{ opacity: 1, x: 0 }}\n        className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-shadow\"\n      >\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-4 flex-1\">\n            {/* Selection Checkbox */}\n            <button\n              onClick={() => handleSelectCollection(collection.id, !isSelected)}\n              className={`w-6 h-6 rounded-md border-2 flex items-center justify-center transition-colors ${\n                isSelected\n                  ? 'bg-blue-600 border-blue-600 text-white'\n                  : 'border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:border-blue-400'\n              }`}\n            >\n              {isSelected && <CheckSquare className=\"w-4 h-4\" />}\n            </button>\n            \n            <div className=\"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center\">\n              {collection.is_smart ? (\n                <Clock className=\"w-6 h-6 text-white\" />\n              ) : (\n                <Grid className=\"w-6 h-6 text-white\" />\n              )}\n            </div>\n            \n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-gray-900 dark:text-white mb-1\">\n                {collection.name}\n              </h3>\n              {collection.description && (\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 line-clamp-1\">\n                  {collection.description}\n                </p>\n              )}\n            </div>\n            \n            <div className=\"text-right\">\n              <div className=\"text-lg font-bold text-gray-900 dark:text-white\">\n                {collection.item_count.toLocaleString()}\n              </div>\n              <div className=\"text-xs text-gray-500 dark:text-gray-400\">items</div>\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-2 ml-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => handlePreviewCollection(collection)}\n              title=\"Preview collection\"\n            >\n              <Eye className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => handleShowAnalytics(collection)}\n              title=\"View analytics\"\n            >\n              <BarChart3 className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => handleShowSharing(collection)}\n              title=\"Share collection\"\n            >\n              <Share2 className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => handleShowExport(collection)}\n              title=\"Export collection\"\n            >\n              <Download className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => handleShowRealTime(collection)}\n              title=\"Real-time collaboration\"\n            >\n              <Users className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => handleOpenSettings(collection)}\n              title=\"Collection settings\"\n            >\n              <Settings className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => handleDeleteCollection(collection)}\n              className=\"text-red-600 hover:text-red-700\"\n              title=\"Delete collection\"\n            >\n              <Trash2 className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n      </motion.div>\n    );\n  };\n\n  if (showSmartBuilder) {\n    return (\n      <div className=\"max-w-4xl mx-auto\">\n        <SmartCollectionBuilder\n          onSave={handleSaveSmartCollection}\n          onCancel={() => setShowSmartBuilder(false)}\n          className=\"mb-6\"\n        />\n      </div>\n    );\n  }\n\n  if (showTemplates) {\n    return (\n      <div className=\"max-w-7xl mx-auto\">\n        <CollectionTemplates \n          onClose={() => setShowTemplates(false)}\n          onApplyTemplate={async (template, collectionName) => {\n            // Implementation for applying template\n            toast.success(`Template \"${template.name}\" applied to \"${collectionName}\"`);\n            setShowTemplates(false);\n          }}\n        />\n      </div>\n    );\n  }\n\n  if (showAdvancedSearch) {\n    return (\n      <div className=\"max-w-7xl mx-auto\">\n        <AdvancedSearch />\n      </div>\n    );\n  }\n\n  if (showAutomation) {\n    return (\n      <div className=\"max-w-7xl mx-auto\">\n        <CollectionAutomation />\n      </div>\n    );\n  }\n\n  if (showIntegrations) {\n    return (\n      <div className=\"max-w-7xl mx-auto\">\n        <ExternalIntegrations />\n      </div>\n    );\n  }\n\n  if (showAI) {\n    return (\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"mb-8\">\n          <div className=\"flex items-center space-x-3\">\n            <Brain className=\"w-8 h-8 text-indigo-600\" />\n            <h1 className=\"text-3xl font-bold text-gray-900\">AI-Powered Features</h1>\n            <Sparkles className=\"w-6 h-6 text-yellow-500\" />\n          </div>\n          <p className=\"text-gray-600 mt-2\">\n            Leverage artificial intelligence for intelligent content management\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n          <AICollectionSuggestions\n            onSuggestionAccept={handleAISuggestionAccept}\n            maxSuggestions={3}\n          />\n          <AINaturalSearch\n            onSearch={handleAINaturalSearch}\n            placeholder=\"Search naturally... try 'show me action movies' or 'find productivity tools'\"\n          />\n        </div>\n\n        <div className=\"mb-8\">\n          <AIContentCategorizer\n            item={{\n              title: 'Sample Content for AI Categorization',\n              description: 'This is a sample content item to demonstrate AI-powered categorization capabilities'\n            }}\n            onCategorizationComplete={handleAICategorizationComplete}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n          <AIUserBehaviorAnalytics\n            userId=\"demo-user\"\n            onActionImplement={handleAIActionImplement}\n          />\n          <AIPredictions\n            onPredictionAction={handleAIPredictionAction}\n          />\n        </div>\n\n        <div className=\"mb-8\">\n          <AISmartOrganization\n            collections={collections}\n            onSuggestionApply={handleAIOrganizationApply}\n          />\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n          <AIMetadataExtractor\n            content={{\n              title: 'Sample Content',\n              description: 'Sample description for AI metadata extraction',\n              fileType: 'video/mp4',\n              size: 1024000\n            }}\n            onMetadataExtracted={handleAIMetadataExtracted}\n          />\n          <AIContentQualityAnalyzer\n            content={{\n              title: 'Sample Content',\n              description: 'Sample description for AI quality analysis'\n            }}\n            onQualityImprovement={handleAIQualityImprovement}\n          />\n        </div>\n\n        <div>\n          <AIAutomationRules\n            onRuleToggle={handleAIRuleToggle}\n            onRuleExecute={handleAIRuleExecute}\n          />\n        </div>\n\n        <div className=\"mt-8 text-center\">\n          <button\n            onClick={() => setShowAI(false)}\n            className=\"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors\"\n          >\n            Back to Collections\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-7xl mx-auto\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\n              Collections\n            </h1>\n            <p className=\"text-gray-600 dark:text-gray-400\">\n              Organize your media with smart and manual collections\n            </p>\n          </div>\n          \n          {/* Performance Indicator */}\n          <div className=\"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400\">\n            <div className=\"flex items-center gap-2\">\n              <Activity className=\"w-4 h-4\" />\n              <span>Render: {performanceMetrics.renderTime.toFixed(1)}ms</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Database className=\"w-4 h-4\" />\n              <span>Items: {filteredCollections.length}</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Zap className=\"w-4 h-4\" />\n              <span>Page {currentPage}/{totalPages}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <Tabs\n        tabs={COLLECTIONS_TABS}\n        activeTab={activeTab}\n        onChangeTab={setActiveTab}\n        className=\"mb-6\"\n      />\n\n      {/* Controls */}\n      <div className=\"mb-6 flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between\">\n        <div className=\"flex flex-col sm:flex-row gap-4 flex-1\">\n          {/* Search */}\n          <div className=\"relative max-w-md\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n            <Input\n              placeholder=\"Search collections...\"\n              value={searchQuery}\n              onChange={(e) => handleSearchChange(e.target.value)}\n              className={`pl-10 ${isDebouncing ? 'border-blue-400' : ''}`}\n            />\n            {isDebouncing && (\n              <div className=\"absolute right-3 top-1/2 transform -translate-y-1/2\">\n                <Loader2 className=\"w-4 h-4 text-blue-600 animate-spin\" />\n              </div>\n            )}\n          </div>\n\n          {/* Media Type Filter */}\n          <Select\n            value={filterMediaType}\n            onChange={setFilterMediaType}\n            options={MEDIA_TYPE_OPTIONS}\n            className=\"w-40\"\n          />\n\n          {/* Sort */}\n          <Select\n            value={sortBy}\n            onChange={setSortBy}\n            options={SORT_OPTIONS}\n            className=\"w-40\"\n          />\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          {/* View Mode Toggle */}\n          <div className=\"flex items-center bg-gray-100 dark:bg-gray-800 rounded-lg p-1\">\n            {VIEW_OPTIONS.map((option) => {\n              const IconComponent = option.icon;\n              return (\n                <button\n                  key={option.value}\n                  onClick={() => setViewMode(option.value as 'grid' | 'list')}\n                  className={`p-2 rounded ${\n                    viewMode === option.value\n                      ? 'bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm'\n                      : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white'\n                  }`}\n                  title={option.label}\n                >\n                  <IconComponent className=\"w-4 h-4\" />\n                </button>\n              );\n            })}\n          </div>\n\n          {/* Create Actions */}\n          <Button\n            onClick={handleCreateSmartCollection}\n            className=\"flex items-center gap-2\"\n          >\n            <Plus className=\"w-4 h-4\" />\n            Smart Collection\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={handleShowTemplates}\n            className=\"flex items-center gap-2\"\n          >\n            <FileText className=\"w-4 h-4\" />\n            Templates\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={handleShowAdvancedSearch}\n            className=\"flex items-center gap-2\"\n          >\n            <Search className=\"w-4 h-4\" />\n            Advanced Search\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={handleShowAutomation}\n            className=\"flex items-center gap-2\"\n          >\n            <Bot className=\"w-4 h-4\" />\n            Automation\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={handleShowIntegrations}\n            className=\"flex items-center gap-2\"\n          >\n            <Zap className=\"w-4 h-4\" />\n            Integrations\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={handleShowAI}\n            className=\"flex items-center gap-2 bg-indigo-50 border-indigo-200 text-indigo-600 hover:bg-indigo-100\"\n          >\n            <Brain className=\"w-4 h-4\" />\n            AI Features\n          </Button>\n          \n          {/* Performance Tools (Development) */}\n          {process.env.NODE_ENV === 'development' && (\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                const analyzer = window.open('', '_blank', 'width=800,height=600');\n                if (analyzer) {\n                  analyzer.document.write('<html><head><title>Bundle Analyzer</title></head><body><div id=\"bundle-analyzer\"></div><script src=\"/bundle-analyzer.js\"></script></body></html>');\n                }\n              }}\n              className=\"flex items-center gap-2 text-green-600 border-green-600 hover:bg-green-50\"\n            >\n              <Activity className=\"w-4 h-4\" />\n              Bundle Analysis\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* Collections Display */}\n      <div className=\"min-h-96\">\n        {/* Bulk Operations Bar */}\n        {selectedCollections.length > 0 && (\n          <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <span className=\"text-sm font-medium text-blue-800 dark:text-blue-200\">\n                {selectedCollections.length} collection{selectedCollections.length > 1 ? 's' : ''} selected\n              </span>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={handleClearSelection}\n                className=\"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200\"\n              >\n                <X className=\"w-4 h-4\" />\n              </Button>\n            </div>\n            <Button\n              onClick={() => setShowBulkOperations(true)}\n              size=\"sm\"\n              className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n            >\n              Bulk Actions\n            </Button>\n          </div>\n        )}\n\n        {/* Selection Controls */}\n        {filteredCollections.length > 0 && (\n          <div className=\"mb-4 flex items-center gap-4\">\n            <label className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\n              <input\n                type=\"checkbox\"\n                checked={selectAll}\n                onChange={handleSelectAll}\n                className=\"rounded border-gray-300 dark:border-gray-600\"\n              />\n              Select all ({filteredCollections.length})\n            </label>\n          </div>\n        )}\n\n        {isLoading ? (\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n          </div>\n        ) : filteredCollections.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <div className=\"w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <Grid className=\"w-8 h-8 text-gray-400\" />\n            </div>\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">\n              No collections found\n            </h3>\n            <p className=\"text-gray-600 dark:text-gray-400 mb-6\">\n              {searchQuery || filterMediaType !== 'all' || activeTab !== 'all'\n                ? 'Try adjusting your search or filters'\n                : 'Create your first collection to get started'\n              }\n            </p>\n            {!searchQuery && filterMediaType === 'all' && activeTab === 'all' && (\n              <Button\n                onClick={handleCreateSmartCollection}\n                className=\"flex items-center gap-2\"\n              >\n                <Plus className=\"w-4 h-4\" />\n                Create Smart Collection\n              </Button>\n            )}\n          </div>\n        ) : (\n          <>\n            <PerformanceOptimizer\n              itemCount={paginatedCollections.length}\n              threshold={50}\n              loadingStrategy=\"lazy\"\n              itemHeight={viewMode === 'grid' ? 200 : 80}\n              containerHeight={600}\n            >\n              <div className={viewMode === 'grid' \n                ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4' \n                : 'space-y-4'\n              }>\n                {paginatedCollections.map(viewMode === 'grid' ? renderCollectionCard : renderCollectionListItem)}\n              </div>\n            </PerformanceOptimizer>\n\n            {/* Pagination Controls */}\n            {totalPages > 1 && (\n              <div className=\"mt-6 flex items-center justify-between\">\n                <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  Showing {((currentPage - 1) * 20) + 1} to {Math.min(currentPage * 20, filteredCollections.length)} of {filteredCollections.length} collections\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={prevPage}\n                    disabled={currentPage === 1}\n                  >\n                    Previous\n                  </Button>\n                  <div className=\"flex items-center gap-1\">\n                    {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n                      let pageNum: number;\n                      if (totalPages <= 5) {\n                        pageNum = i + 1;\n                      } else if (currentPage <= 3) {\n                        pageNum = i + 1;\n                      } else if (currentPage >= totalPages - 2) {\n                        pageNum = totalPages - 4 + i;\n                      } else {\n                        pageNum = currentPage - 2 + i;\n                      }\n                      return (\n                        <Button\n                          key={pageNum}\n                          variant={currentPage === pageNum ? \"default\" : \"outline\"}\n                          size=\"sm\"\n                          onClick={() => goToPage(pageNum)}\n                          className=\"min-w-[2.5rem]\"\n                        >\n                          {pageNum}\n                        </Button>\n                      );\n                    })}\n                  </div>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={nextPage}\n                    disabled={currentPage === totalPages}\n                  >\n                    Next\n                  </Button>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n      </div>\n\n      {/* Modals and Overlays */}\n      {previewCollection && (\n        <CollectionPreview\n          collection={previewCollection}\n          onClose={handleClosePreview}\n        />\n      )}\n\n      {showBulkOperations && (\n        <BulkOperations\n          selectedCollections={selectedCollections}\n          collections={filteredCollections}\n          onOperation={handleBulkOperation}\n          onClose={() => setShowBulkOperations(false)}\n        />\n      )}\n\n      {showSettings && selectedCollection && (\n        <CollectionSettings\n          collection={selectedCollection}\n          onClose={() => setShowSettings(false)}\n          onSave={(settings) => {\n            updateCollection({\n              id: selectedCollection.id,\n              updates: settings\n            });\n            setShowSettings(false);\n          }}\n        />\n      )}\n\n      {showAnalytics && selectedCollection && (\n        <CollectionAnalytics\n          collection={selectedCollection}\n          onClose={() => setShowAnalytics(false)}\n        />\n      )}\n\n      {showSharing && selectedCollection && (\n        <CollectionSharing\n          collection={selectedCollection}\n          onClose={() => setShowSharing(false)}\n        />\n      )}\n\n      {showExport && selectedCollection && (\n        <CollectionExport\n          collection={selectedCollection}\n          onClose={() => setShowExport(false)}\n        />\n      )}\n\n      {showRealTime && selectedCollection && (\n        <CollectionRealTime\n          collection={selectedCollection}\n          onClose={() => setShowRealTime(false)}\n        />\n      )}\n    </div>\n  );\n};"],"file":"assets/Collections-CnjrFI1E.js"}