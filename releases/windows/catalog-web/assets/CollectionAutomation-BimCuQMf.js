import{j as e,B as n,n as u}from"./index-BzqIBI_1.js";import{r,R as W}from"./router-CYAiCCsK.js";import{I as Y}from"./Input-DQaGiHGP.js";import{B as T}from"./Badge-CeVT3Lft.js";import{S as G}from"./Collections-CnjrFI1E.js";import{a6 as k,aD as A,q as f,n as D,z as _,A as z,m as E,C as v,a2 as H,a3 as K,R as N,a5 as V,aw as X,w as ee,y as se,c as te,Z as ae,t as ne}from"./ui-DhyrEzjX.js";import"./charts-BaIhTcLh.js";import"./utils-B26ZFImD.js";import"./Tabs-VczWTLgE.js";import"./Card-pVNkGvZm.js";import"./AIMetadata-CNrDn82p.js";const pe=()=>{const[c,d]=r.useState([]),[M,m]=r.useState(!1),[Z,h]=r.useState(null),[y,b]=r.useState(null),[B,I]=r.useState(null),[x,L]=r.useState("all"),[g,$]=r.useState("created"),[o,P]=r.useState(""),w=r.useCallback(()=>{d([{id:"1",name:"Auto-Tag New Movies",description:"Automatically tag new movie files with genre and year",enabled:!0,trigger:{type:"event",eventType:"file_added",conditions:[{field:"file_type",operator:"equals",value:"video"},{field:"file_path",operator:"contains",value:"/movies/",logic:"AND"}]},actions:[{id:"1",type:"tag_files",parameters:{tags:["movie"],autoDetect:!0,overwriteExisting:!1},order:1},{id:"2",type:"notify",parameters:{message:"New movie tagged: {filename}",channels:["email","webhook"]},order:2}],createdAt:"2024-01-15T10:30:00Z",lastRun:"2024-01-20T14:25:00Z",nextRun:"2024-01-21T14:25:00Z",runCount:15,successCount:14,errorCount:1,status:"idle"},{id:"2",name:"Weekly Collection Cleanup",description:"Remove duplicate and broken files from collections",enabled:!0,trigger:{type:"schedule",schedule:"0 2 * * 0"},actions:[{id:"1",type:"remove_from_collection",parameters:{condition:"duplicate_or_broken",backup:!0,notify:!0},order:1}],createdAt:"2024-01-10T09:00:00Z",lastRun:"2024-01-21T02:00:00Z",nextRun:"2024-01-28T02:00:00Z",runCount:4,successCount:4,errorCount:0,status:"completed"},{id:"3",name:"Sync to External Drive",description:"Sync new photos to external backup drive",enabled:!1,trigger:{type:"event",eventType:"file_added",conditions:[{field:"file_type",operator:"in",value:["image","raw"]},{field:"file_size",operator:"greater_than",value:1024e3,logic:"AND"}]},actions:[{id:"1",type:"copy_files",parameters:{destination:"/backup/photos/",preserveStructure:!0,verify:!0},order:1}],createdAt:"2024-01-18T16:45:00Z",runCount:0,successCount:0,errorCount:0,status:"idle"}])},[]);r.useEffect(()=>{w()},[w]);const C=W.useMemo(()=>{let s=[...c];return x==="enabled"?s=s.filter(t=>t.enabled):x==="disabled"&&(s=s.filter(t=>!t.enabled)),o&&(s=s.filter(t=>t.name.toLowerCase().includes(o.toLowerCase())||t.description.toLowerCase().includes(o.toLowerCase()))),s.sort((t,a)=>{switch(g){case"name":return t.name.localeCompare(a.name);case"created":return new Date(a.createdAt).getTime()-new Date(t.createdAt).getTime();case"lastRun":return t.lastRun?a.lastRun?new Date(a.lastRun).getTime()-new Date(t.lastRun).getTime():-1:1;case"status":return t.status.localeCompare(a.status);default:return 0}}),s},[c,x,g,o]),q=async s=>{d(t=>t.map(a=>a.id===s?{...a,enabled:!a.enabled}:a)),u.success("Rule status updated")},F=async s=>{b(s),setTimeout(()=>{b(null),u.success("Rule test completed successfully")},3e3)},O=async s=>{d(t=>t.map(a=>a.id===s?{...a,status:"running"}:a)),setTimeout(()=>{d(t=>t.map(a=>a.id===s?{...a,status:"completed",lastRun:new Date().toISOString(),runCount:a.runCount+1,successCount:a.successCount+1}:a)),u.success("Rule executed successfully")},2e3)},Q=async s=>{d(t=>t.filter(a=>a.id!==s)),u.success("Rule deleted successfully")},p=s=>{switch(s){case"running":return{icon:N,color:"text-blue-500",bg:"bg-blue-50"};case"completed":return{icon:_,color:"text-green-500",bg:"bg-green-50"};case"error":return{icon:se,color:"text-red-500",bg:"bg-red-50"};default:return{icon:v,color:"text-gray-500",bg:"bg-gray-50"}}},U=s=>{switch(s){case"schedule":return ne;case"event":return ae;case"manual":return f;default:return te}},J=s=>{if(s.trigger.type==="manual")return"Manual trigger";if(!s.nextRun)return"Not scheduled";const t=new Date(s.nextRun),a=new Date,i=t.getTime()-a.getTime();return i<0?"Overdue":i<36e5?`${Math.floor(i/6e4)} minutes`:i<864e5?`${Math.floor(i/36e5)} hours`:`${Math.floor(i/864e5)} days`};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Automation Rules"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Create workflows to automatically manage your collections"})]}),e.jsxs(n,{onClick:()=>m(!0),className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),"Create Rule"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Rules"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.length})]}),e.jsx(A,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.filter(s=>s.enabled).length})]}),e.jsx(f,{className:"w-8 h-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Runs"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.reduce((s,t)=>s+t.runCount,0)})]}),e.jsx(D,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[c.length>0?Math.round(c.reduce((s,t)=>s+t.successCount,0)/c.reduce((s,t)=>s+t.runCount,0)*100):0,"%"]})]}),e.jsx(_,{className:"w-8 h-8 text-green-500"})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between bg-white rounded-lg border p-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","enabled","disabled"].map(s=>e.jsx(n,{variant:x===s?"default":"outline",size:"sm",onClick:()=>L(s),children:s.charAt(0).toUpperCase()+s.slice(1)},s))}),e.jsxs("div",{className:"flex gap-2 items-center w-full sm:w-auto",children:[e.jsx(Y,{placeholder:"Search rules...",value:o,onChange:s=>P(s.target.value),className:"w-full sm:w-64"}),e.jsxs("select",{value:g,onChange:s=>$(s.target.value),className:"px-3 py-2 border rounded-lg bg-white",children:[e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"lastRun",children:"Last Run"}),e.jsx("option",{value:"status",children:"Status"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(z,{children:C.map(s=>{const t=p(s.status).icon,a=U(s.trigger.type),i=B===s.id;return e.jsxs(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-white rounded-lg border hover:shadow-md transition-shadow",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsx(T,{variant:s.enabled?"default":"secondary",children:s.enabled?"Enabled":"Disabled"}),e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs ${p(s.status).bg} ${p(s.status).color}`,children:[e.jsx(t,{className:"w-3 h-3"}),s.status]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a,{className:"w-3 h-3"}),s.trigger.type==="schedule"?`Scheduled: ${s.trigger.schedule}`:s.trigger.type==="event"?`Event: ${s.trigger.eventType}`:"Manual"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-3 h-3"}),"Next: ",J(s)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"}),"Runs: ",s.runCount," (",s.successCount," success)"]}),s.lastRun&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-3 h-3"}),"Last: ",new Date(s.lastRun).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(G,{checked:s.enabled,onCheckedChange:()=>q(s.id)}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>I(i?null:s.id),children:i?e.jsx(H,{className:"w-4 h-4"}):e.jsx(K,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>F(s.id),disabled:y===s.id,children:y===s.id?e.jsx(N,{className:"w-4 h-4 animate-spin"}):e.jsx(V,{className:"w-4 h-4"})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>O(s.id),disabled:s.status==="running",children:s.status==="running"?e.jsx(N,{className:"w-4 h-4 animate-spin"}):e.jsx(f,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>h(s),children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>Q(s.id),children:e.jsx(ee,{className:"w-4 h-4"})})]})]})}),e.jsx(z,{children:i&&e.jsx(E.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{duration:.2},className:"border-t overflow-hidden",children:e.jsxs("div",{className:"p-4 bg-gray-50 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm text-gray-700 mb-2",children:"Trigger"}),e.jsxs("div",{className:"bg-white rounded p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(a,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"font-medium capitalize",children:s.trigger.type})]}),s.trigger.schedule&&e.jsxs("p",{className:"text-gray-600",children:["Schedule: ",s.trigger.schedule]}),s.trigger.eventType&&e.jsxs("p",{className:"text-gray-600",children:["Event: ",s.trigger.eventType]}),s.trigger.conditions&&s.trigger.conditions.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Conditions:"}),s.trigger.conditions.map((l,R)=>e.jsxs("div",{className:"text-xs text-gray-600 ml-4",children:[l.field," ",l.operator," ",l.value,l.logic&&e.jsx("span",{className:"ml-2 text-blue-600",children:l.logic})]},R))]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm text-gray-700 mb-2",children:"Actions"}),e.jsx("div",{className:"space-y-2",children:s.actions.map((l,R)=>e.jsxs("div",{className:"bg-white rounded p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium capitalize",children:l.type.replace("_"," ")}),e.jsxs(T,{variant:"outline",className:"text-xs",children:["Step ",l.order]})]}),e.jsx("div",{className:"text-xs text-gray-600",children:Object.entries(l.parameters).map(([S,j])=>e.jsxs("div",{className:"ml-4",children:[S,": ",typeof j=="object"?JSON.stringify(j):String(j)]},S))})]},l.id))})]})]})})})]},s.id)})}),C.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border",children:[e.jsx(A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No automation rules found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first automation rule to start managing collections automatically"}),e.jsxs(n,{onClick:()=>m(!0),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Create Your First Rule"]})]})]}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create Automation Rule"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Rule creation interface would be implemented here with a comprehensive form"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(n,{onClick:()=>m(!1),children:"Create Rule"})]})]})}),Z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Automation Rule"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Rule editing interface would be implemented here with current rule values"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>h(null),children:"Cancel"}),e.jsx(n,{onClick:()=>h(null),children:"Save Changes"})]})]})})]})};export{pe as default};
//# sourceMappingURL=CollectionAutomation-BimCuQMf.js.map
