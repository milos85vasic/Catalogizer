import{b as v,c as Q,a as M,e as j,z as f,j as a,f as c,B as E}from"./index-BzqIBI_1.js";import{r as A}from"./router-CYAiCCsK.js";import{L,u as S}from"./ui-DhyrEzjX.js";const g={async getFavorites(e){const o=new URLSearchParams;return e!=null&&e.limit&&o.append("limit",e.limit.toString()),e!=null&&e.offset&&o.append("offset",e.offset.toString()),e!=null&&e.media_type&&o.append("media_type",e.media_type),e!=null&&e.sort_by&&o.append("sort_by",e.sort_by),e!=null&&e.sort_order&&o.append("sort_order",e.sort_order),(await v.get(`/api/v1/favorites?${o}`)).data},async getFavoriteStats(){return(await v.get("/api/v1/favorites/stats")).data},async toggleFavorite(e){return(await v.post("/api/v1/favorites/toggle",e)).data},async checkFavorite(e){return(await v.get(`/api/v1/favorites/check/${e}`)).data},async addToFavorites(e){return(await v.post("/api/v1/favorites",{media_id:e})).data},async removeFromFavorites(e){await v.delete(`/api/v1/favorites/${e}`)},async bulkAddToFavorites(e){return(await v.post("/api/v1/favorites/bulk",{media_ids:e})).data},async bulkRemoveFromFavorites(e){return(await v.delete("/api/v1/favorites/bulk",{data:{media_ids:e}})).data}},R=e=>{const o=Q(),{data:s,isLoading:h,error:y,refetch:b}=M({queryKey:["favorites",e],queryFn:()=>g.getFavorites(e),staleTime:1e3*60*5,cacheTime:1e3*60*10}),{data:u,isLoading:m,error:w,refetch:F}=M({queryKey:["favorites-stats"],queryFn:()=>g.getFavoriteStats(),staleTime:1e3*60*2,cacheTime:1e3*60*5}),k=j({mutationFn:t=>g.toggleFavorite(t),onMutate:async t=>{await o.cancelQueries(["favorites"]);const l=o.getQueryData(["favorites"]);return o.setQueryData(["favorites"],i=>{if(!(i!=null&&i.items))return i;if(t.is_favorite)f.success("Added to favorites");else return{...i,items:i.items.filter(T=>T.media_id!==t.media_id)}}),{previousFavorites:l}},onError:(t,l,i)=>{o.setQueryData(["favorites"],i==null?void 0:i.previousFavorites),f.error("Failed to update favorite status")},onSettled:()=>{o.invalidateQueries(["favorites"]),o.invalidateQueries(["favorites-stats"])}}),x=j({mutationFn:t=>g.bulkAddToFavorites(t),onSuccess:t=>{f.success(`Added ${t.added} items to favorites`),o.invalidateQueries(["favorites"]),o.invalidateQueries(["favorites-stats"])},onError:()=>{f.error("Failed to add items to favorites")}}),_=j({mutationFn:t=>g.bulkRemoveFromFavorites(t),onSuccess:t=>{f.success(`Removed ${t.removed} items from favorites`),o.invalidateQueries(["favorites"]),o.invalidateQueries(["favorites-stats"])},onError:()=>{f.error("Failed to remove items from favorites")}}),r=t=>s!=null&&s.items?s.items.some(l=>l.media_id===t):!1,n=(t,l)=>{const i=l??r(t);k.mutate({media_id:t,is_favorite:!i})},d=t=>{x.mutate(t)},p=t=>{_.mutate(t)};return{favorites:(s==null?void 0:s.items)||[],total:(s==null?void 0:s.total)||0,isLoading:h||m,error:y||w,stats:u,refetchFavorites:b,refetchStats:F,toggleFavorite:n,checkFavoriteStatus:r,bulkAddToFavorites:d,bulkRemoveFromFavorites:p,isToggling:k.isLoading}},N=e=>M({queryKey:["favorite-status",e],queryFn:()=>g.checkFavorite(e),staleTime:1e3*60*5,enabled:!!e}),K=({mediaId:e,mediaItem:o,size:s="md",variant:h="button",className:y,showLabel:b=!1,disabled:u=!1})=>{const[m,w]=A.useState(!1),{data:F,isLoading:k}=N(e),{toggleFavorite:x,isToggling:_}=R(),r=(F==null?void 0:F.is_favorite)||!1,n=k||_,d={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"},p=i=>{i.preventDefault(),i.stopPropagation(),!n&&!u&&x(e,r)},t=()=>w(!0),l=()=>w(!1);return h==="icon"?a.jsx("button",{className:c("relative inline-flex items-center justify-center p-1 rounded-full transition-all duration-200","hover:bg-gray-100 dark:hover:bg-gray-800","focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",r&&"text-yellow-500",!r&&"text-gray-400 hover:text-yellow-500",n&&"opacity-50 cursor-not-allowed",u&&"opacity-50 cursor-not-allowed",y),onClick:p,onMouseEnter:t,onMouseLeave:l,disabled:n||u,title:r?"Remove from favorites":"Add to favorites",children:n?a.jsx(L,{className:c("animate-spin",d[s])}):a.jsx(S,{className:c(d[s],r?"fill-current":"",m&&!r&&"fill-current opacity-50")})}):h==="card"?a.jsx("div",{className:c("absolute top-2 right-2 z-10 opacity-0 transition-opacity duration-200","group-hover:opacity-100",y),onMouseEnter:t,onMouseLeave:l,children:a.jsx("button",{className:c("relative inline-flex items-center justify-center p-2 rounded-full transition-all duration-200","bg-white/90 dark:bg-black/90 backdrop-blur-sm","hover:bg-white dark:hover:bg-black","shadow-md",r&&"text-yellow-500",!r&&"text-gray-600 hover:text-yellow-500",n&&"opacity-50 cursor-not-allowed",u&&"opacity-50 cursor-not-allowed"),onClick:p,disabled:n||u,title:r?"Remove from favorites":"Add to favorites",children:n?a.jsx(L,{className:c("animate-spin",d[s])}):a.jsx(S,{className:c(d[s],r?"fill-current":"",m&&!r&&"fill-current opacity-50")})})}):a.jsx(E,{variant:r?"primary":"outline",size:s,onClick:p,onMouseEnter:t,onMouseLeave:l,disabled:n||u,className:c("transition-all duration-200",r&&"bg-yellow-50 border-yellow-300 text-yellow-700 hover:bg-yellow-100 dark:bg-yellow-900/20 dark:border-yellow-600 dark:text-yellow-300",!r&&"hover:border-yellow-300 hover:text-yellow-600",y),children:n?a.jsxs(a.Fragment,{children:[a.jsx(L,{className:c("animate-spin mr-2",d[s])}),b&&"Loading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(S,{className:c("mr-2",d[s],r?"fill-current":"",m&&!r&&"fill-current opacity-50")}),b&&(r?"Remove from Favorites":"Add to Favorites")]})})};export{K as F,R as u};
//# sourceMappingURL=FavoriteToggle-C1Ak6xgo.js.map
