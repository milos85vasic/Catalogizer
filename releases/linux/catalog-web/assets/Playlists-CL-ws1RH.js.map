{"version":3,"file":"Playlists-CL-ws1RH.js","sources":["../../src/types/playlists.ts","../../src/lib/playlistsApi.ts","../../src/components/playlists/PlaylistAnalytics.tsx","../../src/components/playlists/PlaylistPlayer.tsx","../../src/hooks/usePlaylists.tsx","../../src/components/playlists/PlaylistGrid.tsx","../../src/components/playlists/SmartPlaylistBuilder.tsx","../../src/pages/Playlists.tsx"],"sourcesContent":["import { Music, Video, Image, FileText } from 'lucide-react'\n\nexport interface Playlist {\n  id: string\n  name: string\n  description?: string\n  user_id: number\n  is_public: boolean\n  is_smart: boolean\n  thumbnail_url?: string\n  item_count: number\n  total_duration?: number\n  created_at: string\n  updated_at: string\n  last_item_added?: string\n  primary_media_type?: string\n  items?: PlaylistItem[]\n}\n\nexport interface PlaylistItem {\n  id: string\n  playlist_id: string\n  media_id: number\n  position: number\n  media_item: {\n    id: number\n    title: string\n    media_type: string\n    year?: number\n    cover_image?: string\n    duration?: number\n    rating?: number\n    quality?: string\n    file_path?: string\n    thumbnail_url?: string\n    artist?: string\n    album?: string\n    description?: string\n    file_size?: number\n  }\n  added_at: string\n}\n\n// Helper properties for easier access\nexport interface PlaylistItemWithMedia extends PlaylistItem {\n  item_id: string\n  title: string\n  media_type: string\n  artist?: string\n  album?: string\n  description?: string\n  duration?: number\n  quality?: string\n  rating?: number\n  thumbnail_url?: string\n  file_path?: string\n  file_size?: number\n}\n\n// Helper function to flatten PlaylistItem properties\nexport const flattenPlaylistItem = (item: PlaylistItem): PlaylistItemWithMedia => {\n  const { media_item, ...rest } = item\n  return {\n    ...rest,\n    media_item, // Keep the original media_item\n    item_id: media_item.id.toString(),\n    title: media_item.title,\n    media_type: media_item.media_type,\n    artist: media_item.artist,\n    album: media_item.album,\n    description: media_item.description,\n    duration: media_item.duration,\n    quality: media_item.quality,\n    rating: media_item.rating,\n    thumbnail_url: media_item.thumbnail_url,\n    file_path: media_item.file_path,\n    file_size: media_item.file_size\n  }\n}\n\n// Helper function to get media type icon name\nexport const getMediaIconName = (mediaType: string): string => {\n  switch (mediaType.toLowerCase()) {\n    case 'video':\n      return 'video'\n    case 'audio':\n    case 'music':\n      return 'music'\n    case 'image':\n      return 'image'\n    default:\n      return 'document'\n  }\n}\n\n// Helper function to get media type icon component (for generic use)\nexport const getMediaIcon = (mediaType: string, iconMap: { [key: string]: any }) => {\n  const iconName = getMediaIconName(mediaType)\n  return iconMap[iconName] || iconMap.document\n}\n\n// Simplified helper function that uses a default icon map\nexport const getMediaIconWithMap = (mediaType: string) => {\n  const iconName = getMediaIconName(mediaType)\n  \n  // Default icon mapping\n  const defaultIcons = {\n    music: Music,\n    video: Video,\n    image: Image,\n    document: FileText\n  }\n  \n  return defaultIcons[iconName as keyof typeof defaultIcons] || FileText\n}\n\nexport interface PlaylistCreateRequest {\n  name: string\n  description?: string\n  is_public?: boolean\n  is_smart?: boolean\n  smart_rules?: SmartPlaylistRule[]\n  items?: PlaylistItem[]\n}\n\nexport interface PlaylistUpdateRequest {\n  name?: string\n  description?: string\n  is_public?: boolean\n}\n\nexport interface SmartPlaylistRule {\n  field: 'media_type' | 'year' | 'rating' | 'quality' | 'genre' | 'created_at'\n  operator: 'equals' | 'not_equals' | 'greater_than' | 'less_than' | 'contains' | 'starts_with' | 'ends_with' | 'in' | 'not_in'\n  value: string | number | string[]\n  condition?: 'and' | 'or'\n}\n\nexport interface PlaylistResponse {\n  playlists: Playlist[]\n  total: number\n  limit: number\n  offset: number\n}\n\nexport interface PlaylistItemsResponse {\n  items: PlaylistItem[]\n  total: number\n  playlist: Playlist\n}\n\nexport interface PlaylistShareInfo {\n  share_url: string\n  share_token: string\n  expires_at?: string\n  permissions: {\n    can_view: boolean\n    can_comment: boolean\n    can_download: boolean\n  }\n}\n\nexport interface PlaylistAnalytics {\n  playlist_id: string\n  total_plays: number\n  unique_viewers: number\n  average_completion_rate: number\n  popular_items: {\n    media_id: number\n    title: string\n    play_count: number\n  }[]\n  viewing_stats: {\n    date: string\n    plays: number\n    viewers: number\n  }[]\n}\n\nexport const PLAYLIST_TYPES = [\n  'user_created',\n  'recently_played',\n  'most_played',\n  'favorites',\n  'watch_later',\n  'continue_watching',\n  'recommended'\n] as const\n\nexport type PlaylistType = typeof PLAYLIST_TYPES[number]\n\n// Aliases for compatibility with components\nexport type PlaylistViewMode = 'grid' | 'list'\nexport type PlaylistSortBy = 'name' | 'name_desc' | 'created_at' | 'updated_at' | 'duration' | 'item_count'\nexport type CreatePlaylistRequest = PlaylistCreateRequest\nexport type UpdatePlaylistRequest = PlaylistUpdateRequest","import { api } from './api'\nimport type { \n  Playlist,\n  PlaylistItem,\n  PlaylistCreateRequest,\n  PlaylistUpdateRequest,\n  PlaylistResponse,\n  PlaylistItemsResponse,\n  PlaylistShareInfo,\n  PlaylistAnalytics,\n  SmartPlaylistRule,\n  CreatePlaylistRequest,\n  UpdatePlaylistRequest\n} from '@/types/playlists'\n\nexport const playlistsApi = {\n  // Get user's playlists\n  async getPlaylists(params?: {\n    limit?: number\n    offset?: number\n    include_smart?: boolean\n    type?: string\n  }): Promise<PlaylistResponse> {\n    const searchParams = new URLSearchParams()\n    if (params?.limit) searchParams.append('limit', params.limit.toString())\n    if (params?.offset) searchParams.append('offset', params.offset.toString())\n    if (params?.include_smart !== undefined) searchParams.append('include_smart', params.include_smart.toString())\n    if (params?.type) searchParams.append('type', params.type)\n\n    const response = await api.get(`/api/v1/playlists?${searchParams}`)\n    return response.data\n  },\n\n  // Get playlist by ID\n  async getPlaylist(playlistId: string): Promise<Playlist> {\n    const response = await api.get(`/api/v1/playlists/${playlistId}`)\n    return response.data\n  },\n\n  // Get playlist items\n  async getPlaylistItems(playlistId: string, params?: {\n    limit?: number\n    offset?: number\n    sort_by?: 'position' | 'added_at' | 'title' | 'duration'\n    sort_order?: 'asc' | 'desc'\n  }): Promise<PlaylistItemsResponse> {\n    const searchParams = new URLSearchParams()\n    if (params?.limit) searchParams.append('limit', params.limit.toString())\n    if (params?.offset) searchParams.append('offset', params.offset.toString())\n    if (params?.sort_by) searchParams.append('sort_by', params.sort_by)\n    if (params?.sort_order) searchParams.append('sort_order', params.sort_order)\n\n    const response = await api.get(`/api/v1/playlists/${playlistId}/items?${searchParams}`)\n    return response.data\n  },\n\n  // Create playlist\n  async createPlaylist(request: PlaylistCreateRequest): Promise<Playlist> {\n    const response = await api.post('/api/v1/playlists', request)\n    return response.data\n  },\n\n  // Update playlist\n  async updatePlaylist(playlistId: string, request: PlaylistUpdateRequest): Promise<Playlist> {\n    const response = await api.put(`/api/v1/playlists/${playlistId}`, request)\n    return response.data\n  },\n\n  // Delete playlist\n  async deletePlaylist(playlistId: string): Promise<void> {\n    await api.delete(`/api/v1/playlists/${playlistId}`)\n  },\n\n  // Add items to playlist\n  async addItemsToPlaylist(playlistId: string, mediaIds: number[]): Promise<{ added: number; failed: number }> {\n    const response = await api.post(`/api/v1/playlists/${playlistId}/items`, { media_ids: mediaIds })\n    return response.data\n  },\n\n  // Remove item from playlist\n  async removeFromPlaylist(playlistId: string, itemId: string): Promise<void> {\n    await api.delete(`/api/v1/playlists/${playlistId}/items/${itemId}`)\n  },\n\n  // Reorder playlist items\n  async reorderPlaylistItems(playlistId: string, itemOrders: { id: string; position: number }[]): Promise<void> {\n    await api.put(`/api/v1/playlists/${playlistId}/items/reorder`, { items: itemOrders })\n  },\n\n  // Share playlist\n  async sharePlaylist(playlistId: string, permissions: {\n    can_view?: boolean\n    can_comment?: boolean\n    can_download?: boolean\n    expires_at?: string\n  }): Promise<PlaylistShareInfo> {\n    const response = await api.post(`/api/v1/playlists/${playlistId}/share`, permissions)\n    return response.data\n  },\n\n  // Get share info\n  async getSharedPlaylist(shareToken: string): Promise<PlaylistItemsResponse> {\n    const response = await api.get(`/api/v1/playlists/shared/${shareToken}`)\n    return response.data\n  },\n\n  // Unshare playlist\n  async unsharePlaylist(playlistId: string): Promise<void> {\n    await api.delete(`/api/v1/playlists/${playlistId}/share`)\n  },\n\n  // Get playlist analytics\n  async getPlaylistAnalytics(playlistId: string): Promise<PlaylistAnalytics> {\n    const response = await api.get(`/api/v1/playlists/${playlistId}/analytics`)\n    return response.data\n  },\n\n  // Duplicate playlist\n  async duplicatePlaylist(playlistId: string, newName?: string): Promise<Playlist> {\n    const response = await api.post(`/api/v1/playlists/${playlistId}/duplicate`, { name: newName })\n    return response.data\n  },\n\n  // Export playlist\n  async exportPlaylist(playlistId: string, format: 'json' | 'm3u' | 'csv' = 'json'): Promise<any> {\n    const response = await api.get(`/api/v1/playlists/${playlistId}/export?format=${format}`, {\n      responseType: 'blob'\n    })\n    return response.data\n  },\n\n  // Play playlist\n  async playPlaylist(playlistId: string): Promise<void> {\n    await api.post(`/api/v1/playlists/${playlistId}/play`)\n  },\n\n  // Shuffle playlist\n  async shufflePlaylist(playlistId: string): Promise<void> {\n    await api.post(`/api/v1/playlists/${playlistId}/shuffle`)\n  },\n\n  // Reorder playlist items\n  async reorderPlaylist(playlistId: string, itemIds: string[]): Promise<void> {\n    await api.put(`/api/v1/playlists/${playlistId}/reorder`, { itemIds })\n  },\n\n  // Import playlist\n  async importPlaylist(file: File, name?: string): Promise<{ playlist: Playlist; imported: number; failed: number }> {\n    const formData = new FormData()\n    formData.append('file', file)\n    if (name) formData.append('name', name)\n\n    const response = await api.post('/api/v1/playlists/import', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    })\n    return response.data\n  },\n\n  // Validate smart playlist rules\n  async validateSmartRules(rules: SmartPlaylistRule[]): Promise<{ valid: boolean; errors: string[] }> {\n    const response = await api.post('/api/v1/playlists/validate-smart-rules', { rules })\n    return response.data\n  }\n}\n\n// Alias for backward compatibility\nexport const playlistApi = playlistsApi","import React from 'react';\nimport { motion } from 'framer-motion';\nimport {\n  BarChart3,\n  Play,\n  Clock,\n  Users,\n  TrendingUp,\n  Calendar,\n  Music,\n  Film,\n  Image,\n  FileText\n} from 'lucide-react';\nimport { PlaylistAnalytics as PlaylistAnalyticsType } from '../../types/playlists';\nimport { Card } from '../ui/Card';\n\ninterface PlaylistAnalyticsProps {\n  analytics: PlaylistAnalyticsType;\n  className?: string;\n}\n\nconst MEDIA_TYPE_ICONS = {\n  music: Music,\n  video: Film,\n  image: Image,\n  document: FileText,\n};\n\nexport const PlaylistAnalytics: React.FC<PlaylistAnalyticsProps> = ({\n  analytics,\n  className = ''\n}) => {\n  const formatNumber = (num: number) => {\n    if (num >= 1000000) {\n      return (num / 1000000).toFixed(1) + 'M';\n    }\n    if (num >= 1000) {\n      return (num / 1000).toFixed(1) + 'K';\n    }\n    return num.toString();\n  };\n\n  const formatDuration = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = Math.floor(seconds % 60);\n    \n    if (hours > 0) {\n      return `${hours}h ${minutes}m`;\n    }\n    return `${minutes}m ${secs}s`;\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString();\n  };\n\n  return (\n    <div className={`space-y-6 ${className}`}>\n      {/* Overview Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.1 }}\n        >\n          <Card className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg\">\n                <Play className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">Total Plays</p>\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                  {formatNumber(analytics.total_plays)}\n                </p>\n              </div>\n            </div>\n          </Card>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n        >\n          <Card className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg\">\n                <Users className=\"w-5 h-5 text-green-600 dark:text-green-400\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">Unique Viewers</p>\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                  {formatNumber(analytics.unique_viewers)}\n                </p>\n              </div>\n            </div>\n          </Card>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3 }}\n        >\n          <Card className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg\">\n                <TrendingUp className=\"w-5 h-5 text-orange-600 dark:text-orange-400\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">Completion Rate</p>\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                  {Math.round(analytics.average_completion_rate)}%\n                </p>\n              </div>\n            </div>\n          </Card>\n        </motion.div>\n      </div>\n\n      {/* Popular Items */}\n      {analytics.popular_items && analytics.popular_items.length > 0 && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.5 }}\n        >\n          <Card className=\"p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n              Popular Items\n            </h3>\n            <div className=\"space-y-3\">\n              {analytics.popular_items.slice(0, 5).map((item, index) => (\n                <div key={index} className=\"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium text-gray-900 dark:text-white truncate\">\n                      {item.title}\n                    </p>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      {formatNumber(item.play_count)} plays\n                    </p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </Card>\n        </motion.div>\n      )}\n\n      {/* Viewing Stats */}\n      {analytics.viewing_stats && analytics.viewing_stats.length > 0 && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.7 }}\n        >\n          <Card className=\"p-6\">\n            <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n              Viewing Trends\n            </h3>\n            <div className=\"space-y-3\">\n              {analytics.viewing_stats.slice(0, 7).map((stat, index) => (\n                <div key={index} className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <Calendar className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\n                    <span className=\"text-gray-900 dark:text-white\">\n                      {formatDate(stat.date)}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center gap-4\">\n                    <div className=\"text-right\">\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">Plays</p>\n                      <p className=\"font-medium text-gray-900 dark:text-white\">\n                        {formatNumber(stat.plays)}\n                      </p>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">Viewers</p>\n                      <p className=\"font-medium text-gray-900 dark:text-white\">\n                        {formatNumber(stat.viewers)}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </Card>\n        </motion.div>\n      )}\n    </div>\n  );\n};","import React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  GripVertical,\n  Play,\n  Pause,\n  SkipForward,\n  SkipBack,\n  Volume2,\n  Maximize2,\n  Heart,\n  MoreHorizontal,\n  Shuffle,\n  Repeat,\n  List,\n  Share,\n  BarChart3,\n  X,\n  ChevronLeft,\n  ChevronRight,\n  Music,\n  Film,\n  Image,\n  FileText\n} from 'lucide-react';\n\nimport { Button } from '../ui/Button';\nimport { Playlist, PlaylistItem, flattenPlaylistItem, getMediaIconWithMap } from '../../types/playlists';\nimport { MediaPlayer } from '../media/MediaPlayer';\nimport { FavoriteToggle } from '../favorites/FavoriteToggle';\nimport { usePlayerState } from '../../hooks/usePlayerState';\nimport { playlistsApi } from '../../lib/playlistsApi';\nimport { toast } from 'react-hot-toast';\nimport { PlaylistAnalytics } from './PlaylistAnalytics';\n\ninterface PlaylistPlayerProps {\n  playlist: Playlist;\n  items: PlaylistItem[];\n  initialIndex?: number;\n  onClose?: () => void;\n  onShuffle?: () => void;\n  onRepeat?: () => void;\n  className?: string;\n}\n\nconst MEDIA_TYPE_ICONS = {\n  music: Music,\n  video: Film,\n  image: Image,\n  document: FileText,\n};\n\nconst DURATION_FORMATTER = new Intl.DateTimeFormat('en-US', {\n  minute: '2-digit',\n  second: '2-digit'\n});\n\nexport const PlaylistPlayer: React.FC<PlaylistPlayerProps> = ({\n  playlist,\n  items,\n  initialIndex = 0,\n  onClose,\n  onShuffle,\n  onRepeat,\n  className = ''\n}) => {\n  const [currentIndex, setCurrentIndex] = useState(initialIndex);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [isShuffled, setIsShuffled] = useState(false);\n  const [isRepeating, setIsRepeating] = useState(false);\n  const [volume, setVolume] = useState(0.8);\n  const [isMuted, setIsMuted] = useState(false);\n  const [showPlaylist, setShowPlaylist] = useState(false);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const [showControls, setShowControls] = useState(true);\n  const [showAnalytics, setShowAnalytics] = useState(false);\n  const [analytics, setAnalytics] = useState<any>(null);\n  const [repeatMode, setRepeatMode] = useState<'off' | 'all' | 'one'>('off');\n\n  const currentItem = items[currentIndex];\n  const flattenedCurrentItem = currentItem ? flattenPlaylistItem(currentItem) : null;\n  const progress = items.length > 0 ? ((currentIndex + 1) / items.length) * 100 : 0;\n\n  // Auto-hide controls for video playback\n  React.useEffect(() => {\n    if (isPlaying && flattenedCurrentItem?.media_type === 'video' && !isFullscreen) {\n      const timer = setTimeout(() => setShowControls(false), 3000);\n      return () => clearTimeout(timer);\n    }\n  }, [isPlaying, flattenedCurrentItem?.media_type, isFullscreen]);\n\n  const handlePrevious = () => {\n    if (currentIndex > 0) {\n      setCurrentIndex(currentIndex - 1);\n    } else if (isRepeating) {\n      setCurrentIndex(items.length - 1);\n    }\n  };\n\n  const handleNext = () => {\n    if (currentIndex < items.length - 1) {\n      setCurrentIndex(currentIndex + 1);\n    } else if (isRepeating) {\n      setCurrentIndex(0);\n    } else {\n      setIsPlaying(false);\n    }\n  };\n\n  const handleItemClick = (index: number) => {\n    setCurrentIndex(index);\n    setIsPlaying(true);\n  };\n\n  const handleShuffle = () => {\n    setIsShuffled(!isShuffled);\n    onShuffle?.();\n  };\n\n  const handleRepeat = () => {\n    const nextMode = repeatMode === 'off' ? 'all' : repeatMode === 'all' ? 'one' : 'off';\n    setRepeatMode(nextMode);\n    setIsRepeating(nextMode !== 'off');\n    onRepeat?.();\n  };\n\n  const handleVolumeChange = (newVolume: number) => {\n    setVolume(newVolume);\n    setIsMuted(newVolume === 0);\n  };\n\n  const handleMuteToggle = () => {\n    if (isMuted) {\n      setVolume(0.8);\n      setIsMuted(false);\n    } else {\n      setVolume(0);\n      setIsMuted(true);\n    }\n  };\n\n  const handleFullscreen = () => {\n    setIsFullscreen(!isFullscreen);\n  };\n\n  const formatDuration = (seconds: number) => {\n    const minutes = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${minutes}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const formatTimeRemaining = () => {\n    const itemsRemaining = items.length - currentIndex - 1;\n    const totalDuration = items\n      .slice(currentIndex + 1)\n      .reduce((sum, item) => sum + (flattenPlaylistItem(item).duration || 0), 0);\n    return formatDuration(totalDuration);\n  };\n\n  const renderNowPlaying = () => {\n    if (!currentItem || !flattenedCurrentItem) return null;\n\n    const Icon = getMediaIconWithMap(flattenedCurrentItem.media_type);\n\n    return (\n      <div className=\"flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n        {/* Media Thumbnail */}\n        <div className=\"relative group\">\n          <div className=\"w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center\">\n            <Icon className=\"w-12 h-12 text-white/80\" />\n          </div>\n          <Button\n            size=\"sm\"\n            className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity m-auto\"\n            onClick={() => setIsPlaying(!isPlaying)}\n          >\n            {isPlaying ? <Pause className=\"w-6 h-6\" /> : <Play className=\"w-6 h-6\" />}\n          </Button>\n        </div>\n\n        {/* Media Info */}\n        <div className=\"flex-1 min-w-0\">\n          <h3 className=\"font-semibold text-lg text-gray-900 dark:text-white truncate\">\n            {flattenedCurrentItem.title}\n          </h3>\n          <p className=\"text-gray-600 dark:text-gray-400 truncate\">\n            {flattenedCurrentItem.artist || flattenedCurrentItem.description || 'Unknown'}\n          </p>\n          <div className=\"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400 mt-1\">\n            <span>{currentIndex + 1} of {items.length}</span>\n            {flattenedCurrentItem.duration && (\n              <span>{formatDuration(flattenedCurrentItem.duration)}</span>\n            )}\n            <span>{formatTimeRemaining()} remaining</span>\n          </div>\n        </div>\n\n        {/* Actions */}\n        <div className=\"flex items-center gap-2\">\n          <FavoriteToggle\n            mediaId={parseInt(flattenedCurrentItem.item_id)}\n            size=\"sm\"\n          />\n          <Button variant=\"ghost\" size=\"sm\">\n            <MoreHorizontal className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      </div>\n    );\n  };\n\n  const renderControls = () => {\n    return (\n      <div className=\"flex items-center justify-center gap-4 p-4\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={handleShuffle}\n          className={isShuffled ? 'text-blue-600 dark:text-blue-400' : ''}\n        >\n          <Shuffle className=\"w-5 h-5\" />\n        </Button>\n\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={handlePrevious}\n          disabled={currentIndex === 0 && !isRepeating}\n        >\n          <SkipBack className=\"w-5 h-5\" />\n        </Button>\n\n        <Button\n          size=\"lg\"\n          onClick={() => setIsPlaying(!isPlaying)}\n          className=\"w-14 h-14 rounded-full\"\n        >\n          {isPlaying ? <Pause className=\"w-6 h-6\" /> : <Play className=\"w-6 h-6\" />}\n        </Button>\n\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={handleNext}\n          disabled={currentIndex === items.length - 1 && !isRepeating}\n        >\n          <SkipForward className=\"w-5 h-5\" />\n        </Button>\n\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={handleRepeat}\n          className={repeatMode !== 'off' ? 'text-blue-600 dark:text-blue-400' : ''}\n        >\n          <Repeat className={`w-5 h-5 ${repeatMode === 'one' ? 'scale-x-[-1]' : ''}`} />\n        </Button>\n      </div>\n    );\n  };\n\n  const renderVolumeControls = () => {\n    return (\n      <div className=\"flex items-center gap-2 px-4\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={handleMuteToggle}\n        >\n          <Volume2 className={`w-5 h-5 ${isMuted ? 'text-gray-400' : ''}`} />\n        </Button>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max=\"1\"\n          step=\"0.1\"\n          value={isMuted ? 0 : volume}\n          onChange={(e) => handleVolumeChange(parseFloat(e.target.value))}\n          className=\"w-24 h-1 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer slider\"\n        />\n      </div>\n    );\n  };\n\n  const renderProgressBar = () => {\n    return (\n      <div className=\"px-4\">\n        <div className=\"relative\">\n          <div className=\"h-1 bg-gray-200 dark:bg-gray-700 rounded-full\">\n            <div \n              className=\"h-full bg-blue-600 dark:bg-blue-500 rounded-full transition-all duration-300\"\n              style={{ width: `${progress}%` }}\n            />\n          </div>\n          <div className=\"flex justify-between mt-1\">\n            <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n              {currentIndex + 1}\n            </span>\n            <span className=\"text-xs text-gray-500 dark:text-gray-400\">\n              {items.length}\n            </span>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  const renderPlaylist = () => {\n    return (\n      <div className={`border-t border-gray-200 dark:border-gray-700 ${showPlaylist ? 'h-64' : 'h-0'} transition-all duration-300 overflow-hidden`}>\n        <div className=\"p-4\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h4 className=\"font-semibold text-gray-900 dark:text-white\">\n              {playlist.name}\n            </h4>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setShowPlaylist(!showPlaylist)}\n            >\n              {showPlaylist ? <ChevronRight className=\"w-4 h-4\" /> : <ChevronLeft className=\"w-4 h-4\" />}\n            </Button>\n          </div>\n          \n          <div className=\"space-y-1 max-h-48 overflow-y-auto\">\n            {items.map((item, index) => {\n              const flattenedItem = flattenPlaylistItem(item);\n              const Icon = getMediaIconWithMap(flattenedItem.media_type);\n              const isCurrentItem = index === currentIndex;\n\n              return (\n                <motion.div\n                  key={flattenedItem.item_id}\n                  layout\n                  initial={{ opacity: 0, x: -20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  className={`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors ${\n                    isCurrentItem\n                      ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300'\n                      : 'hover:bg-gray-100 dark:hover:bg-gray-800'\n                  }`}\n                  onClick={() => handleItemClick(index)}\n                >\n                  <GripVertical className=\"w-4 h-4 text-gray-400\" />\n                  <Icon className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium text-sm truncate text-gray-900 dark:text-white\">\n                      {flattenedItem.title}\n                    </p>\n                    {flattenedItem.artist && (\n                      <p className=\"text-xs text-gray-600 dark:text-gray-400 truncate\">\n                        {flattenedItem.artist}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                    {formatDuration(flattenedItem.duration || 0)}\n                  </div>\n                  {isCurrentItem && isPlaying && (\n                    <div className=\"w-2 h-2 bg-blue-600 rounded-full animate-pulse\" />\n                  )}\n                </motion.div>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  const renderMediaContent = () => {\n    if (!currentItem || !flattenedCurrentItem) return null;\n\n    if (flattenedCurrentItem.media_type === 'video') {\n      return (\n        <div className=\"relative\">\n          <MediaPlayer\n            media={{\n              id: parseInt(flattenedCurrentItem.item_id),\n              title: flattenedCurrentItem.title,\n              media_type: 'video',\n              directory_path: flattenedCurrentItem.file_path || '',\n              created_at: currentItem.added_at,\n              updated_at: currentItem.added_at,\n              cover_image: flattenedCurrentItem.thumbnail_url,\n              duration: flattenedCurrentItem.duration\n            }}\n            onEnded={handleNext}\n          />\n          <div className=\"absolute inset-0 flex items-center justify-center bg-black bg-opacity-40\">\n            <Button \n              size=\"lg\"\n              onClick={() => setIsPlaying(!isPlaying)}\n              className=\"rounded-full w-16 h-16\"\n            >\n              {isPlaying ? <Pause className=\"w-6 h-6\" /> : <Play className=\"w-6 h-6\" />}\n            </Button>\n          </div>\n        </div>\n      );\n    }\n\n    if (flattenedCurrentItem.media_type === 'image') {\n      return (\n        <div className=\"flex items-center justify-center bg-gray-100 dark:bg-gray-800 h-64\">\n          <img\n            src={flattenedCurrentItem.thumbnail_url || flattenedCurrentItem.file_path || ''}\n            alt={flattenedCurrentItem.title}\n            className=\"max-w-full max-h-full object-contain\"\n            onError={(e) => {\n              e.currentTarget.src = '/placeholder-image.png';\n            }}\n          />\n        </div>\n      );\n    }\n\n    if (flattenedCurrentItem.media_type === 'music') {\n      return (\n        <div className=\"flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-800 h-64\">\n          <Music className=\"w-24 h-24 text-gray-400 mb-4\" />\n          <div className=\"text-center\">\n            <h3 className=\"text-xl font-bold text-gray-900 dark:text-white mb-2\">\n              {flattenedCurrentItem.title}\n            </h3>\n            <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n              {flattenedCurrentItem.artist || 'Unknown Artist'}\n            </p>\n            {flattenedCurrentItem.duration && (\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                {formatDuration(flattenedCurrentItem.duration)}\n              </p>\n            )}\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"flex items-center justify-center bg-gray-100 dark:bg-gray-800 h-64\">\n        <FileText className=\"w-24 h-24 text-gray-400\" />\n      </div>\n    );\n  };\n\n  if (!items.length) {\n    return (\n      <div className=\"flex items-center justify-center h-64 text-center\">\n        <div>\n          <Music className=\"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">\n            No items in playlist\n          </h3>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            Add some media to start playing\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  const handleShare = async () => {\n    try {\n      const shareInfo = await playlistsApi.sharePlaylist(playlist.id, {\n        can_view: true,\n        can_comment: false,\n        can_download: false\n      });\n      \n      // Copy share link to clipboard\n      await navigator.clipboard.writeText(shareInfo.share_url);\n      toast.success('Share link copied to clipboard!');\n    } catch (error) {\n      console.error('Failed to share playlist:', error);\n      toast.error('Failed to create share link');\n    }\n  };\n\n  const handleShowAnalytics = async () => {\n    try {\n      const analyticsData = await playlistsApi.getPlaylistAnalytics(playlist.id);\n      setAnalytics(analyticsData);\n      setShowAnalytics(true);\n    } catch (error) {\n      console.error('Failed to load analytics:', error);\n      toast.error('Failed to load playlist analytics');\n    }\n  };\n\n  return (\n    <>\n      <div className={`bg-white dark:bg-gray-900 rounded-lg shadow-lg ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n        <div>\n          <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">\n            {playlist.name}\n          </h2>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            {items.length} items\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setShowPlaylist(!showPlaylist)}\n          >\n            <List className=\"w-4 h-4\" />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleShare}\n            title=\"Share playlist\"\n          >\n            <Share className=\"w-4 h-4\" />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleShowAnalytics}\n            title=\"View analytics\"\n          >\n            <BarChart3 className=\"w-4 h-4\" />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleFullscreen}\n          >\n            <Maximize2 className=\"w-4 h-4\" />\n          </Button>\n          {onClose && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onClose}\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          )}\n        </div>\n      </div>\n\n      {/* Media Content */}\n      <div className=\"relative\">\n        {renderMediaContent()}\n        \n        {/* Overlay Controls for Video */}\n        {flattenedCurrentItem?.media_type === 'video' && showControls && (\n          <div \n            className=\"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex flex-col justify-between\"\n            onMouseEnter={() => setShowControls(true)}\n            onMouseLeave={() => setShowControls(false)}\n          >\n            <div className=\"p-4\">\n              {/* Spacer for top controls if needed */}\n            </div>\n            <div className=\"p-4\">\n              {renderControls()}\n              {renderProgressBar()}\n              {renderVolumeControls()}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Now Playing Info (for non-video) */}\n      {flattenedCurrentItem?.media_type !== 'video' && (\n        <>\n          {renderNowPlaying()}\n          {renderProgressBar()}\n          {renderControls()}\n          {renderVolumeControls()}\n        </>\n      )}\n\n      {/* Playlist */}\n      {renderPlaylist()}\n    </div>\n\n    {/* Analytics Modal */}\n    {showAnalytics && analytics && (\n      <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n        <div className=\"bg-white dark:bg-gray-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700\">\n            <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">\n              Playlist Analytics - {playlist.name}\n            </h2>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setShowAnalytics(false)}\n            >\n              <X className=\"w-4 h-4\" />\n            </Button>\n          </div>\n          <div className=\"p-6\">\n            <PlaylistAnalytics analytics={analytics} />\n          </div>\n        </div>\n      </div>\n    )}\n    </>\n  );\n};","import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport { playlistsApi } from '@/lib/playlistsApi'\nimport type { \n  Playlist, \n  PlaylistItem, \n  PlaylistCreateRequest, \n  PlaylistUpdateRequest, \n  PlaylistAnalytics \n} from '@/types/playlists'\nimport toast from 'react-hot-toast'\n\nexport const usePlaylists = (params?: {\n  limit?: number\n  offset?: number\n  include_smart?: boolean\n  type?: string\n}) => {\n  const queryClient = useQueryClient()\n\n  const {\n    data: playlistsData,\n    isLoading: isLoadingPlaylists,\n    error: playlistsError,\n    refetch: refetchPlaylists\n  } = useQuery({\n    queryKey: ['playlists', params],\n    queryFn: () => playlistsApi.getPlaylists(params),\n    staleTime: 1000 * 60 * 5, // 5 minutes\n    cacheTime: 1000 * 60 * 10, // 10 minutes\n  })\n\n  const createPlaylistMutation = useMutation({\n    mutationFn: (request: PlaylistCreateRequest) => playlistsApi.createPlaylist(request),\n    onSuccess: (playlist) => {\n      toast.success(`Playlist \"${playlist.name}\" created successfully`)\n      queryClient.invalidateQueries({ queryKey: ['playlists'] })\n      return playlist\n    },\n    onError: (error: any) => {\n      toast.error(error.response?.data?.message || 'Failed to create playlist')\n    }\n  })\n\n  const updatePlaylistMutation = useMutation({\n    mutationFn: ({ id, request }: { id: string; request: PlaylistUpdateRequest }) => \n      playlistsApi.updatePlaylist(id, request),\n    onSuccess: (playlist) => {\n      toast.success(`Playlist \"${playlist.name}\" updated successfully`)\n      queryClient.invalidateQueries({ queryKey: ['playlists'] })\n      queryClient.invalidateQueries({ queryKey: ['playlist', playlist.id] })\n    },\n    onError: (error: any) => {\n      toast.error(error.response?.data?.message || 'Failed to update playlist')\n    }\n  })\n\n  const deletePlaylistMutation = useMutation({\n    mutationFn: playlistsApi.deletePlaylist,\n    onSuccess: (_, playlistId) => {\n      toast.success('Playlist deleted successfully')\n      queryClient.invalidateQueries({ queryKey: ['playlists'] })\n      queryClient.removeQueries({ queryKey: ['playlist', playlistId] })\n    },\n    onError: (error: any) => {\n      toast.error(error.response?.data?.message || 'Failed to delete playlist')\n    }\n  })\n\n  const addItemsMutation = useMutation({\n    mutationFn: ({ playlistId, mediaIds }: { playlistId: string; mediaIds: number[] }) => \n      playlistsApi.addItemsToPlaylist(playlistId, mediaIds),\n    onSuccess: (data, variables) => {\n      toast.success(`Added ${data.added} items to playlist`)\n      queryClient.invalidateQueries({ queryKey: ['playlist-items', variables.playlistId] })\n      queryClient.invalidateQueries({ queryKey: ['playlists'] })\n    },\n    onError: (error: any) => {\n      toast.error(error.response?.data?.message || 'Failed to add items to playlist')\n    }\n  })\n\n  const removeItemMutation = useMutation({\n    mutationFn: ({ playlistId, itemId }: { playlistId: string; itemId: string }) => \n      playlistsApi.removeFromPlaylist(playlistId, itemId),\n    onSuccess: (_, variables) => {\n      toast.success('Item removed from playlist')\n      queryClient.invalidateQueries({ queryKey: ['playlist-items', variables.playlistId] })\n      queryClient.invalidateQueries({ queryKey: ['playlists'] })\n    },\n    onError: (error: any) => {\n      toast.error(error.response?.data?.message || 'Failed to remove item from playlist')\n    }\n  })\n\n  const reorderItemsMutation = useMutation({\n    mutationFn: ({ playlistId, itemOrders }: { playlistId: string; itemOrders: { id: string; position: number }[] }) => \n      playlistsApi.reorderPlaylistItems(playlistId, itemOrders),\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['playlist-items', variables.playlistId] })\n    },\n    onError: (error: any) => {\n      toast.error(error.response?.data?.message || 'Failed to reorder playlist')\n    }\n  })\n\n  const createPlaylist = (request: PlaylistCreateRequest) => {\n    return createPlaylistMutation.mutateAsync(request)\n  }\n\n  const updatePlaylist = (id: string, request: PlaylistUpdateRequest) => {\n    updatePlaylistMutation.mutate({ id, request })\n  }\n\n  const deletePlaylist = (id: string) => {\n    if (window.confirm('Are you sure you want to delete this playlist? This action cannot be undone.')) {\n      deletePlaylistMutation.mutate(id)\n    }\n  }\n\n  const addItemsToPlaylist = (playlistId: string, mediaIds: number[]) => {\n    addItemsMutation.mutate({ playlistId, mediaIds })\n  }\n\n  const removeFromPlaylist = (playlistId: string, itemId: string) => {\n    removeItemMutation.mutate({ playlistId, itemId })\n  }\n\n  const reorderPlaylistItems = (playlistId: string, itemOrders: { id: string; position: number }[]) => {\n    reorderItemsMutation.mutate({ playlistId, itemOrders })\n  }\n\n  return {\n    playlists: playlistsData?.playlists || [],\n    total: playlistsData?.total || 0,\n    isLoading: isLoadingPlaylists,\n    error: playlistsError,\n    refetchPlaylists,\n    createPlaylist,\n    updatePlaylist,\n    deletePlaylist,\n    addItemsToPlaylist,\n    removeFromPlaylist,\n    reorderPlaylistItems,\n    isCreating: createPlaylistMutation.isLoading,\n    isUpdating: updatePlaylistMutation.isLoading,\n    isDeleting: deletePlaylistMutation.isLoading,\n    isAddingItems: addItemsMutation.isLoading\n  }\n}\n\n// Hook for playlist items\nexport const usePlaylistItems = (playlistId: string, params?: {\n  limit?: number\n  offset?: number\n  sort_by?: 'position' | 'added_at' | 'title' | 'duration'\n  sort_order?: 'asc' | 'desc'\n}) => {\n  const queryClient = useQueryClient()\n\n  const {\n    data: playlistItemsData,\n    isLoading: isLoadingItems,\n    error: itemsError,\n    refetch: refetchItems\n  } = useQuery({\n    queryKey: ['playlist-items', playlistId, params],\n    queryFn: () => playlistsApi.getPlaylistItems(playlistId, params),\n    staleTime: 1000 * 60 * 5, // 5 minutes\n    cacheTime: 1000 * 60 * 10, // 10 minutes,\n    enabled: !!playlistId\n  })\n\n  return {\n    items: playlistItemsData?.items || [],\n    total: playlistItemsData?.total || 0,\n    playlist: playlistItemsData?.playlist,\n    isLoading: isLoadingItems,\n    error: itemsError,\n    refetchItems\n  }\n}\n\n// Hook for playlist analytics\nexport const usePlaylistAnalytics = (playlistId: string) => {\n  return useQuery({\n    queryKey: ['playlist-analytics', playlistId],\n    queryFn: () => playlistsApi.getPlaylistAnalytics(playlistId),\n    staleTime: 1000 * 60 * 10, // 10 minutes\n    cacheTime: 1000 * 60 * 30, // 30 minutes\n    enabled: !!playlistId\n  })\n}","import React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Search,\n  Filter,\n  Plus,\n  Play,\n  Shuffle,\n  Heart,\n  Clock,\n  MoreHorizontal,\n  Grid,\n  List,\n  Download,\n  Share2,\n  Edit3,\n  Trash2,\n  Music,\n  Film,\n  Image,\n  FileText,\n  Copy,\n  ExternalLink\n} from 'lucide-react';\n\nimport { Button } from '../ui/Button';\nimport { Input } from '../ui/Input';\nimport { Select } from '../ui/Select';\nimport { PlaylistManager } from './PlaylistManager';\nimport { PlaylistPlayer } from './PlaylistPlayer';\nimport { PlaylistItemComponent } from './PlaylistItem';\nimport { playlistApi } from '../../lib/playlistsApi';\nimport { usePlaylists } from '../../hooks/usePlaylists';\nimport { useFavorites } from '../../hooks/useFavorites';\nimport { Playlist, PlaylistItem, PlaylistViewMode, PlaylistSortBy, getMediaIconWithMap } from '../../types/playlists';\nimport { toast } from 'react-hot-toast';\n\ninterface PlaylistGridProps {\n  onCreatePlaylist?: () => void;\n  onEditPlaylist?: (playlist: Playlist) => void;\n  className?: string;\n}\n\nconst MEDIA_TYPE_ICONS = {\n  music: Music,\n  video: Film,\n  image: Image,\n  document: FileText,\n};\n\nconst DURATION_FORMATTER = new Intl.DateTimeFormat('en-US', {\n  hour: 'numeric',\n  minute: '2-digit',\n  second: '2-digit',\n  hour12: false\n});\n\nexport const PlaylistGrid: React.FC<PlaylistGridProps> = ({\n  onCreatePlaylist,\n  onEditPlaylist,\n  className = ''\n}) => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [viewMode, setViewMode] = useState<PlaylistViewMode>('grid');\n  const [sortBy, setSortBy] = useState<PlaylistSortBy>('name');\n  const [filterMediaType, setFilterMediaType] = useState<string>('all');\n  const [filterVisibility, setFilterVisibility] = useState<string>('all');\n  const [selectedPlaylist, setSelectedPlaylist] = useState<Playlist | null>(null);\n  const [selectedItems, setSelectedItems] = useState<Set<string>>(new Set());\n  const [showPlayer, setShowPlayer] = useState(false);\n  const [showDropdown, setShowDropdown] = useState<string | null>(null);\n\n  const {\n    playlists = [],\n    isLoading,\n    error,\n    refetchPlaylists\n  } = usePlaylists();\n\n  const { checkFavoriteStatus } = useFavorites();\n\n  const filteredAndSortedPlaylists = React.useMemo(() => {\n    let filtered = playlists;\n\n    // Apply search filter\n    if (searchQuery) {\n      filtered = filtered.filter(playlist =>\n        playlist.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        playlist.description?.toLowerCase().includes(searchQuery.toLowerCase())\n      );\n    }\n\n    // Apply media type filter\n    if (filterMediaType !== 'all') {\n      filtered = filtered.filter(playlist => \n        playlist.primary_media_type === filterMediaType\n      );\n    }\n\n    // Apply visibility filter\n    if (filterVisibility !== 'all') {\n      filtered = filtered.filter(playlist => \n        filterVisibility === 'public' ? playlist.is_public : !playlist.is_public\n      );\n    }\n\n    // Apply sorting\n    return filtered.sort((a, b) => {\n      switch (sortBy) {\n        case 'name':\n          return a.name.localeCompare(b.name);\n        case 'created_at':\n          return new Date(b.created_at).getTime() - new Date(a.created_at).getTime();\n        case 'updated_at':\n          return new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime();\n        case 'duration':\n          return (b.total_duration || 0) - (a.total_duration || 0);\n        case 'item_count':\n          return b.item_count - a.item_count;\n        case 'name_desc':\n          return b.name.localeCompare(a.name);\n        default:\n          return 0;\n      }\n    });\n  }, [playlists, searchQuery, sortBy, filterMediaType, filterVisibility]);\n\n  const handlePlaylistAction = async (playlist: Playlist, action: string) => {\n    try {\n      switch (action) {\n        case 'play': {\n          const _items = await playlistApi.getPlaylistItems(playlist.id);\n          setSelectedPlaylist(playlist);\n          setShowPlayer(true);\n          toast.success(`Playing ${playlist.name}`);\n          break;\n        }\n\n        case 'shuffle': {\n          const _shuffleItems = await playlistApi.getPlaylistItems(playlist.id);\n          await playlistApi.shufflePlaylist(playlist.id);\n          setSelectedPlaylist(playlist);\n          setShowPlayer(true);\n          toast.success(`Shuffling ${playlist.name}`);\n          break;\n        }\n\n        case 'duplicate': {\n          const duplicateName = `${playlist.name} (Copy)`;\n          const duplicate = await playlistApi.createPlaylist({\n            name: duplicateName,\n            description: playlist.description,\n            is_public: playlist.is_public,\n            items: playlist.items || []\n          });\n          toast.success(`Playlist duplicated as ${duplicate.name}`);\n          refetchPlaylists();\n          break;\n        }\n\n        case 'toggle_public': {\n          const updated = await playlistApi.updatePlaylist(playlist.id, {\n            is_public: !playlist.is_public\n          });\n          toast.success(`Playlist is now ${updated.is_public ? 'public' : 'private'}`);\n          refetchPlaylists();\n          break;\n        }\n\n        case 'export': {\n          const exportData = await playlistApi.exportPlaylist(playlist.id);\n          const blob = new Blob([JSON.stringify(exportData, null, 2)], {\n            type: 'application/json'\n          });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `${playlist.name.replace(/[^a-z0-9]/gi, '_')}.json`;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n          toast.success(`Exported ${playlist.name}`);\n          break;\n        }\n        \n        case 'share':\n          if (navigator.share) {\n            await navigator.share({\n              title: playlist.name,\n              text: playlist.description || `Check out this playlist: ${playlist.name}`,\n              url: window.location.origin + `/playlists/${playlist.id}`\n            });\n          } else {\n            await navigator.clipboard.writeText(\n              window.location.origin + `/playlists/${playlist.id}`\n            );\n            toast.success('Playlist link copied to clipboard');\n          }\n          break;\n        \n        case 'delete':\n          if (window.confirm(`Are you sure you want to delete \"${playlist.name}\"?`)) {\n            await playlistApi.deletePlaylist(playlist.id);\n            toast.success(`Deleted ${playlist.name}`);\n            refetchPlaylists();\n          }\n          break;\n      }\n    } catch (error) {\n      console.error(`Failed to ${action} playlist:`, error);\n      toast.error(`Failed to ${action} playlist`);\n    } finally {\n      setShowDropdown(null);\n    }\n  };\n\n  const handleSelectPlaylist = (playlist: Playlist, isSelected: boolean) => {\n    const newSelection = new Set(selectedItems);\n    if (isSelected) {\n      newSelection.add(playlist.id);\n    } else {\n      newSelection.delete(playlist.id);\n    }\n    setSelectedItems(newSelection);\n  };\n\n  const handleSelectAll = () => {\n    if (selectedItems.size === filteredAndSortedPlaylists.length) {\n      setSelectedItems(new Set());\n    } else {\n      setSelectedItems(new Set(filteredAndSortedPlaylists.map(p => p.id)));\n    }\n  };\n\n  const handleBulkAction = async (action: string) => {\n    try {\n      switch (action) {\n        case 'delete':\n          if (window.confirm(`Are you sure you want to delete ${selectedItems.size} playlists?`)) {\n            await Promise.all(\n              Array.from(selectedItems).map(id => playlistApi.deletePlaylist(id))\n            );\n            toast.success(`Deleted ${selectedItems.size} playlists`);\n            setSelectedItems(new Set());\n            refetchPlaylists();\n          }\n          break;\n        \n        case 'export': {\n          const selectedPlaylists = playlists.filter(p => selectedItems.has(p.id));\n          const exportData = {\n            playlists: selectedPlaylists,\n            exported_at: new Date().toISOString(),\n            version: '1.0'\n          };\n          const blob = new Blob([JSON.stringify(exportData, null, 2)], {\n            type: 'application/json'\n          });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `playlists_export_${new Date().toISOString().split('T')[0]}.json`;\n          document.body.appendChild(a);\n          a.click();\n          document.body.removeChild(a);\n          URL.revokeObjectURL(url);\n          toast.success(`Exported ${selectedItems.size} playlists`);\n          break;\n        }\n      }\n    } catch (error) {\n      console.error(`Failed to ${action} playlists:`, error);\n      toast.error(`Failed to ${action} playlists`);\n    }\n  };\n\n  const formatDuration = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = Math.floor(seconds % 60);\n    \n    if (hours > 0) {\n      return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    }\n    return `${minutes}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const getMediaTypes = (playlist: Playlist) => {\n    const types = new Set(playlist.items?.map(item => item.media_item.media_type));\n    return Array.from(types);\n  };\n\n  const renderPlaylistCard = (playlist: Playlist) => {\n    const Icon = getMediaIconWithMap(playlist.primary_media_type || '');\n    const mediaTypes = getMediaTypes(playlist);\n    const isDropdownOpen = showDropdown === playlist.id;\n    const isSelected = selectedItems.has(playlist.id);\n\n    return (\n      <motion.div\n        key={playlist.id}\n        layout\n        initial={{ opacity: 0, scale: 0.9 }}\n        animate={{ opacity: 1, scale: 1 }}\n        exit={{ opacity: 0, scale: 0.9 }}\n        whileHover={{ y: -4 }}\n        className={`group relative bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-md transition-all duration-200 border ${\n          isSelected \n            ? 'border-blue-500 dark:border-blue-400' \n            : 'border-gray-200 dark:border-gray-700'\n        }`}\n      >\n        {/* Selection Checkbox */}\n        <div className=\"absolute top-2 left-2 z-10\">\n          <input\n            type=\"checkbox\"\n            checked={isSelected}\n            onChange={(e) => {\n              e.stopPropagation();\n              handleSelectPlaylist(playlist, e.target.checked);\n            }}\n            className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 opacity-0 group-hover:opacity-100 transition-opacity\"\n          />\n        </div>\n\n        {/* Playlist Cover */}\n        <div className=\"aspect-video bg-gradient-to-br from-blue-500 to-purple-600 rounded-t-lg relative overflow-hidden\">\n          <div className=\"absolute inset-0 bg-black/20 flex items-center justify-center\">\n            <Icon className=\"w-16 h-16 text-white/80\" />\n          </div>\n          \n          {/* Media Type Badges */}\n          <div className=\"absolute top-2 left-8 flex gap-1\">\n            {mediaTypes.slice(0, 2).map((type) => {\n              const TypeIcon = getMediaIconWithMap(type);\n              return (\n                <div\n                  key={type}\n                  className=\"bg-white/90 backdrop-blur-sm p-1 rounded\"\n                  title={type}\n                >\n                  <TypeIcon className=\"w-3 h-3 text-gray-700\" />\n                </div>\n              );\n            })}\n            {mediaTypes.length > 2 && (\n              <div className=\"bg-white/90 backdrop-blur-sm p-1 rounded text-xs text-gray-700\">\n                +{mediaTypes.length - 2}\n              </div>\n            )}\n          </div>\n\n          {/* Favorite Badge */}\n          {checkFavoriteStatus(parseInt(playlist.id)) && (\n            <div className=\"absolute top-2 right-2\">\n              <Heart className=\"w-4 h-4 text-red-500 fill-current\" />\n            </div>\n          )}\n\n          {/* Quick Actions */}\n          <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center gap-2\">\n            <Button\n              size=\"sm\"\n              variant=\"secondary\"\n              onClick={(e) => {\n                e.stopPropagation();\n                handlePlaylistAction(playlist, 'play');\n              }}\n              className=\"bg-white/90 hover:bg-white text-gray-900\"\n            >\n              <Play className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"secondary\"\n              onClick={(e) => {\n                e.stopPropagation();\n                handlePlaylistAction(playlist, 'shuffle');\n              }}\n              className=\"bg-white/90 hover:bg-white text-gray-900\"\n            >\n              <Shuffle className=\"w-4 h-4\" />\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"secondary\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onEditPlaylist?.(playlist);\n              }}\n              className=\"bg-white/90 hover:bg-white text-gray-900\"\n            >\n              <Edit3 className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </div>\n\n        {/* Playlist Info */}\n        <div className=\"p-4\">\n          <div className=\"flex justify-between items-start mb-2\">\n            <div className=\"flex-1 min-w-0\">\n              <h3 className=\"font-semibold text-gray-900 dark:text-white truncate\">\n                {playlist.name}\n              </h3>\n              {playlist.description && (\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2\">\n                  {playlist.description}\n                </p>\n              )}\n            </div>\n            <div className=\"relative ml-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setShowDropdown(isDropdownOpen ? null : playlist.id);\n                }}\n                className=\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n              >\n                <MoreHorizontal className=\"w-4 h-4\" />\n              </Button>\n              \n              {/* Dropdown Menu */}\n              <AnimatePresence>\n                {isDropdownOpen && (\n                  <motion.div\n                    initial={{ opacity: 0, scale: 0.95, y: -10 }}\n                    animate={{ opacity: 1, scale: 1, y: 0 }}\n                    exit={{ opacity: 0, scale: 0.95, y: -10 }}\n                    transition={{ duration: 0.15 }}\n                    className=\"absolute right-0 mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-10\"\n                  >\n                    <div className=\"py-1\">\n                      <button\n                        onClick={() => handlePlaylistAction(playlist, 'duplicate')}\n                        className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\n                      >\n                        <Copy className=\"w-4 h-4\" />\n                        Duplicate\n                      </button>\n                      <button\n                        onClick={() => handlePlaylistAction(playlist, 'export')}\n                        className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\n                      >\n                        <Download className=\"w-4 h-4\" />\n                        Export\n                      </button>\n                      <button\n                        onClick={() => handlePlaylistAction(playlist, 'share')}\n                        className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\n                      >\n                        <Share2 className=\"w-4 h-4\" />\n                        Share\n                      </button>\n                      <button\n                        onClick={() => {\n                          window.open(`/playlists/${playlist.id}`, '_blank');\n                        }}\n                        className=\"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\n                      >\n                        <ExternalLink className=\"w-4 h-4\" />\n                        Open in New Tab\n                      </button>\n                      <button\n                        onClick={() => handlePlaylistAction(playlist, 'delete')}\n                        className=\"w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2\"\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                        Delete\n                      </button>\n                    </div>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n            </div>\n          </div>\n\n          {/* Playlist Stats */}\n          <div className=\"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400\">\n            <span className=\"flex items-center gap-1\">\n              <Grid className=\"w-3 h-3\" />\n              {playlist.item_count} items\n            </span>\n            {playlist.total_duration && playlist.total_duration > 0 && (\n              <span className=\"flex items-center gap-1\">\n                <Clock className=\"w-3 h-3\" />\n                {formatDuration(playlist.total_duration)}\n              </span>\n            )}\n            <span>\n              {playlist.is_public ? 'Public' : 'Private'}\n            </span>\n            <span>\n              {new Date(playlist.updated_at).toLocaleDateString()}\n            </span>\n          </div>\n        </div>\n      </motion.div>\n    );\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"text-gray-500 dark:text-gray-400\">Loading playlists...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-64 text-center\">\n        <p className=\"text-red-600 dark:text-red-400 mb-4\">Failed to load playlists</p>\n        <Button onClick={() => refetchPlaylists()} variant=\"outline\">\n          Try Again\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`space-y-6 ${className}`}>\n      {/* Playlist Player Modal */}\n      <AnimatePresence>\n        {showPlayer && selectedPlaylist && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\"\n            onClick={() => setShowPlayer(false)}\n          >\n            <motion.div\n              initial={{ opacity: 0, scale: 0.95 }}\n              animate={{ opacity: 1, scale: 1 }}\n              exit={{ opacity: 0, scale: 0.95 }}\n              transition={{ duration: 0.2 }}\n              className=\"bg-white dark:bg-gray-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto\"\n              onClick={(e) => e.stopPropagation()}\n            >\n              <PlaylistPlayer\n                playlist={selectedPlaylist}\n                items={selectedPlaylist.items || []}\n                onClose={() => setShowPlayer(false)}\n              />\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n            Playlists\n          </h2>\n          <p className=\"text-gray-600 dark:text-gray-400 mt-1\">\n            {playlists.length} playlist{playlists.length !== 1 ? 's' : ''}\n          </p>\n        </div>\n        <Button onClick={onCreatePlaylist} className=\"flex items-center gap-2\">\n          <Plus className=\"w-4 h-4\" />\n          Create Playlist\n        </Button>\n      </div>\n\n      {/* Bulk Actions */}\n      {selectedItems.size > 0 && (\n        <motion.div\n          initial={{ opacity: 0, y: -20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\"\n        >\n          <div className=\"flex items-center justify-between\">\n            <p className=\"text-blue-800 dark:text-blue-200\">\n              {selectedItems.size} playlist{selectedItems.size !== 1 ? 's' : ''} selected\n            </p>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => handleBulkAction('export')}\n              >\n                <Download className=\"w-4 h-4 mr-2\" />\n                Export Selected\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"destructive\"\n                onClick={() => handleBulkAction('delete')}\n              >\n                <Trash2 className=\"w-4 h-4 mr-2\" />\n                Delete Selected\n              </Button>\n            </div>\n          </div>\n        </motion.div>\n      )}\n\n      {/* Filters and Controls */}\n      <div className=\"flex flex-col lg:flex-row gap-4\">\n        {/* Search */}\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n          <Input\n            placeholder=\"Search playlists...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n\n        {/* Filters */}\n        <div className=\"flex items-center gap-2\">\n          <Select\n            value={filterMediaType}\n            onChange={(value) => setFilterMediaType(value)}\n            options={[\n              { value: 'all', label: 'All Types' },\n              { value: 'music', label: 'Music' },\n              { value: 'video', label: 'Video' },\n              { value: 'image', label: 'Images' },\n              { value: 'document', label: 'Documents' }\n            ]}\n            className=\"w-32\"\n          />\n          \n          <Select\n            value={filterVisibility}\n            onChange={(value) => setFilterVisibility(value)}\n            options={[\n              { value: 'all', label: 'All' },\n              { value: 'public', label: 'Public' },\n              { value: 'private', label: 'Private' }\n            ]}\n            className=\"w-32\"\n          />\n        </div>\n\n        {/* View Mode Toggle */}\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant={viewMode === 'grid' ? 'secondary' : 'ghost'}\n            size=\"sm\"\n            onClick={() => setViewMode('grid')}\n          >\n            <Grid className=\"w-4 h-4\" />\n          </Button>\n          <Button\n            variant={viewMode === 'list' ? 'secondary' : 'ghost'}\n            size=\"sm\"\n            onClick={() => setViewMode('list')}\n          >\n            <List className=\"w-4 h-4\" />\n          </Button>\n        </div>\n\n        {/* Sort */}\n        <div className=\"flex items-center gap-2\">\n          <Select\n            value={sortBy}\n            onChange={(value) => setSortBy(value as PlaylistSortBy)}\n            options={[\n              { value: 'name', label: 'Name (A-Z)' },\n              { value: 'name_desc', label: 'Name (Z-A)' },\n              { value: 'created_at', label: 'Created' },\n              { value: 'updated_at', label: 'Updated' },\n              { value: 'duration', label: 'Duration' },\n              { value: 'item_count', label: 'Items' }\n            ]}\n            className=\"w-40\"\n          />\n        </div>\n\n        {/* Select All */}\n        <div className=\"flex items-center gap-2\">\n          <input\n            type=\"checkbox\"\n            checked={selectedItems.size === filteredAndSortedPlaylists.length && filteredAndSortedPlaylists.length > 0}\n            onChange={handleSelectAll}\n            className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n          />\n          <span className=\"text-sm text-gray-600 dark:text-gray-400\">\n            Select All\n          </span>\n        </div>\n      </div>\n\n      {/* Playlists Grid */}\n      {filteredAndSortedPlaylists.length === 0 ? (\n        <div className=\"text-center py-12\">\n          <Music className=\"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4\" />\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">\n            {searchQuery || filterMediaType !== 'all' || filterVisibility !== 'all' \n              ? 'No playlists found' \n              : 'No playlists yet'\n            }\n          </h3>\n          <p className=\"text-gray-600 dark:text-gray-400 mb-6\">\n            {searchQuery || filterMediaType !== 'all' || filterVisibility !== 'all'\n              ? 'Try adjusting your filters or search terms'\n              : 'Create your first playlist to start organizing your media'\n            }\n          </p>\n          {!searchQuery && filterMediaType === 'all' && filterVisibility === 'all' && (\n            <Button onClick={onCreatePlaylist}>\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Create Playlist\n            </Button>\n          )}\n        </div>\n      ) : (\n        <div className={viewMode === 'grid' \n          ? 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4'\n          : 'space-y-2'\n        }>\n          <AnimatePresence mode=\"popLayout\">\n            {filteredAndSortedPlaylists.map((playlist) => \n              viewMode === 'grid' \n                ? renderPlaylistCard(playlist)\n                : (\n                    <div key={playlist.id} className=\"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-all duration-200\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex-1\">\n                          <h3 className=\"font-semibold text-gray-900 dark:text-white\">\n                            {playlist.name}\n                          </h3>\n                          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                            {playlist.item_count} items  {formatDuration(playlist.total_duration || 0)}\n                          </p>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => handlePlaylistAction(playlist, 'play')}\n                          >\n                            <Play className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => onEditPlaylist?.(playlist)}\n                          >\n                            <Edit3 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  )\n            )}\n          </AnimatePresence>\n        </div>\n      )}\n    </div>\n  );\n};","import React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Plus,\n  X,\n  Save,\n  Play,\n  Shuffle,\n  Filter,\n  Search,\n  Calendar,\n  Clock,\n  Star,\n  Tag,\n  Music,\n  Film,\n  Image,\n  FileText,\n  ChevronDown,\n  ChevronUp,\n  HelpCircle\n} from 'lucide-react';\nimport { Button } from '../ui/Button';\nimport { Input } from '../ui/Input';\nimport { Select } from '../ui/Select';\nimport { Switch } from '../ui/Switch';\nimport { SmartPlaylistRule, PlaylistType } from '../../types/playlists';\nimport { toast } from 'react-hot-toast';\n\ninterface SmartPlaylistBuilderProps {\n  onSave: (name: string, description: string, rules: SmartPlaylistRule[]) => void;\n  onCancel: () => void;\n  initialData?: {\n    name: string;\n    description: string;\n    rules: SmartPlaylistRule[];\n  };\n  className?: string;\n}\n\nconst FIELD_OPTIONS = [\n  { value: 'media_type', label: 'Media Type', icon: Music },\n  { value: 'year', label: 'Year', icon: Calendar },\n  { value: 'rating', label: 'Rating', icon: Star },\n  { value: 'quality', label: 'Quality', icon: Filter },\n  { value: 'genre', label: 'Genre', icon: Tag },\n  { value: 'created_at', label: 'Date Added', icon: Clock },\n] as const;\n\nconst OPERATOR_OPTIONS = [\n  { value: 'equals', label: 'Is', description: 'Exactly matches the value' },\n  { value: 'not_equals', label: 'Is not', description: 'Does not match the value' },\n  { value: 'greater_than', label: 'Greater than', description: 'More than the value' },\n  { value: 'less_than', label: 'Less than', description: 'Less than the value' },\n  { value: 'contains', label: 'Contains', description: 'Contains the text' },\n  { value: 'starts_with', label: 'Starts with', description: 'Begins with the text' },\n  { value: 'ends_with', label: 'Ends with', description: 'Ends with the text' },\n  { value: 'in', label: 'Is one of', description: 'Matches any of the values' },\n  { value: 'not_in', label: 'Is not one of', description: 'Does not match any of the values' },\n] as const;\n\nconst MEDIA_TYPE_OPTIONS = [\n  { value: 'video', label: 'Video', icon: Film },\n  { value: 'music', label: 'Music', icon: Music },\n  { value: 'image', label: 'Image', icon: Image },\n  { value: 'document', label: 'Document', icon: FileText },\n] as const;\n\nconst QUALITY_OPTIONS = [\n  { value: 'cam', label: 'CAM' },\n  { value: 'ts', label: 'TS' },\n  { value: 'dvdrip', label: 'DVDrip' },\n  { value: 'brrip', label: 'BRRip' },\n  { value: '720p', label: '720p' },\n  { value: '1080p', label: '1080p' },\n  { value: '4k', label: '4K' },\n  { value: 'hdr', label: 'HDR' },\n  { value: 'dolby_vision', label: 'Dolby Vision' },\n] as const;\n\nconst GENRE_OPTIONS = [\n  'Action', 'Comedy', 'Drama', 'Horror', 'Sci-Fi', 'Romance', 'Thriller', \n  'Documentary', 'Animation', 'Fantasy', 'Mystery', 'Adventure', 'Crime',\n  'Family', 'Biography', 'History', 'War', 'Western', 'Musical', 'Sport'\n];\n\nconst COMMON_PRESETS = [\n  {\n    name: 'Recently Added',\n    description: 'Items added in the last 30 days',\n    rules: [\n      {\n        field: 'created_at',\n        operator: 'greater_than',\n        value: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n        condition: 'and'\n      }\n    ]\n  },\n  {\n    name: 'High Rated Movies',\n    description: 'Movies with rating 8 or higher',\n    rules: [\n      {\n        field: 'media_type',\n        operator: 'equals',\n        value: 'video',\n        condition: 'and'\n      },\n      {\n        field: 'rating',\n        operator: 'greater_than',\n        value: 8,\n        condition: 'and'\n      }\n    ]\n  },\n  {\n    name: 'HD Movies Only',\n    description: 'Movies in 1080p or higher quality',\n    rules: [\n      {\n        field: 'media_type',\n        operator: 'equals',\n        value: 'video',\n        condition: 'and'\n      },\n      {\n        field: 'quality',\n        operator: 'in',\n        value: ['1080p', '4k', 'hdr', 'dolby_vision'],\n        condition: 'and'\n      }\n    ]\n  }\n] as Array<{\n  name: string;\n  description: string;\n  rules: SmartPlaylistRule[];\n}>;\n\nexport const SmartPlaylistBuilder: React.FC<SmartPlaylistBuilderProps> = ({\n  onSave,\n  onCancel,\n  initialData,\n  className = ''\n}) => {\n  const [name, setName] = useState(initialData?.name || '');\n  const [description, setDescription] = useState(initialData?.description || '');\n  const [rules, setRules] = useState<SmartPlaylistRule[]>(\n    initialData?.rules || [{ field: 'media_type', operator: 'equals', value: '', condition: 'and' }]\n  );\n  const [expandedRules, setExpandedRules] = useState<Set<number>>(new Set([0]));\n  const [showAdvanced, setShowAdvanced] = useState(false);\n\n  const addRule = () => {\n    const newRule: SmartPlaylistRule = {\n      field: 'media_type',\n      operator: 'equals',\n      value: '',\n      condition: 'and'\n    };\n    setRules([...rules, newRule]);\n    setExpandedRules(new Set([...expandedRules, rules.length]));\n  };\n\n  const removeRule = (index: number) => {\n    setRules(rules.filter((_, i) => i !== index));\n    setExpandedRules(new Set([...expandedRules].filter(i => i !== index)));\n  };\n\n  const updateRule = (index: number, updates: Partial<SmartPlaylistRule>) => {\n    setRules(rules.map((rule, i) => \n      i === index ? { ...rule, ...updates } : rule\n    ));\n  };\n\n  const moveRule = (index: number, direction: 'up' | 'down') => {\n    const newIndex = direction === 'up' ? index - 1 : index + 1;\n    if (newIndex >= 0 && newIndex < rules.length) {\n      const newRules = [...rules];\n      [newRules[index], newRules[newIndex]] = [newRules[newIndex], newRules[index]];\n      setRules(newRules);\n    }\n  };\n\n  const toggleRuleExpanded = (index: number) => {\n    setExpandedRules(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(index)) {\n        newSet.delete(index);\n      } else {\n        newSet.add(index);\n      }\n      return newSet;\n    });\n  };\n\n  const applyPreset = (preset: typeof COMMON_PRESETS[0]) => {\n    setName(preset.name);\n    setDescription(preset.description);\n    setRules(preset.rules);\n    setExpandedRules(new Set(preset.rules.map((_, index) => index)));\n  };\n\n  const validateRules = (): string | null => {\n    if (!name.trim()) {\n      return 'Playlist name is required';\n    }\n    \n    if (rules.length === 0) {\n      return 'At least one rule is required';\n    }\n\n    for (let i = 0; i < rules.length; i++) {\n      const rule = rules[i];\n      if (!rule.field || !rule.operator) {\n        return `Rule ${i + 1} is incomplete`;\n      }\n      \n      if (rule.value === '' || rule.value === null || rule.value === undefined) {\n        return `Rule ${i + 1} has no value`;\n      }\n    }\n\n    return null;\n  };\n\n  const handleSave = () => {\n    const error = validateRules();\n    if (error) {\n      toast.error(error);\n      return;\n    }\n\n    onSave(name, description, rules);\n  };\n\n  const renderRuleInput = (rule: SmartPlaylistRule, index: number) => {\n    const fieldInfo = FIELD_OPTIONS.find(f => f.value === rule.field);\n    const operatorInfo = OPERATOR_OPTIONS.find(o => o.value === rule.operator);\n    const isExpanded = expandedRules.has(index);\n\n    const renderValueInput = () => {\n      switch (rule.field) {\n        case 'media_type':\n          return (\n            <Select\n              value={String(rule.value)}\n              onChange={(value) => updateRule(index, { value: value })}\n              className=\"flex-1\"\n            >\n              <option value=\"\">Select media type...</option>\n              {MEDIA_TYPE_OPTIONS.map(option => (\n                <option key={option.value} value={option.value}>\n                  {option.label}\n                </option>\n              ))}\n            </Select>\n          );\n        \n        case 'quality':\n          return (\n            <Select\n              value={Array.isArray(rule.value) ? rule.value[0] : String(rule.value)}\n              onChange={(value) => updateRule(index, { value: value })}\n              className=\"flex-1\"\n            >\n              <option value=\"\">Select quality...</option>\n              {QUALITY_OPTIONS.map(option => (\n                <option key={option.value} value={option.value}>\n                  {option.label}\n                </option>\n              ))}\n            </Select>\n          );\n        \n        case 'rating':\n          return (\n            <Input\n              type=\"number\"\n              min=\"0\"\n              max=\"10\"\n              step=\"0.1\"\n              value={String(rule.value)}\n              onChange={(e) => updateRule(index, { value: parseFloat(e.target.value) || 0 })}\n              placeholder=\"Rating\"\n              className=\"flex-1\"\n            />\n          );\n        \n        case 'year':\n          return (\n            <Input\n              type=\"number\"\n              min=\"1900\"\n              max=\"2030\"\n              value={String(rule.value)}\n              onChange={(e) => updateRule(index, { value: parseInt(e.target.value) || 0 })}\n              placeholder=\"Year\"\n              className=\"flex-1\"\n            />\n          );\n        \n        case 'genre':\n          return (\n            <Select\n              value={String(rule.value)}\n              onChange={(value) => updateRule(index, { value: value })}\n              className=\"flex-1\"\n            >\n              <option value=\"\">Select genre...</option>\n              {GENRE_OPTIONS.map(genre => (\n                <option key={genre} value={genre}>\n                  {genre}\n                </option>\n              ))}\n            </Select>\n          );\n        \n        case 'created_at':\n          return (\n            <Input\n              type=\"date\"\n              value={String(rule.value)}\n              onChange={(e) => updateRule(index, { value: e.target.value })}\n              className=\"flex-1\"\n            />\n          );\n        \n        default:\n          return (\n            <Input\n              value={String(rule.value || '')}\n              onChange={(e) => updateRule(index, { value: e.target.value })}\n              placeholder=\"Enter value...\"\n              className=\"flex-1\"\n            />\n          );\n      }\n    };\n\n    return (\n      <motion.div\n        layout\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        exit={{ opacity: 0, y: -20 }}\n        className=\"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4\"\n      >\n        <div className=\"flex items-start gap-3\">\n          {/* Drag Handle */}\n          <div className=\"flex flex-col gap-1 pt-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => moveRule(index, 'up')}\n              disabled={index === 0}\n              className=\"p-1\"\n            >\n              <ChevronUp className=\"w-3 h-3\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => moveRule(index, 'down')}\n              disabled={index === rules.length - 1}\n              className=\"p-1\"\n            >\n              <ChevronDown className=\"w-3 h-3\" />\n            </Button>\n          </div>\n\n          {/* Rule Content */}\n          <div className=\"flex-1 space-y-3\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                {fieldInfo && <fieldInfo.icon className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />}\n                <span className=\"font-medium text-gray-900 dark:text-white\">\n                  Rule {index + 1}\n                </span>\n              </div>\n              \n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => toggleRuleExpanded(index)}\n                  className=\"p-2\"\n                >\n                  {isExpanded ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                </Button>\n                {rules.length > 1 && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => removeRule(index)}\n                    className=\"text-red-600 hover:text-red-700 p-2\"\n                  >\n                    <X className=\"w-4 h-4\" />\n                  </Button>\n                )}\n              </div>\n            </div>\n\n            {/* Rule Builder */}\n            <AnimatePresence>\n              {isExpanded && (\n                <motion.div\n                  initial={{ opacity: 0, height: 0 }}\n                  animate={{ opacity: 1, height: 'auto' }}\n                  exit={{ opacity: 0, height: 0 }}\n                  className=\"space-y-3\"\n                >\n                  <div className=\"flex items-center gap-3\">\n                    {/* Field */}\n                    <div className=\"flex-1\">\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                        Field\n                      </label>\n                      <Select\n                        value={rule.field}\n                        onChange={(value) => updateRule(index, { \n                          field: value as SmartPlaylistRule['field'],\n                          value: '' // Reset value when field changes\n                        })}\n                      >\n                        {FIELD_OPTIONS.map(option => (\n                          <option key={option.value} value={option.value}>\n                            {option.label}\n                          </option>\n                        ))}\n                      </Select>\n                    </div>\n\n                    {/* Operator */}\n                    <div className=\"flex-1\">\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                        Condition\n                      </label>\n                      <Select\n                        value={rule.operator}\n                        onChange={(value) => updateRule(index, { \n                          operator: value as SmartPlaylistRule['operator']\n                        })}\n                      >\n                        {OPERATOR_OPTIONS.map(option => (\n                          <option key={option.value} value={option.value}>\n                            {option.label}\n                          </option>\n                        ))}\n                      </Select>\n                    </div>\n\n                    {/* Value */}\n                    <div className=\"flex-2\">\n                      <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n                        Value\n                      </label>\n                      {renderValueInput()}\n                    </div>\n                  </div>\n\n                  {operatorInfo && (\n                    <div className=\"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400\">\n                      <HelpCircle className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n                      <span>{operatorInfo.description}</span>\n                    </div>\n                  )}\n\n                  {/* Advanced Options */}\n                  {showAdvanced && (\n                    <div className=\"flex items-center gap-4\">\n                      <label className=\"flex items-center gap-2 text-sm\">\n                        <span className=\"text-gray-700 dark:text-gray-300\">Logic:</span>\n                        <Select\n                          value={rule.condition}\n                          onChange={(value) => updateRule(index, { \n                            condition: value as SmartPlaylistRule['condition']\n                          })}\n                          className=\"w-20\"\n                        >\n                          <option value=\"and\">AND</option>\n                          <option value=\"or\">OR</option>\n                        </Select>\n                      </label>\n                    </div>\n                  )}\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </div>\n        </div>\n      </motion.div>\n    );\n  };\n\n  return (\n    <div className={`space-y-6 ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n          Smart Playlist Builder\n        </h2>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setShowAdvanced(!showAdvanced)}\n          >\n            <Filter className=\"w-4 h-4\" />\n            {showAdvanced ? 'Simple' : 'Advanced'}\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={onCancel}\n          >\n            <X className=\"w-4 h-4\" />\n            Cancel\n          </Button>\n        </div>\n      </div>\n\n      {/* Basic Info */}\n      <div className=\"space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n            Playlist Name\n          </label>\n          <Input\n            value={name}\n            onChange={(e) => setName(e.target.value)}\n            placeholder=\"Enter playlist name...\"\n            className=\"w-full\"\n          />\n        </div>\n        \n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n            Description (optional)\n          </label>\n          <Input\n            value={description}\n            onChange={(e) => setDescription(e.target.value)}\n            placeholder=\"Describe your smart playlist...\"\n            className=\"w-full\"\n          />\n        </div>\n      </div>\n\n      {/* Presets */}\n      <div>\n        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n          Quick Presets\n        </label>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n          {COMMON_PRESETS.map((preset, index) => (\n            <motion.button\n              key={index}\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n              onClick={() => applyPreset(preset)}\n              className=\"text-left p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-600 transition-colors\"\n            >\n              <h3 className=\"font-medium text-gray-900 dark:text-white mb-1\">\n                {preset.name}\n              </h3>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                {preset.description}\n              </p>\n            </motion.button>\n          ))}\n        </div>\n      </div>\n\n      {/* Rules Section */}\n      <div>\n        <div className=\"flex items-center justify-between mb-4\">\n          <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\n            Rules ({rules.length})\n          </label>\n          <Button\n            onClick={addRule}\n            size=\"sm\"\n          >\n            <Plus className=\"w-4 h-4\" />\n            Add Rule\n          </Button>\n        </div>\n\n        {/* Rules List */}\n        <div className=\"space-y-3\">\n          <AnimatePresence>\n            {rules.map((rule, index) => (\n              <div key={index}>\n                {renderRuleInput(rule, index)}\n              </div>\n            ))}\n          </AnimatePresence>\n        </div>\n      </div>\n\n      {/* Actions */}\n      <div className=\"flex items-center justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700\">\n        <Button\n          variant=\"ghost\"\n          onClick={onCancel}\n        >\n          Cancel\n        </Button>\n        <Button\n          onClick={handleSave}\n          className=\"min-w-32\"\n        >\n          <Save className=\"w-4 h-4\" />\n          Save Playlist\n        </Button>\n      </div>\n    </div>\n  );\n};","import React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  ArrowLeft, \n  Save, \n  X, \n  Plus, \n  Trash2, \n  Search,\n  Filter,\n  Shuffle,\n  Play,\n  Music,\n  Film,\n  Image,\n  FileText\n} from 'lucide-react';\n\nimport { PageHeader } from '../components/layout/PageHeader';\nimport { Button } from '../components/ui/Button';\nimport { Input } from '../components/ui/Input';\nimport { Select } from '../components/ui/Select';\nimport { Tabs } from '../components/ui/Tabs';\nimport { PlaylistGrid } from '../components/playlists/PlaylistGrid';\nimport { PlaylistManager } from '../components/playlists/PlaylistManager';\nimport { PlaylistPlayer } from '../components/playlists/PlaylistPlayer';\nimport { PlaylistItemComponent } from '../components/playlists/PlaylistItem';\nimport { SmartPlaylistBuilder } from '../components/playlists/SmartPlaylistBuilder';\nimport { playlistsApi } from '../lib/playlistsApi';\nimport { mediaApi } from '../lib/mediaApi';\nimport { usePlaylists } from '../hooks/usePlaylists';\nimport type { MediaItem } from '../types/media';\nimport { Playlist, PlaylistItem, CreatePlaylistRequest, UpdatePlaylistRequest, flattenPlaylistItem, getMediaIconWithMap, PlaylistCreateRequest } from '../types/playlists';\nimport { toast } from 'react-hot-toast';\n\nconst MEDIA_TYPE_OPTIONS = [\n  { value: 'all', label: 'All Media' },\n  { value: 'music', label: 'Music' },\n  { value: 'video', label: 'Video' },\n  { value: 'image', label: 'Images' },\n  { value: 'document', label: 'Documents' }\n];\n\nconst MEDIA_TYPE_ICONS = {\n  music: Music,\n  video: Film,\n  image: Image,\n  document: FileText,\n};\n\ninterface CreatePlaylistFormData extends Omit<CreatePlaylistRequest, 'items'> {\n  selectedItems: PlaylistItem[];\n}\n\nexport const PlaylistsPage: React.FC = () => {\n  const [activeTab, setActiveTab] = useState<'all' | 'my' | 'public' | 'favorites' | 'smart'>('all');\n  const [isCreating, setIsCreating] = useState(false);\n  const [isEditing, setIsEditing] = useState(false);\n  const [editingPlaylist, setEditingPlaylist] = useState<Playlist | null>(null);\n  const [showPlayer, setShowPlayer] = useState(false);\n  const [selectedPlaylist, setSelectedPlaylist] = useState<Playlist | null>(null);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [filterMediaType, setFilterMediaType] = useState('all');\n\n  // Media item search state\n  const [mediaSearchQuery, setMediaSearchQuery] = useState('');\n  const [mediaSearchResults, setMediaSearchResults] = useState<MediaItem[]>([]);\n  const [isSearchingMedia, setIsSearchingMedia] = useState(false);\n\n  // Form state for creating/editing playlists\n  const [formData, setFormData] = useState<CreatePlaylistFormData>({\n    name: '',\n    description: '',\n    is_public: false,\n    selectedItems: []\n  });\n\n  const {\n    playlists,\n    isLoading,\n    error,\n    refetchPlaylists\n  } = usePlaylists();\n\n  // Filter playlists based on active tab\n  const filteredPlaylists = React.useMemo(() => {\n    let filtered = playlists;\n\n    switch (activeTab) {\n      case 'my':\n        filtered = filtered.filter((p: Playlist) => !p.is_public);\n        break;\n      case 'public':\n        filtered = filtered.filter((p: Playlist) => p.is_public);\n        break;\n      case 'favorites':\n        // This would need favorites integration\n        filtered = filtered.filter(() => false); // Placeholder\n        break;\n    }\n\n    // Apply search filter\n    if (searchQuery) {\n      filtered = filtered.filter((p: Playlist) =>\n        p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        p.description?.toLowerCase().includes(searchQuery.toLowerCase())\n      );\n    }\n\n    // Apply media type filter\n    if (filterMediaType !== 'all') {\n      filtered = filtered.filter((p: Playlist) => p.primary_media_type === filterMediaType);\n    }\n\n    return filtered;\n  }, [playlists, activeTab, searchQuery, filterMediaType]);\n\n  const handleCreatePlaylist = async () => {\n    try {\n      const playlistData: CreatePlaylistRequest = {\n        name: formData.name,\n        description: formData.description,\n        is_public: formData.is_public,\n        items: formData.selectedItems\n      };\n\n      const newPlaylist = await playlistsApi.createPlaylist(playlistData);\n      toast.success(`Created playlist: ${newPlaylist.name}`);\n      setIsCreating(false);\n      resetForm();\n      refetchPlaylists();\n    } catch (error) {\n      console.error('Failed to create playlist:', error);\n      toast.error('Failed to create playlist');\n    }\n  };\n\n  const handleUpdatePlaylist = async () => {\n    if (!editingPlaylist) return;\n\n    try {\n      const updateData: UpdatePlaylistRequest = {\n        name: formData.name,\n        description: formData.description,\n        is_public: formData.is_public\n      };\n\n      const updated = await playlistsApi.updatePlaylist(editingPlaylist.id, updateData);\n      toast.success(`Updated playlist: ${updated.name}`);\n      setIsEditing(false);\n      setEditingPlaylist(null);\n      resetForm();\n      refetchPlaylists();\n    } catch (error) {\n      console.error('Failed to update playlist:', error);\n      toast.error('Failed to update playlist');\n    }\n  };\n\n  const handleDeletePlaylist = async (playlist: Playlist) => {\n    if (!window.confirm(`Are you sure you want to delete \"${playlist.name}\"?`)) {\n      return;\n    }\n\n    try {\n      await playlistsApi.deletePlaylist(playlist.id);\n      toast.success(`Deleted playlist: ${playlist.name}`);\n      refetchPlaylists();\n    } catch (error) {\n      console.error('Failed to delete playlist:', error);\n      toast.error('Failed to delete playlist');\n    }\n  };\n\n  const handleEditPlaylist = (playlist: Playlist) => {\n    setEditingPlaylist(playlist);\n    setFormData({\n      name: playlist.name,\n      description: playlist.description || '',\n      is_public: playlist.is_public,\n      selectedItems: playlist.items || []\n    });\n    setIsEditing(true);\n  };\n\n  const handlePlayPlaylist = async (playlist: Playlist) => {\n    try {\n      const items = await playlistsApi.getPlaylistItems(playlist.id);\n      setSelectedPlaylist({ ...playlist, items: items.items });\n      setShowPlayer(true);\n    } catch (error) {\n      console.error('Failed to load playlist items:', error);\n      toast.error('Failed to load playlist items');\n    }\n  };\n\n  // Media item search function\n  const handleMediaSearch = async () => {\n    if (!mediaSearchQuery.trim()) {\n      setMediaSearchResults([]);\n      return;\n    }\n\n    setIsSearchingMedia(true);\n    try {\n      const response = await mediaApi.searchMedia({\n        query: mediaSearchQuery,\n        limit: 20\n      });\n      setMediaSearchResults(response.items || []);\n    } catch (error) {\n      console.error('Failed to search media:', error);\n      toast.error('Failed to search media items');\n      setMediaSearchResults([]);\n    } finally {\n      setIsSearchingMedia(false);\n    }\n  };\n\n  // Add media item to playlist\n  const handleAddMediaToPlaylist = (media: MediaItem) => {\n    // Check if already added\n    if (formData.selectedItems.some(item => item.media_id === media.id)) {\n      toast.error('This item is already in the playlist');\n      return;\n    }\n\n    const newItem: PlaylistItem = {\n      id: `temp-${Date.now()}`,\n      playlist_id: editingPlaylist?.id || '',\n      media_id: media.id,\n      position: formData.selectedItems.length,\n      added_at: new Date().toISOString(),\n      media_item: {\n        id: media.id,\n        title: media.title,\n        media_type: media.media_type,\n        year: media.year,\n        cover_image: media.cover_image,\n        duration: media.duration,\n        rating: media.rating,\n        quality: media.quality,\n        file_path: media.directory_path,\n        thumbnail_url: media.cover_image\n      }\n    };\n\n    setFormData(prev => ({\n      ...prev,\n      selectedItems: [...prev.selectedItems, newItem]\n    }));\n    toast.success(`Added \"${media.title}\" to playlist`);\n  };\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      description: '',\n      is_public: false,\n      selectedItems: []\n    });\n    setMediaSearchQuery('');\n    setMediaSearchResults([]);\n  };\n\n  const handleFormChange = (field: keyof CreatePlaylistFormData, value: any) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const renderCreateEditForm = () => {\n    const isEditMode = isEditing && editingPlaylist;\n    const title = isEditMode ? 'Edit Playlist' : 'Create New Playlist';\n\n    return (\n      <motion.div\n        initial={{ opacity: 0, scale: 0.95 }}\n        animate={{ opacity: 1, scale: 1 }}\n        exit={{ opacity: 0, scale: 0.95 }}\n        className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\"\n      >\n        <motion.div\n          initial={{ y: 20 }}\n          animate={{ y: 0 }}\n          className=\"bg-white dark:bg-gray-900 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\"\n        >\n          <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">\n                {title}\n              </h2>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => {\n                  setIsCreating(false);\n                  setIsEditing(false);\n                  setEditingPlaylist(null);\n                  resetForm();\n                }}\n              >\n                <X className=\"w-4 h-4\" />\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"p-6 space-y-6\">\n            {/* Basic Info */}\n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Playlist Name *\n                </label>\n                <Input\n                  value={formData.name}\n                  onChange={(e) => handleFormChange('name', e.target.value)}\n                  placeholder=\"Enter playlist name\"\n                  className=\"w-full\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                  Description\n                </label>\n                <textarea\n                  value={formData.description}\n                  onChange={(e) => handleFormChange('description', e.target.value)}\n                  placeholder=\"Enter playlist description (optional)\"\n                  rows={3}\n                  className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-white\"\n                />\n              </div>\n\n              <div className=\"flex items-center\">\n                <input\n                  type=\"checkbox\"\n                  id=\"is_public\"\n                  checked={formData.is_public}\n                  onChange={(e) => handleFormChange('is_public', e.target.checked)}\n                  className=\"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\n                />\n                <label htmlFor=\"is_public\" className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">\n                  Make this playlist public\n                </label>\n              </div>\n            </div>\n\n            {/* Selected Items */}\n            {formData.selectedItems.length > 0 && (\n              <div>\n                <div className=\"flex items-center justify-between mb-3\">\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\n                    Selected Items ({formData.selectedItems.length})\n                  </label>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => handleFormChange('selectedItems', [])}\n                    className=\"text-red-600 hover:text-red-700\"\n                  >\n                    Clear All\n                  </Button>\n                </div>\n                <div className=\"max-h-48 overflow-y-auto space-y-2 border border-gray-200 dark:border-gray-700 rounded-lg p-3\">\n                  {formData.selectedItems.map((item, index) => {\n                    const flattenedItem = flattenPlaylistItem(item);\n                    const Icon = getMediaIconWithMap(flattenedItem.media_type);\n                    return (\n                      <div key={`${flattenedItem.item_id}-${index}`} className=\"flex items-center gap-3 p-2 bg-gray-50 dark:bg-gray-800 rounded\">\n                        <Icon className=\"w-4 h-4 text-gray-600 dark:text-gray-400\" />\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm font-medium text-gray-900 dark:text-white truncate\">\n                            {flattenedItem.title}\n                          </p>\n                          {flattenedItem.artist && (\n                            <p className=\"text-xs text-gray-600 dark:text-gray-400 truncate\">\n                              {flattenedItem.artist}\n                            </p>\n                          )}\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => {\n                            const newItems = formData.selectedItems.filter((_, i) => i !== index);\n                            handleFormChange('selectedItems', newItems);\n                          }}\n                          className=\"text-red-600 hover:text-red-700\"\n                        >\n                          <Trash2 className=\"w-3 h-3\" />\n                        </Button>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n\n            {/* Item Search/Selection */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Add Items to Playlist\n              </label>\n              <div className=\"flex gap-2\">\n                <Input\n                  placeholder=\"Search media items...\"\n                  className=\"flex-1\"\n                  value={mediaSearchQuery}\n                  onChange={(e) => setMediaSearchQuery(e.target.value)}\n                  onKeyDown={(e) => e.key === 'Enter' && handleMediaSearch()}\n                />\n                <Button\n                  variant=\"outline\"\n                  onClick={handleMediaSearch}\n                  disabled={isSearchingMedia}\n                >\n                  <Search className=\"w-4 h-4\" />\n                </Button>\n              </div>\n\n              {/* Search Results */}\n              {mediaSearchResults.length > 0 && (\n                <div className=\"mt-3 max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg\">\n                  {mediaSearchResults.map((media) => {\n                    const isAdded = formData.selectedItems.some(item => item.media_id === media.id);\n                    const MediaIcon = MEDIA_TYPE_ICONS[media.media_type as keyof typeof MEDIA_TYPE_ICONS] || FileText;\n                    return (\n                      <div\n                        key={media.id}\n                        className={`flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-800 border-b border-gray-100 dark:border-gray-700 last:border-b-0 ${\n                          isAdded ? 'bg-green-50 dark:bg-green-900/20' : ''\n                        }`}\n                      >\n                        <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n                          <MediaIcon className=\"w-4 h-4 text-gray-500 flex-shrink-0\" />\n                          <div className=\"min-w-0\">\n                            <div className=\"text-sm font-medium truncate\">{media.title}</div>\n                            <div className=\"text-xs text-gray-500\">\n                              {media.media_type} {media.year && ` ${media.year}`}\n                            </div>\n                          </div>\n                        </div>\n                        <Button\n                          size=\"sm\"\n                          variant={isAdded ? 'ghost' : 'outline'}\n                          onClick={() => handleAddMediaToPlaylist(media)}\n                          disabled={isAdded}\n                          className=\"flex-shrink-0 ml-2\"\n                        >\n                          {isAdded ? ' Added' : <Plus className=\"w-4 h-4\" />}\n                        </Button>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n\n              {isSearchingMedia && (\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\n                  Searching...\n                </p>\n              )}\n\n              {mediaSearchQuery && !isSearchingMedia && mediaSearchResults.length === 0 && (\n                <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-2\">\n                  No results found. Try a different search term.\n                </p>\n              )}\n            </div>\n          </div>\n\n          <div className=\"p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsCreating(false);\n                setIsEditing(false);\n                setEditingPlaylist(null);\n                resetForm();\n              }}\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={isEditMode ? handleUpdatePlaylist : handleCreatePlaylist}\n              disabled={!formData.name.trim()}\n              className=\"flex items-center gap-2\"\n            >\n              <Save className=\"w-4 h-4\" />\n              {isEditMode ? 'Update' : 'Create'} Playlist\n            </Button>\n          </div>\n        </motion.div>\n      </motion.div>\n    );\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <PageHeader\n        title=\"Playlists\"\n        subtitle=\"Organize and manage your media collections\"\n        breadcrumbs={[\n          { label: 'Home', href: '/' },\n          { label: 'Playlists' }\n        ]}\n      />\n\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Tabs */}\n        <Tabs\n          tabs={[\n            { id: 'all', label: 'All Playlists' },\n            { id: 'my', label: 'My Playlists' },\n            { id: 'public', label: 'Public' },\n            { id: 'favorites', label: 'Favorites' },\n            { id: 'smart', label: 'Smart Builder' }\n          ]}\n          activeTab={activeTab}\n          onChangeTab={(tab) => setActiveTab(tab as any)}\n        />\n\n        {/* Filters and Controls */}\n        <div className=\"mt-6 flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between\">\n          <div className=\"flex flex-col sm:flex-row gap-4 flex-1\">\n            {/* Search */}\n            <div className=\"relative max-w-md\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\n              <Input\n                placeholder=\"Search playlists...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10\"\n              />\n            </div>\n\n            {/* Media Type Filter */}\n            <Select\n              value={filterMediaType}\n              onChange={setFilterMediaType}\n              options={MEDIA_TYPE_OPTIONS}\n              className=\"w-40\"\n            />\n          </div>\n\n          {/* Actions */}\n          <Button\n            onClick={() => setIsCreating(true)}\n            className=\"flex items-center gap-2\"\n          >\n            <Plus className=\"w-4 h-4\" />\n            Create Playlist\n          </Button>\n        </div>\n\n        {/* Playlists Grid */}\n        <div className=\"mt-8\">\n          {activeTab === 'smart' ? (\n            <SmartPlaylistBuilder\n              onSave={(name, description, rules) => {\n                // Convert smart playlist rules to actual playlist data\n                const playlistData: PlaylistCreateRequest = {\n                  name,\n                  description,\n                  is_public: false,\n                  is_smart: true,\n                  smart_rules: rules,\n                  items: [] // Will be populated based on rules by backend\n                };\n                \n                playlistsApi.createPlaylist(playlistData)\n                  .then((newPlaylist) => {\n                    toast.success(`Created smart playlist: ${newPlaylist.name}`);\n                    setActiveTab('my'); // Switch to My Playlists to see the result\n                    refetchPlaylists();\n                  })\n                  .catch((error) => {\n                    console.error('Failed to create smart playlist:', error);\n                    toast.error('Failed to create smart playlist');\n                  });\n              }}\n              onCancel={() => setActiveTab('all')}\n              className=\"w-full\"\n            />\n          ) : (\n            <PlaylistGrid\n              onCreatePlaylist={() => setIsCreating(true)}\n              onEditPlaylist={handleEditPlaylist}\n            />\n          )}\n        </div>\n\n        {/* Create/Edit Modal */}\n        <AnimatePresence>\n          {(isCreating || isEditing) && renderCreateEditForm()}\n        </AnimatePresence>\n\n        {/* Player Modal */}\n        <AnimatePresence>\n          {showPlayer && selectedPlaylist && (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\"\n              onClick={() => setShowPlayer(false)}\n            >\n              <motion.div\n                initial={{ opacity: 0, scale: 0.95 }}\n                animate={{ opacity: 1, scale: 1 }}\n                exit={{ opacity: 0, scale: 0.95 }}\n                transition={{ duration: 0.2 }}\n                className=\"bg-white dark:bg-gray-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto\"\n                onClick={(e) => e.stopPropagation()}\n              >\n                <PlaylistPlayer\n                  playlist={selectedPlaylist}\n                  items={selectedPlaylist.items || []}\n                  onClose={() => setShowPlayer(false)}\n                />\n              </motion.div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </div>\n  );\n};"],"names":["flattenPlaylistItem","item","media_item","rest","getMediaIconName","mediaType","getMediaIconWithMap","iconName","Music","Video","Image","FileText","playlistsApi","params","searchParams","api","playlistId","request","mediaIds","itemId","itemOrders","permissions","shareToken","newName","format","itemIds","file","name","formData","rules","playlistApi","PlaylistAnalytics","analytics","className","formatNumber","num","formatDate","dateString","jsxs","jsx","motion","Card","Play","Users","TrendingUp","index","stat","Calendar","PlaylistPlayer","playlist","items","initialIndex","onClose","onShuffle","onRepeat","currentIndex","setCurrentIndex","useState","isPlaying","setIsPlaying","isShuffled","setIsShuffled","isRepeating","setIsRepeating","volume","setVolume","isMuted","setIsMuted","showPlaylist","setShowPlaylist","isFullscreen","setIsFullscreen","showControls","setShowControls","showAnalytics","setShowAnalytics","setAnalytics","repeatMode","setRepeatMode","currentItem","flattenedCurrentItem","progress","React","timer","handlePrevious","handleNext","handleItemClick","handleShuffle","handleRepeat","nextMode","handleVolumeChange","newVolume","handleMuteToggle","handleFullscreen","formatDuration","seconds","minutes","secs","formatTimeRemaining","totalDuration","sum","renderNowPlaying","Icon","Button","Pause","FavoriteToggle","MoreHorizontal","renderControls","Shuffle","SkipBack","SkipForward","Repeat","renderVolumeControls","Volume2","e","renderProgressBar","renderPlaylist","ChevronRight","ChevronLeft","flattenedItem","isCurrentItem","GripVertical","renderMediaContent","MediaPlayer","handleShare","shareInfo","toast","error","handleShowAnalytics","analyticsData","Fragment","List","Share","BarChart3","Maximize2","X","usePlaylists","queryClient","useQueryClient","playlistsData","isLoadingPlaylists","playlistsError","refetchPlaylists","useQuery","createPlaylistMutation","useMutation","_b","_a","updatePlaylistMutation","id","deletePlaylistMutation","_","addItemsMutation","data","variables","removeItemMutation","reorderItemsMutation","createPlaylist","updatePlaylist","deletePlaylist","addItemsToPlaylist","removeFromPlaylist","reorderPlaylistItems","PlaylistGrid","onCreatePlaylist","onEditPlaylist","searchQuery","setSearchQuery","viewMode","setViewMode","sortBy","setSortBy","filterMediaType","setFilterMediaType","filterVisibility","setFilterVisibility","selectedPlaylist","setSelectedPlaylist","selectedItems","setSelectedItems","showPlayer","setShowPlayer","showDropdown","setShowDropdown","playlists","isLoading","checkFavoriteStatus","useFavorites","filteredAndSortedPlaylists","filtered","a","b","handlePlaylistAction","action","_items","_shuffleItems","duplicateName","duplicate","updated","exportData","blob","url","handleSelectPlaylist","isSelected","newSelection","handleSelectAll","p","handleBulkAction","hours","getMediaTypes","types","renderPlaylistCard","mediaTypes","isDropdownOpen","type","TypeIcon","Heart","Edit3","AnimatePresence","Copy","Download","Share2","ExternalLink","Trash2","Grid","Clock","Plus","Search","Input","Select","value","FIELD_OPTIONS","Star","Filter","Tag","OPERATOR_OPTIONS","MEDIA_TYPE_OPTIONS","Film","QUALITY_OPTIONS","GENRE_OPTIONS","COMMON_PRESETS","SmartPlaylistBuilder","onSave","onCancel","initialData","setName","description","setDescription","setRules","expandedRules","setExpandedRules","showAdvanced","setShowAdvanced","addRule","newRule","removeRule","i","updateRule","updates","rule","moveRule","direction","newIndex","newRules","toggleRuleExpanded","prev","newSet","applyPreset","preset","validateRules","handleSave","renderRuleInput","fieldInfo","f","operatorInfo","isExpanded","renderValueInput","option","genre","ChevronUp","ChevronDown","HelpCircle","Save","MEDIA_TYPE_ICONS","PlaylistsPage","activeTab","setActiveTab","isCreating","setIsCreating","isEditing","setIsEditing","editingPlaylist","setEditingPlaylist","mediaSearchQuery","setMediaSearchQuery","mediaSearchResults","setMediaSearchResults","isSearchingMedia","setIsSearchingMedia","setFormData","handleCreatePlaylist","playlistData","newPlaylist","resetForm","handleUpdatePlaylist","updateData","handleEditPlaylist","handleMediaSearch","response","mediaApi","handleAddMediaToPlaylist","media","newItem","handleFormChange","field","renderCreateEditForm","isEditMode","title","newItems","isAdded","MediaIcon","PageHeader","Tabs","tab"],"mappings":"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"}