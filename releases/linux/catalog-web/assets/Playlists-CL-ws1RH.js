import{b as F,j as e,B as x,n as P,c as Ke,a as He,e as te,z as B}from"./index-BzqIBI_1.js";import{r as h,R as ye}from"./router-CYAiCCsK.js";import{P as Ge}from"./PageHeader-1sRnzjfp.js";import{I as H}from"./Input-DQaGiHGP.js";import{S as G,T as Ye}from"./Tabs-VczWTLgE.js";import{Y as re,a7 as ge,aK as Je,V as X,m as z,q as le,i as We,T as Ze,t as Ie,J as $e,aF as Xe,aj as ea,aL as aa,X as ce,aa as xe,aM as Me,aN as sa,aO as ta,aP as la,ab as ra,ac as Fe,N as ia,K as na,aQ as ca,A as Z,a6 as oe,o as Ne,w as ue,S as he,G as we,aR as ke,H as oa,a9 as da,ad as ma,aq as xa,C as Te,r as ze,a8 as Ae,u as ua,ae as ha,a2 as _e,a3 as Se,aS as ya,v as Re}from"./ui-DhyrEzjX.js";import{M as ga}from"./MediaPlayer-DrQ3sVTP.js";import{F as pa,u as va}from"./FavoriteToggle-C1Ak6xgo.js";import{C as ne}from"./Card-pVNkGvZm.js";import{m as ja}from"./mediaApi-7GevB2yo.js";import"./charts-BaIhTcLh.js";import"./utils-B26ZFImD.js";const me=t=>{const{media_item:s,...m}=t;return{...m,media_item:s,item_id:s.id.toString(),title:s.title,media_type:s.media_type,artist:s.artist,album:s.album,description:s.description,duration:s.duration,quality:s.quality,rating:s.rating,thumbnail_url:s.thumbnail_url,file_path:s.file_path,file_size:s.file_size}},fa=t=>{switch(t.toLowerCase()){case"video":return"video";case"audio":case"music":return"music";case"image":return"image";default:return"document"}},de=t=>{const s=fa(t);return{music:X,video:Je,image:ge,document:re}[s]||re},V={async getPlaylists(t){const s=new URLSearchParams;return t!=null&&t.limit&&s.append("limit",t.limit.toString()),t!=null&&t.offset&&s.append("offset",t.offset.toString()),(t==null?void 0:t.include_smart)!==void 0&&s.append("include_smart",t.include_smart.toString()),t!=null&&t.type&&s.append("type",t.type),(await F.get(`/api/v1/playlists?${s}`)).data},async getPlaylist(t){return(await F.get(`/api/v1/playlists/${t}`)).data},async getPlaylistItems(t,s){const m=new URLSearchParams;return s!=null&&s.limit&&m.append("limit",s.limit.toString()),s!=null&&s.offset&&m.append("offset",s.offset.toString()),s!=null&&s.sort_by&&m.append("sort_by",s.sort_by),s!=null&&s.sort_order&&m.append("sort_order",s.sort_order),(await F.get(`/api/v1/playlists/${t}/items?${m}`)).data},async createPlaylist(t){return(await F.post("/api/v1/playlists",t)).data},async updatePlaylist(t,s){return(await F.put(`/api/v1/playlists/${t}`,s)).data},async deletePlaylist(t){await F.delete(`/api/v1/playlists/${t}`)},async addItemsToPlaylist(t,s){return(await F.post(`/api/v1/playlists/${t}/items`,{media_ids:s})).data},async removeFromPlaylist(t,s){await F.delete(`/api/v1/playlists/${t}/items/${s}`)},async reorderPlaylistItems(t,s){await F.put(`/api/v1/playlists/${t}/items/reorder`,{items:s})},async sharePlaylist(t,s){return(await F.post(`/api/v1/playlists/${t}/share`,s)).data},async getSharedPlaylist(t){return(await F.get(`/api/v1/playlists/shared/${t}`)).data},async unsharePlaylist(t){await F.delete(`/api/v1/playlists/${t}/share`)},async getPlaylistAnalytics(t){return(await F.get(`/api/v1/playlists/${t}/analytics`)).data},async duplicatePlaylist(t,s){return(await F.post(`/api/v1/playlists/${t}/duplicate`,{name:s})).data},async exportPlaylist(t,s="json"){return(await F.get(`/api/v1/playlists/${t}/export?format=${s}`,{responseType:"blob"})).data},async playPlaylist(t){await F.post(`/api/v1/playlists/${t}/play`)},async shufflePlaylist(t){await F.post(`/api/v1/playlists/${t}/shuffle`)},async reorderPlaylist(t,s){await F.put(`/api/v1/playlists/${t}/reorder`,{itemIds:s})},async importPlaylist(t,s){const m=new FormData;return m.append("file",t),s&&m.append("name",s),(await F.post("/api/v1/playlists/import",m,{headers:{"Content-Type":"multipart/form-data"}})).data},async validateSmartRules(t){return(await F.post("/api/v1/playlists/validate-smart-rules",{rules:t})).data}},Y=V,ba=({analytics:t,className:s=""})=>{const m=p=>p>=1e6?(p/1e6).toFixed(1)+"M":p>=1e3?(p/1e3).toFixed(1)+"K":p.toString(),k=p=>new Date(p).toLocaleDateString();return e.jsxs("div",{className:`space-y-6 ${s}`,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(ne,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(le,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Plays"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:m(t.total_plays)})]})]})})}),e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(ne,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(We,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Unique Viewers"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:m(t.unique_viewers)})]})]})})}),e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(ne,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx(Ze,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completion Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[Math.round(t.average_completion_rate),"%"]})]})]})})})]}),t.popular_items&&t.popular_items.length>0&&e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:e.jsxs(ne,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Popular Items"}),e.jsx("div",{className:"space-y-3",children:t.popular_items.slice(0,5).map((p,C)=>e.jsx("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:p.title}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[m(p.play_count)," plays"]})]})},C))})]})}),t.viewing_stats&&t.viewing_stats.length>0&&e.jsx(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},children:e.jsxs(ne,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Viewing Trends"}),e.jsx("div",{className:"space-y-3",children:t.viewing_stats.slice(0,7).map((p,C)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ie,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),e.jsx("span",{className:"text-gray-900 dark:text-white",children:k(p.date)})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Plays"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:m(p.plays)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Viewers"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:m(p.viewers)})]})]})]},C))})]})})]})},De=({playlist:t,items:s,initialIndex:m=0,onClose:k,onShuffle:p,onRepeat:C,className:A=""})=>{const[f,b]=h.useState(m),[v,R]=h.useState(!1),[T,D]=h.useState(!1),[L,Q]=h.useState(!1),[M,w]=h.useState(.8),[U,i]=h.useState(!1),[c,j]=h.useState(!1),[q,S]=h.useState(!1),[r,d]=h.useState(!0),[N,I]=h.useState(!1),[E,J]=h.useState(null),[o,ee]=h.useState("off"),O=s[f],u=O?me(O):null,ie=s.length>0?(f+1)/s.length*100:0;ye.useEffect(()=>{if(v&&(u==null?void 0:u.media_type)==="video"&&!q){const g=setTimeout(()=>d(!1),3e3);return()=>clearTimeout(g)}},[v,u==null?void 0:u.media_type,q]);const a=()=>{f>0?b(f-1):L&&b(s.length-1)},n=()=>{f<s.length-1?b(f+1):L?b(0):R(!1)},l=g=>{b(g),R(!0)},_=()=>{D(!T),p==null||p()},$=()=>{const g=o==="off"?"all":o==="all"?"one":"off";ee(g),Q(g!=="off"),C==null||C()},y=g=>{w(g),i(g===0)},W=()=>{U?(w(.8),i(!1)):(w(0),i(!0))},pe=()=>{S(!q)},ae=g=>{const se=Math.floor(g/60),K=Math.floor(g%60);return`${se}:${K.toString().padStart(2,"0")}`},Le=()=>{s.length-f-1;const g=s.slice(f+1).reduce((se,K)=>se+(me(K).duration||0),0);return ae(g)},qe=()=>{if(!O||!u)return null;const g=de(u.media_type);return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx(g,{className:"w-12 h-12 text-white/80"})}),e.jsx(x,{size:"sm",className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity m-auto",onClick:()=>R(!v),children:v?e.jsx(xe,{className:"w-6 h-6"}):e.jsx(le,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-white truncate",children:u.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 truncate",children:u.artist||u.description||"Unknown"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400 mt-1",children:[e.jsxs("span",{children:[f+1," of ",s.length]}),u.duration&&e.jsx("span",{children:ae(u.duration)}),e.jsxs("span",{children:[Le()," remaining"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pa,{mediaId:parseInt(u.item_id),size:"sm"}),e.jsx(x,{variant:"ghost",size:"sm",children:e.jsx(Fe,{className:"w-4 h-4"})})]})]})},ve=()=>e.jsxs("div",{className:"flex items-center justify-center gap-4 p-4",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:_,className:T?"text-blue-600 dark:text-blue-400":"",children:e.jsx(Me,{className:"w-5 h-5"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:a,disabled:f===0&&!L,children:e.jsx(sa,{className:"w-5 h-5"})}),e.jsx(x,{size:"lg",onClick:()=>R(!v),className:"w-14 h-14 rounded-full",children:v?e.jsx(xe,{className:"w-6 h-6"}):e.jsx(le,{className:"w-6 h-6"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:n,disabled:f===s.length-1&&!L,children:e.jsx(ta,{className:"w-5 h-5"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:$,className:o!=="off"?"text-blue-600 dark:text-blue-400":"",children:e.jsx(la,{className:`w-5 h-5 ${o==="one"?"scale-x-[-1]":""}`})})]}),je=()=>e.jsxs("div",{className:"flex items-center gap-2 px-4",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:W,children:e.jsx(ra,{className:`w-5 h-5 ${U?"text-gray-400":""}`})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:U?0:M,onChange:g=>y(parseFloat(g.target.value)),className:"w-24 h-1 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer slider"})]}),fe=()=>e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-1 bg-gray-200 dark:bg-gray-700 rounded-full",children:e.jsx("div",{className:"h-full bg-blue-600 dark:bg-blue-500 rounded-full transition-all duration-300",style:{width:`${ie}%`}})}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:f+1}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.length})]})]})}),Oe=()=>e.jsx("div",{className:`border-t border-gray-200 dark:border-gray-700 ${c?"h-64":"h-0"} transition-all duration-300 overflow-hidden`,children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:t.name}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>j(!c),children:c?e.jsx(ia,{className:"w-4 h-4"}):e.jsx(na,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:s.map((g,se)=>{const K=me(g),Be=de(K.media_type),be=se===f;return e.jsxs(z.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:`flex items-center gap-3 p-2 rounded-lg cursor-pointer transition-colors ${be?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"hover:bg-gray-100 dark:hover:bg-gray-800"}`,onClick:()=>l(se),children:[e.jsx(ca,{className:"w-4 h-4 text-gray-400"}),e.jsx(Be,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate text-gray-900 dark:text-white",children:K.title}),K.artist&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:K.artist})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:ae(K.duration||0)}),be&&v&&e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"})]},K.item_id)})})]})}),Qe=()=>!O||!u?null:u.media_type==="video"?e.jsxs("div",{className:"relative",children:[e.jsx(ga,{media:{id:parseInt(u.item_id),title:u.title,media_type:"video",directory_path:u.file_path||"",created_at:O.added_at,updated_at:O.added_at,cover_image:u.thumbnail_url,duration:u.duration},onEnded:n}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-40",children:e.jsx(x,{size:"lg",onClick:()=>R(!v),className:"rounded-full w-16 h-16",children:v?e.jsx(xe,{className:"w-6 h-6"}):e.jsx(le,{className:"w-6 h-6"})})})]}):u.media_type==="image"?e.jsx("div",{className:"flex items-center justify-center bg-gray-100 dark:bg-gray-800 h-64",children:e.jsx("img",{src:u.thumbnail_url||u.file_path||"",alt:u.title,className:"max-w-full max-h-full object-contain",onError:g=>{g.currentTarget.src="/placeholder-image.png"}})}):u.media_type==="music"?e.jsxs("div",{className:"flex flex-col items-center justify-center bg-gray-100 dark:bg-gray-800 h-64",children:[e.jsx(X,{className:"w-24 h-24 text-gray-400 mb-4"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:u.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:u.artist||"Unknown Artist"}),u.duration&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:ae(u.duration)})]})]}):e.jsx("div",{className:"flex items-center justify-center bg-gray-100 dark:bg-gray-800 h-64",children:e.jsx(re,{className:"w-24 h-24 text-gray-400"})});if(!s.length)return e.jsx("div",{className:"flex items-center justify-center h-64 text-center",children:e.jsxs("div",{children:[e.jsx(X,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No items in playlist"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Add some media to start playing"})]})});const Ue=async()=>{try{const g=await V.sharePlaylist(t.id,{can_view:!0,can_comment:!1,can_download:!1});await navigator.clipboard.writeText(g.share_url),P.success("Share link copied to clipboard!")}catch(g){console.error("Failed to share playlist:",g),P.error("Failed to create share link")}},Ve=async()=>{try{const g=await V.getPlaylistAnalytics(t.id);J(g),I(!0)}catch(g){console.error("Failed to load analytics:",g),P.error("Failed to load playlist analytics")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`bg-white dark:bg-gray-900 rounded-lg shadow-lg ${A}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[s.length," items"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>j(!c),children:e.jsx($e,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:Ue,title:"Share playlist",children:e.jsx(Xe,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:Ve,title:"View analytics",children:e.jsx(ea,{className:"w-4 h-4"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:pe,children:e.jsx(aa,{className:"w-4 h-4"})}),k&&e.jsx(x,{variant:"ghost",size:"sm",onClick:k,children:e.jsx(ce,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"relative",children:[Qe(),(u==null?void 0:u.media_type)==="video"&&r&&e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex flex-col justify-between",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[e.jsx("div",{className:"p-4"}),e.jsxs("div",{className:"p-4",children:[ve(),fe(),je()]})]})]}),(u==null?void 0:u.media_type)!=="video"&&e.jsxs(e.Fragment,{children:[qe(),fe(),ve(),je()]}),Oe()]}),N&&E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Playlist Analytics - ",t.name]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>I(!1),children:e.jsx(ce,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(ba,{analytics:E})})]})})]})},Ee=t=>{const s=Ke(),{data:m,isLoading:k,error:p,refetch:C}=He({queryKey:["playlists",t],queryFn:()=>V.getPlaylists(t),staleTime:1e3*60*5,cacheTime:1e3*60*10}),A=te({mutationFn:i=>V.createPlaylist(i),onSuccess:i=>(B.success(`Playlist "${i.name}" created successfully`),s.invalidateQueries({queryKey:["playlists"]}),i),onError:i=>{var c,j;B.error(((j=(c=i.response)==null?void 0:c.data)==null?void 0:j.message)||"Failed to create playlist")}}),f=te({mutationFn:({id:i,request:c})=>V.updatePlaylist(i,c),onSuccess:i=>{B.success(`Playlist "${i.name}" updated successfully`),s.invalidateQueries({queryKey:["playlists"]}),s.invalidateQueries({queryKey:["playlist",i.id]})},onError:i=>{var c,j;B.error(((j=(c=i.response)==null?void 0:c.data)==null?void 0:j.message)||"Failed to update playlist")}}),b=te({mutationFn:V.deletePlaylist,onSuccess:(i,c)=>{B.success("Playlist deleted successfully"),s.invalidateQueries({queryKey:["playlists"]}),s.removeQueries({queryKey:["playlist",c]})},onError:i=>{var c,j;B.error(((j=(c=i.response)==null?void 0:c.data)==null?void 0:j.message)||"Failed to delete playlist")}}),v=te({mutationFn:({playlistId:i,mediaIds:c})=>V.addItemsToPlaylist(i,c),onSuccess:(i,c)=>{B.success(`Added ${i.added} items to playlist`),s.invalidateQueries({queryKey:["playlist-items",c.playlistId]}),s.invalidateQueries({queryKey:["playlists"]})},onError:i=>{var c,j;B.error(((j=(c=i.response)==null?void 0:c.data)==null?void 0:j.message)||"Failed to add items to playlist")}}),R=te({mutationFn:({playlistId:i,itemId:c})=>V.removeFromPlaylist(i,c),onSuccess:(i,c)=>{B.success("Item removed from playlist"),s.invalidateQueries({queryKey:["playlist-items",c.playlistId]}),s.invalidateQueries({queryKey:["playlists"]})},onError:i=>{var c,j;B.error(((j=(c=i.response)==null?void 0:c.data)==null?void 0:j.message)||"Failed to remove item from playlist")}}),T=te({mutationFn:({playlistId:i,itemOrders:c})=>V.reorderPlaylistItems(i,c),onSuccess:(i,c)=>{s.invalidateQueries({queryKey:["playlist-items",c.playlistId]})},onError:i=>{var c,j;B.error(((j=(c=i.response)==null?void 0:c.data)==null?void 0:j.message)||"Failed to reorder playlist")}}),D=i=>A.mutateAsync(i),L=(i,c)=>{f.mutate({id:i,request:c})},Q=i=>{window.confirm("Are you sure you want to delete this playlist? This action cannot be undone.")&&b.mutate(i)},M=(i,c)=>{v.mutate({playlistId:i,mediaIds:c})},w=(i,c)=>{R.mutate({playlistId:i,itemId:c})},U=(i,c)=>{T.mutate({playlistId:i,itemOrders:c})};return{playlists:(m==null?void 0:m.playlists)||[],total:(m==null?void 0:m.total)||0,isLoading:k,error:p,refetchPlaylists:C,createPlaylist:D,updatePlaylist:L,deletePlaylist:Q,addItemsToPlaylist:M,removeFromPlaylist:w,reorderPlaylistItems:U,isCreating:A.isLoading,isUpdating:f.isLoading,isDeleting:b.isLoading,isAddingItems:v.isLoading}},Na=({onCreatePlaylist:t,onEditPlaylist:s,className:m=""})=>{const[k,p]=h.useState(""),[C,A]=h.useState("grid"),[f,b]=h.useState("name"),[v,R]=h.useState("all"),[T,D]=h.useState("all"),[L,Q]=h.useState(null),[M,w]=h.useState(new Set),[U,i]=h.useState(!1),[c,j]=h.useState(null),{playlists:q=[],isLoading:S,error:r,refetchPlaylists:d}=Ee(),{checkFavoriteStatus:N}=va(),I=ye.useMemo(()=>{let a=q;return k&&(a=a.filter(n=>{var l;return n.name.toLowerCase().includes(k.toLowerCase())||((l=n.description)==null?void 0:l.toLowerCase().includes(k.toLowerCase()))})),v!=="all"&&(a=a.filter(n=>n.primary_media_type===v)),T!=="all"&&(a=a.filter(n=>T==="public"?n.is_public:!n.is_public)),a.sort((n,l)=>{switch(f){case"name":return n.name.localeCompare(l.name);case"created_at":return new Date(l.created_at).getTime()-new Date(n.created_at).getTime();case"updated_at":return new Date(l.updated_at).getTime()-new Date(n.updated_at).getTime();case"duration":return(l.total_duration||0)-(n.total_duration||0);case"item_count":return l.item_count-n.item_count;case"name_desc":return l.name.localeCompare(n.name);default:return 0}})},[q,k,f,v,T]),E=async(a,n)=>{try{switch(n){case"play":{const l=await Y.getPlaylistItems(a.id);Q(a),i(!0),P.success(`Playing ${a.name}`);break}case"shuffle":{const l=await Y.getPlaylistItems(a.id);await Y.shufflePlaylist(a.id),Q(a),i(!0),P.success(`Shuffling ${a.name}`);break}case"duplicate":{const l=`${a.name} (Copy)`,_=await Y.createPlaylist({name:l,description:a.description,is_public:a.is_public,items:a.items||[]});P.success(`Playlist duplicated as ${_.name}`),d();break}case"toggle_public":{const l=await Y.updatePlaylist(a.id,{is_public:!a.is_public});P.success(`Playlist is now ${l.is_public?"public":"private"}`),d();break}case"export":{const l=await Y.exportPlaylist(a.id),_=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),$=URL.createObjectURL(_),y=document.createElement("a");y.href=$,y.download=`${a.name.replace(/[^a-z0-9]/gi,"_")}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL($),P.success(`Exported ${a.name}`);break}case"share":navigator.share?await navigator.share({title:a.name,text:a.description||`Check out this playlist: ${a.name}`,url:window.location.origin+`/playlists/${a.id}`}):(await navigator.clipboard.writeText(window.location.origin+`/playlists/${a.id}`),P.success("Playlist link copied to clipboard"));break;case"delete":window.confirm(`Are you sure you want to delete "${a.name}"?`)&&(await Y.deletePlaylist(a.id),P.success(`Deleted ${a.name}`),d());break}}catch(l){console.error(`Failed to ${n} playlist:`,l),P.error(`Failed to ${n} playlist`)}finally{j(null)}},J=(a,n)=>{const l=new Set(M);n?l.add(a.id):l.delete(a.id),w(l)},o=()=>{M.size===I.length?w(new Set):w(new Set(I.map(a=>a.id)))},ee=async a=>{try{switch(a){case"delete":window.confirm(`Are you sure you want to delete ${M.size} playlists?`)&&(await Promise.all(Array.from(M).map(n=>Y.deletePlaylist(n))),P.success(`Deleted ${M.size} playlists`),w(new Set),d());break;case"export":{const l={playlists:q.filter(W=>M.has(W.id)),exported_at:new Date().toISOString(),version:"1.0"},_=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),$=URL.createObjectURL(_),y=document.createElement("a");y.href=$,y.download=`playlists_export_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL($),P.success(`Exported ${M.size} playlists`);break}}}catch(n){console.error(`Failed to ${a} playlists:`,n),P.error(`Failed to ${a} playlists`)}},O=a=>{const n=Math.floor(a/3600),l=Math.floor(a%3600/60),_=Math.floor(a%60);return n>0?`${n}:${l.toString().padStart(2,"0")}:${_.toString().padStart(2,"0")}`:`${l}:${_.toString().padStart(2,"0")}`},u=a=>{var l;const n=new Set((l=a.items)==null?void 0:l.map(_=>_.media_item.media_type));return Array.from(n)},ie=a=>{const n=de(a.primary_media_type||""),l=u(a),_=c===a.id,$=M.has(a.id);return e.jsxs(z.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},whileHover:{y:-4},className:`group relative bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-md transition-all duration-200 border ${$?"border-blue-500 dark:border-blue-400":"border-gray-200 dark:border-gray-700"}`,children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsx("input",{type:"checkbox",checked:$,onChange:y=>{y.stopPropagation(),J(a,y.target.checked)},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"})}),e.jsxs("div",{className:"aspect-video bg-gradient-to-br from-blue-500 to-purple-600 rounded-t-lg relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center",children:e.jsx(n,{className:"w-16 h-16 text-white/80"})}),e.jsxs("div",{className:"absolute top-2 left-8 flex gap-1",children:[l.slice(0,2).map(y=>{const W=de(y);return e.jsx("div",{className:"bg-white/90 backdrop-blur-sm p-1 rounded",title:y,children:e.jsx(W,{className:"w-3 h-3 text-gray-700"})},y)}),l.length>2&&e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm p-1 rounded text-xs text-gray-700",children:["+",l.length-2]})]}),N(parseInt(a.id))&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(oa,{className:"w-4 h-4 text-red-500 fill-current"})}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center gap-2",children:[e.jsx(x,{size:"sm",variant:"secondary",onClick:y=>{y.stopPropagation(),E(a,"play")},className:"bg-white/90 hover:bg-white text-gray-900",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx(x,{size:"sm",variant:"secondary",onClick:y=>{y.stopPropagation(),E(a,"shuffle")},className:"bg-white/90 hover:bg-white text-gray-900",children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsx(x,{size:"sm",variant:"secondary",onClick:y=>{y.stopPropagation(),s==null||s(a)},className:"bg-white/90 hover:bg-white text-gray-900",children:e.jsx(ke,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:a.name}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2",children:a.description})]}),e.jsxs("div",{className:"relative ml-2",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:y=>{y.stopPropagation(),j(_?null:a.id)},className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx(Z,{children:_&&e.jsx(z.div,{initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},transition:{duration:.15},className:"absolute right-0 mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>E(a,"duplicate"),className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(da,{className:"w-4 h-4"}),"Duplicate"]}),e.jsxs("button",{onClick:()=>E(a,"export"),className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{onClick:()=>E(a,"share"),className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(ma,{className:"w-4 h-4"}),"Share"]}),e.jsxs("button",{onClick:()=>{window.open(`/playlists/${a.id}`,"_blank")},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(xa,{className:"w-4 h-4"}),"Open in New Tab"]}),e.jsxs("button",{onClick:()=>E(a,"delete"),className:"w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Delete"]})]})})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-3 h-3"}),a.item_count," items"]}),a.total_duration&&a.total_duration>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-3 h-3"}),O(a.total_duration)]}),e.jsx("span",{children:a.is_public?"Public":"Private"}),e.jsx("span",{children:new Date(a.updated_at).toLocaleDateString()})]})]})]},a.id)};return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading playlists..."})}):r?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-4",children:"Failed to load playlists"}),e.jsx(x,{onClick:()=>d(),variant:"outline",children:"Try Again"})]}):e.jsxs("div",{className:`space-y-6 ${m}`,children:[e.jsx(Z,{children:U&&L&&e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:()=>i(!1),children:e.jsx(z.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"bg-white dark:bg-gray-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:e.jsx(De,{playlist:L,items:L.items||[],onClose:()=>i(!1)})})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Playlists"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:[q.length," playlist",q.length!==1?"s":""]})]}),e.jsxs(x,{onClick:t,className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Create Playlist"]})]}),M.size>0&&e.jsx(z.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-blue-800 dark:text-blue-200",children:[M.size," playlist",M.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>ee("export"),children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"Export Selected"]}),e.jsxs(x,{size:"sm",variant:"destructive",onClick:()=>ee("delete"),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Delete Selected"]})]})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(H,{placeholder:"Search playlists...",value:k,onChange:a=>p(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{value:v,onChange:a=>R(a),options:[{value:"all",label:"All Types"},{value:"music",label:"Music"},{value:"video",label:"Video"},{value:"image",label:"Images"},{value:"document",label:"Documents"}],className:"w-32"}),e.jsx(G,{value:T,onChange:a=>D(a),options:[{value:"all",label:"All"},{value:"public",label:"Public"},{value:"private",label:"Private"}],className:"w-32"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:C==="grid"?"secondary":"ghost",size:"sm",onClick:()=>A("grid"),children:e.jsx(we,{className:"w-4 h-4"})}),e.jsx(x,{variant:C==="list"?"secondary":"ghost",size:"sm",onClick:()=>A("list"),children:e.jsx($e,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(G,{value:f,onChange:a=>b(a),options:[{value:"name",label:"Name (A-Z)"},{value:"name_desc",label:"Name (Z-A)"},{value:"created_at",label:"Created"},{value:"updated_at",label:"Updated"},{value:"duration",label:"Duration"},{value:"item_count",label:"Items"}],className:"w-40"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:M.size===I.length&&I.length>0,onChange:o,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Select All"})]})]}),I.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(X,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:k||v!=="all"||T!=="all"?"No playlists found":"No playlists yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:k||v!=="all"||T!=="all"?"Try adjusting your filters or search terms":"Create your first playlist to start organizing your media"}),!k&&v==="all"&&T==="all"&&e.jsxs(x,{onClick:t,children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Create Playlist"]})]}):e.jsx("div",{className:C==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4":"space-y-2",children:e.jsx(Z,{mode:"popLayout",children:I.map(a=>C==="grid"?ie(a):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[a.item_count," items â€¢ ",O(a.total_duration||0)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>E(a,"play"),children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>s==null?void 0:s(a),children:e.jsx(ke,{className:"w-4 h-4"})})]})]})},a.id))})})]})},Pe=[{value:"media_type",label:"Media Type",icon:X},{value:"year",label:"Year",icon:Ie},{value:"rating",label:"Rating",icon:ua},{value:"quality",label:"Quality",icon:ze},{value:"genre",label:"Genre",icon:ha},{value:"created_at",label:"Date Added",icon:Te}],Ce=[{value:"equals",label:"Is",description:"Exactly matches the value"},{value:"not_equals",label:"Is not",description:"Does not match the value"},{value:"greater_than",label:"Greater than",description:"More than the value"},{value:"less_than",label:"Less than",description:"Less than the value"},{value:"contains",label:"Contains",description:"Contains the text"},{value:"starts_with",label:"Starts with",description:"Begins with the text"},{value:"ends_with",label:"Ends with",description:"Ends with the text"},{value:"in",label:"Is one of",description:"Matches any of the values"},{value:"not_in",label:"Is not one of",description:"Does not match any of the values"}],wa=[{value:"video",label:"Video",icon:Re},{value:"music",label:"Music",icon:X},{value:"image",label:"Image",icon:ge},{value:"document",label:"Document",icon:re}],ka=[{value:"cam",label:"CAM"},{value:"ts",label:"TS"},{value:"dvdrip",label:"DVDrip"},{value:"brrip",label:"BRRip"},{value:"720p",label:"720p"},{value:"1080p",label:"1080p"},{value:"4k",label:"4K"},{value:"hdr",label:"HDR"},{value:"dolby_vision",label:"Dolby Vision"}],_a=["Action","Comedy","Drama","Horror","Sci-Fi","Romance","Thriller","Documentary","Animation","Fantasy","Mystery","Adventure","Crime","Family","Biography","History","War","Western","Musical","Sport"],Sa=[{name:"Recently Added",description:"Items added in the last 30 days",rules:[{field:"created_at",operator:"greater_than",value:new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0],condition:"and"}]},{name:"High Rated Movies",description:"Movies with rating 8 or higher",rules:[{field:"media_type",operator:"equals",value:"video",condition:"and"},{field:"rating",operator:"greater_than",value:8,condition:"and"}]},{name:"HD Movies Only",description:"Movies in 1080p or higher quality",rules:[{field:"media_type",operator:"equals",value:"video",condition:"and"},{field:"quality",operator:"in",value:["1080p","4k","hdr","dolby_vision"],condition:"and"}]}],Pa=({onSave:t,onCancel:s,initialData:m,className:k=""})=>{const[p,C]=h.useState((m==null?void 0:m.name)||""),[A,f]=h.useState((m==null?void 0:m.description)||""),[b,v]=h.useState((m==null?void 0:m.rules)||[{field:"media_type",operator:"equals",value:"",condition:"and"}]),[R,T]=h.useState(new Set([0])),[D,L]=h.useState(!1),Q=()=>{const r={field:"media_type",operator:"equals",value:"",condition:"and"};v([...b,r]),T(new Set([...R,b.length]))},M=r=>{v(b.filter((d,N)=>N!==r)),T(new Set([...R].filter(d=>d!==r)))},w=(r,d)=>{v(b.map((N,I)=>I===r?{...N,...d}:N))},U=(r,d)=>{const N=d==="up"?r-1:r+1;if(N>=0&&N<b.length){const I=[...b];[I[r],I[N]]=[I[N],I[r]],v(I)}},i=r=>{T(d=>{const N=new Set(d);return N.has(r)?N.delete(r):N.add(r),N})},c=r=>{C(r.name),f(r.description),v(r.rules),T(new Set(r.rules.map((d,N)=>N)))},j=()=>{if(!p.trim())return"Playlist name is required";if(b.length===0)return"At least one rule is required";for(let r=0;r<b.length;r++){const d=b[r];if(!d.field||!d.operator)return`Rule ${r+1} is incomplete`;if(d.value===""||d.value===null||d.value===void 0)return`Rule ${r+1} has no value`}return null},q=()=>{const r=j();if(r){P.error(r);return}t(p,A,b)},S=(r,d)=>{const N=Pe.find(o=>o.value===r.field),I=Ce.find(o=>o.value===r.operator),E=R.has(d),J=()=>{switch(r.field){case"media_type":return e.jsxs(G,{value:String(r.value),onChange:o=>w(d,{value:o}),className:"flex-1",children:[e.jsx("option",{value:"",children:"Select media type..."}),wa.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]});case"quality":return e.jsxs(G,{value:Array.isArray(r.value)?r.value[0]:String(r.value),onChange:o=>w(d,{value:o}),className:"flex-1",children:[e.jsx("option",{value:"",children:"Select quality..."}),ka.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]});case"rating":return e.jsx(H,{type:"number",min:"0",max:"10",step:"0.1",value:String(r.value),onChange:o=>w(d,{value:parseFloat(o.target.value)||0}),placeholder:"Rating",className:"flex-1"});case"year":return e.jsx(H,{type:"number",min:"1900",max:"2030",value:String(r.value),onChange:o=>w(d,{value:parseInt(o.target.value)||0}),placeholder:"Year",className:"flex-1"});case"genre":return e.jsxs(G,{value:String(r.value),onChange:o=>w(d,{value:o}),className:"flex-1",children:[e.jsx("option",{value:"",children:"Select genre..."}),_a.map(o=>e.jsx("option",{value:o,children:o},o))]});case"created_at":return e.jsx(H,{type:"date",value:String(r.value),onChange:o=>w(d,{value:o.target.value}),className:"flex-1"});default:return e.jsx(H,{value:String(r.value||""),onChange:o=>w(d,{value:o.target.value}),placeholder:"Enter value...",className:"flex-1"})}};return e.jsx(z.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-1 pt-2",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>U(d,"up"),disabled:d===0,className:"p-1",children:e.jsx(_e,{className:"w-3 h-3"})}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>U(d,"down"),disabled:d===b.length-1,className:"p-1",children:e.jsx(Se,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[N&&e.jsx(N.icon,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:["Rule ",d+1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>i(d),className:"p-2",children:E?e.jsx(_e,{className:"w-4 h-4"}):e.jsx(Se,{className:"w-4 h-4"})}),b.length>1&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>M(d),className:"text-red-600 hover:text-red-700 p-2",children:e.jsx(ce,{className:"w-4 h-4"})})]})]}),e.jsx(Z,{children:E&&e.jsxs(z.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Field"}),e.jsx(G,{value:r.field,onChange:o=>w(d,{field:o,value:""}),children:Pe.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Condition"}),e.jsx(G,{value:r.operator,onChange:o=>w(d,{operator:o}),children:Ce.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))})]}),e.jsxs("div",{className:"flex-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Value"}),J()]})]}),I&&e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(ya,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:I.description})]}),D&&e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Logic:"}),e.jsxs(G,{value:r.condition,onChange:o=>w(d,{condition:o}),className:"w-20",children:[e.jsx("option",{value:"and",children:"AND"}),e.jsx("option",{value:"or",children:"OR"})]})]})})]})})]})]})})};return e.jsxs("div",{className:`space-y-6 ${k}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Smart Playlist Builder"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>L(!D),children:[e.jsx(ze,{className:"w-4 h-4"}),D?"Simple":"Advanced"]}),e.jsxs(x,{variant:"ghost",size:"sm",onClick:s,children:[e.jsx(ce,{className:"w-4 h-4"}),"Cancel"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Playlist Name"}),e.jsx(H,{value:p,onChange:r=>C(r.target.value),placeholder:"Enter playlist name...",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description (optional)"}),e.jsx(H,{value:A,onChange:r=>f(r.target.value),placeholder:"Describe your smart playlist...",className:"w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Quick Presets"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:Sa.map((r,d)=>e.jsxs(z.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>c(r),className:"text-left p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-blue-300 dark:hover:border-blue-600 transition-colors",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white mb-1",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.description})]},d))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Rules (",b.length,")"]}),e.jsxs(x,{onClick:Q,size:"sm",children:[e.jsx(oe,{className:"w-4 h-4"}),"Add Rule"]})]}),e.jsx("div",{className:"space-y-3",children:e.jsx(Z,{children:b.map((r,d)=>e.jsx("div",{children:S(r,d)},d))})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(x,{variant:"ghost",onClick:s,children:"Cancel"}),e.jsxs(x,{onClick:q,className:"min-w-32",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Save Playlist"]})]})]})},Ca=[{value:"all",label:"All Media"},{value:"music",label:"Music"},{value:"video",label:"Video"},{value:"image",label:"Images"},{value:"document",label:"Documents"}],Ia={music:X,video:Re,image:ge,document:re},Qa=()=>{const[t,s]=h.useState("all"),[m,k]=h.useState(!1),[p,C]=h.useState(!1),[A,f]=h.useState(null),[b,v]=h.useState(!1),[R,T]=h.useState(null),[D,L]=h.useState(""),[Q,M]=h.useState("all"),[w,U]=h.useState(""),[i,c]=h.useState([]),[j,q]=h.useState(!1),[S,r]=h.useState({name:"",description:"",is_public:!1,selectedItems:[]}),{playlists:d,refetchPlaylists:N}=Ee();ye.useMemo(()=>{let a=d;switch(t){case"my":a=a.filter(n=>!n.is_public);break;case"public":a=a.filter(n=>n.is_public);break;case"favorites":a=a.filter(()=>!1);break}return D&&(a=a.filter(n=>{var l;return n.name.toLowerCase().includes(D.toLowerCase())||((l=n.description)==null?void 0:l.toLowerCase().includes(D.toLowerCase()))})),Q!=="all"&&(a=a.filter(n=>n.primary_media_type===Q)),a},[d,t,D,Q]);const I=async()=>{try{const a={name:S.name,description:S.description,is_public:S.is_public,items:S.selectedItems},n=await V.createPlaylist(a);P.success(`Created playlist: ${n.name}`),k(!1),O(),N()}catch(a){console.error("Failed to create playlist:",a),P.error("Failed to create playlist")}},E=async()=>{if(A)try{const a={name:S.name,description:S.description,is_public:S.is_public},n=await V.updatePlaylist(A.id,a);P.success(`Updated playlist: ${n.name}`),C(!1),f(null),O(),N()}catch(a){console.error("Failed to update playlist:",a),P.error("Failed to update playlist")}},J=a=>{f(a),r({name:a.name,description:a.description||"",is_public:a.is_public,selectedItems:a.items||[]}),C(!0)},o=async()=>{if(!w.trim()){c([]);return}q(!0);try{const a=await ja.searchMedia({query:w,limit:20});c(a.items||[])}catch(a){console.error("Failed to search media:",a),P.error("Failed to search media items"),c([])}finally{q(!1)}},ee=a=>{if(S.selectedItems.some(l=>l.media_id===a.id)){P.error("This item is already in the playlist");return}const n={id:`temp-${Date.now()}`,playlist_id:(A==null?void 0:A.id)||"",media_id:a.id,position:S.selectedItems.length,added_at:new Date().toISOString(),media_item:{id:a.id,title:a.title,media_type:a.media_type,year:a.year,cover_image:a.cover_image,duration:a.duration,rating:a.rating,quality:a.quality,file_path:a.directory_path,thumbnail_url:a.cover_image}};r(l=>({...l,selectedItems:[...l.selectedItems,n]})),P.success(`Added "${a.title}" to playlist`)},O=()=>{r({name:"",description:"",is_public:!1,selectedItems:[]}),U(""),c([])},u=(a,n)=>{r(l=>({...l,[a]:n}))},ie=()=>{const a=p&&A,n=a?"Edit Playlist":"Create New Playlist";return e.jsx(z.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs(z.div,{initial:{y:20},animate:{y:0},className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:n}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{k(!1),C(!1),f(null),O()},children:e.jsx(ce,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Playlist Name *"}),e.jsx(H,{value:S.name,onChange:l=>u("name",l.target.value),placeholder:"Enter playlist name",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:S.description,onChange:l=>u("description",l.target.value),placeholder:"Enter playlist description (optional)",rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-white"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_public",checked:S.is_public,onChange:l=>u("is_public",l.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_public",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Make this playlist public"})]})]}),S.selectedItems.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Selected Items (",S.selectedItems.length,")"]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>u("selectedItems",[]),className:"text-red-600 hover:text-red-700",children:"Clear All"})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:S.selectedItems.map((l,_)=>{const $=me(l),y=de($.media_type);return e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 dark:bg-gray-800 rounded",children:[e.jsx(y,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:$.title}),$.artist&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate",children:$.artist})]}),e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{const W=S.selectedItems.filter((pe,ae)=>ae!==_);u("selectedItems",W)},className:"text-red-600 hover:text-red-700",children:e.jsx(ue,{className:"w-3 h-3"})})]},`${$.item_id}-${_}`)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Add Items to Playlist"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{placeholder:"Search media items...",className:"flex-1",value:w,onChange:l=>U(l.target.value),onKeyDown:l=>l.key==="Enter"&&o()}),e.jsx(x,{variant:"outline",onClick:o,disabled:j,children:e.jsx(he,{className:"w-4 h-4"})})]}),i.length>0&&e.jsx("div",{className:"mt-3 max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:i.map(l=>{const _=S.selectedItems.some(y=>y.media_id===l.id),$=Ia[l.media_type]||re;return e.jsxs("div",{className:`flex items-center justify-between p-2 hover:bg-gray-50 dark:hover:bg-gray-800 border-b border-gray-100 dark:border-gray-700 last:border-b-0 ${_?"bg-green-50 dark:bg-green-900/20":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx($,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium truncate",children:l.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[l.media_type," ",l.year&&`â€¢ ${l.year}`]})]})]}),e.jsx(x,{size:"sm",variant:_?"ghost":"outline",onClick:()=>ee(l),disabled:_,className:"flex-shrink-0 ml-2",children:_?"âœ“ Added":e.jsx(oe,{className:"w-4 h-4"})})]},l.id)})}),j&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"Searching..."}),w&&!j&&i.length===0&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"No results found. Try a different search term."})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3",children:[e.jsx(x,{variant:"outline",onClick:()=>{k(!1),C(!1),f(null),O()},children:"Cancel"}),e.jsxs(x,{onClick:a?E:I,disabled:!S.name.trim(),className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),a?"Update":"Create"," Playlist"]})]})]})})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(Ge,{title:"Playlists",subtitle:"Organize and manage your media collections",breadcrumbs:[{label:"Home",href:"/"},{label:"Playlists"}]}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(Ye,{tabs:[{id:"all",label:"All Playlists"},{id:"my",label:"My Playlists"},{id:"public",label:"Public"},{id:"favorites",label:"Favorites"},{id:"smart",label:"Smart Builder"}],activeTab:t,onChangeTab:a=>s(a)}),e.jsxs("div",{className:"mt-6 flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(H,{placeholder:"Search playlists...",value:D,onChange:a=>L(a.target.value),className:"pl-10"})]}),e.jsx(G,{value:Q,onChange:M,options:Ca,className:"w-40"})]}),e.jsxs(x,{onClick:()=>k(!0),className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Create Playlist"]})]}),e.jsx("div",{className:"mt-8",children:t==="smart"?e.jsx(Pa,{onSave:(a,n,l)=>{const _={name:a,description:n,is_public:!1,is_smart:!0,smart_rules:l,items:[]};V.createPlaylist(_).then($=>{P.success(`Created smart playlist: ${$.name}`),s("my"),N()}).catch($=>{console.error("Failed to create smart playlist:",$),P.error("Failed to create smart playlist")})},onCancel:()=>s("all"),className:"w-full"}):e.jsx(Na,{onCreatePlaylist:()=>k(!0),onEditPlaylist:J})}),e.jsx(Z,{children:(m||p)&&ie()}),e.jsx(Z,{children:b&&R&&e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:()=>v(!1),children:e.jsx(z.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"bg-white dark:bg-gray-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:e.jsx(De,{playlist:R,items:R.items||[],onClose:()=>v(!1)})})})})]})]})};export{Qa as PlaylistsPage};
//# sourceMappingURL=Playlists-CL-ws1RH.js.map
